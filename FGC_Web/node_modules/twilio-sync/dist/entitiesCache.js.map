{"version":3,"file":"entitiesCache.js","sources":["../src/entitiesCache.ts"],"sourcesContent":["import { SyncEntity } from './entity';\n\n/**\n * Container for entities which are known by the client\n * It's needed for deduplication when client obtain the same object several times\n */\nexport class EntitiesCache {\n  private readonly names: Map<string, string>;\n  private readonly entities: Map<string, SyncEntity>;\n\n  constructor() {\n    this.names = new Map<string, string>();\n    this.entities = new Map<string, SyncEntity>();\n  }\n\n  store<T extends SyncEntity>(entity: T): T {\n    let stored = this.entities.get(entity.sid);\n    if (stored) {\n      return stored as T;\n    }\n\n    this.entities.set(entity.sid, entity);\n    if (entity.uniqueName) {\n      this.names.set(entity.type + '::' + entity.uniqueName, entity.sid);\n    }\n    return entity;\n  }\n\n  protected getResolved(id: string, type: string): SyncEntity {\n    let resolvedSid = this.names.get(type + '::' + id);\n    return resolvedSid ? this.entities.get(resolvedSid) : null;\n  }\n\n  get(id: string, type: string): SyncEntity {\n    return this.entities.get(id) || this.getResolved(id, type) || null;\n  }\n\n  remove(sid: string): void {\n    let cached = this.entities.get(sid);\n    if (cached) {\n      this.entities.delete(sid);\n      if (cached.uniqueName) {\n        this.names.delete(cached.type + '::' + cached.uniqueName);\n      }\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;AAGG;MACU,aAAa,CAAA;AAIxB,IAAA,WAAA,GAAA;AACE,QAAA,IAAI,CAAC,KAAK,GAAG,IAAI,GAAG,EAAkB,CAAC;AACvC,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,EAAsB,CAAC;KAC/C;AAED,IAAA,KAAK,CAAuB,MAAS,EAAA;AACnC,QAAA,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC3C,QAAA,IAAI,MAAM,EAAE;AACV,YAAA,OAAO,MAAW,CAAC;AACpB,SAAA;QAED,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QACtC,IAAI,MAAM,CAAC,UAAU,EAAE;AACrB,YAAA,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,GAAG,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC;AACpE,SAAA;AACD,QAAA,OAAO,MAAM,CAAC;KACf;IAES,WAAW,CAAC,EAAU,EAAE,IAAY,EAAA;AAC5C,QAAA,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC,CAAC;AACnD,QAAA,OAAO,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC;KAC5D;IAED,GAAG,CAAC,EAAU,EAAE,IAAY,EAAA;AAC1B,QAAA,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,WAAW,CAAC,EAAE,EAAE,IAAI,CAAC,IAAI,IAAI,CAAC;KACpE;AAED,IAAA,MAAM,CAAC,GAAW,EAAA;QAChB,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AACpC,QAAA,IAAI,MAAM,EAAE;AACV,YAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YAC1B,IAAI,MAAM,CAAC,UAAU,EAAE;AACrB,gBAAA,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC;AAC3D,aAAA;AACF,SAAA;KACF;AACF;;;;"}