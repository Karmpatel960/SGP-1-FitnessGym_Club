{"version":3,"file":"websocketchannel.js","sources":["../src/websocketchannel.ts"],"sourcesContent":["import { Channel } from \"./interfaces/channel\";\nimport { EventEmitter } from \"events\";\nimport { log } from \"./logger\";\n\nclass WebSocketChannel extends EventEmitter implements Channel {\n  private readonly WebSocket;\n  private socket: WebSocket | null = null;\n\n  constructor(private readonly url: string) {\n    super();\n    this.url = url;\n    this.WebSocket =\n      global[\"WebSocket\"] || global[\"MozWebSocket\"] || require(\"ws\");\n  }\n\n  public get isConnected(): boolean {\n    return !!this.socket && this.socket.readyState === 1;\n  }\n\n  public connect(): void {\n    log.trace(\"connecting to socket\");\n\n    let socket;\n\n    try {\n      socket = new this.WebSocket(this.url);\n    } catch (e) {\n      log.debug(`Socket error: ${this.url}`);\n      this.emit(\"socketError\", e);\n      return;\n    }\n\n    socket.binaryType = \"arraybuffer\";\n\n    socket.onopen = () => {\n      log.debug(`socket opened ${this.url}`);\n      this.emit(\"connected\");\n    };\n\n    socket.onclose = (e) => {\n      log.debug(\"socket closed\", e);\n      this.emit(\"disconnected\", e);\n    };\n\n    socket.onerror = (e) => {\n      log.debug(\"Socket error:\", e);\n      this.emit(\"socketError\", e);\n    };\n\n    socket.onmessage = (message: MessageEvent) => {\n      this.emit(\"message\", message.data);\n    };\n\n    this.socket = socket;\n  }\n\n  public send(message: ArrayBuffer): void | null {\n    return this.socket && this.socket.send(message);\n  }\n\n  close(): void {\n    log.trace(\"closing socket\");\n\n    if (this.socket) {\n      this.socket.onopen = null;\n      this.socket.onclose = null;\n      this.socket.onerror = null;\n      this.socket.onmessage = null;\n      try {\n        this.socket.close();\n      } finally {\n      }\n    }\n  }\n}\n\nexport { WebSocketChannel };\n"],"names":["EventEmitter","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,MAAM,gBAAiB,SAAQA,+BAAY;IAIzC,YAA6B,GAAW;QACtC,KAAK,EAAE,CAAC;QADmB,QAAG,GAAH,GAAG,CAAQ;QAFhC,WAAM,GAAqB,IAAI,CAAC;QAItC,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,SAAS;YACZ,MAAM,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,cAAc,CAAC,IAAI,EAAa,CAAC;KAClE;IAED,IAAW,WAAW;QACpB,OAAO,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,UAAU,KAAK,CAAC,CAAC;KACtD;IAEM,OAAO;QACZC,UAAG,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;QAElC,IAAI,MAAM,CAAC;QAEX,IAAI;YACF,MAAM,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACvC;QAAC,OAAO,CAAC,EAAE;YACVA,UAAG,CAAC,KAAK,CAAC,iBAAiB,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;YACvC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;YAC5B,OAAO;SACR;QAED,MAAM,CAAC,UAAU,GAAG,aAAa,CAAC;QAElC,MAAM,CAAC,MAAM,GAAG;YACdA,UAAG,CAAC,KAAK,CAAC,iBAAiB,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;YACvC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;SACxB,CAAC;QAEF,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC;YACjBA,UAAG,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;YAC9B,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;SAC9B,CAAC;QAEF,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC;YACjBA,UAAG,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;YAC9B,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;SAC7B,CAAC;QAEF,MAAM,CAAC,SAAS,GAAG,CAAC,OAAqB;YACvC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;SACpC,CAAC;QAEF,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;KACtB;IAEM,IAAI,CAAC,OAAoB;QAC9B,OAAO,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACjD;IAED,KAAK;QACHA,UAAG,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;QAE5B,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;YAC1B,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;YAC7B,IAAI;gBACF,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;aACrB;oBAAS;aACT;SACF;KACF;;;;;"}