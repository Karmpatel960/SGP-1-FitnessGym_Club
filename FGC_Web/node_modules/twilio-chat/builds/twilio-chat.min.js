/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2019, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes q under the following license.

    Copyright 2009–2014 Kristopher Michael Kowal. All rights reserved.
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to
    deal in the Software without restriction, including without limitation the
    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
    sell copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
    IN THE SOFTWARE.

This software includes platform.js under the following license.

    Copyright 2014 Benjamin Tan <https://d10.github.io/>
    Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/
this.Twilio=this.Twilio||{},this.Twilio.Chat=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")(),s={},a=function(e){try{return!!e()}catch(e){return!0}},o=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u={},c={}.propertyIsEnumerable,l=Object.getOwnPropertyDescriptor,f=l&&!c.call({1:2},1);u.f=f?function(e){var t=l(this,e);return!!t&&t.enumerable}:c;var d,p,h=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},y={}.toString,v=function(e){return y.call(e).slice(8,-1)},m=v,g="".split,b=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==m(e)?g.call(e,""):Object(e)}:Object,k=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},w=b,x=k,_=function(e){return w(x(e))},S=function(e){return"object"==typeof e?null!==e:"function"==typeof e},E=i,T=function(e){return"function"==typeof e?e:void 0},R=function(e,t){return arguments.length<2?T(E[e]):E[e]&&E[e][t]},I=R("navigator","userAgent")||"",C=i,O=I,P=C.process,A=C.Deno,j=P&&P.versions||A&&A.version,M=j&&j.v8;M?p=(d=M.split("."))[0]<4?1:d[0]+d[1]:O&&(!(d=O.match(/Edge\/(\d+)/))||d[1]>=74)&&(d=O.match(/Chrome\/(\d+)/))&&(p=d[1]);var L=p&&+p,N=L,U=a,D=!!Object.getOwnPropertySymbols&&!U((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&N&&N<41})),F=D&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,B=R,q=F?function(e){return"symbol"==typeof e}:function(e){var t=B("Symbol");return"function"==typeof t&&Object(e)instanceof t},z=S,W={exports:{}},G=i,$=function(e,t){try{Object.defineProperty(G,e,{value:t,configurable:!0,writable:!0})}catch(n){G[e]=t}return t},J=$,V="__core-js_shared__",K=i[V]||J(V,{}),H=K;(W.exports=function(e,t){return H[e]||(H[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.17.3",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"});var Y=k,Q=function(e){return Object(Y(e))},X=Q,Z={}.hasOwnProperty,ee=Object.hasOwn||function(e,t){return Z.call(X(e),t)},te=0,ne=Math.random(),re=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++te+ne).toString(36)},ie=i,se=W.exports,ae=ee,oe=re,ue=D,ce=F,le=se("wks"),fe=ie.Symbol,de=ce?fe:fe&&fe.withoutSetter||oe,pe=function(e){return ae(le,e)&&(ue||"string"==typeof le[e])||(ue&&ae(fe,e)?le[e]=fe[e]:le[e]=de("Symbol."+e)),le[e]},he=S,ye=q,ve=function(e,t){var n,r;if("string"===t&&"function"==typeof(n=e.toString)&&!z(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!z(r=n.call(e)))return r;if("string"!==t&&"function"==typeof(n=e.toString)&&!z(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},me=pe("toPrimitive"),ge=function(e,t){if(!he(e)||ye(e))return e;var n,r=e[me];if(void 0!==r){if(void 0===t&&(t="default"),n=r.call(e,t),!he(n)||ye(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),ve(e,t)},be=ge,ke=q,we=function(e){var t=be(e,"string");return ke(t)?t:String(t)},xe=S,_e=i.document,Se=xe(_e)&&xe(_e.createElement),Ee=function(e){return Se?_e.createElement(e):{}},Te=Ee,Re=!o&&!a((function(){return 7!=Object.defineProperty(Te("div"),"a",{get:function(){return 7}}).a})),Ie=o,Ce=u,Oe=h,Pe=_,Ae=we,je=ee,Me=Re,Le=Object.getOwnPropertyDescriptor;s.f=Ie?Le:function(e,t){if(e=Pe(e),t=Ae(t),Me)try{return Le(e,t)}catch(e){}if(je(e,t))return Oe(!Ce.f.call(e,t),e[t])};var Ne={},Ue=S,De=function(e){if(!Ue(e))throw TypeError(String(e)+" is not an object");return e},Fe=o,Be=Re,qe=De,ze=we,We=Object.defineProperty;Ne.f=Fe?We:function(e,t,n){if(qe(e),t=ze(t),qe(n),Be)try{return We(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Ge=Ne,$e=h,Je=o?function(e,t,n){return Ge.f(e,t,$e(1,n))}:function(e,t,n){return e[t]=n,e},Ve={exports:{}},Ke=K,He=Function.toString;"function"!=typeof Ke.inspectSource&&(Ke.inspectSource=function(e){return He.call(e)});var Ye,Qe,Xe,Ze=Ke.inspectSource,et=Ze,tt=i.WeakMap,nt="function"==typeof tt&&/native code/.test(et(tt)),rt=W.exports,it=re,st=rt("keys"),at=function(e){return st[e]||(st[e]=it(e))},ot={},ut=nt,ct=S,lt=Je,ft=ee,dt=K,pt=at,ht=ot,yt="Object already initialized",vt=i.WeakMap;if(ut||dt.state){var mt=dt.state||(dt.state=new vt),gt=mt.get,bt=mt.has,kt=mt.set;Ye=function(e,t){if(bt.call(mt,e))throw new TypeError(yt);return t.facade=e,kt.call(mt,e,t),t},Qe=function(e){return gt.call(mt,e)||{}},Xe=function(e){return bt.call(mt,e)}}else{var wt=pt("state");ht[wt]=!0,Ye=function(e,t){if(ft(e,wt))throw new TypeError(yt);return t.facade=e,lt(e,wt,t),t},Qe=function(e){return ft(e,wt)?e[wt]:{}},Xe=function(e){return ft(e,wt)}}var xt={set:Ye,get:Qe,has:Xe,enforce:function(e){return Xe(e)?Qe(e):Ye(e,{})},getterFor:function(e){return function(t){var n;if(!ct(t)||(n=Qe(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},_t=i,St=Je,Et=ee,Tt=$,Rt=Ze,It=xt.get,Ct=xt.enforce,Ot=String(String).split("String");(Ve.exports=function(e,t,n,r){var i,s=!!r&&!!r.unsafe,a=!!r&&!!r.enumerable,o=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||Et(n,"name")||St(n,"name",t),(i=Ct(n)).source||(i.source=Ot.join("string"==typeof t?t:""))),e!==_t?(s?!o&&e[t]&&(a=!0):delete e[t],a?e[t]=n:St(e,t,n)):a?e[t]=n:Tt(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&It(this).source||Rt(this)}));var Pt={},At=Math.ceil,jt=Math.floor,Mt=function(e){return isNaN(e=+e)?0:(e>0?jt:At)(e)},Lt=Mt,Nt=Math.min,Ut=function(e){return e>0?Nt(Lt(e),9007199254740991):0},Dt=Mt,Ft=Math.max,Bt=Math.min,qt=function(e,t){var n=Dt(e);return n<0?Ft(n+t,0):Bt(n,t)},zt=_,Wt=Ut,Gt=qt,$t=function(e){return function(t,n,r){var i,s=zt(t),a=Wt(s.length),o=Gt(r,a);if(e&&n!=n){for(;a>o;)if((i=s[o++])!=i)return!0}else for(;a>o;o++)if((e||o in s)&&s[o]===n)return e||o||0;return!e&&-1}},Jt={includes:$t(!0),indexOf:$t(!1)},Vt=ee,Kt=_,Ht=Jt.indexOf,Yt=ot,Qt=function(e,t){var n,r=Kt(e),i=0,s=[];for(n in r)!Vt(Yt,n)&&Vt(r,n)&&s.push(n);for(;t.length>i;)Vt(r,n=t[i++])&&(~Ht(s,n)||s.push(n));return s},Xt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zt=Qt,en=Xt.concat("length","prototype");Pt.f=Object.getOwnPropertyNames||function(e){return Zt(e,en)};var tn={};tn.f=Object.getOwnPropertySymbols;var nn,rn=Pt,sn=tn,an=De,on=R("Reflect","ownKeys")||function(e){var t=rn.f(an(e)),n=sn.f;return n?t.concat(n(e)):t},un=ee,cn=on,ln=s,fn=Ne,dn=function(e,t){for(var n=cn(t),r=fn.f,i=ln.f,s=0;s<n.length;s++){var a=n[s];un(e,a)||r(e,a,i(t,a))}},pn=a,hn=/#|\.prototype\./,yn=function(e,t){var n=mn[vn(e)];return n==bn||n!=gn&&("function"==typeof t?pn(t):!!t)},vn=yn.normalize=function(e){return String(e).replace(hn,".").toLowerCase()},mn=yn.data={},gn=yn.NATIVE="N",bn=yn.POLYFILL="P",kn=yn,wn=i,xn=s.f,_n=Je,Sn=Ve.exports,En=$,Tn=dn,Rn=kn,In=function(e,t){var n,r,i,s,a,o=e.target,u=e.global,c=e.stat;if(n=u?wn:c?wn[o]||En(o,{}):(wn[o]||{}).prototype)for(r in t){if(s=t[r],i=e.noTargetGet?(a=xn(n,r))&&a.value:n[r],!Rn(u?r:o+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof s==typeof i)continue;Tn(s,i)}(e.sham||i&&i.sham)&&_n(s,"sham",!0),Sn(n,r,s,e)}},Cn=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},On=Qt,Pn=Xt,An=Object.keys||function(e){return On(e,Pn)},jn=Ne,Mn=De,Ln=An,Nn=o?Object.defineProperties:function(e,t){Mn(e);for(var n,r=Ln(t),i=r.length,s=0;i>s;)jn.f(e,n=r[s++],t[n]);return e},Un=R("document","documentElement"),Dn=De,Fn=Nn,Bn=Xt,qn=ot,zn=Un,Wn=Ee,Gn=at("IE_PROTO"),$n=function(){},Jn=function(e){return"<script>"+e+"</"+"script>"},Vn=function(e){e.write(Jn("")),e.close();var t=e.parentWindow.Object;return e=null,t},Kn=function(){try{nn=new ActiveXObject("htmlfile")}catch(e){}var e,t;Kn="undefined"!=typeof document?document.domain&&nn?Vn(nn):((t=Wn("iframe")).style.display="none",zn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Jn("document.F=Object")),e.close(),e.F):Vn(nn);for(var n=Bn.length;n--;)delete Kn.prototype[Bn[n]];return Kn()};qn[Gn]=!0;var Hn=Object.create||function(e,t){var n;return null!==e?($n.prototype=Dn(e),n=new $n,$n.prototype=null,n[Gn]=e):n=Kn(),void 0===t?n:Fn(n,t)},Yn=Cn,Qn=S,Xn=[].slice,Zn={},er=function(e,t,n){if(!(t in Zn)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";Zn[t]=Function("C,a","return new C("+r.join(",")+")")}return Zn[t](e,n)},tr=Function.bind||function(e){var t=Yn(this),n=Xn.call(arguments,1),r=function(){var i=n.concat(Xn.call(arguments));return this instanceof r?er(t,i.length,i):t.apply(e,i)};return Qn(t.prototype)&&(r.prototype=t.prototype),r},nr=In,rr=Cn,ir=De,sr=S,ar=Hn,or=tr,ur=a,cr=R("Reflect","construct"),lr=ur((function(){function e(){}return!(cr((function(){}),[],e)instanceof e)})),fr=!ur((function(){cr((function(){}))})),dr=lr||fr;nr({target:"Reflect",stat:!0,forced:dr,sham:dr},{construct:function(e,t){rr(e),ir(t);var n=arguments.length<3?e:rr(arguments[2]);if(fr&&!lr)return cr(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(or.apply(e,r))}var i=n.prototype,s=ar(sr(i)?i:Object.prototype),a=Function.apply.call(e,s,t);return sr(a)?a:s}});var pr=Q,hr=An;In({target:"Object",stat:!0,forced:a((function(){hr(1)}))},{keys:function(e){return hr(pr(e))}});var yr=v,vr=Array.isArray||function(e){return"Array"==yr(e)},mr=q,gr=function(e){if(mr(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},br={},kr=_,wr=Pt.f,xr={}.toString,_r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];br.f=function(e){return _r&&"[object Window]"==xr.call(e)?function(e){try{return wr(e)}catch(e){return _r.slice()}}(e):wr(kr(e))};var Sr={},Er=pe;Sr.f=Er;var Tr=i,Rr=ee,Ir=Sr,Cr=Ne.f,Or=function(e){var t=Tr.Symbol||(Tr.Symbol={});Rr(t,e)||Cr(t,e,{value:Ir.f(e)})},Pr=Ne.f,Ar=ee,jr=pe("toStringTag"),Mr=function(e,t,n){e&&!Ar(e=n?e:e.prototype,jr)&&Pr(e,jr,{configurable:!0,value:t})},Lr=Cn,Nr=function(e,t,n){if(Lr(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},Ur=S,Dr=vr,Fr=pe("species"),Br=function(e){var t;return Dr(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!Dr(t.prototype)?Ur(t)&&null===(t=t[Fr])&&(t=void 0):t=void 0),void 0===t?Array:t},qr=function(e,t){return new(Br(e))(0===t?0:t)},zr=Nr,Wr=b,Gr=Q,$r=Ut,Jr=qr,Vr=[].push,Kr=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,s=6==e,a=7==e,o=5==e||s;return function(u,c,l,f){for(var d,p,h=Gr(u),y=Wr(h),v=zr(c,l,3),m=$r(y.length),g=0,b=f||Jr,k=t?b(u,m):n||a?b(u,0):void 0;m>g;g++)if((o||g in y)&&(p=v(d=y[g],g,h),e))if(t)k[g]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return g;case 2:Vr.call(k,d)}else switch(e){case 4:return!1;case 7:Vr.call(k,d)}return s?-1:r||i?i:k}},Hr={forEach:Kr(0),map:Kr(1),filter:Kr(2),some:Kr(3),every:Kr(4),find:Kr(5),findIndex:Kr(6),filterReject:Kr(7)},Yr=In,Qr=i,Xr=R,Zr=o,ei=D,ti=a,ni=ee,ri=vr,ii=S,si=q,ai=De,oi=Q,ui=_,ci=we,li=gr,fi=h,di=Hn,pi=An,hi=Pt,yi=br,vi=tn,mi=s,gi=Ne,bi=u,ki=Je,wi=Ve.exports,xi=W.exports,_i=ot,Si=re,Ei=pe,Ti=Sr,Ri=Or,Ii=Mr,Ci=xt,Oi=Hr.forEach,Pi=at("hidden"),Ai="Symbol",ji=Ei("toPrimitive"),Mi=Ci.set,Li=Ci.getterFor(Ai),Ni=Object.prototype,Ui=Qr.Symbol,Di=Xr("JSON","stringify"),Fi=mi.f,Bi=gi.f,qi=yi.f,zi=bi.f,Wi=xi("symbols"),Gi=xi("op-symbols"),$i=xi("string-to-symbol-registry"),Ji=xi("symbol-to-string-registry"),Vi=xi("wks"),Ki=Qr.QObject,Hi=!Ki||!Ki.prototype||!Ki.prototype.findChild,Yi=Zr&&ti((function(){return 7!=di(Bi({},"a",{get:function(){return Bi(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Fi(Ni,t);r&&delete Ni[t],Bi(e,t,n),r&&e!==Ni&&Bi(Ni,t,r)}:Bi,Qi=function(e,t){var n=Wi[e]=di(Ui.prototype);return Mi(n,{type:Ai,tag:e,description:t}),Zr||(n.description=t),n},Xi=function(e,t,n){e===Ni&&Xi(Gi,t,n),ai(e);var r=ci(t);return ai(n),ni(Wi,r)?(n.enumerable?(ni(e,Pi)&&e[Pi][r]&&(e[Pi][r]=!1),n=di(n,{enumerable:fi(0,!1)})):(ni(e,Pi)||Bi(e,Pi,fi(1,{})),e[Pi][r]=!0),Yi(e,r,n)):Bi(e,r,n)},Zi=function(e,t){ai(e);var n=ui(t),r=pi(n).concat(rs(n));return Oi(r,(function(t){Zr&&!es.call(n,t)||Xi(e,t,n[t])})),e},es=function(e){var t=ci(e),n=zi.call(this,t);return!(this===Ni&&ni(Wi,t)&&!ni(Gi,t))&&(!(n||!ni(this,t)||!ni(Wi,t)||ni(this,Pi)&&this[Pi][t])||n)},ts=function(e,t){var n=ui(e),r=ci(t);if(n!==Ni||!ni(Wi,r)||ni(Gi,r)){var i=Fi(n,r);return!i||!ni(Wi,r)||ni(n,Pi)&&n[Pi][r]||(i.enumerable=!0),i}},ns=function(e){var t=qi(ui(e)),n=[];return Oi(t,(function(e){ni(Wi,e)||ni(_i,e)||n.push(e)})),n},rs=function(e){var t=e===Ni,n=qi(t?Gi:ui(e)),r=[];return Oi(n,(function(e){!ni(Wi,e)||t&&!ni(Ni,e)||r.push(Wi[e])})),r};(ei||(wi((Ui=function(){if(this instanceof Ui)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?li(arguments[0]):void 0,t=Si(e),n=function(e){this===Ni&&n.call(Gi,e),ni(this,Pi)&&ni(this[Pi],t)&&(this[Pi][t]=!1),Yi(this,t,fi(1,e))};return Zr&&Hi&&Yi(Ni,t,{configurable:!0,set:n}),Qi(t,e)}).prototype,"toString",(function(){return Li(this).tag})),wi(Ui,"withoutSetter",(function(e){return Qi(Si(e),e)})),bi.f=es,gi.f=Xi,mi.f=ts,hi.f=yi.f=ns,vi.f=rs,Ti.f=function(e){return Qi(Ei(e),e)},Zr&&(Bi(Ui.prototype,"description",{configurable:!0,get:function(){return Li(this).description}}),wi(Ni,"propertyIsEnumerable",es,{unsafe:!0}))),Yr({global:!0,wrap:!0,forced:!ei,sham:!ei},{Symbol:Ui}),Oi(pi(Vi),(function(e){Ri(e)})),Yr({target:Ai,stat:!0,forced:!ei},{for:function(e){var t=li(e);if(ni($i,t))return $i[t];var n=Ui(t);return $i[t]=n,Ji[n]=t,n},keyFor:function(e){if(!si(e))throw TypeError(e+" is not a symbol");if(ni(Ji,e))return Ji[e]},useSetter:function(){Hi=!0},useSimple:function(){Hi=!1}}),Yr({target:"Object",stat:!0,forced:!ei,sham:!Zr},{create:function(e,t){return void 0===t?di(e):Zi(di(e),t)},defineProperty:Xi,defineProperties:Zi,getOwnPropertyDescriptor:ts}),Yr({target:"Object",stat:!0,forced:!ei},{getOwnPropertyNames:ns,getOwnPropertySymbols:rs}),Yr({target:"Object",stat:!0,forced:ti((function(){vi.f(1)}))},{getOwnPropertySymbols:function(e){return vi.f(oi(e))}}),Di)&&Yr({target:"JSON",stat:!0,forced:!ei||ti((function(){var e=Ui();return"[null]"!=Di([e])||"{}"!=Di({a:e})||"{}"!=Di(Object(e))}))},{stringify:function(e,t,n){for(var r,i=[e],s=1;arguments.length>s;)i.push(arguments[s++]);if(r=t,(ii(t)||void 0!==e)&&!si(e))return ri(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!si(t))return t}),i[1]=t,Di.apply(null,i)}});Ui.prototype[ji]||ki(Ui.prototype,ji,Ui.prototype.valueOf),Ii(Ui,Ai),_i[Pi]=!0;var is=a,ss=L,as=pe("species"),os=function(e){return ss>=51||!is((function(){var t=[];return(t.constructor={})[as]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},us=Hr.filter;In({target:"Array",proto:!0,forced:!os("filter")},{filter:function(e){return us(this,e,arguments.length>1?arguments[1]:void 0)}});var cs=In,ls=a,fs=_,ds=s.f,ps=o,hs=ls((function(){ds(1)}));cs({target:"Object",stat:!0,forced:!ps||hs,sham:!ps},{getOwnPropertyDescriptor:function(e,t){return ds(fs(e),t)}});var ys=we,vs=Ne,ms=h,gs=function(e,t,n){var r=ys(t);r in e?vs.f(e,r,ms(0,n)):e[r]=n},bs=on,ks=_,ws=s,xs=gs;function _s(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function Ss(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){_s(s,r,i,a,o,"next",e)}function o(e){_s(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Es(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ts(e,t,n){return t&&Es(e.prototype,t),n&&Es(e,n),e}function Rs(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Is(e,t){return(Is=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Cs(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Is(e,t)}function Os(e){return(Os="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ps(e,t){return!t||"object"!==Os(t)&&"function"!=typeof t?Rs(e):t}function As(e){return(As=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function js(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ms(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}In({target:"Object",stat:!0,sham:!o},{getOwnPropertyDescriptors:function(e){for(var t,n,r=ks(e),i=ws.f,s=bs(r),a={},o=0;s.length>o;)void 0!==(n=i(r,t=s[o++]))&&xs(a,t,n);return a}});var Ls={};Ls[pe("toStringTag")]="z";var Ns="[object z]"===String(Ls),Us=Ns,Ds=v,Fs=pe("toStringTag"),Bs="Arguments"==Ds(function(){return arguments}()),qs=Us?Ds:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Fs))?n:Bs?Ds(t):"Object"==(r=Ds(t))&&"function"==typeof t.callee?"Arguments":r},zs=qs,Ws=Ns?{}.toString:function(){return"[object "+zs(this)+"]"},Gs=Ns,$s=Ve.exports,Js=Ws;Gs||$s(Object.prototype,"toString",Js,{unsafe:!0});var Vs=i.Promise,Ks=Ve.exports,Hs=function(e,t,n){for(var r in t)Ks(e,r,t[r],n);return e},Ys=S,Qs=De,Xs=function(e){if(!Ys(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},Zs=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Qs(n),Xs(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),ea=R,ta=Ne,na=o,ra=pe("species"),ia=function(e){var t=ea(e),n=ta.f;na&&t&&!t[ra]&&n(t,ra,{configurable:!0,get:function(){return this}})},sa=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},aa={},oa=aa,ua=pe("iterator"),ca=Array.prototype,la=function(e){return void 0!==e&&(oa.Array===e||ca[ua]===e)},fa=qs,da=aa,pa=pe("iterator"),ha=function(e){if(null!=e)return e[pa]||e["@@iterator"]||da[fa(e)]},ya=De,va=ha,ma=function(e,t){var n=arguments.length<2?va(e):t;if("function"!=typeof n)throw TypeError(String(e)+" is not iterable");return ya(n.call(e))},ga=De,ba=function(e,t,n){var r,i;ga(e);try{if(void 0===(r=e.return)){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return ga(r),n},ka=De,wa=la,xa=Ut,_a=Nr,Sa=ma,Ea=ha,Ta=ba,Ra=function(e,t){this.stopped=e,this.result=t},Ia=function(e,t,n){var r,i,s,a,o,u,c,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),h=_a(t,l,1+f+p),y=function(e){return r&&Ta(r,"normal",e),new Ra(!0,e)},v=function(e){return f?(ka(e),p?h(e[0],e[1],y):h(e[0],e[1])):p?h(e,y):h(e)};if(d)r=e;else{if("function"!=typeof(i=Ea(e)))throw TypeError("Target is not iterable");if(wa(i)){for(s=0,a=xa(e.length);a>s;s++)if((o=v(e[s]))&&o instanceof Ra)return o;return new Ra(!1)}r=Sa(e,i)}for(u=r.next;!(c=u.call(r)).done;){try{o=v(c.value)}catch(e){Ta(r,"throw",e)}if("object"==typeof o&&o&&o instanceof Ra)return o}return new Ra(!1)},Ca=pe("iterator"),Oa=!1;try{var Pa=0,Aa={next:function(){return{done:!!Pa++}},return:function(){Oa=!0}};Aa[Ca]=function(){return this},Array.from(Aa,(function(){throw 2}))}catch(e){}var ja,Ma,La,Na,Ua=function(e,t){if(!t&&!Oa)return!1;var n=!1;try{var r={};r[Ca]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Da=De,Fa=Cn,Ba=pe("species"),qa=function(e,t){var n,r=Da(e).constructor;return void 0===r||null==(n=Da(r)[Ba])?t:Fa(n)},za=/(?:ipad|iphone|ipod).*applewebkit/i.test(I),Wa="process"==v(i.process),Ga=i,$a=a,Ja=Nr,Va=Un,Ka=Ee,Ha=za,Ya=Wa,Qa=Ga.setImmediate,Xa=Ga.clearImmediate,Za=Ga.process,eo=Ga.MessageChannel,to=Ga.Dispatch,no=0,ro={},io="onreadystatechange";try{ja=Ga.location}catch(e){}var so=function(e){if(ro.hasOwnProperty(e)){var t=ro[e];delete ro[e],t()}},ao=function(e){return function(){so(e)}},oo=function(e){so(e.data)},uo=function(e){Ga.postMessage(String(e),ja.protocol+"//"+ja.host)};Qa&&Xa||(Qa=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return ro[++no]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Ma(no),no},Xa=function(e){delete ro[e]},Ya?Ma=function(e){Za.nextTick(ao(e))}:to&&to.now?Ma=function(e){to.now(ao(e))}:eo&&!Ha?(Na=(La=new eo).port2,La.port1.onmessage=oo,Ma=Ja(Na.postMessage,Na,1)):Ga.addEventListener&&"function"==typeof postMessage&&!Ga.importScripts&&ja&&"file:"!==ja.protocol&&!$a(uo)?(Ma=uo,Ga.addEventListener("message",oo,!1)):Ma=io in Ka("script")?function(e){Va.appendChild(Ka("script")).onreadystatechange=function(){Va.removeChild(this),so(e)}}:function(e){setTimeout(ao(e),0)});var co,lo,fo,po,ho,yo,vo,mo,go={set:Qa,clear:Xa},bo=i,ko=/ipad|iphone|ipod/i.test(I)&&void 0!==bo.Pebble,wo=/web0s(?!.*chrome)/i.test(I),xo=i,_o=s.f,So=go.set,Eo=za,To=ko,Ro=wo,Io=Wa,Co=xo.MutationObserver||xo.WebKitMutationObserver,Oo=xo.document,Po=xo.process,Ao=xo.Promise,jo=_o(xo,"queueMicrotask"),Mo=jo&&jo.value;Mo||(co=function(){var e,t;for(Io&&(e=Po.domain)&&e.exit();lo;){t=lo.fn,lo=lo.next;try{t()}catch(e){throw lo?po():fo=void 0,e}}fo=void 0,e&&e.enter()},Eo||Io||Ro||!Co||!Oo?!To&&Ao&&Ao.resolve?((vo=Ao.resolve(void 0)).constructor=Ao,mo=vo.then,po=function(){mo.call(vo,co)}):po=Io?function(){Po.nextTick(co)}:function(){So.call(xo,co)}:(ho=!0,yo=Oo.createTextNode(""),new Co(co).observe(yo,{characterData:!0}),po=function(){yo.data=ho=!ho}));var Lo=Mo||function(e){var t={fn:e,next:void 0};fo&&(fo.next=t),lo||(lo=t,po()),fo=t},No={},Uo=Cn,Do=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Uo(t),this.reject=Uo(n)};No.f=function(e){return new Do(e)};var Fo,Bo,qo,zo,Wo=De,Go=S,$o=No,Jo=i,Vo="object"==typeof window,Ko=In,Ho=i,Yo=R,Qo=Vs,Xo=Ve.exports,Zo=Hs,eu=Zs,tu=Mr,nu=ia,ru=S,iu=Cn,su=sa,au=Ze,ou=Ia,uu=Ua,cu=qa,lu=go.set,fu=Lo,du=function(e,t){if(Wo(e),Go(t)&&t.constructor===e)return t;var n=$o.f(e);return(0,n.resolve)(t),n.promise},pu=function(e,t){var n=Jo.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},hu=No,yu=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},vu=xt,mu=kn,gu=Vo,bu=Wa,ku=L,wu=pe("species"),xu="Promise",_u=vu.get,Su=vu.set,Eu=vu.getterFor(xu),Tu=Qo&&Qo.prototype,Ru=Qo,Iu=Tu,Cu=Ho.TypeError,Ou=Ho.document,Pu=Ho.process,Au=hu.f,ju=Au,Mu=!!(Ou&&Ou.createEvent&&Ho.dispatchEvent),Lu="function"==typeof PromiseRejectionEvent,Nu="unhandledrejection",Uu=!1,Du=mu(xu,(function(){var e=au(Ru),t=e!==String(Ru);if(!t&&66===ku)return!0;if(ku>=51&&/native code/.test(e))return!1;var n=new Ru((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[wu]=r,!(Uu=n.then((function(){}))instanceof r)||!t&&gu&&!Lu})),Fu=Du||!uu((function(e){Ru.all(e).catch((function(){}))})),Bu=function(e){var t;return!(!ru(e)||"function"!=typeof(t=e.then))&&t},qu=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;fu((function(){for(var r=e.value,i=1==e.state,s=0;n.length>s;){var a,o,u,c=n[s++],l=i?c.ok:c.fail,f=c.resolve,d=c.reject,p=c.domain;try{l?(i||(2===e.rejection&&$u(e),e.rejection=1),!0===l?a=r:(p&&p.enter(),a=l(r),p&&(p.exit(),u=!0)),a===c.promise?d(Cu("Promise-chain cycle")):(o=Bu(a))?o.call(a,f,d):f(a)):d(r)}catch(e){p&&!u&&p.exit(),d(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Wu(e)}))}},zu=function(e,t,n){var r,i;Mu?((r=Ou.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Ho.dispatchEvent(r)):r={promise:t,reason:n},!Lu&&(i=Ho["on"+e])?i(r):e===Nu&&pu("Unhandled promise rejection",n)},Wu=function(e){lu.call(Ho,(function(){var t,n=e.facade,r=e.value;if(Gu(e)&&(t=yu((function(){bu?Pu.emit("unhandledRejection",r,n):zu(Nu,n,r)})),e.rejection=bu||Gu(e)?2:1,t.error))throw t.value}))},Gu=function(e){return 1!==e.rejection&&!e.parent},$u=function(e){lu.call(Ho,(function(){var t=e.facade;bu?Pu.emit("rejectionHandled",t):zu("rejectionhandled",t,e.value)}))},Ju=function(e,t,n){return function(r){e(t,r,n)}},Vu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,qu(e,!0))},Ku=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Cu("Promise can't be resolved itself");var r=Bu(t);r?fu((function(){var n={done:!1};try{r.call(t,Ju(Ku,n,e),Ju(Vu,n,e))}catch(t){Vu(n,t,e)}})):(e.value=t,e.state=1,qu(e,!1))}catch(t){Vu({done:!1},t,e)}}};if(Du&&(Iu=(Ru=function(e){su(this,Ru,xu),iu(e),Fo.call(this);var t=_u(this);try{e(Ju(Ku,t),Ju(Vu,t))}catch(e){Vu(t,e)}}).prototype,(Fo=function(e){Su(this,{type:xu,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Zo(Iu,{then:function(e,t){var n=Eu(this),r=Au(cu(this,Ru));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=bu?Pu.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&qu(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Bo=function(){var e=new Fo,t=_u(e);this.promise=e,this.resolve=Ju(Ku,t),this.reject=Ju(Vu,t)},hu.f=Au=function(e){return e===Ru||e===qo?new Bo(e):ju(e)},"function"==typeof Qo&&Tu!==Object.prototype)){zo=Tu.then,Uu||(Xo(Tu,"then",(function(e,t){var n=this;return new Ru((function(e,t){zo.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Xo(Tu,"catch",Iu.catch,{unsafe:!0}));try{delete Tu.constructor}catch(e){}eu&&eu(Tu,Iu)}Ko({global:!0,wrap:!0,forced:Du},{Promise:Ru}),tu(Ru,xu,!1),nu(xu),qo=Yo(xu),Ko({target:xu,stat:!0,forced:Du},{reject:function(e){var t=Au(this);return t.reject.call(void 0,e),t.promise}}),Ko({target:xu,stat:!0,forced:Du},{resolve:function(e){return du(this,e)}}),Ko({target:xu,stat:!0,forced:Fu},{all:function(e){var t=this,n=Au(t),r=n.resolve,i=n.reject,s=yu((function(){var n=iu(t.resolve),s=[],a=0,o=1;ou(e,(function(e){var u=a++,c=!1;s.push(void 0),o++,n.call(t,e).then((function(e){c||(c=!0,s[u]=e,--o||r(s))}),i)})),--o||r(s)}));return s.error&&i(s.value),n.promise},race:function(e){var t=this,n=Au(t),r=n.reject,i=yu((function(){var i=iu(t.resolve);ou(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Hu={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Yu=Ee("span").classList,Qu=Yu&&Yu.constructor&&Yu.constructor.prototype,Xu=Qu===Object.prototype?void 0:Qu,Zu=a,ec=function(e,t){var n=[][e];return!!n&&Zu((function(){n.call(null,t||function(){throw 1},1)}))},tc=Hr.forEach,nc=i,rc=Hu,ic=Xu,sc=ec("forEach")?[].forEach:function(e){return tc(this,e,arguments.length>1?arguments[1]:void 0)},ac=Je,oc=function(e){if(e&&e.forEach!==sc)try{ac(e,"forEach",sc)}catch(t){e.forEach=sc}};for(var uc in rc)oc(nc[uc]&&nc[uc].prototype);oc(ic);var cc=De,lc=ba,fc=Nr,dc=Q,pc=function(e,t,n,r){try{return r?t(cc(n)[0],n[1]):t(n)}catch(t){lc(e,"throw",t)}},hc=la,yc=Ut,vc=gs,mc=ma,gc=ha,bc=function(e){var t,n,r,i,s,a,o=dc(e),u="function"==typeof this?this:Array,c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,d=gc(o),p=0;if(f&&(l=fc(l,c>2?arguments[2]:void 0,2)),null==d||u==Array&&hc(d))for(n=new u(t=yc(o.length));t>p;p++)a=f?l(o[p],p):o[p],vc(n,p,a);else for(s=(i=mc(o,d)).next,n=new u;!(r=s.call(i)).done;p++)a=f?pc(i,l,[r.value,p],!0):r.value,vc(n,p,a);return n.length=p,n},kc=bc;In({target:"Array",stat:!0,forced:!Ua((function(e){Array.from(e)}))},{from:kc});var wc,xc,_c,Sc=Mt,Ec=gr,Tc=k,Rc=function(e){return function(t,n){var r,i,s=Ec(Tc(t)),a=Sc(n),o=s.length;return a<0||a>=o?e?"":void 0:(r=s.charCodeAt(a))<55296||r>56319||a+1===o||(i=s.charCodeAt(a+1))<56320||i>57343?e?s.charAt(a):r:e?s.slice(a,a+2):i-56320+(r-55296<<10)+65536}},Ic={codeAt:Rc(!1),charAt:Rc(!0)},Cc=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Oc=ee,Pc=Q,Ac=Cc,jc=at("IE_PROTO"),Mc=Object.prototype,Lc=Ac?Object.getPrototypeOf:function(e){return e=Pc(e),Oc(e,jc)?e[jc]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Mc:null},Nc=a,Uc=Lc,Dc=Je,Fc=pe("iterator"),Bc=!1;[].keys&&("next"in(_c=[].keys())?(xc=Uc(Uc(_c)))!==Object.prototype&&(wc=xc):Bc=!0),(null==wc||Nc((function(){var e={};return wc[Fc].call(e)!==e})))&&(wc={}),"function"!=typeof wc[Fc]&&Dc(wc,Fc,(function(){return this}));var qc={IteratorPrototype:wc,BUGGY_SAFARI_ITERATORS:Bc},zc=qc.IteratorPrototype,Wc=Hn,Gc=h,$c=Mr,Jc=aa,Vc=function(){return this},Kc=function(e,t,n){var r=t+" Iterator";return e.prototype=Wc(zc,{next:Gc(1,n)}),$c(e,r,!1),Jc[r]=Vc,e},Hc=In,Yc=Kc,Qc=Lc,Xc=Zs,Zc=Mr,el=Je,tl=Ve.exports,nl=aa,rl=qc.IteratorPrototype,il=qc.BUGGY_SAFARI_ITERATORS,sl=pe("iterator"),al="keys",ol="values",ul="entries",cl=function(){return this},ll=function(e,t,n,r,i,s,a){Yc(n,t,r);var o,u,c,l=function(e){if(e===i&&y)return y;if(!il&&e in p)return p[e];switch(e){case al:case ol:case ul:return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",d=!1,p=e.prototype,h=p[sl]||p["@@iterator"]||i&&p[i],y=!il&&h||l(i),v="Array"==t&&p.entries||h;if(v&&(o=Qc(v.call(new e)))!==Object.prototype&&o.next&&(Qc(o)!==rl&&(Xc?Xc(o,rl):"function"!=typeof o[sl]&&el(o,sl,cl)),Zc(o,f,!0)),i==ol&&h&&h.name!==ol&&(d=!0,y=function(){return h.call(this)}),p[sl]!==y&&el(p,sl,y),nl[t]=y,i)if(u={values:l(ol),keys:s?y:l(al),entries:l(ul)},a)for(c in u)(il||d||!(c in p))&&tl(p,c,u[c]);else Hc({target:t,proto:!0,forced:il||d},u);return u},fl=Ic.charAt,dl=gr,pl=xt,hl=ll,yl="String Iterator",vl=pl.set,ml=pl.getterFor(yl);hl(String,"String",(function(e){vl(this,{type:yl,string:dl(e),index:0})}),(function(){var e,t=ml(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=fl(n,r),t.index+=e.length,{value:e,done:!1})}));var gl=Hn,bl=Ne,kl=pe("unscopables"),wl=Array.prototype;null==wl[kl]&&bl.f(wl,kl,{configurable:!0,value:gl(null)});var xl=function(e){wl[kl][e]=!0},_l=_,Sl=xl,El=aa,Tl=xt,Rl=ll,Il="Array Iterator",Cl=Tl.set,Ol=Tl.getterFor(Il),Pl=Rl(Array,"Array",(function(e,t){Cl(this,{type:Il,target:_l(e),index:0,kind:t})}),(function(){var e=Ol(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");El.Arguments=El.Array,Sl("keys"),Sl("values"),Sl("entries");var Al=i,jl=Hu,Ml=Xu,Ll=Pl,Nl=Je,Ul=pe,Dl=Ul("iterator"),Fl=Ul("toStringTag"),Bl=Ll.values,ql=function(e,t){if(e){if(e[Dl]!==Bl)try{Nl(e,Dl,Bl)}catch(t){e[Dl]=Bl}if(e[Fl]||Nl(e,Fl,t),jl[t])for(var n in Ll)if(e[n]!==Ll[n])try{Nl(e,n,Ll[n])}catch(t){e[n]=Ll[n]}}};for(var zl in jl)ql(Al[zl]&&Al[zl].prototype,zl);ql(Ml,"DOMTokenList");var Wl=Math.floor,Gl=function(e,t){var n=e.length,r=Wl(n/2);return n<8?$l(e,t):Jl(Gl(e.slice(0,r),t),Gl(e.slice(r),t),t)},$l=function(e,t){for(var n,r,i=e.length,s=1;s<i;){for(r=s,n=e[s];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==s++&&(e[r]=n)}return e},Jl=function(e,t,n){for(var r=e.length,i=t.length,s=0,a=0,o=[];s<r||a<i;)s<r&&a<i?o.push(n(e[s],t[a])<=0?e[s++]:t[a++]):o.push(s<r?e[s++]:t[a++]);return o},Vl=Gl,Kl=I.match(/firefox\/(\d+)/i),Hl=!!Kl&&+Kl[1],Yl=/MSIE|Trident/.test(I),Ql=I.match(/AppleWebKit\/(\d+)\./),Xl=!!Ql&&+Ql[1],Zl=In,ef=Cn,tf=Q,nf=Ut,rf=gr,sf=a,af=Vl,of=ec,uf=Hl,cf=Yl,lf=L,ff=Xl,df=[],pf=df.sort,hf=sf((function(){df.sort(void 0)})),yf=sf((function(){df.sort(null)})),vf=of("sort"),mf=!sf((function(){if(lf)return lf<70;if(!(uf&&uf>3)){if(cf)return!0;if(ff)return ff<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)df.push({k:t+r,v:n})}for(df.sort((function(e,t){return t.v-e.v})),r=0;r<df.length;r++)t=df[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Zl({target:"Array",proto:!0,forced:hf||!yf||!vf||!mf},{sort:function(e){void 0!==e&&ef(e);var t=tf(this);if(mf)return void 0===e?pf.call(t):pf.call(t,e);var n,r,i=[],s=nf(t.length);for(r=0;r<s;r++)r in t&&i.push(t[r]);for(n=(i=af(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:rf(t)>rf(n)?1:-1}}(e))).length,r=0;r<n;)t[r]=i[r++];for(;r<s;)delete t[r++];return t}});var gf=In,bf=a,kf=vr,wf=S,xf=Q,_f=Ut,Sf=gs,Ef=qr,Tf=os,Rf=L,If=pe("isConcatSpreadable"),Cf=9007199254740991,Of="Maximum allowed index exceeded",Pf=Rf>=51||!bf((function(){var e=[];return e[If]=!1,e.concat()[0]!==e})),Af=Tf("concat"),jf=function(e){if(!wf(e))return!1;var t=e[If];return void 0!==t?!!t:kf(e)};gf({target:"Array",proto:!0,forced:!Pf||!Af},{concat:function(e){var t,n,r,i,s,a=xf(this),o=Ef(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(jf(s=-1===t?a:arguments[t])){if(u+(i=_f(s.length))>Cf)throw TypeError(Of);for(n=0;n<i;n++,u++)n in s&&Sf(o,u,s[n])}else{if(u>=Cf)throw TypeError(Of);Sf(o,u++,s)}return o.length=u,o}});var Mf=S,Lf=Zs,Nf=function(e,t,n){var r,i;return Lf&&"function"==typeof(r=t.constructor)&&r!==n&&Mf(i=r.prototype)&&i!==n.prototype&&Lf(e,i),e},Uf=k,Df=gr,Ff="[\t\n\v\f\r                　\u2028\u2029\ufeff]",Bf=RegExp("^"+Ff+Ff+"*"),qf=RegExp(Ff+Ff+"*$"),zf=function(e){return function(t){var n=Df(Uf(t));return 1&e&&(n=n.replace(Bf,"")),2&e&&(n=n.replace(qf,"")),n}},Wf={start:zf(1),end:zf(2),trim:zf(3)},Gf=o,$f=i,Jf=kn,Vf=Ve.exports,Kf=ee,Hf=v,Yf=Nf,Qf=q,Xf=ge,Zf=a,ed=Hn,td=Pt.f,nd=s.f,rd=Ne.f,id=Wf.trim,sd="Number",ad=$f.Number,od=ad.prototype,ud=Hf(ed(od))==sd,cd=function(e){if(Qf(e))throw TypeError("Cannot convert a Symbol value to a number");var t,n,r,i,s,a,o,u,c=Xf(e,"number");if("string"==typeof c&&c.length>2)if(43===(t=(c=id(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(s=c.slice(2)).length,o=0;o<a;o++)if((u=s.charCodeAt(o))<48||u>i)return NaN;return parseInt(s,r)}return+c};if(Jf(sd,!ad(" 0o1")||!ad("0b1")||ad("+0x1"))){for(var ld,fd=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof fd&&(ud?Zf((function(){od.valueOf.call(n)})):Hf(n)!=sd)?Yf(new ad(cd(t)),n,fd):cd(t)},dd=Gf?td(ad):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),pd=0;dd.length>pd;pd++)Kf(ad,ld=dd[pd])&&!Kf(fd,ld)&&rd(fd,ld,nd(ad,ld));fd.prototype=od,od.constructor=fd,Vf($f,sd,fd)}var hd,yd=Object.prototype,vd=yd.hasOwnProperty,md="function"==typeof Symbol?Symbol:{},gd=md.iterator||"@@iterator",bd=md.asyncIterator||"@@asyncIterator",kd=md.toStringTag||"@@toStringTag";function wd(e,t,n,r){var i=t&&t.prototype instanceof Id?t:Id,s=Object.create(i.prototype),a=new qd(r||[]);return s._invoke=function(e,t,n){var r=_d;return function(i,s){if(r===Ed)throw new Error("Generator is already running");if(r===Td){if("throw"===i)throw s;return Wd()}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=Dd(a,n);if(o){if(o===Rd)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===_d)throw r=Td,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=Ed;var u=xd(e,t,n);if("normal"===u.type){if(r=n.done?Td:Sd,u.arg===Rd)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=Td,n.method="throw",n.arg=u.arg)}}}(e,n,a),s}function xd(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}var _d="suspendedStart",Sd="suspendedYield",Ed="executing",Td="completed",Rd={};function Id(){}function Cd(){}function Od(){}var Pd={};Pd[gd]=function(){return this};var Ad=Object.getPrototypeOf,jd=Ad&&Ad(Ad(zd([])));jd&&jd!==yd&&vd.call(jd,gd)&&(Pd=jd);var Md=Od.prototype=Id.prototype=Object.create(Pd);function Ld(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function Nd(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===Cd||"GeneratorFunction"===(t.displayName||t.name))}function Ud(e,t){function n(r,i,s,a){var o=xd(e[r],e,i);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"===Os(c)&&vd.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(c).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,a)}))}a(o.arg)}var r;this._invoke=function(e,i){function s(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(s,s):s()}}function Dd(e,t){var n=e.iterator[t.method];if(n===hd){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=hd,Dd(e,t),"throw"===t.method))return Rd;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return Rd}var r=xd(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,Rd;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=hd),t.delegate=null,Rd):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,Rd)}function Fd(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Bd(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function qd(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(Fd,this),this.reset(!0)}function zd(e){if(e){var t=e[gd];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(vd.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=hd,t.done=!0,t};return r.next=r}}return{next:Wd}}function Wd(){return{value:hd,done:!0}}Cd.prototype=Md.constructor=Od,Od.constructor=Cd,Od[kd]=Cd.displayName="GeneratorFunction",Ld(Ud.prototype),Ud.prototype[bd]=function(){return this},Ld(Md),Md[kd]="Generator",Md[gd]=function(){return this},Md.toString=function(){return"[object Generator]"},qd.prototype={constructor:qd,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=hd,this.done=!1,this.delegate=null,this.method="next",this.arg=hd,this.tryEntries.forEach(Bd),!e)for(var t in this)"t"===t.charAt(0)&&vd.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=hd)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=hd),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=vd.call(i,"catchLoc"),o=vd.call(i,"finallyLoc");if(a&&o){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&vd.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,Rd):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),Rd},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),Bd(n),Rd}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;Bd(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:zd(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=hd),Rd}};var Gd={wrap:wd,isGeneratorFunction:Nd,AsyncIterator:Ud,mark:function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Od):(e.__proto__=Od,kd in e||(e[kd]="GeneratorFunction")),e.prototype=Object.create(Md),e},awrap:function(e){return{__await:e}},async:function(e,t,n,r,i){void 0===i&&(i=Promise);var s=new Ud(wd(e,t,n,r),i);return Nd(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},keys:function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},values:zd},$d=Object.freeze({__proto__:null,default:Gd});function Jd(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":Os(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}function Vd(e,t){if("object"===("undefined"==typeof Reflect?"undefined":Os(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var Kd,Hd,Yd,Qd={exports:{}};function Xd(e,t){return["".concat((new Date).toISOString()," Chat ").concat(e,":")].concat(Array.from(t))}Hd=t,Yd=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":Os(window))!==t&&Os(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":Os(console))!==t&&("trace"===r&&n?s:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function o(t,n){for(var i=0;i<r.length;i++){var s=r[i];this[s]=i<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function u(e,n,r){return function(){("undefined"==typeof console?"undefined":Os(console))!==t&&(o.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return a(e)||u.apply(this,arguments)}function l(e,n,i){var s,a=this,u="loglevel";function l(){var e;if(("undefined"==typeof window?"undefined":Os(window))!==t&&u){try{e=window.localStorage[u]}catch(e){}if(Os(e)===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"===Os(e)&&(u=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=i||c,a.getLevel=function(){return s},a.setLevel=function(n,i){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":Os(window))!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),o.call(a,n,e),("undefined"==typeof console?"undefined":Os(console))===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){l()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=l();null==f&&(f=null==n?"WARN":n),a.setLevel(f,!1)}var f=new l,d={};f.getLogger=function(e){if("symbol"!==Os(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,f.getLevel(),f.methodFactory)),t};var p=("undefined"==typeof window?"undefined":Os(window))!==t?window.log:void 0;return f.noConflict=function(){return("undefined"==typeof window?"undefined":Os(window))!==t&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return d},f.default=f,f},(Kd=Qd).exports?Kd.exports=Yd():Hd.log=Yd();var Zd,ep,tp=Qd.exports.getLogger("twilio-chat"),np=function(){function e(t){Ms(this,e),js(this,"prefix",""),this.prefix=null!=t&&t.length>0?t+" ":""}return Ts(e,[{key:"setLevel",value:function(e){tp.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.trace.apply(null,Xd(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.debug.apply(null,Xd(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.info.apply(null,Xd(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.warn.apply(null,Xd(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.error.apply(null,Xd(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){tp.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.trace.apply(null,Xd("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.debug.apply(null,Xd("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.info.apply(null,Xd("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.warn.apply(null,Xd("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];tp.error.apply(null,Xd("E",t))}}]),e}(),rp={};Object.defineProperty(rp,"__esModule",{value:!0});var ip=["weeks","years","months","days","hours","minutes","seconds"],sp=rp.pattern=new RegExp("P(?:(\\d+(?:[\\.,]\\d+)?W)|(\\d+(?:[\\.,]\\d+)?Y)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?D)?(?:T(\\d+(?:[\\.,]\\d+)?H)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?S)?)?)"),ap=ep=rp.parse=function(e){return e.match(sp).slice(1).reduce((function(e,t,n){return e[ip[n]]=parseFloat(t)||0,e}),{})},op=rp.end=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+1e3*e.seconds),r.setDate(r.getDate()+7*e.weeks),r},up=Zd=rp.toSeconds=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return(op(e,r).getTime()-r.getTime())/1e3};function cp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cp(Object(n),!0).forEach((function(t){js(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}rp.default={end:op,toSeconds:up,pattern:sp,parse:ap};var fp="PT5S",dp="PT5S",pp=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;Ms(this,e),js(this,"typingIndicatorTimeoutDefault",5e3);var i=t.Chat||t.IPMessaging||t||{};this.productId=i.productId,this.links={myConversations:n.links.my_conversations,conversations:n.links.conversations,users:n.links.users,currentUser:n.links.current_user,typing:n.links.typing,mediaService:n.links.media_service,messagesReceipts:n.links.messages_receipts},this.typingIndicatorTimeoutOverride=i.typingIndicatorTimeoutOverride,this.backoffConfiguration=lp({min:1e3,max:4e3,maxAttemptsCount:3},i.backoffConfigOverride),this.retryWhenThrottled=void 0===i.retryWhenThrottledOverride||i.retryWhenThrottledOverride,this.userInfosToSubscribe=i.userInfosToSubscribeOverride||n.options.user_infos_to_subscribe||100,this.reachabilityEnabled=n.options.reachability_enabled,this.userIdentity=n.identity,this.userInfo=n.sync_objects.my_user_info,this.myConversations=n.sync_objects.my_conversations;var s=i.httpCacheIntervalOverride||n.options.http_cache_interval||fp;try{this.httpCacheInterval=Zd(ep(s))}catch(e){r.error("Failed to parse http cache interval ".concat(s,", using default value ").concat(fp)),this.httpCacheInterval=Zd(ep(fp))}var a=i.consumptionReportIntervalOverride||n.options.consumption_report_interval||dp;try{this.consumptionReportInterval=Zd(ep(a))}catch(e){r.error("Failed to parse consumption report interval ".concat(a,", using default value ").concat(dp)),this.consumptionReportInterval=Zd(ep(dp))}},hp=Hr.map;In({target:"Array",proto:!0,forced:!os("map")},{map:function(e){return hp(this,e,arguments.length>1?arguments[1]:void 0)}});var yp=De,vp=function(){var e=yp(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},mp={},gp=a,bp=i.RegExp;mp.UNSUPPORTED_Y=gp((function(){var e=bp("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),mp.BROKEN_CARET=gp((function(){var e=bp("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var kp,wp,xp=a,_p=i.RegExp,Sp=xp((function(){var e=_p(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Ep=a,Tp=i.RegExp,Rp=Ep((function(){var e=Tp("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Ip=gr,Cp=vp,Op=mp,Pp=W.exports,Ap=Hn,jp=xt.get,Mp=Sp,Lp=Rp,Np=RegExp.prototype.exec,Up=Pp("native-string-replace",String.prototype.replace),Dp=Np,Fp=(kp=/a/,wp=/b*/g,Np.call(kp,"a"),Np.call(wp,"a"),0!==kp.lastIndex||0!==wp.lastIndex),Bp=Op.UNSUPPORTED_Y||Op.BROKEN_CARET,qp=void 0!==/()??/.exec("")[1];(Fp||qp||Bp||Mp||Lp)&&(Dp=function(e){var t,n,r,i,s,a,o,u=this,c=jp(u),l=Ip(e),f=c.raw;if(f)return f.lastIndex=u.lastIndex,t=Dp.call(f,l),u.lastIndex=f.lastIndex,t;var d=c.groups,p=Bp&&u.sticky,h=Cp.call(u),y=u.source,v=0,m=l;if(p&&(-1===(h=h.replace("y","")).indexOf("g")&&(h+="g"),m=l.slice(u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==l.charAt(u.lastIndex-1))&&(y="(?: "+y+")",m=" "+m,v++),n=new RegExp("^(?:"+y+")",h)),qp&&(n=new RegExp("^"+y+"$(?!\\s)",h)),Fp&&(r=u.lastIndex),i=Np.call(p?n:u,m),p?i?(i.input=i.input.slice(v),i[0]=i[0].slice(v),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:Fp&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),qp&&i&&i.length>1&&Up.call(i[0],n,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(i[s]=void 0)})),i&&d)for(i.groups=a=Ap(null),s=0;s<d.length;s++)a[(o=d[s])[0]]=i[o[1]];return i});var zp=Dp;In({target:"RegExp",proto:!0,forced:/./.exec!==zp},{exec:zp});var Wp=Ve.exports,Gp=zp,$p=a,Jp=pe,Vp=Je,Kp=Jp("species"),Hp=RegExp.prototype,Yp=function(e,t,n,r){var i=Jp(e),s=!$p((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=s&&!$p((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Kp]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!s||!a||n){var o=/./[i],u=t(i,""[e],(function(e,t,n,r,i){var a=t.exec;return a===Gp||a===Hp.exec?s&&!i?{done:!0,value:o.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));Wp(String.prototype,e,u[0]),Wp(Hp,i,u[1])}r&&Vp(Hp[i],"sham",!0)},Qp=Ic.charAt,Xp=function(e,t,n){return t+(n?Qp(e,t).length:1)},Zp=Q,eh=Math.floor,th="".replace,nh=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,rh=/\$([$&'`]|\d{1,2})/g,ih=v,sh=zp,ah=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==ih(e))throw TypeError("RegExp#exec called on incompatible receiver");return sh.call(e,t)},oh=Yp,uh=a,ch=De,lh=Mt,fh=Ut,dh=gr,ph=k,hh=Xp,yh=function(e,t,n,r,i,s){var a=n+e.length,o=r.length,u=rh;return void 0!==i&&(i=Zp(i),u=nh),th.call(s,u,(function(s,u){var c;switch(u.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":c=i[u.slice(1,-1)];break;default:var l=+u;if(0===l)return s;if(l>o){var f=eh(l/10);return 0===f?s:f<=o?void 0===r[f-1]?u.charAt(1):r[f-1]+u.charAt(1):s}c=r[l-1]}return void 0===c?"":c}))},vh=ah,mh=pe("replace"),gh=Math.max,bh=Math.min,kh="$0"==="a".replace(/./,"$0"),wh=!!/./[mh]&&""===/./[mh]("a","$0");oh("replace",(function(e,t,n){var r=wh?"$":"$0";return[function(e,n){var r=ph(this),i=null==e?void 0:e[mh];return void 0!==i?i.call(e,r,n):t.call(dh(r),e,n)},function(e,i){var s=ch(this),a=dh(e);if("string"==typeof i&&-1===i.indexOf(r)&&-1===i.indexOf("$<")){var o=n(t,s,a,i);if(o.done)return o.value}var u="function"==typeof i;u||(i=dh(i));var c=s.global;if(c){var l=s.unicode;s.lastIndex=0}for(var f=[];;){var d=vh(s,a);if(null===d)break;if(f.push(d),!c)break;""===dh(d[0])&&(s.lastIndex=hh(a,fh(s.lastIndex),l))}for(var p,h="",y=0,v=0;v<f.length;v++){d=f[v];for(var m=dh(d[0]),g=gh(bh(lh(d.index),a.length),0),b=[],k=1;k<d.length;k++)b.push(void 0===(p=d[k])?p:String(p));var w=d.groups;if(u){var x=[m].concat(b,g,a);void 0!==w&&x.push(w);var _=dh(i.apply(void 0,x))}else _=yh(m,a,g,b,w,i);g>=y&&(h+=a.slice(y,g)+_,y=g+m.length)}return h+a.slice(y)}]}),!!uh((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!kh||wh);var xh=In,_h=_,Sh=[].join,Eh=b!=Object,Th=ec("join",",");function Rh(e){return JSON.parse(JSON.stringify(e))}function Ih(e){return void 0===e||isNaN(Number(e))?null:Number(e)}function Ch(e){try{return new Date(e)}catch(e){return null}}function Oh(e,t,n){var r={};if(e)try{r=JSON.parse(e)}catch(e){n.warn(t,e)}return r}xh({target:"Array",proto:!0,forced:Eh||!Th},{join:function(e){return Sh.call(_h(this),void 0===e?",":e)}});var Ph=function(){function e(t){Ms(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return Ts(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}(),Ah={},jh=In,Mh=S,Lh=vr,Nh=qt,Uh=Ut,Dh=_,Fh=gs,Bh=pe,qh=os("slice"),zh=Bh("species"),Wh=[].slice,Gh=Math.max;jh({target:"Array",proto:!0,forced:!qh},{slice:function(e,t){var n,r,i,s=Dh(this),a=Uh(s.length),o=Nh(e,a),u=Nh(void 0===t?a:t,a);if(Lh(s)&&("function"!=typeof(n=s.constructor)||n!==Array&&!Lh(n.prototype)?Mh(n)&&null===(n=n[zh])&&(n=void 0):n=void 0,n===Array||void 0===n))return Wh.call(s,o,u);for(r=new(void 0===n?Array:n)(Gh(u-o,0)),i=0;o<u;o++,i++)o in s&&Fh(r,i,s[o]);return r.length=i,r}});var $h=In,Jh=o,Vh=i,Kh=ee,Hh=S,Yh=Ne.f,Qh=dn,Xh=Vh.Symbol;if(Jh&&"function"==typeof Xh&&(!("description"in Xh.prototype)||void 0!==Xh().description)){var Zh={},ey=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof ey?new Xh(e):void 0===e?Xh():Xh(e);return""===e&&(Zh[t]=!0),t};Qh(ey,Xh);var ty=ey.prototype=Xh.prototype;ty.constructor=ey;var ny=ty.toString,ry="Symbol(test)"==String(Xh("test")),iy=/^Symbol\((.*)\)[^)]+$/;Yh(ty,"description",{configurable:!0,get:function(){var e=Hh(this)?this.valueOf():this,t=ny.call(e);if(Kh(Zh,e))return"";var n=ry?t.slice(7,-1):t.replace(iy,"$1");return""===n?void 0:n}}),$h({global:!0,forced:!0},{Symbol:ey})}Or("iterator");var sy={exports:{}};!function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(sy);var ay=o,oy=Ne.f,uy=Function.prototype,cy=uy.toString,ly=/^\s*function ([^ (]*)/,fy="name";ay&&!(fy in uy)&&oy(uy,fy,{configurable:!0,get:function(){try{return cy.call(this).match(ly)[1]}catch(e){return""}}});var dy=S,py=Math.floor,hy=function(e){return!dy(e)&&isFinite(e)&&py(e)===e};In({target:"Number",stat:!0},{isInteger:hy});var yy={exports:{}},vy={exports:{}};!function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0}(vy);var my={exports:{}};!function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return s}},e.exports.default=e.exports,e.exports.__esModule=!0}(my);var gy={exports:{}},by={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0}(by),function(e){var t=by.exports;e.exports=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}(gy);var ky={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(ky),function(e){var t=vy.exports,n=my.exports,r=gy.exports,i=ky.exports;e.exports=function(e,s){return t(e)||n(e,s)||r(e,s)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(yy);var wy=o,xy=An,_y=_,Sy=u.f,Ey=function(e){return function(t){for(var n,r=_y(t),i=xy(r),s=i.length,a=0,o=[];s>a;)n=i[a++],wy&&!Sy.call(r,n)||o.push(e?[n,r[n]]:r[n]);return o}},Ty={entries:Ey(!0),values:Ey(!1)}.entries;In({target:"Object",stat:!0},{entries:function(e){return Ty(e)}});var Ry={exports:{}},Iy={exports:{}};!function(e){var t=by.exports;e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(Iy);var Cy={exports:{}};!function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(Cy);var Oy={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(Oy),function(e){var t=Iy.exports,n=Cy.exports,r=gy.exports,i=Oy.exports;e.exports=function(e){return t(e)||n(e)||r(e)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(Ry);var Py={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}(Py);var Ay={exports:{}},jy={exports:{}};!function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(n,r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(jy),function(e){var t=jy.exports;e.exports=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)},e.exports.default=e.exports,e.exports.__esModule=!0}(Ay);var My={exports:{}},Ly={exports:{}};!function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0}(Ly),function(e){var t=sy.exports.default,n=Ly.exports;e.exports=function(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?n(e):r},e.exports.default=e.exports,e.exports.__esModule=!0}(My);var Ny={exports:{}};!function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(Ny);var Uy=Jt.includes,Dy=xl;In({target:"Array",proto:!0},{includes:function(e){return Uy(this,e,arguments.length>1?arguments[1]:void 0)}}),Dy("includes"),Object.defineProperty(Ah,"__esModule",{value:!0});var Fy=yy.exports,By=Ry.exports,qy=Py.exports,zy=Ay.exports,Wy=My.exports,Gy=Ny.exports;function $y(e){return e&&"object"===Os(e)&&"default"in e?e:{default:e}}var Jy=$y(sy.exports),Vy=$y(Fy),Ky=$y(By),Hy=$y(qy),Yy=$y(zy),Qy=$y(Wy),Xy=$y(Gy),Zy=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{checks:t}};function ev(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return tv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function tv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var nv=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Zy((function(e){var n,r=!1,i=[],s=ev(t);try{for(s.s();!(n=s.n()).done;){var a=n.value;"string"!=typeof a?(r=r||e instanceof a,i.push("an instance of ".concat(a.name))):(r=r||Jy.default(e)===a,i.push("of type ".concat(a)))}}catch(e){s.e(e)}finally{s.f()}return[r,i]}))};function rv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return iv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return iv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function iv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var sv=Zy((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),av=Zy((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),ov=Zy((function(e){return["object"===Jy.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function uv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Xy.default(e);if(t){var i=Xy.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qy.default(this,n)}}function cv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return lv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function lv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var fv=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var n,r=cv(t.entries());try{for(r.s();!(n=r.n()).done;){var i=Vy.default(n.value,2),s=i[0],a=i[1],o=yv(e[s],a),u=Vy.default(o,4),c=u[0],l=u[1],f=u[2],d=u[3];if(!c)throw new Error("Argument ".concat(s+1," is expected to be ").concat(f).concat(d," but got ").concat(l))}}catch(e){r.e(e)}finally{r.f()}},dv=function(e){var t,n,r;(["undefined","boolean","number","bigint","string"].includes(Jy.default(e))&&(n="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===Jy.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(n=null===e?"null":"instance of ".concat(null==e||null===(r=e.constructor)||void 0===r?void 0:r.name));return n||(n=Jy.default(e)),n},pv=function(e){var t,n=[],r=cv(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(hv(i))}}catch(e){r.e(e)}finally{r.f()}return n},hv=function(e){var t,n=[],r=cv(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?n.push(i):n.push(nv(i))}}catch(e){r.e(e)}finally{r.f()}return n},yv=function(e,t){var n,r,i=[],s=!1,a=cv(e);try{for(a.s();!(r=a.n()).done;){var o,u=cv(r.value.checks);try{for(u.s();!(o=u.n()).done;){var c=(0,o.value)(t),l=Vy.default(c,3),f=l[0],d=l[1],p=l[2];s=s||f,!n&&p&&(n=p),d&&(i=[].concat(Ky.default(i),"string"==typeof d?[d]:Ky.default(d)))}}catch(e){u.e(e)}finally{u.f()}}}catch(e){a.e(e)}finally{a.f()}if(s)return[!0];var h=n||dv(t),y=i.length-1;return[!1,h,y>0?"".concat(i.slice(0,y).join(", ")," or ").concat(i[y]):i.join(", "),y>1?";":","]};function vv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return mv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function mv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Ah.array=function(e,t){return Zy((function(n){if(!Array.isArray(n))return[!1,"an array of ".concat(e)];var r,i=vv(n.entries());try{for(i.s();!(r=i.n()).done;){var s=Vy.default(r.value,2),a=s[0],o=s[1],u=yv(hv(t),o),c=Vy.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(a," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(a," is ").concat(f,")")]}}catch(e){i.e(e)}finally{i.f()}return[!0]}))};var gv=Ah.custom=Zy,bv=Ah.literal=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Zy((function(e){var n,r=!1,i=[],s=rv(t);try{for(s.s();!(n=s.n()).done;){var a=n.value;r=r||e===a,i.push("string"==typeof a?'"'.concat(a,'"'):"".concat(a))}}catch(e){s.e(e)}finally{s.f()}return[r,i]}))},kv=Ah.nonEmptyString=sv,wv=Ah.nonNegativeInteger=av,xv=Ah.objectSchema=function(e,t){return Zy((function(n){if("object"!==Jy.default(n)||null===n||Array.isArray(n))return[!1,"valid ".concat(e," (should be a pure object)")];for(var r=0,i=Object.entries(t);r<i.length;r++){var s=Vy.default(i[r],2),a=s[0],o=s[1],u=yv(hv(o),n[a]),c=Vy.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(a,'" should be ').concat(d,")"),"malformed ".concat(e,' (key "').concat(a,'" is ').concat(f,")")]}return[!0]}))},_v=Ah.pureObject=ov;Ah.runtimeTypeValidation=fv,Ah.stringifyReceivedType=dv,Ah.type=nv;var Sv=Ah.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=pv(t);return function(e){return function(e){Yy.default(n,e);var t=uv(n);function n(){Hy.default(this,n);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return fv(r,i),t.call.apply(t,[this].concat(i))}return n}(e)}},Ev=Ah.validateTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=pv(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return fv(r,t),i.apply(this,t)}}},Tv=Ah.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=pv(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{fv(r,t)}catch(e){return Promise.reject(e)}return i.apply(this,t)}}},Rv={exports:{}};!function(e,n){var r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",a="[object Array]",o="[object Boolean]",u="[object Date]",c="[object Error]",l="[object Function]",f="[object Map]",d="[object Number]",p="[object Object]",h="[object Promise]",y="[object RegExp]",v="[object Set]",m="[object String]",g="[object Symbol]",b="[object WeakMap]",k="[object ArrayBuffer]",w="[object DataView]",x=/^\[object .+?Constructor\]$/,_=/^(?:0|[1-9]\d*)$/,S={};S["[object Float32Array]"]=S["[object Float64Array]"]=S["[object Int8Array]"]=S["[object Int16Array]"]=S["[object Int32Array]"]=S["[object Uint8Array]"]=S["[object Uint8ClampedArray]"]=S["[object Uint16Array]"]=S["[object Uint32Array]"]=!0,S[s]=S[a]=S[k]=S[o]=S[w]=S[u]=S[c]=S[l]=S[f]=S[d]=S[p]=S[y]=S[v]=S[m]=S[b]=!1;var E="object"==Os(t)&&t&&t.Object===Object&&t,T="object"==("undefined"==typeof self?"undefined":Os(self))&&self&&self.Object===Object&&self,R=E||T||Function("return this")(),I=n&&!n.nodeType&&n,C=I&&e&&!e.nodeType&&e,O=C&&C.exports===I,P=O&&E.process,A=function(){try{return P&&P.binding&&P.binding("util")}catch(e){}}(),j=A&&A.isTypedArray;function M(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function L(e,t){return e.has(t)}function N(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function U(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var D,F,B=Array.prototype,q=Function.prototype,z=Object.prototype,W=R["__core-js_shared__"],G=q.toString,$=z.hasOwnProperty,J=function(){var e=/[^.]+$/.exec(W&&W.keys&&W.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),V=z.toString,K=RegExp("^"+G.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),H=O?R.Buffer:void 0,Y=R.Symbol,Q=R.Uint8Array,X=z.propertyIsEnumerable,Z=B.splice,ee=Y?Y.toStringTag:void 0,te=Object.getOwnPropertySymbols,ne=H?H.isBuffer:void 0,re=(D=Object.keys,F=Object,function(e){return D(F(e))}),ie=Ae(R,"DataView"),se=Ae(R,"Map"),ae=Ae(R,"Promise"),oe=Ae(R,"Set"),ue=Ae(R,"WeakMap"),ce=Ae(Object,"create"),le=Ne(ie),fe=Ne(se),de=Ne(ae),pe=Ne(oe),he=Ne(ue),ye=Y?Y.prototype:void 0,ve=ye?ye.valueOf:void 0;function me(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ge(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function be(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ke(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new be;++t<n;)this.add(e[t])}function we(e){var t=this.__data__=new ge(e);this.size=t.size}function xe(e,t){var n=Fe(e),r=!n&&De(e),i=!n&&!r&&Be(e),s=!n&&!r&&!i&&$e(e),a=n||r||i||s,o=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=o.length;for(var c in e)!t&&!$.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Le(c,u))||o.push(c);return o}function _e(e,t){for(var n=e.length;n--;)if(Ue(e[n][0],t))return n;return-1}function Se(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ee&&ee in Object(e)?function(e){var t=$.call(e,ee),n=e[ee];try{e[ee]=void 0;var r=!0}catch(e){}var i=V.call(e);r&&(t?e[ee]=n:delete e[ee]);return i}(e):function(e){return V.call(e)}(e)}function Ee(e){return Ge(e)&&Se(e)==s}function Te(e,t,n,r,i){return e===t||(null==e||null==t||!Ge(e)&&!Ge(t)?e!=e&&t!=t:function(e,t,n,r,i,l){var h=Fe(e),b=Fe(t),x=h?a:Me(e),_=b?a:Me(t),S=(x=x==s?p:x)==p,E=(_=_==s?p:_)==p,T=x==_;if(T&&Be(e)){if(!Be(t))return!1;h=!0,S=!1}if(T&&!S)return l||(l=new we),h||$e(e)?Ce(e,t,n,r,i,l):function(e,t,n,r,i,s,a){switch(n){case w:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case k:return!(e.byteLength!=t.byteLength||!s(new Q(e),new Q(t)));case o:case u:case d:return Ue(+e,+t);case c:return e.name==t.name&&e.message==t.message;case y:case m:return e==t+"";case f:var l=N;case v:var p=1&r;if(l||(l=U),e.size!=t.size&&!p)return!1;var h=a.get(e);if(h)return h==t;r|=2,a.set(e,t);var b=Ce(l(e),l(t),r,i,s,a);return a.delete(e),b;case g:if(ve)return ve.call(e)==ve.call(t)}return!1}(e,t,x,n,r,i,l);if(!(1&n)){var R=S&&$.call(e,"__wrapped__"),I=E&&$.call(t,"__wrapped__");if(R||I){var C=R?e.value():e,O=I?t.value():t;return l||(l=new we),i(C,O,n,r,l)}}if(!T)return!1;return l||(l=new we),function(e,t,n,r,i,s){var a=1&n,o=Oe(e),u=o.length,c=Oe(t).length;if(u!=c&&!a)return!1;var l=u;for(;l--;){var f=o[l];if(!(a?f in t:$.call(t,f)))return!1}var d=s.get(e);if(d&&s.get(t))return d==t;var p=!0;s.set(e,t),s.set(t,e);var h=a;for(;++l<u;){var y=e[f=o[l]],v=t[f];if(r)var m=a?r(v,y,f,t,e,s):r(y,v,f,e,t,s);if(!(void 0===m?y===v||i(y,v,n,r,s):m)){p=!1;break}h||(h="constructor"==f)}if(p&&!h){var g=e.constructor,b=t.constructor;g==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(p=!1)}return s.delete(e),s.delete(t),p}(e,t,n,r,i,l)}(e,t,n,r,Te,i))}function Re(e){return!(!We(e)||function(e){return!!J&&J in e}(e))&&(qe(e)?K:x).test(Ne(e))}function Ie(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||z,t!==r)return re(e);var t,n,r,i=[];for(var s in Object(e))$.call(e,s)&&"constructor"!=s&&i.push(s);return i}function Ce(e,t,n,r,i,s){var a=1&n,o=e.length,u=t.length;if(o!=u&&!(a&&u>o))return!1;var c=s.get(e);if(c&&s.get(t))return c==t;var l=-1,f=!0,d=2&n?new ke:void 0;for(s.set(e,t),s.set(t,e);++l<o;){var p=e[l],h=t[l];if(r)var y=a?r(h,p,l,t,e,s):r(p,h,l,e,t,s);if(void 0!==y){if(y)continue;f=!1;break}if(d){if(!M(t,(function(e,t){if(!L(d,t)&&(p===e||i(p,e,n,r,s)))return d.push(t)}))){f=!1;break}}else if(p!==h&&!i(p,h,n,r,s)){f=!1;break}}return s.delete(e),s.delete(t),f}function Oe(e){return function(e,t,n){var r=t(e);return Fe(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,Je,je)}function Pe(e,t){var n=e.__data__;return function(e){var t=Os(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Ae(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Re(n)?n:void 0}me.prototype.clear=function(){this.__data__=ce?ce(null):{},this.size=0},me.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},me.prototype.get=function(e){var t=this.__data__;if(ce){var n=t[e];return n===r?void 0:n}return $.call(t,e)?t[e]:void 0},me.prototype.has=function(e){var t=this.__data__;return ce?void 0!==t[e]:$.call(t,e)},me.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ce&&void 0===t?r:t,this},ge.prototype.clear=function(){this.__data__=[],this.size=0},ge.prototype.delete=function(e){var t=this.__data__,n=_e(t,e);return!(n<0)&&(n==t.length-1?t.pop():Z.call(t,n,1),--this.size,!0)},ge.prototype.get=function(e){var t=this.__data__,n=_e(t,e);return n<0?void 0:t[n][1]},ge.prototype.has=function(e){return _e(this.__data__,e)>-1},ge.prototype.set=function(e,t){var n=this.__data__,r=_e(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},be.prototype.clear=function(){this.size=0,this.__data__={hash:new me,map:new(se||ge),string:new me}},be.prototype.delete=function(e){var t=Pe(this,e).delete(e);return this.size-=t?1:0,t},be.prototype.get=function(e){return Pe(this,e).get(e)},be.prototype.has=function(e){return Pe(this,e).has(e)},be.prototype.set=function(e,t){var n=Pe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},ke.prototype.add=ke.prototype.push=function(e){return this.__data__.set(e,r),this},ke.prototype.has=function(e){return this.__data__.has(e)},we.prototype.clear=function(){this.__data__=new ge,this.size=0},we.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},we.prototype.get=function(e){return this.__data__.get(e)},we.prototype.has=function(e){return this.__data__.has(e)},we.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ge){var r=n.__data__;if(!se||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new be(r)}return n.set(e,t),this.size=n.size,this};var je=te?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var a=e[n];t(a,n,e)&&(s[i++]=a)}return s}(te(e),(function(t){return X.call(e,t)})))}:function(){return[]},Me=Se;function Le(e,t){return!!(t=null==t?i:t)&&("number"==typeof e||_.test(e))&&e>-1&&e%1==0&&e<t}function Ne(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ue(e,t){return e===t||e!=e&&t!=t}(ie&&Me(new ie(new ArrayBuffer(1)))!=w||se&&Me(new se)!=f||ae&&Me(ae.resolve())!=h||oe&&Me(new oe)!=v||ue&&Me(new ue)!=b)&&(Me=function(e){var t=Se(e),n=t==p?e.constructor:void 0,r=n?Ne(n):"";if(r)switch(r){case le:return w;case fe:return f;case de:return h;case pe:return v;case he:return b}return t});var De=Ee(function(){return arguments}())?Ee:function(e){return Ge(e)&&$.call(e,"callee")&&!X.call(e,"callee")},Fe=Array.isArray;var Be=ne||function(){return!1};function qe(e){if(!We(e))return!1;var t=Se(e);return t==l||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function ze(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}function We(e){var t=Os(e);return null!=e&&("object"==t||"function"==t)}function Ge(e){return null!=e&&"object"==Os(e)}var $e=j?function(e){return function(t){return e(t)}}(j):function(e){return Ge(e)&&ze(e.length)&&!!S[Se(e)]};function Je(e){return null!=(t=e)&&ze(t.length)&&!qe(t)?xe(e):Ie(e);var t}e.exports=function(e,t){return Te(e,t)}}(Rv,Rv.exports);var Iv=Rv.exports,Cv={};function Ov(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pv(e){return function(e){if(Array.isArray(e))return Ov(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ov(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ov(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Av(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jv(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mv(e){return(Mv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lv(e,t,n){return(Lv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Mv(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Nv(e,t){return(Nv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Uv(e){return(Uv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dv(e,t){return!t||"object"!==Uv(t)&&"function"!=typeof t?jv(e):t}function Fv(){}function Bv(){Bv.init.call(this)}function qv(e){return void 0===e._maxListeners?Bv.defaultMaxListeners:e._maxListeners}function zv(e,t,n){if(t)e.call(n);else for(var r=e.length,i=Yv(e,r),s=0;s<r;++s)i[s].call(n)}function Wv(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=Yv(e,i),a=0;a<i;++a)s[a].call(n,r)}function Gv(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,a=Yv(e,s),o=0;o<s;++o)a[o].call(n,r,i)}function $v(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var a=e.length,o=Yv(e,a),u=0;u<a;++u)o[u].call(n,r,i,s)}function Jv(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=Yv(e,i),a=0;a<i;++a)s[a].apply(n,r)}function Vv(e,t,n,r){var i,s,a,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=new Fv,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=qv(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[t]=n,++e._eventsCount;return e}function Kv(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function Hv(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Yv(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function Qv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Mv(e);if(t){var i=Mv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Dv(this,n)}}
/*
	@license
	Copyright (c) 2021 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

	*/
Object.defineProperty(Cv,"__esModule",{value:!0}),Fv.prototype=Object.create(null),Bv.EventEmitter=Bv,Bv.usingDomains=!1,Bv.prototype.domain=void 0,Bv.prototype._events=void 0,Bv.prototype._maxListeners=void 0,Bv.defaultMaxListeners=10,Bv.init=function(){this.domain=null,Bv.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Fv,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Bv.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Bv.prototype.getMaxListeners=function(){return qv(this)},Bv.prototype.emit=function(e){var t,n,r,i,s,a,o,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(o=this.domain,u){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:zv(n,l,this);break;case 2:Wv(n,l,this,arguments[1]);break;case 3:Gv(n,l,this,arguments[1],arguments[2]);break;case 4:$v(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];Jv(n,l,this,i)}return!0},Bv.prototype.addListener=function(e,t){return Vv(this,e,t,!1)},Bv.prototype.on=Bv.prototype.addListener,Bv.prototype.prependListener=function(e,t){return Vv(this,e,t,!0)},Bv.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Kv(this,e,t)),this},Bv.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Kv(this,e,t)),this},Bv.prototype.removeListener=function(e,t){var n,r,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Fv:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Fv,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},Bv.prototype.off=function(e,t){return this.removeListener(e,t)},Bv.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Fv,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Fv:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),s=0;s<i.length;++s)"removeListener"!==(r=i[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Fv,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Bv.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},Bv.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Hv.call(e,t)},Bv.prototype.listenerCount=Hv,Bv.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Xv=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nv(e,t)}(n,e);var t=Qv(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(jv(e=t.call(this)),"eventHistory",new Map),e}return function(e,t,n){t&&Av(e.prototype,t),n&&Av(e,n)}(n,[{key:"on",value:function(e,t){return Lv(Mv(n.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return Lv(Mv(n.prototype),"once",this).call(this,e,t)}},{key:"off",value:function(e,t){return Lv(Mv(n.prototype),"off",this).call(this,e,t)}},{key:"emit",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return this.eventHistory.set(e,i),(t=Lv(Mv(n.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}},{key:"addListener",value:function(e,t){return Lv(Mv(n.prototype),"addListener",this).call(this,e,t)}},{key:"removeListener",value:function(e,t){return Lv(Mv(n.prototype),"removeListener",this).call(this,e,t)}},{key:"addListenerWithReplay",value:function(e,t){var n=this.eventHistory.get(e);return void 0!==n&&t.apply(void 0,Pv(n)),this.addListener(e,t)}},{key:"onWithReplay",value:function(e,t){return this.addListenerWithReplay(e,t)}}]),n}(Bv),Zv=Cv.ReplayEventEmitter=Xv;function em(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}var tm=np.scope("User"),User=function(e){Cs(User,e);var t,n,r,i,s,a,o,u=em(User);function User(e,t,n,r){var i;return Ms(this,User),js(Rs(i=u.call(this)),"promiseToFetch",null),js(Rs(i),"updated","updated"),js(Rs(i),"userSubscribed","userSubscribed"),js(Rs(i),"userUnsubscribed","userUnsubscribed"),i.services=r,i.subscribed="initializing",i.setMaxListeners(0),i.state={identity:e,entityName:t,friendlyName:null,attributes:{},online:null,notifiable:null},i._initializationPromise=new Promise((function(e){i._resolveInitializationPromise=e})),null!==n&&i._resolveInitialization(n,e,t,!1),i}return Ts(User,[{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}},{key:"_update",value:(o=Ss(Gd.mark((function e(t,n){var r,i;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:r=[],tm.debug("User for",this.state.identity,"updated:",t,n),e.t0=t,e.next="friendlyName"===e.t0?7:"attributes"===e.t0?9:"reachability"===e.t0?12:15;break;case 7:return this.state.friendlyName!==n.value&&(r.push("friendlyName"),this.state.friendlyName=n.value),e.abrupt("break",16);case 9:return i=Oh(n.value,"Retrieved malformed attributes from the server for user: ".concat(this.state.identity),tm),Iv(this.state.attributes,i)||(this.state.attributes=i,r.push("attributes")),e.abrupt("break",16);case 12:return this.state.online!==n.online&&(this.state.online=n.online,r.push("online")),this.state.notifiable!==n.notifiable&&(this.state.notifiable=n.notifiable,r.push("notifiable")),e.abrupt("break",16);case 15:return e.abrupt("return");case 16:r.length>0&&this.emit("updated",{user:this,updateReasons:r});case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"_updateReachabilityInfo",value:(a=Ss(Gd.mark((function e(t,n){var r=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(this.configuration.reachabilityEnabled){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",t.get("reachability").then(n).catch((function(e){tm.warn("Failed to get reachability info for ",r.state.identity,e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"_fetch",value:(s=Ss(Gd.mark((function e(){var t=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(this.state.entityName){e.next=4;break}return e.abrupt("return",this);case 4:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then((function(e){return t.entity=e,e.on("itemUpdated",(function(e){return tm.debug("".concat(t.state.entityName," (").concat(t.state.identity,") itemUpdated: ").concat(e.item.key)),t._update(e.item.key,e.item.data)})),Promise.all([e.get("friendlyName").then((function(e){return t._update(e.key,e.data)})),e.get("attributes").then((function(e){return t._update(e.key,e.data)})),t._updateReachabilityInfo(e,(function(e){return t._update(e.key,e.data)}))])})).then((function(){return tm.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t})).catch((function(e){throw t.promiseToFetch=null,e})),e.abrupt("return",this.promiseToFetch);case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"_ensureFetched",value:(i=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:return e.abrupt("return",this.promiseToFetch||this._fetch());case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateAttributes",value:(r=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(t)});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateFriendlyName",value:(n=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:t});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unsubscribe",value:(t=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(!this.promiseToFetch){e.next=9;break}return e.next=5,this.promiseToFetch;case 5:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_resolveInitialization",value:function(e,t,n,r){this.configuration=e,this.identity=t,this.entityName=n,this.links={self:"".concat(this.configuration.links.users,"/").concat(this.identity)},this._resolveInitializationPromise(),r&&this.emit("updated",{user:this,updateReasons:["friendlyName","attributes","online","notifiable"]})}}]),User}(Zv);Jd([Tv(["string","number","boolean","object",bv(null)]),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],User.prototype,"updateAttributes",null),Jd([Tv("string"),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],User.prototype,"updateFriendlyName",null);var nm=function(){function e(t,n,r,i){Ms(this,e),this.state={prevToken:r,nextToken:i,source:n,items:t}}var t,n;return Ts(e,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}},{key:"nextPage",value:(n=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.hasNextPage?this.state.source(this.state.nextToken):Promise.reject(new Error("No next page")));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"prevPage",value:(t=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.hasPrevPage?this.state.source(this.state.prevToken):Promise.reject(new Error("No previous page")));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),rm=np.scope("ChannelDescriptor"),ChannelDescriptor=function(){function ChannelDescriptor(e,t){Ms(this,ChannelDescriptor),this.client=e,this.descriptor=t,this.sid=t.sid||t.conversation_sid,this.channel="".concat(this.sid,".channel"),this.uniqueName=t.unique_name,this.friendlyName=t.friendly_name,this.attributes=Oh(t.attributes,"Failed to parse channel attributes",rm),this.createdBy=t.created_by,this.dateCreated=Ch(t.date_created),this.dateUpdated=Ch(t.date_updated),this.messagesCount=t.messages_count,this.membersCount=t.participants_count,this.type=t.type,this.isPrivate="private"===t.type,this.lastConsumedMessageIndex=t.last_consumed_message_index,this.notificationLevel=t.notification_level||void 0,this.status=t.status||"unknown"}return Ts(ChannelDescriptor,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),ChannelDescriptor}(),im=function(){function e(t,n,r){Ms(this,e),this.client=t,this.services=n,this.url=r}var t,n,r;return Ts(e,[{key:"getChannels",value:(r=Ss(Gd.mark((function e(){var t,n,r,i=this,s=arguments;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=new Ph(this.url).arg("PageToken",t.pageToken).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,e.abrupt("return",new nm(r.body.conversations.map((function(e){return new ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),r.body.meta.previous_token,r.body.meta.next_token));case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getChannelBySid",value:(n=Ss(Gd.mark((function e(t){var n,r;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ph(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,e.abrupt("return",new ChannelDescriptor(this.client,r.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(t=Ss(Gd.mark((function e(t){var n,r;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ph(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,e.abrupt("return",new ChannelDescriptor(this.client,r.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function sm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function am(e,t){if(e){if("string"==typeof e)return sm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?sm(e,t):void 0}}function om(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return s}}(e,t)||am(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var um={exports:{}},cm=!a((function(){return Object.isExtensible(Object.preventExtensions({}))})),lm=In,fm=ot,dm=S,pm=ee,hm=Ne.f,ym=Pt,vm=br,mm=cm,gm=!1,bm=re("meta"),km=0,wm=Object.isExtensible||function(){return!0},xm=function(e){hm(e,bm,{value:{objectID:"O"+km++,weakData:{}}})},_m=um.exports={enable:function(){_m.enable=function(){},gm=!0;var e=ym.f,t=[].splice,n={};n[bm]=1,e(n).length&&(ym.f=function(n){for(var r=e(n),i=0,s=r.length;i<s;i++)if(r[i]===bm){t.call(r,i,1);break}return r},lm({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:vm.f}))},fastKey:function(e,t){if(!dm(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!pm(e,bm)){if(!wm(e))return"F";if(!t)return"E";xm(e)}return e[bm].objectID},getWeakData:function(e,t){if(!pm(e,bm)){if(!wm(e))return!0;if(!t)return!1;xm(e)}return e[bm].weakData},onFreeze:function(e){return mm&&gm&&wm(e)&&!pm(e,bm)&&xm(e),e}};fm[bm]=!0;var Sm=In,Em=i,Tm=kn,Rm=Ve.exports,Im=um.exports,Cm=Ia,Om=sa,Pm=S,Am=a,jm=Ua,Mm=Mr,Lm=Nf,Nm=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),s=r?"set":"add",a=Em[e],o=a&&a.prototype,u=a,c={},l=function(e){var t=o[e];Rm(o,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!Pm(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!Pm(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!Pm(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Tm(e,"function"!=typeof a||!(i||o.forEach&&!Am((function(){(new a).entries().next()})))))u=n.getConstructor(t,e,r,s),Im.enable();else if(Tm(e,!0)){var f=new u,d=f[s](i?{}:-0,1)!=f,p=Am((function(){f.has(1)})),h=jm((function(e){new a(e)})),y=!i&&Am((function(){for(var e=new a,t=5;t--;)e[s](t,t);return!e.has(-0)}));h||((u=t((function(t,n){Om(t,u,e);var i=Lm(new a,t,u);return null!=n&&Cm(n,i[s],{that:i,AS_ENTRIES:r}),i}))).prototype=o,o.constructor=u),(p||y)&&(l("delete"),l("has"),r&&l("get")),(y||d)&&l(s),i&&o.clear&&delete o.clear}return c[e]=u,Sm({global:!0,forced:u!=a},c),Mm(u,e),i||n.setStrong(u,e,r),u},Um=Ne.f,Dm=Hn,Fm=Hs,Bm=Nr,qm=sa,zm=Ia,Wm=ll,Gm=ia,$m=o,Jm=um.exports.fastKey,Vm=xt.set,Km=xt.getterFor,Hm={getConstructor:function(e,t,n,r){var i=e((function(e,s){qm(e,i,t),Vm(e,{type:t,index:Dm(null),first:void 0,last:void 0,size:0}),$m||(e.size=0),null!=s&&zm(s,e[r],{that:e,AS_ENTRIES:n})})),s=Km(t),a=function(e,t,n){var r,i,a=s(e),u=o(e,t);return u?u.value=n:(a.last=u={index:i=Jm(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=u),r&&(r.next=u),$m?a.size++:e.size++,"F"!==i&&(a.index[i]=u)),e},o=function(e,t){var n,r=s(e),i=Jm(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return Fm(i.prototype,{clear:function(){for(var e=s(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,$m?e.size=0:this.size=0},delete:function(e){var t=this,n=s(t),r=o(t,e);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first==r&&(n.first=i),n.last==r&&(n.last=a),$m?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=s(this),r=Bm(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!o(this,e)}}),Fm(i.prototype,n?{get:function(e){var t=o(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),$m&&Um(i.prototype,"size",{get:function(){return s(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Km(t),s=Km(r);Wm(e,t,(function(e,t){Vm(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Gm(t)}};Nm("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Hm);var Ym={},Qm={exports:{}};!function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0}(Qm);var Xm={exports:{}};!function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0}(Xm),Object.defineProperty(Ym,"__esModule",{value:!0});var Zm=Qm.exports,eg=Ly.exports,tg=Ay.exports,ng=My.exports,rg=Ny.exports,ig=Xm.exports;function sg(e){return e&&"object"===Os(e)&&"default"in e?e:{default:e}}var ag=sg(Py.exports),og=sg(Zm),ug=sg(eg),cg=sg(tg),lg=sg(ng),fg=sg(rg),dg=sg(ig);function pg(){}function hg(){hg.init.call(this)}function yg(e){return void 0===e._maxListeners?hg.defaultMaxListeners:e._maxListeners}function vg(e,t,n){if(t)e.call(n);else for(var r=e.length,i=Sg(e,r),s=0;s<r;++s)i[s].call(n)}function mg(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=Sg(e,i),a=0;a<i;++a)s[a].call(n,r)}function gg(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,a=Sg(e,s),o=0;o<s;++o)a[o].call(n,r,i)}function bg(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var a=e.length,o=Sg(e,a),u=0;u<a;++u)o[u].call(n,r,i,s)}function kg(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=Sg(e,i),a=0;a<i;++a)s[a].apply(n,r)}function wg(e,t,n,r){var i,s,a,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=new pg,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=yg(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[t]=n,++e._eventsCount;return e}function xg(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function _g(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Sg(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function Eg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=fg.default(e);if(t){var i=fg.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return lg.default(this,n)}}pg.prototype=Object.create(null),hg.EventEmitter=hg,hg.usingDomains=!1,hg.prototype.domain=void 0,hg.prototype._events=void 0,hg.prototype._maxListeners=void 0,hg.defaultMaxListeners=10,hg.init=function(){this.domain=null,hg.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new pg,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},hg.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},hg.prototype.getMaxListeners=function(){return yg(this)},hg.prototype.emit=function(e){var t,n,r,i,s,a,o,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(o=this.domain,u){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:vg(n,l,this);break;case 2:mg(n,l,this,arguments[1]);break;case 3:gg(n,l,this,arguments[1],arguments[2]);break;case 4:bg(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];kg(n,l,this,i)}return!0},hg.prototype.addListener=function(e,t){return wg(this,e,t,!1)},hg.prototype.on=hg.prototype.addListener,hg.prototype.prependListener=function(e,t){return wg(this,e,t,!0)},hg.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,xg(this,e,t)),this},hg.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,xg(this,e,t)),this},hg.prototype.removeListener=function(e,t){var n,r,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new pg:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new pg,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},hg.prototype.off=function(e,t){return this.removeListener(e,t)},hg.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new pg,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new pg:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),s=0;s<i.length;++s)"removeListener"!==(r=i[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new pg,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},hg.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},hg.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_g.call(e,t)},hg.prototype.listenerCount=_g,hg.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Tg=function(e){cg.default(n,e);var t=Eg(n);function n(e){var r;return ag.default(this,n),r=t.call(this),dg.default(ug.default(r),"timeout",null),dg.default(ug.default(r),"startTimestamp",-1),r.minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return og.default(n,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt count limit reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(e){this.emit("succeeded",e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}}]),n}(hg),Rg=function(e){cg.default(n,e);var t=Eg(n);function n(e){var r;return ag.default(this,n),r=t.call(this),dg.default(ug.default(r),"resolve",(function(){})),dg.default(ug.default(r),"reject",(function(){})),r.retrier=new Tg(e),r}return og.default(n,[{key:"run",value:function(e){var t=this;return this.retrier.on("attempt",(function(){e().then((function(e){return t.retrier.succeeded(e)})).catch((function(e){return t.retrier.failed(e)}))})),this.retrier.on("succeeded",(function(e){return t.resolve(e)})),this.retrier.on("cancelled",(function(){return t.reject(new Error("Cancelled"))})),this.retrier.on("failed",(function(e){return t.reject(e)})),new Promise((function(e,n){t.resolve=e,t.reject=n,t.retrier.start()}))}},{key:"cancel",value:function(){this.retrier.cancel()}}]),n}(hg);function Ig(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=fg.default(e);if(t){var i=fg.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return lg.default(this,n)}}function Cg(e){return null!=e}var Og=function(e){cg.default(n,e);var t=Ig(n);function n(e){var r;ag.default(this,n),r=t.call(this),dg.default(ug.default(r),"backoffDelay",0),dg.default(ug.default(r),"nextBackoffDelay",0),dg.default(ug.default(r),"backoffNumber",0),dg.default(ug.default(r),"timeoutID",null),dg.default(ug.default(r),"maxNumberOfRetry",-1);var i=e=e||{},s=i.initialDelay,a=i.maxDelay,o=i.randomisationFactor,u=i.factor;if(Cg(s)&&s<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(Cg(a)&&a<=1)throw new Error("The maximal timeout must be greater than 1.");if(Cg(o)&&(o<0||o>1))throw new Error("The randomisation factor must be between 0 and 1.");if(Cg(u)&&u<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=s||100,r.maxDelay=a||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=o||0,r.factor=u||2,r.reset(),r}return og.default(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(hg),Pg=Ym.AsyncRetrier=Rg;Ym.Backoff=Og;var Ag=Ym.Retrier=Tg;function jg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Mg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mg(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function Mg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Lg=function(){function e(t,n){Ms(this,e),this.configuration=t,this.services=n,this.cache=new Map,this.cacheLifetime=100*this.configuration.httpCacheInterval,this.cleanupCache()}var t;return Ts(e,[{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e,t=jg(this.cache);try{for(t.s();!(e=t.n()).done;){var n=om(e.value,2),r=n[0],i=n[1];this.isExpired(i.timestamp)&&this.cache.delete(r)}}catch(e){t.e(e)}finally{t.f()}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval((function(){return e.cleanupCache()}),2*this.cacheLifetime)}},{key:"executeWithRetry",value:(t=Ss(Gd.mark((function e(t){var n,r=this,i=arguments;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],e.abrupt("return",new Promise((function(e,i){var s=[502,503,504];n&&s.push(429);var a=new Ag(r.configuration.backoffConfiguration);a.on("attempt",(function(){t().then((function(e){return a.succeeded(e)})).catch((function(e){s.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?a.failed(e):(a.removeAllListeners(),a.cancel(),i(e))}))})),a.on("succeeded",(function(t){e(t)})),a.on("cancelled",(function(e){return i(e)})),a.on("failed",(function(e){return i(e)})),a.start()})));case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"get",value:function(){var e=Ss(Gd.mark((function e(t){var n,r,i,s=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))||this.isExpired(n.timestamp)){e.next=3;break}return e.abrupt("return",n.response);case 3:return r={},e.next=6,this.executeWithRetry((function(){return s.services.transport.get(t,r,s.configuration.productId)}),this.configuration.retryWhenThrottled);case 6:return i=e.sent,this.cache.set(t,{response:i,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ng=function e(){Ms(this,e)};js(Ng,"TYPING_INDICATOR","twilio.ipmsg.typing_indicator"),js(Ng,"NEW_MESSAGE","twilio.channel.new_message"),js(Ng,"ADDED_TO_CHANNEL","twilio.channel.added_to_channel"),js(Ng,"INVITED_TO_CHANNEL","twilio.channel.invited_to_channel"),js(Ng,"REMOVED_FROM_CHANNEL","twilio.channel.removed_from_channel"),js(Ng,"CONSUMPTION_UPDATE","twilio.channel.consumption_update");var Ug={},Dg={exports:{}};!function(e){function t(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,s){var a=e.apply(n,r);function o(e){t(a,i,s,o,u,"next",e)}function u(e){t(a,i,s,o,u,"throw",e)}o(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0}(Dg);var Fg=n($d),Bg={},qg={exports:{}},zg={exports:{}};!function(e){var t=Ny.exports;e.exports=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=t(e)););return e},e.exports.default=e.exports,e.exports.__esModule=!0}(zg),function(e){var t=zg.exports;function n(r,i,s){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=n=Reflect.get,e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e,n,r){var i=t(e,n);if(i){var s=Object.getOwnPropertyDescriptor(i,n);return s.get?s.get.call(r):s.value}},e.exports.default=e.exports,e.exports.__esModule=!0),n(r,i,s||r)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0}(qg);var Wg=Ve.exports,Gg=De,$g=gr,Jg=a,Vg=vp,Kg="toString",Hg=RegExp.prototype,Yg=Hg.toString,Qg=Jg((function(){return"/a/b"!=Yg.call({source:"a",flags:"b"})})),Xg=Yg.name!=Kg;(Qg||Xg)&&Wg(RegExp.prototype,Kg,(function(){var e=Gg(this),t=$g(e.source),n=e.flags;return"/"+t+"/"+$g(void 0===n&&e instanceof RegExp&&!("flags"in Hg)?Vg.call(e):n)}),{unsafe:!0}),Nm("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Hm);var Zg={exports:{}};!function(e,t){var n;n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){var r=n(0);e.exports={build:function(e,t){var n,i,s,a=t.plugins;for(n=0,i=a.length;n<i;n++)(s=a[n]).methods&&r(e,s.methods),s.properties&&Object.defineProperties(e,s.properties)},hook:function(e,t,n){var r,i,s,a,o=e.config.plugins,u=[e.context];for(n&&(u=u.concat(n)),r=0,i=o.length;r<i;r++)a=o[r],(s=o[r][t])&&s.apply(a,u)}}},function(e,t,n){function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){var r=n(0),i=n(2);function s(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(s.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"===Os(e)?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"===Os(e)?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,s,a=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||a],s=r.to||a,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:s})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=s},function(e,t,n){var r=n(0),i=n(6),s=n(1),a=[null,[]];function o(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(o.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),s.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,s=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),s?this.observersForEvent(i.onLeave.state):a,s?this.observersForEvent(i.onLeave[t]):a,this.observersForEvent(i.on.transition),s?["doTransit",[this]]:a,s?this.observersForEvent(i.onEnter.state):a,s?this.observersForEvent(i.onEnter[n]):a,s?this.observersForEvent(i.on[n]):a,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],a=e[0][1],o=e[0][2];if(t[0].event=i,i&&o&&i!==n&&s.hook(this,"lifecycle",t),0===a.length)return e.shift(),this.observeEvents(e,t,i,r);var u=a.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=o},function(e,t,n){var r=n(0),i=n(2),s=n(1),a=n(3),o=n(4),u={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return f(this||{},e)}function f(e,t){return d(e,new a(t,l)),e._fsm(),e}function d(e,t){if("object"!==Os(e)||Array.isArray(e))throw Error("StateMachine can only be applied to objects");s.build(e,t),Object.defineProperties(e,c),r(e,u),r(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new o(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new a(t,l);return d(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=f,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=n()}(Zg);var eb={exports:{}},tb="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(tb){var nb=new Uint8Array(16);eb.exports=function(){return tb(nb),nb}}else{var rb=new Array(16);eb.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),rb[t]=e>>>((3&t)<<3)&255;return rb}}for(var ib=[],sb=0;sb<256;++sb)ib[sb]=(sb+256).toString(16).substr(1);var ab,ob,ub=function(e,t){var n=t||0,r=ib;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")},cb=eb.exports,lb=ub,fb=0,db=0;var pb=function(e,t,n){var r=t&&n||0,i=t||[],s=(e=e||{}).node||ab,a=void 0!==e.clockseq?e.clockseq:ob;if(null==s||null==a){var o=cb();null==s&&(s=ab=[1|o[0],o[1],o[2],o[3],o[4],o[5]]),null==a&&(a=ob=16383&(o[6]<<8|o[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:db+1,l=u-fb+(c-db)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||u>fb)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");fb=u,db=c,ob=a;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=255&f;var d=u/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=255&d,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=a>>>8|128,i[r++]=255&a;for(var p=0;p<6;++p)i[r+p]=s[p];return t||lb(i)},hb=eb.exports,yb=ub;var vb=pb,mb=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||hb)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;++s)t[r+s]=i[s];return t||yb(i)},gb=mb;gb.v1=vb,gb.v4=mb;var bb,kb,wb,xb=gb,_b={exports:{}},Sb="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Eb=Sb,Tb=o,Rb=i,Ib=S,Cb=ee,Ob=qs,Pb=Je,Ab=Ve.exports,jb=Ne.f,Mb=Lc,Lb=Zs,Nb=pe,Ub=re,Db=Rb.Int8Array,Fb=Db&&Db.prototype,Bb=Rb.Uint8ClampedArray,qb=Bb&&Bb.prototype,zb=Db&&Mb(Db),Wb=Fb&&Mb(Fb),Gb=Object.prototype,$b=Gb.isPrototypeOf,Jb=Nb("toStringTag"),Vb=Ub("TYPED_ARRAY_TAG"),Kb=Ub("TYPED_ARRAY_CONSTRUCTOR"),Hb=Eb&&!!Lb&&"Opera"!==Ob(Rb.opera),Yb=!1,Qb={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Xb={BigInt64Array:8,BigUint64Array:8},Zb=function(e){if(!Ib(e))return!1;var t=Ob(e);return Cb(Qb,t)||Cb(Xb,t)};for(bb in Qb)(wb=(kb=Rb[bb])&&kb.prototype)?Pb(wb,Kb,kb):Hb=!1;for(bb in Xb)(wb=(kb=Rb[bb])&&kb.prototype)&&Pb(wb,Kb,kb);if((!Hb||"function"!=typeof zb||zb===Function.prototype)&&(zb=function(){throw TypeError("Incorrect invocation")},Hb))for(bb in Qb)Rb[bb]&&Lb(Rb[bb],zb);if((!Hb||!Wb||Wb===Gb)&&(Wb=zb.prototype,Hb))for(bb in Qb)Rb[bb]&&Lb(Rb[bb].prototype,Wb);if(Hb&&Mb(qb)!==Wb&&Lb(qb,Wb),Tb&&!Cb(Wb,Jb))for(bb in Yb=!0,jb(Wb,Jb,{get:function(){return Ib(this)?this[Vb]:void 0}}),Qb)Rb[bb]&&Pb(Rb[bb],Vb,bb);var ek={NATIVE_ARRAY_BUFFER_VIEWS:Hb,TYPED_ARRAY_CONSTRUCTOR:Kb,TYPED_ARRAY_TAG:Yb&&Vb,aTypedArray:function(e){if(Zb(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Lb&&!$b.call(zb,e))throw TypeError("Target is not a typed array constructor");return e},exportTypedArrayMethod:function(e,t,n){if(Tb){if(n)for(var r in Qb){var i=Rb[r];if(i&&Cb(i.prototype,e))try{delete i.prototype[e]}catch(e){}}Wb[e]&&!n||Ab(Wb,e,n?t:Hb&&Fb[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Tb){if(Lb){if(n)for(r in Qb)if((i=Rb[r])&&Cb(i,e))try{delete i[e]}catch(e){}if(zb[e]&&!n)return;try{return Ab(zb,e,n?t:Hb&&zb[e]||t)}catch(e){}}for(r in Qb)!(i=Rb[r])||i[e]&&!n||Ab(i,e,t)}},isView:function(e){if(!Ib(e))return!1;var t=Ob(e);return"DataView"===t||Cb(Qb,t)||Cb(Xb,t)},isTypedArray:Zb,TypedArray:zb,TypedArrayPrototype:Wb},tk=i,nk=a,rk=Ua,ik=ek.NATIVE_ARRAY_BUFFER_VIEWS,sk=tk.ArrayBuffer,ak=tk.Int8Array,ok=!ik||!nk((function(){ak(1)}))||!nk((function(){new ak(-1)}))||!rk((function(e){new ak,new ak(null),new ak(1.5),new ak(e)}),!0)||nk((function(){return 1!==new ak(new sk(2),1,void 0).length})),uk=Mt,ck=Ut,lk=function(e){if(void 0===e)return 0;var t=uk(e),n=ck(t);if(t!==n)throw RangeError("Wrong length or index");return n},fk=Math.abs,dk=Math.pow,pk=Math.floor,hk=Math.log,yk=Math.LN2,vk=Q,mk=qt,gk=Ut,bk=function(e){for(var t=vk(this),n=gk(t.length),r=arguments.length,i=mk(r>1?arguments[1]:void 0,n),s=r>2?arguments[2]:void 0,a=void 0===s?n:mk(s,n);a>i;)t[i++]=e;return t},kk=i,wk=o,xk=Sb,_k=Je,Sk=Hs,Ek=a,Tk=sa,Rk=Mt,Ik=Ut,Ck=lk,Ok={pack:function(e,t,n){var r,i,s,a=new Array(n),o=8*n-t-1,u=(1<<o)-1,c=u>>1,l=23===t?dk(2,-24)-dk(2,-77):0,f=e<0||0===e&&1/e<0?1:0,d=0;for((e=fk(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=pk(hk(e)/yk),e*(s=dk(2,-r))<1&&(r--,s*=2),(e+=r+c>=1?l/s:l*dk(2,1-c))*s>=2&&(r++,s/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*s-1)*dk(2,t),r+=c):(i=e*dk(2,c-1)*dk(2,t),r=0));t>=8;a[d++]=255&i,i/=256,t-=8);for(r=r<<t|i,o+=t;o>0;a[d++]=255&r,r/=256,o-=8);return a[--d]|=128*f,a},unpack:function(e,t){var n,r=e.length,i=8*r-t-1,s=(1<<i)-1,a=s>>1,o=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;o>0;l=256*l+e[u],u--,o-=8);for(n=l&(1<<-o)-1,l>>=-o,o+=t;o>0;n=256*n+e[u],u--,o-=8);if(0===l)l=1-a;else{if(l===s)return n?NaN:c?-1/0:1/0;n+=dk(2,t),l-=a}return(c?-1:1)*n*dk(2,l-t)}},Pk=Lc,Ak=Zs,jk=Pt.f,Mk=Ne.f,Lk=bk,Nk=Mr,Uk=xt.get,Dk=xt.set,Fk="ArrayBuffer",Bk="DataView",qk="Wrong index",zk=kk.ArrayBuffer,Wk=zk,Gk=kk.DataView,$k=Gk&&Gk.prototype,Jk=Object.prototype,Vk=kk.RangeError,Kk=Ok.pack,Hk=Ok.unpack,Yk=function(e){return[255&e]},Qk=function(e){return[255&e,e>>8&255]},Xk=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Zk=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},ew=function(e){return Kk(e,23,4)},tw=function(e){return Kk(e,52,8)},nw=function(e,t){Mk(e.prototype,t,{get:function(){return Uk(this)[t]}})},rw=function(e,t,n,r){var i=Ck(n),s=Uk(e);if(i+t>s.byteLength)throw Vk(qk);var a=Uk(s.buffer).bytes,o=i+s.byteOffset,u=a.slice(o,o+t);return r?u:u.reverse()},iw=function(e,t,n,r,i,s){var a=Ck(n),o=Uk(e);if(a+t>o.byteLength)throw Vk(qk);for(var u=Uk(o.buffer).bytes,c=a+o.byteOffset,l=r(+i),f=0;f<t;f++)u[c+f]=l[s?f:t-f-1]};if(xk){if(!Ek((function(){zk(1)}))||!Ek((function(){new zk(-1)}))||Ek((function(){return new zk,new zk(1.5),new zk(NaN),zk.name!=Fk}))){for(var sw,aw=(Wk=function(e){return Tk(this,Wk),new zk(Ck(e))}).prototype=zk.prototype,ow=jk(zk),uw=0;ow.length>uw;)(sw=ow[uw++])in Wk||_k(Wk,sw,zk[sw]);aw.constructor=Wk}Ak&&Pk($k)!==Jk&&Ak($k,Jk);var cw=new Gk(new Wk(2)),lw=$k.setInt8;cw.setInt8(0,2147483648),cw.setInt8(1,2147483649),!cw.getInt8(0)&&cw.getInt8(1)||Sk($k,{setInt8:function(e,t){lw.call(this,e,t<<24>>24)},setUint8:function(e,t){lw.call(this,e,t<<24>>24)}},{unsafe:!0})}else Wk=function(e){Tk(this,Wk,Fk);var t=Ck(e);Dk(this,{bytes:Lk.call(new Array(t),0),byteLength:t}),wk||(this.byteLength=t)},Gk=function(e,t,n){Tk(this,Gk,Bk),Tk(e,Wk,Bk);var r=Uk(e).byteLength,i=Rk(t);if(i<0||i>r)throw Vk("Wrong offset");if(i+(n=void 0===n?r-i:Ik(n))>r)throw Vk("Wrong length");Dk(this,{buffer:e,byteLength:n,byteOffset:i}),wk||(this.buffer=e,this.byteLength=n,this.byteOffset=i)},wk&&(nw(Wk,"byteLength"),nw(Gk,"buffer"),nw(Gk,"byteLength"),nw(Gk,"byteOffset")),Sk(Gk.prototype,{getInt8:function(e){return rw(this,1,e)[0]<<24>>24},getUint8:function(e){return rw(this,1,e)[0]},getInt16:function(e){var t=rw(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=rw(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Zk(rw(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Zk(rw(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Hk(rw(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Hk(rw(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){iw(this,1,e,Yk,t)},setUint8:function(e,t){iw(this,1,e,Yk,t)},setInt16:function(e,t){iw(this,2,e,Qk,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){iw(this,2,e,Qk,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){iw(this,4,e,Xk,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){iw(this,4,e,Xk,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){iw(this,4,e,ew,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){iw(this,8,e,tw,t,arguments.length>2?arguments[2]:void 0)}});Nk(Wk,Fk),Nk(Gk,Bk);var fw={ArrayBuffer:Wk,DataView:Gk},dw=Mt,pw=function(e){var t=dw(e);if(t<0)throw RangeError("The argument can't be less than 0");return t},hw=function(e,t){var n=pw(e);if(n%t)throw RangeError("Wrong offset");return n},yw=Q,vw=Ut,mw=ma,gw=ha,bw=la,kw=Nr,ww=ek.aTypedArrayConstructor,xw=In,_w=i,Sw=o,Ew=ok,Tw=ek,Rw=fw,Iw=sa,Cw=h,Ow=Je,Pw=hy,Aw=Ut,jw=lk,Mw=hw,Lw=we,Nw=ee,Uw=qs,Dw=S,Fw=q,Bw=Hn,qw=Zs,zw=Pt.f,Ww=function(e){var t,n,r,i,s,a,o=yw(e),u=arguments.length,c=u>1?arguments[1]:void 0,l=void 0!==c,f=gw(o);if(null!=f&&!bw(f))for(a=(s=mw(o,f)).next,o=[];!(i=a.call(s)).done;)o.push(i.value);for(l&&u>2&&(c=kw(c,arguments[2],2)),n=vw(o.length),r=new(ww(this))(n),t=0;n>t;t++)r[t]=l?c(o[t],t):o[t];return r},Gw=Hr.forEach,$w=ia,Jw=Ne,Vw=s,Kw=Nf,Hw=xt.get,Yw=xt.set,Qw=Jw.f,Xw=Vw.f,Zw=Math.round,ex=_w.RangeError,tx=Rw.ArrayBuffer,nx=Rw.DataView,rx=Tw.NATIVE_ARRAY_BUFFER_VIEWS,ix=Tw.TYPED_ARRAY_CONSTRUCTOR,sx=Tw.TYPED_ARRAY_TAG,ax=Tw.TypedArray,ox=Tw.TypedArrayPrototype,ux=Tw.aTypedArrayConstructor,cx=Tw.isTypedArray,lx="BYTES_PER_ELEMENT",fx="Wrong length",dx=function(e,t){for(var n=0,r=t.length,i=new(ux(e))(r);r>n;)i[n]=t[n++];return i},px=function(e,t){Qw(e,t,{get:function(){return Hw(this)[t]}})},hx=function(e){var t;return e instanceof tx||"ArrayBuffer"==(t=Uw(e))||"SharedArrayBuffer"==t},yx=function(e,t){return cx(e)&&!Fw(t)&&t in e&&Pw(+t)&&t>=0},vx=function(e,t){return t=Lw(t),yx(e,t)?Cw(2,e[t]):Xw(e,t)},mx=function(e,t,n){return t=Lw(t),!(yx(e,t)&&Dw(n)&&Nw(n,"value"))||Nw(n,"get")||Nw(n,"set")||n.configurable||Nw(n,"writable")&&!n.writable||Nw(n,"enumerable")&&!n.enumerable?Qw(e,t,n):(e[t]=n.value,e)};Sw?(rx||(Vw.f=vx,Jw.f=mx,px(ox,"buffer"),px(ox,"byteOffset"),px(ox,"byteLength"),px(ox,"length")),xw({target:"Object",stat:!0,forced:!rx},{getOwnPropertyDescriptor:vx,defineProperty:mx}),_b.exports=function(e,t,n){var r=e.match(/\d+$/)[0]/8,i=e+(n?"Clamped":"")+"Array",s="get"+e,a="set"+e,o=_w[i],u=o,c=u&&u.prototype,l={},f=function(e,t){Qw(e,t,{get:function(){return function(e,t){var n=Hw(e);return n.view[s](t*r+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var s=Hw(e);n&&(i=(i=Zw(i))<0?0:i>255?255:255&i),s.view[a](t*r+s.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};rx?Ew&&(u=t((function(e,t,n,s){return Iw(e,u,i),Kw(Dw(t)?hx(t)?void 0!==s?new o(t,Mw(n,r),s):void 0!==n?new o(t,Mw(n,r)):new o(t):cx(t)?dx(u,t):Ww.call(u,t):new o(jw(t)),e,u)})),qw&&qw(u,ax),Gw(zw(o),(function(e){e in u||Ow(u,e,o[e])})),u.prototype=c):(u=t((function(e,t,n,s){Iw(e,u,i);var a,o,c,l=0,d=0;if(Dw(t)){if(!hx(t))return cx(t)?dx(u,t):Ww.call(u,t);a=t,d=Mw(n,r);var p=t.byteLength;if(void 0===s){if(p%r)throw ex(fx);if((o=p-d)<0)throw ex(fx)}else if((o=Aw(s)*r)+d>p)throw ex(fx);c=o/r}else c=jw(t),a=new tx(o=c*r);for(Yw(e,{buffer:a,byteOffset:d,byteLength:o,length:c,view:new nx(a)});l<c;)f(e,l++)})),qw&&qw(u,ax),c=u.prototype=Bw(ox)),c.constructor!==u&&Ow(c,"constructor",u),Ow(c,ix,u),sx&&Ow(c,sx,i),l[i]=u,xw({global:!0,forced:u!=o,sham:!rx},l),lx in u||Ow(u,lx,r),lx in c||Ow(c,lx,r),$w(i)}):_b.exports=function(){},(0,_b.exports)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var gx=Q,bx=qt,kx=Ut,wx=Math.min,xx=[].copyWithin||function(e,t){var n=gx(this),r=kx(n.length),i=bx(e,r),s=bx(t,r),a=arguments.length>2?arguments[2]:void 0,o=wx((void 0===a?r:bx(a,r))-s,r-i),u=1;for(s<i&&i<s+o&&(u=-1,s+=o-1,i+=o-1);o-- >0;)s in n?n[i]=n[s]:delete n[i],i+=u,s+=u;return n},_x=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("copyWithin",(function(e,t){return xx.call(_x(this),e,t,arguments.length>2?arguments[2]:void 0)}));var Sx=Hr.every,Ex=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("every",(function(e){return Sx(Ex(this),e,arguments.length>1?arguments[1]:void 0)}));var Tx=bk,Rx=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("fill",(function(e){return Tx.apply(Rx(this),arguments)}));var Ix=qa,Cx=ek.TYPED_ARRAY_CONSTRUCTOR,Ox=ek.aTypedArrayConstructor,Px=function(e){return Ox(Ix(e,e[Cx]))},Ax=function(e,t){for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},jx=Px,Mx=Hr.filter,Lx=function(e,t){return Ax(jx(e),t)},Nx=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("filter",(function(e){var t=Mx(Nx(this),e,arguments.length>1?arguments[1]:void 0);return Lx(this,t)}));var Ux=Hr.find,Dx=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("find",(function(e){return Ux(Dx(this),e,arguments.length>1?arguments[1]:void 0)}));var Fx=Hr.findIndex,Bx=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("findIndex",(function(e){return Fx(Bx(this),e,arguments.length>1?arguments[1]:void 0)}));var qx=Hr.forEach,zx=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("forEach",(function(e){qx(zx(this),e,arguments.length>1?arguments[1]:void 0)}));var Wx=Jt.includes,Gx=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("includes",(function(e){return Wx(Gx(this),e,arguments.length>1?arguments[1]:void 0)}));var $x=Jt.indexOf,Jx=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("indexOf",(function(e){return $x(Jx(this),e,arguments.length>1?arguments[1]:void 0)}));var Vx=i,Kx=ek,Hx=Pl,Yx=pe("iterator"),Qx=Vx.Uint8Array,Xx=Hx.values,Zx=Hx.keys,e_=Hx.entries,t_=Kx.aTypedArray,n_=Kx.exportTypedArrayMethod,r_=Qx&&Qx.prototype[Yx],i_=!!r_&&("values"==r_.name||null==r_.name),s_=function(){return Xx.call(t_(this))};n_("entries",(function(){return e_.call(t_(this))})),n_("keys",(function(){return Zx.call(t_(this))})),n_("values",s_,!i_),n_(Yx,s_,!i_);var a_=ek.aTypedArray,o_=[].join;(0,ek.exportTypedArrayMethod)("join",(function(e){return o_.apply(a_(this),arguments)}));var u_=_,c_=Mt,l_=Ut,f_=ec,d_=Math.min,p_=[].lastIndexOf,h_=!!p_&&1/[1].lastIndexOf(1,-0)<0,y_=f_("lastIndexOf"),v_=h_||!y_?function(e){if(h_)return p_.apply(this,arguments)||0;var t=u_(this),n=l_(t.length),r=n-1;for(arguments.length>1&&(r=d_(r,c_(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:p_,m_=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("lastIndexOf",(function(e){return v_.apply(m_(this),arguments)}));var g_=Hr.map,b_=Px,k_=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("map",(function(e){return g_(k_(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(b_(e))(t)}))}));var w_=Cn,x_=Q,__=b,S_=Ut,E_=function(e){return function(t,n,r,i){w_(n);var s=x_(t),a=__(s),o=S_(s.length),u=e?o-1:0,c=e?-1:1;if(r<2)for(;;){if(u in a){i=a[u],u+=c;break}if(u+=c,e?u<0:o<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:o>u;u+=c)u in a&&(i=n(i,a[u],u,s));return i}},T_={left:E_(!1),right:E_(!0)},R_=T_.left,I_=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("reduce",(function(e){return R_(I_(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var C_=T_.right,O_=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("reduceRight",(function(e){return C_(O_(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var P_=ek.aTypedArray,A_=ek.exportTypedArrayMethod,j_=Math.floor;A_("reverse",(function(){for(var e,t=this,n=P_(t).length,r=j_(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t}));var M_=Ut,L_=hw,N_=Q,U_=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("set",(function(e){U_(this);var t=L_(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=N_(e),i=M_(r.length),s=0;if(i+t>n)throw RangeError("Wrong length");for(;s<i;)this[t+s]=r[s++]}),a((function(){new Int8Array(1).set({})})));var D_=Px,F_=ek.aTypedArray,B_=[].slice;(0,ek.exportTypedArrayMethod)("slice",(function(e,t){for(var n=B_.call(F_(this),e,t),r=D_(this),i=0,s=n.length,a=new r(s);s>i;)a[i]=n[i++];return a}),a((function(){new Int8Array(1).slice()})));var q_=Hr.some,z_=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("some",(function(e){return q_(z_(this),e,arguments.length>1?arguments[1]:void 0)}));var W_=a,G_=Cn,$_=Ut,J_=Vl,V_=Hl,K_=Yl,H_=L,Y_=Xl,Q_=ek.aTypedArray,X_=ek.exportTypedArrayMethod,Z_=i.Uint16Array,eS=Z_&&Z_.prototype.sort,tS=!!eS&&!W_((function(){var e=new Z_(2);e.sort(null),e.sort({})})),nS=!!eS&&!W_((function(){if(H_)return H_<74;if(V_)return V_<67;if(K_)return!0;if(Y_)return Y_<602;var e,t,n=new Z_(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(n.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));X_("sort",(function(e){var t=this;if(void 0!==e&&G_(e),nS)return eS.call(t,e);Q_(t);var n,r=$_(t.length),i=Array(r);for(n=0;n<r;n++)i[n]=t[n];for(i=J_(t,function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e)),n=0;n<r;n++)t[n]=i[n];return t}),!nS||tS);var rS=Ut,iS=qt,sS=Px,aS=ek.aTypedArray;(0,ek.exportTypedArrayMethod)("subarray",(function(e,t){var n=aS(this),r=n.length,i=iS(e,r);return new(sS(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,rS((void 0===t?r:iS(t,r))-i))}));var oS=ek,uS=a,cS=i.Int8Array,lS=oS.aTypedArray,fS=oS.exportTypedArrayMethod,dS=[].toLocaleString,pS=[].slice,hS=!!cS&&uS((function(){dS.call(new cS(1))}));fS("toLocaleString",(function(){return dS.apply(hS?pS.call(lS(this)):lS(this),arguments)}),uS((function(){return[1,2].toLocaleString()!=new cS([1,2]).toLocaleString()}))||!uS((function(){cS.prototype.toLocaleString.call([1,2])})));var yS=ek.exportTypedArrayMethod,vS=a,mS=i.Uint8Array,gS=mS&&mS.prototype||{},bS=[].toString,kS=[].join;vS((function(){bS.call({})}))&&(bS=function(){return kS.call(this)});var wS=gS.toString!=bS;yS("toString",bS,wS);var xS=S,_S=v,SS=pe("match"),ES=function(e){var t;return xS(e)&&(void 0!==(t=e[SS])?!!t:"RegExp"==_S(e))},TS=Yp,RS=ES,IS=De,CS=k,OS=qa,PS=Xp,AS=Ut,jS=gr,MS=ah,LS=zp,NS=a,US=mp.UNSUPPORTED_Y,DS=[].push,FS=Math.min,BS=4294967295;TS("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=jS(CS(this)),i=void 0===n?BS:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!RS(e))return t.call(r,e,i);for(var s,a,o,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,f=new RegExp(e.source,c+"g");(s=LS.call(f,r))&&!((a=f.lastIndex)>l&&(u.push(r.slice(l,s.index)),s.length>1&&s.index<r.length&&DS.apply(u,s.slice(1)),o=s[0].length,l=a,u.length>=i));)f.lastIndex===s.index&&f.lastIndex++;return l===r.length?!o&&f.test("")||u.push(""):u.push(r.slice(l)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=CS(this),s=null==t?void 0:t[e];return void 0!==s?s.call(t,i,n):r.call(jS(i),t,n)},function(e,i){var s=IS(this),a=jS(e),o=n(r,s,a,i,r!==t);if(o.done)return o.value;var u=OS(s,RegExp),c=s.unicode,l=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(US?"g":"y"),f=new u(US?"^(?:"+s.source+")":s,l),d=void 0===i?BS:i>>>0;if(0===d)return[];if(0===a.length)return null===MS(f,a)?[a]:[];for(var p=0,h=0,y=[];h<a.length;){f.lastIndex=US?0:h;var v,m=MS(f,US?a.slice(h):a);if(null===m||(v=FS(AS(f.lastIndex+(US?h:0)),a.length))===p)h=PS(a,h,c);else{if(y.push(a.slice(p,h)),y.length===d)return y;for(var g=1;g<=m.length-1;g++)if(y.push(m[g]),y.length===d)return y;h=p=v}}return y.push(a.slice(p)),y}]}),!!NS((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),US);var qS={exports:{}},zS={exports:{}};!function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.default=e.exports,e.exports.__esModule=!0}(zS);var WS={exports:{}},GS={exports:{}};!function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.default=e.exports,e.exports.__esModule=!0}(GS),function(e){var t=jy.exports,n=GS.exports;function r(i,s,a){return n()?(e.exports=r=Reflect.construct,e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=r=function(e,n,r){var i=[null];i.push.apply(i,n);var s=new(Function.bind.apply(e,i));return r&&t(s,r.prototype),s},e.exports.default=e.exports,e.exports.__esModule=!0),r.apply(null,arguments)}e.exports=r,e.exports.default=e.exports,e.exports.__esModule=!0}(WS),function(e){var t=Ny.exports,n=jy.exports,r=zS.exports,i=WS.exports;function s(a){var o="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!r(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(e))return o.get(e);o.set(e,s)}function s(){return i(e,arguments,t(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),n(s,e)},e.exports.default=e.exports,e.exports.__esModule=!0,s(a)}e.exports=s,e.exports.default=e.exports,e.exports.__esModule=!0}(qS);var $S={exports:{}};!function(e,n){(function(){var r={function:!0,object:!0}["undefined"==typeof window?"undefined":Os(window)]&&window||this,i=n,s=e&&!e.nodeType&&e,a=i&&s&&"object"==Os(t)&&t;!a||a.global!==a&&a.window!==a&&a.self!==a||(r=a);var o=Math.pow(2,53)-1,u=/\bOpera/,c=Object.prototype,l=c.hasOwnProperty,f=c.toString;function d(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function p(e){return e=g(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:d(e)}function h(e,t){for(var n in e)l.call(e,n)&&t(e[n],n,e)}function y(e){return null==e?d(e):f.call(e).slice(8,-1)}function v(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function m(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=o)for(;++n<r;)t(e[n],n,e);else h(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function g(e){return String(e).replace(/^ +| +$/g,"")}var b=function e(t){var n=r,i=t&&"object"==Os(t)&&"String"!=y(t);i&&(n=t,t=null);var s=n.navigator||{},a=s.userAgent||"";t||(t=a);var o,c,l=i?!!s.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(f.toString()),d="Object",b=i?d:"ScriptBridgingProxyObject",k=i?d:"Environment",w=i&&n.java?"JavaPackage":y(n.java),x=i?d:"RuntimeObject",_=/\bJava/.test(w)&&n.java,S=_&&y(n.environment)==k,E=_?"a":"α",T=_?"b":"β",R=n.document||{},I=n.operamini||n.opera,C=u.test(C=i&&I?I["[[Class]]"]:y(I))?C:I=null,O=t,P=[],A=null,j=t==a,M=j&&I&&"function"==typeof I.version&&I.version(),L=m([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||v(n))+"\\b","i").exec(t)&&(n.label||n)})),N=function(e){return m(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||v(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return m(e,(function(e,n,r){return e||(n[U]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+v(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),F=function(e){return m(e,(function(e,n){var r=n.pattern||v(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),p(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function B(e){return m(e,(function(e,n){var r=n.pattern||v(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=p(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function q(e){return m(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(F)&&!U&&(o=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(U=g(o[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!U?U=B([D]):D&&U&&(U=U.replace(RegExp("^("+v(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+v(D)+")[-_.]?(\\w)","i"),D+" $2")),(o=/\bGoogle TV\b/.exec(U))&&(U=o[0]),/\bSimulator\b/i.test(t)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==N&&/\bOPiOS\b/.test(t)&&P.push("running in Turbo/Uncompressed mode"),"IE"==N&&/\blike iPhone OS\b/.test(t)?(D=(o=e(t.replace(/like iPhone OS/,""))).manufacturer,U=o.product):/^iP/.test(U)?(N||(N="Safari"),F="iOS"+((o=/ OS ([\d_]+)/i.exec(t))?" "+o[1].replace(/_/g,"."):"")):"Konqueror"==N&&/^Linux\b/i.test(F)?F="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(U))||/\bAndroid\b/.test(F)&&/^Chrome/.test(N)&&/\bVersion\//i.test(t)?(N="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==N?(/\bMobi/i.test(t)||(F="Android",P.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&P.unshift("accelerated")):"UC Browser"==N&&/\bUCWEB\b/.test(t)?P.push("speed mode"):"PaleMoon"==N&&(o=/\bFirefox\/([\d.]+)\b/.exec(t))?P.push("identifying as Firefox "+o[1]):"Firefox"==N&&(o=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(F||(F="Firefox OS"),U||(U=o[1])):!N||(o=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!U&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(o+"/")+8))&&(N=null),(o=U||D||F)&&(U||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:o)+" Browser")):"Electron"==N&&(o=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&P.push("Chromium "+o),M||(M=q(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",v(N),"(?:Firefox|Minefield|NetFront)"])),(o=("iCab"==L&&parseFloat(M)>3?"WebKit":/\bOpera\b/.test(N)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(L=[o]),"IE"==N&&(o=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(N+=" Mobile",F="Windows Phone "+(/\+$/.test(o)?o:o+".x"),P.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(N="IE Mobile",F="Windows Phone 8.x",P.unshift("desktop mode"),M||(M=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=N&&"Trident"==L&&(o=/\brv:([\d.]+)/.exec(t))&&(N&&P.push("identifying as "+N+(M?" "+M:"")),N="IE",M=o[1]),j){if(function(e,t){var n=null!=e?Os(e[t]):"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(n,"global"))if(_&&(O=(o=_.lang.System).getProperty("os.arch"),F=F||o.getProperty("os.name")+" "+o.getProperty("os.version")),S){try{M=n.require("ringo/engine").version.join("."),N="RingoJS"}catch(e){(o=n.system)&&o.global.system==n.system&&(N="Narwhal",F||(F=o[0].os||null))}N||(N="Rhino")}else"object"==Os(n.process)&&!n.process.browser&&(o=n.process)&&("object"==Os(o.versions)&&("string"==typeof o.versions.electron?(P.push("Node "+o.versions.node),N="Electron",M=o.versions.electron):"string"==typeof o.versions.nw&&(P.push("Chromium "+M,"Node "+o.versions.node),N="NW.js",M=o.versions.nw)),N||(N="Node.js",O=o.arch,F=o.platform,M=(M=/[\d.]+/.exec(o.version))?M[0]:null));else y(o=n.runtime)==b?(N="Adobe AIR",F=o.flash.system.Capabilities.os):y(o=n.phantom)==x?(N="PhantomJS",M=(o=o.version||null)&&o.major+"."+o.minor+"."+o.patch):"number"==typeof R.documentMode&&(o=/\bTrident\/(\d+)/i.exec(t))?(M=[M,R.documentMode],(o=+o[1]+4)!=M[1]&&(P.push("IE "+M[1]+" mode"),L&&(L[1]=""),M[1]=o),M="IE"==N?String(M[1].toFixed(1)):M[0]):"number"==typeof R.documentMode&&/^(?:Chrome|Firefox)\b/.test(N)&&(P.push("masking as "+N+" "+M),N="IE",M="11.0",L=["Trident"],F="Windows");F=F&&p(F)}if(M&&(o=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(M)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(j&&s.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(A=/b/i.test(o)?"beta":"alpha",M=M.replace(RegExp(o+"\\+?$"),"")+("beta"==A?T:E)+(/\d+\+?/.exec(o)||"")),"Fennec"==N||"Firefox"==N&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(F))N="Firefox Mobile";else if("Maxthon"==N&&M)M=M.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(F=null),"Xbox 360"==U&&/\bIEMobile\b/.test(t)&&P.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(N)&&(!N||U||/Browser|Mobi/.test(N))||"Windows CE"!=F&&!/Mobi/i.test(t))if("IE"==N&&j)try{null===n.external&&P.unshift("platform preview")}catch(e){P.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(t))&&(o=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||M)?(F=((o=[o,/BB10/.test(t)])[1]?(U=null,D="BlackBerry"):"Device Software")+" "+o[0],M=null):this!=h&&"Wii"!=U&&(j&&I||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==N&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==N&&(F&&!/^Win/.test(F)&&M>5.5||/\bWindows XP\b/.test(F)&&M>8||8==M&&!/\bTrident\b/.test(t)))&&!u.test(o=e.call(h,t.replace(u,"")+";"))&&o.name&&(o="ing as "+o.name+((o=o.version)?" "+o:""),u.test(N)?(/\bIE\b/.test(o)&&"Mac OS"==F&&(F=null),o="identify"+o):(o="mask"+o,N=C?p(C.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(o)&&(F=null),j||(M=null)),L=["Presto"],P.push(o));else N+=" Mobile";(o=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(o=[parseFloat(o.replace(/\.(\d)$/,".0$1")),o],"Safari"==N&&"+"==o[1].slice(-1)?(N="WebKit Nightly",A="alpha",M=o[1].slice(0,-1)):M!=o[1]&&M!=(o[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(M=null),o[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==o[0]&&537.36==o[2]&&parseFloat(o[1])>=28&&"WebKit"==L&&(L=["Blink"]),j&&(l||o[1])?(L&&(L[1]="like Chrome"),o=o[1]||((o=o[0])<530?1:o<532?2:o<532.05?3:o<533?4:o<534.03?5:o<534.07?6:o<534.1?7:o<534.13?8:o<534.16?9:o<534.24?10:o<534.3?11:o<535.01?12:o<535.02?"13+":o<535.07?15:o<535.11?16:o<535.19?17:o<536.05?18:o<536.1?19:o<537.01?20:o<537.11?"21+":o<537.13?23:o<537.18?24:o<537.24?25:o<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),o=(o=o[0])<400?1:o<500?2:o<526?3:o<533?4:o<534?"4+":o<535?5:o<537?6:o<538?7:o<601?8:o<602?9:o<604?10:o<606?11:o<608?12:"12"),L&&(L[1]+=" "+(o+="number"==typeof o?".x":/[.+]/.test(o)?"":"+")),"Safari"==N&&(!M||parseInt(M)>45)?M=o:"Chrome"==N&&/\bHeadlessChrome/i.test(t)&&P.unshift("headless")),"Opera"==N&&(o=/\bzbov|zvav$/.exec(F))?(N+=" ",P.unshift("desktop mode"),"zvav"==o?(N+="Mini",M=null):N+="Mobile",F=F.replace(RegExp(" *"+o+"$"),"")):"Safari"==N&&/\bChrome\b/.exec(L&&L[1])?(P.unshift("desktop mode"),N="Chrome Mobile",M=null,/\bOS X\b/.test(F)?(D="Apple",F="iOS 4.3+"):F=null):/\bSRWare Iron\b/.test(N)&&!M&&(M=q("Chrome")),M&&0==M.indexOf(o=/[\d.]+$/.exec(F))&&t.indexOf("/"+o+"-")>-1&&(F=g(F.replace(o,""))),F&&-1!=F.indexOf(N)&&!RegExp(N+" OS").test(F)&&(F=F.replace(RegExp(" *"+v(N)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||"Safari"!=N&&/^iOS/.test(F)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(N)&&L[1])&&(o=L[L.length-1])&&P.push(o),P.length&&(P=["("+P.join("; ")+")"]),D&&U&&U.indexOf(D)<0&&P.push("on "+D),U&&P.push((/^on /.test(P[P.length-1])?"":"on ")+U),F&&(o=/ ([\d.+]+)$/.exec(F),c=o&&"/"==F.charAt(F.length-o[0].length-1),F={architecture:32,family:o&&!c?F.replace(o[0],""):F,version:o?o[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(o=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(O))&&!/\bi686\b/i.test(O)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+o),"")),N&&(/\bWOW64\b/i.test(t)||j&&/\w(?:86|32)$/.test(s.cpuClass||s.platform)&&!/\bWin64; x64\b/i.test(t))&&P.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==N&&parseFloat(M)>=39&&(F.architecture=64),t||(t=null);var z={};return z.description=t,z.layout=L&&L[0],z.manufacturer=D,z.name=N,z.prerelease=A,z.product=U,z.ua=t,z.version=N&&M,z.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},z.parse=e,z.toString=function(){return this.description||""},z.version&&P.unshift(M),z.name&&P.unshift(N),F&&N&&(F!=String(F).split(" ")[0]||F!=N.split(" ")[0]&&!U)&&P.push(U?"("+F+")":"on "+F),P.length&&(z.description=P.join(" ")),z}();i&&s?h(b,(function(e,t){i[t]=e})):r.platform=b}).call(t)}($S,$S.exports);var JS=De,VS=Ut,KS=gr,HS=k,YS=Xp,QS=ah;Yp("match",(function(e,t,n){return[function(t){var n=HS(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](KS(n))},function(e){var r=JS(this),i=KS(e),s=n(t,r,i);if(s.done)return s.value;if(!r.global)return QS(r,i);var a=r.unicode;r.lastIndex=0;for(var o,u=[],c=0;null!==(o=QS(r,i));){var l=KS(o[0]);u[c]=l,""===l&&(r.lastIndex=YS(i,VS(r.lastIndex),a)),c++}return 0===c?null:u}]}));var XS=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},ZS=De,eE=k,tE=XS,nE=gr,rE=ah;Yp("search",(function(e,t,n){return[function(t){var n=eE(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](nE(n))},function(e){var r=ZS(this),i=nE(e),s=n(t,r,i);if(s.done)return s.value;var a=r.lastIndex;tE(a,0)||(r.lastIndex=0);var o=rE(r,i);return tE(r.lastIndex,a)||(r.lastIndex=a),null===o?-1:o.index}]}));var iE=In,sE=qt,aE=Mt,oE=Ut,uE=Q,cE=qr,lE=gs,fE=os("splice"),dE=Math.max,pE=Math.min,hE=9007199254740991,yE="Maximum allowed length exceeded";iE({target:"Array",proto:!0,forced:!fE},{splice:function(e,t){var n,r,i,s,a,o,u=uE(this),c=oE(u.length),l=sE(e,c),f=arguments.length;if(0===f?n=r=0:1===f?(n=0,r=c-l):(n=f-2,r=pE(dE(aE(t),0),c-l)),c+n-r>hE)throw TypeError(yE);for(i=cE(u,r),s=0;s<r;s++)(a=l+s)in u&&lE(i,s,u[a]);if(i.length=r,n<r){for(s=l;s<c-r;s++)o=s+n,(a=s+r)in u?u[o]=u[a]:delete u[o];for(s=c;s>c-r+n;s--)delete u[s-1]}else if(n>r)for(s=c-r;s>l;s--)o=s+n-1,(a=s+r-1)in u?u[o]=u[a]:delete u[o];for(s=0;s<n;s++)u[s+l]=arguments[s+2];return u.length=c-r+n,i}}),function(e){var t=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Object.defineProperty(e,"__esModule",{value:!0});var n=Dg.exports,r=Qm.exports,i=Ly.exports,s=qg.exports,a=Ay.exports,o=My.exports,u=Ny.exports,c=Py.exports,l=Xm.exports,f=Fg,d=sy.exports,p=Ah,h=Qd.exports,y=Zg.exports,v=xb,m=qS.exports,g=Ym,b=$S.exports;function k(e){return e&&"object"===Os(e)&&"default"in e?e:{default:e}}function w(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var x=k(n),_=k(r),S=k(i),E=k(s),T=k(a),R=k(o),I=k(u),C=k(c),O=k(l),P=k(f),A=k(d),j=w(h),M=w(y),L=k(m),N=w(b);function U(){}function D(){D.init.call(this)}function F(e){return void 0===e._maxListeners?D.defaultMaxListeners:e._maxListeners}function B(e,t,n){if(t)e.call(n);else for(var r=e.length,i=K(e,r),s=0;s<r;++s)i[s].call(n)}function q(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=K(e,i),a=0;a<i;++a)s[a].call(n,r)}function z(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,a=K(e,s),o=0;o<s;++o)a[o].call(n,r,i)}function W(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var a=e.length,o=K(e,a),u=0;u<a;++u)o[u].call(n,r,i,s)}function G(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=K(e,i),a=0;a<i;++a)s[a].apply(n,r)}function $(e,t,n,r){var i,s,a,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=new U,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=F(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[t]=n,++e._eventsCount;return e}function J(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function V(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function K(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}U.prototype=Object.create(null),D.EventEmitter=D,D.usingDomains=!1,D.prototype.domain=void 0,D.prototype._events=void 0,D.prototype._maxListeners=void 0,D.defaultMaxListeners=10,D.init=function(){this.domain=null,D.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new U,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},D.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},D.prototype.getMaxListeners=function(){return F(this)},D.prototype.emit=function(e){var t,n,r,i,s,a,o,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(o=this.domain,u){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:B(n,l,this);break;case 2:q(n,l,this,arguments[1]);break;case 3:z(n,l,this,arguments[1],arguments[2]);break;case 4:W(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];G(n,l,this,i)}return!0},D.prototype.addListener=function(e,t){return $(this,e,t,!1)},D.prototype.on=D.prototype.addListener,D.prototype.prependListener=function(e,t){return $(this,e,t,!0)},D.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,J(this,e,t)),this},D.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,J(this,e,t)),this},D.prototype.removeListener=function(e,t){var n,r,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new U:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new U,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},D.prototype.off=function(e,t){return this.removeListener(e,t)},D.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new U,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new U:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),s=0;s<i.length;++s)"removeListener"!==(r=i[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new U,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},D.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},D.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):V.call(e,t)},D.prototype.listenerCount=V,D.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var H=j.getLogger("twilsock");function Y(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var Q=new(function(){function e(t){C.default(this,e),O.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?" "+t+":":""}return _.default(e,[{key:"setLevel",value:function(e){H.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.trace.apply(null,Y("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.debug.apply(null,Y("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.info.apply(null,Y("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.warn.apply(null,Y("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.error.apply(null,Y("E",t))}}],[{key:"setLevel",value:function(e){H.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.trace.apply(null,Y("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.debug.apply(null,Y("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.info.apply(null,Y("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.warn.apply(null,Y("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.error.apply(null,Y("E",t))}}]),e}())(""),X="0.12.1",Z=function(){function e(t,n,r){C.default(this,e),O.default(this,"confirmedCapabilities",new Set),this.activeGrant=n,this._token=t;var i=r.region||"us1",s="wss://tsock.".concat(i,".twilio.com/v3/wsconnect"),a=r.twilsock||r.Twilsock||{};this.url=a.uri||s,this._continuationToken=r.continuationToken?r.continuationToken:null,this.logLevel=r.logLevel?r.logLevel:"error",this.retryPolicy=r.retryPolicy?r.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=r.clientMetadata?r.clientMetadata:{},this.clientMetadata.ver=X,this.initRegistrations=r.initRegistrations?r.initRegistrations:null,this.tweaks=r.tweaks?r.tweaks:null}return _.default(e,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}}]),e}(),ee=function e(t){C.default(this,e),this.id=t||"TM".concat(v.v4())};function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ne=function(e){T.default(n,e);var t=te(n);function n(e,r,i,s,a){var o;return C.default(this,n),o=t.call(this),O.default(S.default(o),"method","init"),o.token=e,o.continuation_token=r,o.metadata=i,o.registrations=s,o.tweaks=a,o.capabilities=["client_update","offline_storage","telemetry.v1"],o}return n}(ee);function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ie=function(e){T.default(n,e);var t=re(n);function n(e,r,i,s,a,o,u){var c;return C.default(this,n),(c=t.call(this,e)).continuationToken=r,c.continuationTokenStatus=s,c.offlineStorage=a,c.initRegistrations=o,c.debugInfo=u,c.confirmedCapabilities=i,c}return n}(ee);function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ae=function(e){T.default(n,e);var t=se(n);function n(e){var r;return C.default(this,n),r=t.call(this),O.default(S.default(r),"method","update"),r.token=e,r}return n}(ee);function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Message=function(e){T.default(Message,e);var t=oe(Message);function Message(e,n,r){var i;return C.default(this,Message),i=t.call(this),O.default(S.default(i),"method","message"),i.active_grant=e,i.payload_type=n,i.http_request=r,i}return Message}(ee);function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ce=function(e){T.default(n,e);var t=ue(n);function n(e){var r;return C.default(this,n),r=t.call(this,e),O.default(S.default(r),"method","reply"),O.default(S.default(r),"payload_type","application/json"),O.default(S.default(r),"status",{code:200,status:"OK"}),r}return n}(ee);function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var fe=function(e){T.default(n,e);var t=le(n);function n(){var e;return C.default(this,n),e=t.call(this),O.default(S.default(e),"method","close"),e}return n}(ee);function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var pe=function e(t,n,r,i,s,a){C.default(this,e),this.start=t,this.end=n,this.title=r,this.details=i,this.id=s,this.type=a},he=function(e){T.default(n,e);var t=de(n);function n(e){var r;return C.default(this,n),r=t.call(this),O.default(S.default(r),"method","telemetry.v1"),r.events=e,r}return n}(ee);function ye(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})).length}function ve(e){var t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,(function(e,t){n[t]=e.charCodeAt(0)})),n}function me(e){var t=Array.prototype.map.call(e,(function(e){return String.fromCharCode(e)})).join("").replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function ge(e){return JSON.parse(me(e))}var be=function(){function e(){C.default(this,e)}return _.default(e,null,[{key:"parse",value:function(e){var t,n,r=new Uint8Array(e),i=function(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(r);if("TWILSOCK"!==i.protocol||"V3.0"!==i.version)return Q.error("unsupported protocol: ".concat(i.protocol," ver ").concat(i.version)),null;try{t=ge(r.subarray(i.size,i.size+i.headerSize))}catch(t){return Q.error("failed to parse message header",t,e),null}if(Q.debug("message received: ",t.method),Q.trace("message received: ",t),t.payload_size>0){var s=2+i.size+i.headerSize,a=t.payload_size;if(t.hasOwnProperty("payload_type")&&0!==t.payload_type.indexOf("application/json"))0===t.payload_type.indexOf("text/plain")&&(n=me(r.subarray(s,s+a)));else try{n=ge(r.subarray(s,s+a))}catch(t){return Q.error("failed to parse message body",t,e),null}}return{method:t.method,header:t,payload:n}}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=ye(t);var n=JSON.stringify(e),r="TWILSOCK V3.0 "+ye(n);Q.debug("send request:",r+n+t);var i=ve(r+"\r\n"+n+"\r\n"+t);return i.buffer}}]),e}();function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var we=function(e){T.default(n,e);var t=ke(n);function n(e){return C.default(this,n),t.call(this,e)}return n}(L.default(Error));function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var _e=function(e){T.default(n,e);var t=xe(n);function n(e,r){var i;return C.default(this,n),(i=t.call(this,e)).reply=r,i}return n}(we);function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){O.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Re=function(e){T.default(n,e);var t=Te(n);function n(e){var r;return C.default(this,n),r=t.call(this),O.default(S.default(r),"newBackoff",null),O.default(S.default(r),"usedBackoff",null),O.default(S.default(r),"retrier",null),r.options=e?Ee({},e):{},r}return _.default(n,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");var e,t;this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():null===(e=this.retrier)||void 0===e||e.failed(new Error):null===(t=this.retrier)||void 0===t||t.failed(new Error)}},{key:"cancel",value:function(){var e;null===(e=this.retrier)||void 0===e||e.cancel()}},{key:"cleanRetrier",value:function(){var e,t;null===(e=this.retrier)||void 0===e||e.removeAllListeners(),null===(t=this.retrier)||void 0===t||t.cancel(),this.retrier=null}},{key:"getRetryPolicy",value:function(){var e=Ee({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new g.Retrier(t),this.retrier.once("attempt",(function(){var t,n;null===(t=e.retrier)||void 0===t||t.on("attempt",(function(){return e.emit("attempt")})),null===(n=e.retrier)||void 0===n||n.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(function(t){return e.emit("failed",t)})),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}]),n}(D);function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Ce=function(e){T.default(i,e);var t,n,r=Ie(i);function i(e,t,n){var s;C.default(this,i),s=r.call(this),O.default(S.default(s),"disconnectingTimer",null),O.default(S.default(s),"disconnectedPromiseResolve",null),O.default(S.default(s),"terminalStates",["disconnected","rejected"]),O.default(S.default(s),"tokenExpiredSasCode",20104),O.default(S.default(s),"terminationReason","Connection is not initialized"),s.websocket=e,s.websocket.on("connected",(function(){return s.fsm.socketConnected()})),s.websocket.on("disconnected",(function(){return s.fsm.socketClosed()})),s.websocket.on("message",(function(e){return s.onIncomingMessage(e)})),s.websocket.on("socketError",(function(e){return s.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(e.message),httpStatusCode:null,errorCode:null})})),s.transport=t,s.config=n,s.retrier=new Re(n.retryPolicy),s.retrier.on("attempt",(function(){return s.retry()})),s.retrier.on("failed",(function(e){Q.warn("Retrying failed: ".concat(e.message)),s.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(function(){Q.debug("Browser reported connectivity state: online"),s.resetBackoff(),s.fsm.systemOnline()})),window.addEventListener("offline",(function(){Q.debug("Browser reported connectivity state: offline"),s.websocket.close(),s.fsm.socketClosed()})));var a=M.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){s.setupSocket(),s.emit("connecting")},onEnterInitialising:function(){s.sendInit()},onLeaveInitialising:function(){s.cancelInit()},onEnterUpdating:function(){s.sendUpdate()},onLeaveUpdating:function(){s.cancelUpdate()},onEnterRetrying:function(){s.initRetry(),s.emit("connecting")},onEnterConnected:function(){s.resetBackoff(),s.onConnected()},onUserUpdateToken:function(){s.resetBackoff()},onTokenRejected:function(){s.resetBackoff(),s.closeSocket(!0),s.finalizeSocket()},onUserDisconnect:function(){s.closeSocket(!0)},onEnterDisconnecting:function(){s.startDisconnectTimer()},onLeaveDisconnecting:function(){s.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){s.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){s.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){s.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){s.cancelDisconnectTimer()},onDisconnected:function(){s.resetBackoff(),s.finalizeSocket()},onReceiveClose:function(){s.onCloseReceived()},onReceiveOffload:function(e,t){Q.debug("onreceiveoffload: ",t),s.modifyBackoff(t.body),s.onCloseReceived()},onUnsupported:function(){s.closeSocket(!0),s.finalizeSocket()},onError:function(e,t){s.closeSocket(t),s.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&s.changeState(e)},onInvalidTransition:function(e,t,n){Q.warn("FSM: unexpected transition",t,n)}}});return s.fsm=new a,s}return _.default(i,[{key:"changeState",value:function(e){Q.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){Q.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){Q.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var e=this;Q.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((function(){Q.debug("disconnecting is timed out"),e.closeSocket(!0)}),3e3)}},{key:"cancelDisconnectTimer",value:function(){Q.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"initRetry",value:function(){Q.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(Q.trace("retry"),this.websocket.close(),this.fsm.userRetry()):Q.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){Q.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){Q.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=be.parse(e);if(t){var n=t.method,r=t.header,i=t.payload;if("reply"!==n&&this.confirmReceiving(r),"notification"===n)this.emit("message",r.message_type,i);else if("reply"===r.method)this.transport.processReply({id:r.id,status:r.status,header:r,body:i});else if("client_update"===r.method)"token_about_to_expire"===r.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===r.method)if(308===r.status.code)Q.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:r.status.status,body:i});else if(406===r.status.code){var s="Server closed connection because can't parse protocol: ".concat(JSON.stringify(r.status));this.emitReplyConnectionError(s,r,!0),Q.error(s),this.fsm.receiveFatalClose()}else 417===r.status.code?(Q.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose(r.status.status)):410===r.status.code?(Q.warn("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status),this.emit("tokenExpired")):401===r.status.code?(Q.error("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status)):(Q.warn("unexpected message: ",r.status),this.fsm.receiveOffload({status:r.status.status,body:null}))}}},{key:"sendInit",value:(n=x.default(P.default.mark((function e(){var t,n;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q.trace("sendInit"),e.prev=1,this.emit("beforeSendInit"),e.next=5,this.transport.sendInit();case 5:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.config.confirmedCapabilities=t.confirmedCapabilities,this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0 instanceof _e?(n=!1,Q.warn("Init rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),this.emit("sendInitFailed"),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.t0.message,e.t0.reply,n)):(this.terminationReason=e.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(e.t0.message,"\n").concat(JSON.stringify(e.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(){return n.apply(this,arguments)})},{key:"sendUpdate",value:(t=x.default(P.default.mark((function e(){var t,n,r;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q.trace("sendUpdate"),t=new ae(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:n=e.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof _e?(r=!1,Q.warn("Token update rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(r=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status),this.emitReplyConnectionError(e.t0.message,e.t0.reply,r)):(this.emit("error",!1,e.t0.message,null,null),this.fsm.updateError(e.t0)),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(){return t.apply(this,arguments)})},{key:"emitReplyConnectionError",value:function(e,t,n){var r=t.status&&t.status.description?t.status.description:e,i=t.status.code,s=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:"Connection error: ".concat(r),httpStatusCode:i,errorCode:s})}},{key:"cancelInit",value:function(){Q.trace("cancelInit")}},{key:"cancelUpdate",value:function(){Q.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){Q.trace("confirmReceiving");try{this.transport.send(new ce(e.id))}catch(e){Q.debug("failed to confirm packet receiving",e)}}},{key:"closeSocket",value:function(e){var t=this;Q.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((function(){return t.fsm.socketClosed()}),0)}},{key:"connect",value:function(){Q.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return Q.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()}))}},{key:"updateToken",value:function(e){var t=this;return Q.trace("updateToken:",e),new Promise((function(e,n){t.once("tokenUpdated",(function(t){t?n(t):e()})),t.fsm.userUpdateToken()}))}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(){this.websocket.close()}}]),i}(D),Oe=function(){function e(){C.default(this,e)}return _.default(e,null,[{key:"getMetadata",value:function(e){var t,n,r,i,s,a,o,u,c=e&&e.clientMetadata?e.clientMetadata:{},l={env:null!==(t=N.name)&&void 0!==t?t:"unknown",envv:null!==(n=N.version)&&void 0!==n?n:"unknown",os:null!==(r=null===(i=N.os)||void 0===i?void 0:i.family)&&void 0!==r?r:"unknown",osv:null!==(s=null===(a=N.os)||void 0===a?void 0:a.version)&&void 0!==s?s:"unknown",osa:null!==(o=null===(u=N.os)||void 0===u?void 0:u.architecture)&&void 0!==o?o:"unknown",sdk:"js-default"},f={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((function(e){return e in c||e in l})).forEach((function(e){return f[e]=e in c?c[e]:l[e]})),f}}]),e}();var Pe=function(){function e(t,n){var r=this;C.default(this,e),this.config=n,this.activeRequests=new Map,this.channel=t,this.channel.on("reply",(function(e){return r.processReply(e)})),this.channel.on("disconnected",(function(){r.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new we("disconnected"))})),r.activeRequests.clear()}))}var t;return _.default(e,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new _e("Transport failure: "+e.status.status,e)),Q.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout((function(){Q.trace("request",e,"is timed out"),n(new we("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,r)}},{key:"shutdown",value:function(){this.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new we("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}},{key:"sendInit",value:(t=x.default(P.default.mark((function e(){var t,n,r;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q.trace("sendInit"),t=Oe.getMetadata(this.config),n=new ne(this.config.token,this.config.continuationToken,t,this.config.initRegistrations,this.config.tweaks),e.next=5,this.sendWithReply(n);case 5:return r=e.sent,e.abrupt("return",new ie(r.id,r.header.continuation_token,new Set(r.header.capabilities),r.header.continuation_token_status,r.header.offline_storage,r.header.init_registrations,r.header.debug_info));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sendClose",value:function(){var e=new fe;this.send(e)}},{key:"sendWithReply",value:function(e,t){var n=this;return new Promise((function(r,i){var s=n.send(e,t);n.storeRequest(s,r,i)}))}},{key:"send",value:function(e,t){e.id=e.id||"TM".concat(v.v4());var n=be.createPacket(e,function(e){switch(A.default(e)){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw Q.debug("failed to send ",e,t),Q.trace(t.stack),t}}}]),e}();function Ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var je=function(e){T.default(r,e);var n=Ae(r);function r(e){var i;return C.default(this,r),i=n.call(this),O.default(S.default(i),"socket",null),i.url=e,i.url=e,i.WebSocket=t.WebSocket||t.MozWebSocket||{},i}return _.default(r,[{key:"isConnected",get:function(){return!!this.socket&&1===this.socket.readyState}},{key:"connect",value:function(){var e,t=this;Q.trace("connecting to socket");try{e=new this.WebSocket(this.url)}catch(e){return Q.debug("Socket error: ".concat(this.url)),void this.emit("socketError",e)}e.binaryType="arraybuffer",e.onopen=function(){Q.debug("socket opened ".concat(t.url)),t.emit("connected")},e.onclose=function(e){Q.debug("socket closed",e),t.emit("disconnected",e)},e.onerror=function(e){Q.debug("Socket error:",e),t.emit("socketError",e)},e.onmessage=function(e){t.emit("message",e.data)},this.socket=e}},{key:"send",value:function(e){return this.socket&&this.socket.send(e)}},{key:"close",value:function(){if(Q.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),r}(D);function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Le=function(e){T.default(u,e);var t,n,r,i,s,a,o=Me(u);function u(e){var t;return C.default(this,u),(t=o.call(this)).transport=e,t.registrations=new Map,t.registrationsInProgress=new Map,t}return _.default(u,[{key:"putNotificationContext",value:(a=x.default(P.default.mark((function e(t,n){var r;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(r,n);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"deleteNotificationContext",value:(s=x.default(P.default.mark((function e(t){var n;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"updateRegistration",value:(i=x.default(P.default.mark((function e(t,n){var r,i;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q.debug("update registration for context",t),(r=this.registrationsInProgress.get(t))||(r=new Set,this.registrationsInProgress.set(t,r)),i=v.v4(),r.add(i),e.prev=5,e.next=8,this.putNotificationContext(t,n);case 8:Q.debug("registration attempt succeeded for context",n),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),Q.warn("registration attempt failed for context",n),Q.debug(e.t0),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e,t){return i.apply(this,arguments)})},{key:"updateRegistrations",value:(r=x.default(P.default.mark((function e(){var t,n=this;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q.trace("refreshing ".concat(this.registrations.size," registrations")),t=[],this.registrations.forEach((function(e,r){t.push(n.updateRegistration(r,e))})),e.next=5,Promise.all(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setNotificationsContext",value:(n=x.default(P.default.mark((function e(t,n){return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}throw new we("Invalid arguments provided");case 2:return this.registrations.set(t,n),e.next=5,this.updateRegistration(t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeNotificationsContext",value:(t=x.default(P.default.mark((function e(t){return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(D);function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Ue=function(e){T.default(n,e);var t=Ne(n);function n(e,r,i){var s;return C.default(this,n),(s=t.call(this,r)).status=e,s.description=r,s.body=i,s}return n}(we);function De(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Fe=function(e){T.default(n,e);var t=De(n);function n(e){return C.default(this,n),t.call(this,e)}return n}(we);function Be(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:{}};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map((function(e){return e.split("=")})).reduce((function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e}),{})}return n}throw new we("Incorrect URI: "+e)}(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}function qe(e,t,n,r,i){return{to:Be(e,t),headers:n,body:r,grant:i}}var ze=function(){function e(t,n,r){C.default(this,e),this.config=r,this.transport=t,this.pendingMessages=[],this.twilsock=n}var t;return _.default(e,[{key:"saveMessage",value:function(e){var t=this;return new Promise((function(n,r){var i={message:e,resolve:n,reject:r,alreadyRejected:!1,timeout:setTimeout((function(){Q.debug("request is timed out"),r(new we("request '".concat(e.to.method,"' to '").concat(e.to.host,"' timed out"))),i.alreadyRejected=!0}),2e4)};t.pendingMessages.push(i)}))}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var n=t.message;e.actualSend(n).then((function(e){return t.resolve(e)})).catch((function(e){return t.reject(e)})),clearTimeout(t.timeout)}catch(e){return Q.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){var e=this;this.pendingMessages.forEach((function(t){t.reject(new Fe("Unable to connect: "+e.twilsock.getTerminationReason)),t.alreadyRejected=!0,clearTimeout(t.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:(t=x.default(P.default.mark((function e(t){var n,r,i,s,a,o,u,c;return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.to,i=t.headers,s=t.body,a=null!==(n=t.grant)&&void 0!==n?n:this.config.activeGrant,o={host:r.host,path:r.path,method:r.method,params:r.params,headers:i},u=new Message(a,i["Content-Type"]||"application/json",o),Q.trace("Sending upstream message",u),e.next=9,this.transport.sendWithReply(u,s);case 9:if(c=e.sent,Q.trace("Received upstream message response",c),!((f=c)&&f.header&&f.header.http_status)||(l=c.header.http_status.code)>=200&&l<300){e.next=13;break}throw new Ue(c.header.http_status.code,c.header.http_status.status,c.body);case 13:return e.abrupt("return",{status:c.header.http_status,headers:c.header.http_headers,body:c.body});case 14:case"end":return e.stop()}var l,f}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new Fe("Unable to connect: "+this.twilsock.getTerminationReason));var s=qe(e,t,n,r,i);return this.twilsock.isConnected?this.actualSend(s):this.saveMessage(s)}}]),e}(),We=function(){function e(){var t=this;C.default(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return _.default(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}(),Ge=function(){function e(t){C.default(this,e),this.id=t}return _.default(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new we('Field "storage_id" is missing')}}]),e}(),$e=function(){function e(){return C.default(this,e),O.default(this,"initializedFlag","twilio_twilsock_token_storage"),O.default(this,"tokenStoragePrefix","twilio_continuation_token_"),e._instance||(this.initialize(),e._instance=this),e._instance}return _.default(e,[{key:"sessionStorage",value:function(){try{return t.sessionStorage}catch(e){return null}}},{key:"window",value:function(){try{return t.window}catch(e){return null}}},{key:"storeToken",value:function(e,t){this.canStore()&&this.sessionStorage.setItem(this.getKeyName(t),e)}},{key:"getStoredToken",value:function(e){return this.canStore()?this.sessionStorage.getItem(this.getKeyName(e)):null}},{key:"initialize",value:function(){var e=this;if(this.canStore()){this.sessionStorage.getItem(this.initializedFlag)&&this.clear(),this.sessionStorage.setItem(this.initializedFlag,"true");var t=this.sessionStorage.removeItem;this.window.addEventListener("unload",(function(){t(e.initializedFlag)}))}}},{key:"clear",value:function(){if(this.canStore()){for(var e=[],t=0;t<this.sessionStorage.length;t++){var n=this.sessionStorage.key(t);n&&0===n.indexOf(this.tokenStoragePrefix)&&e.push(n)}var r=this.sessionStorage.removeItem;e.forEach((function(e){return r(e)})),r(this.initializedFlag)}}},{key:"getKeyName",value:function(e){return"".concat(this.tokenStoragePrefix).concat(e)}},{key:"canStore",value:function(){return!!(this.sessionStorage&&this.sessionStorage.length&&this.window)}}]),e}();O.default($e,"_instance",null);var Je,Ve,Ke=new $e,He=function(){function e(t,n,r,i,s,a){C.default(this,e),this.title=t,this.details=n,this.start=r,this.type=s,this.id=a,this.end=i}return _.default(e,[{key:"toTelemetryEvent",value:function(){var e=new Date,t=this.start,n=this.end?this.end:e;if(n<t){var r=n;n=t,t=r}var i=t.getTime()-e.getTime(),s=n.getTime()-e.getTime();return new pe(i,s,this.title,this.details,this.id,this.type)}}]),e}();e.TelemetryPoint=void 0,(Je=e.TelemetryPoint||(e.TelemetryPoint={}))[Je.Start=0]="Start",Je[Je.End=1]="End",e.EventSendingLimitation=void 0,(Ve=e.EventSendingLimitation||(e.EventSendingLimitation={}))[Ve.MinEventsPortion=0]="MinEventsPortion",Ve[Ve.AnyEvents=1]="AnyEvents",Ve[Ve.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished";var Ye=function(){function t(e,n){C.default(this,t),O.default(this,"minEventsPortionToSend",50),O.default(this,"maxEventsPortionToSend",100),O.default(this,"pendingEvents",new Map),O.default(this,"readyEvents",[]),O.default(this,"hasInitializationFinished",!1),O.default(this,"_canSendTelemetry",!1),this.config=e,this.packetInterface=n}return _.default(t,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(t){Q.debug("TelemetryTracker.canSendTelemetry: ".concat(t," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!t&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=t,t&&this.sendTelemetry(e.EventSendingLimitation.AnyEvents),t&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}},{key:"addPartialEvent",value:function(t,n,r){Q.debug("Adding ".concat(r===e.TelemetryPoint.Start?"starting":"ending"," timepoint for '").concat(n,"' event"));var i=this.pendingEvents.has(n);if(r===e.TelemetryPoint.Start)i&&Q.debug("Overwriting starting point for '".concat(n,"' event")),this.pendingEvents.set(n,t);else{if(!i)return void Q.info("Could not find started event for '".concat(n,"' event"));this.addTelemetryEvent(this.merge(this.pendingEvents.get(n),t)),this.pendingEvents.delete(n)}}},{key:"getTelemetryToSend",value:function(t){return this.canSendTelemetry&&0!=this.readyEvents.length?t==e.EventSendingLimitation.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(t==e.EventSendingLimitation.AnyEventsIncludingUnfinished):[]}},{key:"getTelemetryPortion",value:function(e){var t=this,n=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),r=this.readyEvents.splice(0,n);return e&&r.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach((function(e,n){if(!(r.length>=t.maxEventsPortionToSend)){var i=t.pendingEvents.get(n);t.pendingEvents.delete(n),r.push(new He("[UNFINISHED] ".concat(i.title),i.details,i.start,null,i.type,i.id))}})),r}},{key:"merge",value:function(e,t){return new He(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(e.EventSendingLimitation.MinEventsPortion)}},{key:"sendTelemetry",value:function(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new he(t.map((function(e){return e.toTelemetryEvent()}))))}catch(e){Q.debug("Error while sending ".concat(t.length," telemetry events due to ").concat(e,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(t)}}}]),t}();function Qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Xe=function e(){C.default(this,e)};O.default(Xe,"TWILSOCK_CONNECT","twilsock.sdk.connect"),O.default(Xe,"TWILSOCK_INIT","twilsock.sdk.init"),e.TwilsockClient=function(t){T.default(f,t);var n,r,i,s,a,o,u,c,l=Qe(f);function f(t,n,r){var i;C.default(this,f),i=l.call(this),O.default(S.default(i),"version",X),O.default(S.default(i),"offlineStorageDeferred",new We),r.continuationToken=r.continuationToken?r.continuationToken:Ke.getStoredToken(n);var s=i.config=new Z(t,n,r);Q.setLevel(s.logLevel);var a=new je(s.url),o=new Pe(a,s);return i.channel=new Ce(a,o,s),i.registrations=new Le(o),i.upstream=new ze(o,i.channel,s),i.telemetryTracker=new Ye(s,o),i.channel.on("initialized",(function(){return i.telemetryTracker.canSendTelemetry=!0})),a.on("disconnected",(function(){return i.telemetryTracker.canSendTelemetry=!1})),i.registrations.on("registered",(function(e){return i.emit("registered",e)})),i.channel.on("message",(function(e,t){return setTimeout((function(){return i.emit("message",e,t)}),0)})),i.channel.on("stateChanged",(function(e){return setTimeout((function(){return i.emit("stateChanged",e)}),0)})),i.channel.on("connectionError",(function(e){return setTimeout((function(){return i.emit("connectionError",e)}),0)})),i.channel.on("tokenAboutToExpire",(function(){return setTimeout((function(){return i.emit("tokenAboutToExpire")}),0)})),i.channel.on("tokenExpired",(function(){return setTimeout((function(){return i.emit("tokenExpired")}),0)})),i.channel.on("connected",(function(){return i.registrations.updateRegistrations()})),i.channel.on("connected",(function(){return i.upstream.sendPendingMessages()})),i.channel.on("connected",(function(){return setTimeout((function(){return i.emit("connected")}),0)})),i.channel.on("beforeConnect",(function(){return i.telemetryTracker.addPartialEvent(new He("Establish WebSocket connection","",new Date),Xe.TWILSOCK_CONNECT,e.TelemetryPoint.Start)})),i.channel.on("connected",(function(){return i.telemetryTracker.addPartialEvent(new He("Establish WebSocket connection","",new Date,new Date),Xe.TWILSOCK_CONNECT,e.TelemetryPoint.End)})),i.channel.on("beforeSendInit",(function(){return i.telemetryTracker.addPartialEvent(new He("Send Twilsock init","",new Date),Xe.TWILSOCK_INIT,e.TelemetryPoint.Start)})),i.channel.on("initialized",(function(){return i.telemetryTracker.addPartialEvent(new He("Send Twilsock init","Succeeded",new Date,new Date),Xe.TWILSOCK_INIT,e.TelemetryPoint.End)})),i.channel.on("sendInitFailed",(function(){return i.telemetryTracker.addPartialEvent(new He("Send Twilsock init","Failed",new Date,new Date),Xe.TWILSOCK_INIT,e.TelemetryPoint.End)})),i.channel.on("initialized",(function(e){i.handleStorageId(n,e),Ke.storeToken(e.continuationToken,n),setTimeout((function(){return i.emit("initialized",e)}),0)})),i.channel.on("disconnected",(function(){return setTimeout((function(){return i.emit("disconnected")}),0)})),i.channel.on("disconnected",(function(){return i.upstream.rejectPendingMessages()})),i.channel.on("disconnected",(function(){return i.offlineStorageDeferred.fail(new we("Client disconnected"))})),i.offlineStorageDeferred.promise.catch((function(){})),i}return _.default(f,[{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Q.debug("Emitting ".concat(e.toString(),"(").concat(r.map((function(e){return JSON.stringify(e)})).join(", "),")")),(t=E.default(I.default(f.prototype),"emit",this)).call.apply(t,[this,e].concat(r))}},{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(Ge.create(t.offlineStorage[e])),Q.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(n){this.offlineStorageDeferred.fail(new we("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(n,".")))}else this.offlineStorageDeferred.fail(new we("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new we("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:(c=x.default(P.default.mark((function e(t){return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q.trace("updating token '".concat(t,"'")),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.next=6,this.channel.updateToken(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"setNotificationsContext",value:(u=x.default(P.default.mark((function e(t,n){return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.setNotificationsContext(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"removeNotificationsContext",value:(o=x.default(P.default.mark((function e(t){return P.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.removeNotificationsContext(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:(a=x.default(P.default.mark((function t(){return P.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEventsIncludingUnfinished),t.next=3,this.channel.disconnect();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"get",value:(s=x.default(P.default.mark((function t(n,r,i){return P.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("GET",n,r,void 0,i);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"post",value:(i=x.default(P.default.mark((function t(n,r,i,s){return P.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("POST",n,r,i,s);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"put",value:(r=x.default(P.default.mark((function t(n,r,i,s){return P.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("PUT",n,r,i,s);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"delete",value:(n=x.default(P.default.mark((function t(n,r,i,s){return P.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("DELETE",n,r,i,s);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"addTelemetryEvent",value:function(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(t,n,r){this.telemetryTracker.addPartialEvent(t,n,r),r===e.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),f}(D),e.TwilsockClient=function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":A.default(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}([p.validateConstructorTypes(p.nonEmptyString,p.nonEmptyString,[p.pureObject,"undefined",p.literal(null)]),function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":A.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[String,String,Object])],e.TwilsockClient);var Ze=function(){function e(t){C.default(this,e),this.product=t,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}return _.default(e,[{key:"populateInitRegistrations",value:function(e){var t=new Set(this.message_types);for(var n in e)t.add(e[n]);this.message_types=Array.from(t)}}]),e}();e.InitRegistration=Ze,e.TelemetryEventDescription=He,e.TelemetryTracker=Ye,e.TransportUnavailableError=Fe,e.Twilsock=e.TwilsockClient,e.TwilsockError=we}(Bg);var vE=o,mE=a,gE=An,bE=tn,kE=u,wE=Q,xE=b,_E=Object.assign,SE=Object.defineProperty,EE=!_E||mE((function(){if(vE&&1!==_E({b:1},_E(SE({},"a",{enumerable:!0,get:function(){SE(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=_E({},e)[n]||gE(_E({},t)).join("")!=r}))?function(e,t){for(var n=wE(e),r=arguments.length,i=1,s=bE.f,a=kE.f;r>i;)for(var o,u=xE(arguments[i++]),c=s?gE(u).concat(s(u)):gE(u),l=c.length,f=0;l>f;)o=c[f++],vE&&!a.call(u,o)||(n[o]=u[o]);return n}:_E,TE=EE;In({target:"Object",stat:!0,forced:Object.assign!==TE},{assign:TE}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Dg.exports,n=Py.exports,r=Qm.exports,i=Ay.exports,s=My.exports,a=Ny.exports,o=Fg,u=sy.exports,c=Bg,l=Ly.exports,f=Xm.exports,d=Ym,p=yy.exports,h=Ry.exports,y=Qd.exports,v=xb,m=Ah;function g(e){return e&&"object"===Os(e)&&"default"in e?e:{default:e}}function b(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var k=g(t),w=g(n),x=g(r),_=g(i),S=g(s),E=g(a),T=g(o),R=g(u),I=g(l),C=g(f),O=g(p),P=g(h),A=b(y),j=b(v);function M(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":R.default(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}function L(e,t){if("object"===("undefined"==typeof Reflect?"undefined":R.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function N(){}function U(){U.init.call(this)}function D(e){return void 0===e._maxListeners?U.defaultMaxListeners:e._maxListeners}function F(e,t,n){if(t)e.call(n);else for(var r=e.length,i=V(e,r),s=0;s<r;++s)i[s].call(n)}function B(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=V(e,i),a=0;a<i;++a)s[a].call(n,r)}function q(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,a=V(e,s),o=0;o<s;++o)a[o].call(n,r,i)}function z(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var a=e.length,o=V(e,a),u=0;u<a;++u)o[u].call(n,r,i,s)}function W(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=V(e,i),a=0;a<i;++a)s[a].apply(n,r)}function G(e,t,n,r){var i,s,a,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=new N,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=D(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[t]=n,++e._eventsCount;return e}function $(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function J(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function V(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}N.prototype=Object.create(null),U.EventEmitter=U,U.usingDomains=!1,U.prototype.domain=void 0,U.prototype._events=void 0,U.prototype._maxListeners=void 0,U.defaultMaxListeners=10,U.init=function(){this.domain=null,U.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new N,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},U.prototype.getMaxListeners=function(){return D(this)},U.prototype.emit=function(e){var t,n,r,i,s,a,o,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(o=this.domain,u){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:F(n,l,this);break;case 2:B(n,l,this,arguments[1]);break;case 3:q(n,l,this,arguments[1],arguments[2]);break;case 4:z(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];W(n,l,this,i)}return!0},U.prototype.addListener=function(e,t){return G(this,e,t,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(e,t){return G(this,e,t,!0)},U.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,$(this,e,t)),this},U.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,$(this,e,t)),this},U.prototype.removeListener=function(e,t){var n,r,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new N:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new N,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},U.prototype.off=function(e,t){return this.removeListener(e,t)},U.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new N,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new N:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),s=0;s<i.length;++s)"removeListener"!==(r=i[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new N,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},U.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},U.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):J.call(e,t)},U.prototype.listenerCount=J,U.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var K=A.getLogger("twilio-notificatiions");function H(e,t){return["".concat((new Date).toISOString()," Twilio.Notifications ").concat(e,":")].concat(Array.from(t))}var Y=new(function(){function e(){w.default(this,e)}return x.default(e,[{key:"setLevel",value:function(e){K.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];K.trace.apply(null,H("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];K.debug.apply(null,H("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];K.info.apply(null,H("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];K.warn.apply(null,H("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];K.error.apply(null,H("E",t))}}]),e}());function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var X=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;w.default(this,e),this.token=t,this.notificationId=n,this.messageTypes=r};function Z(e,t){var n=new Set;return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return[].concat(P.default(P.default(e).filter((function(e){return!t.has(e)}))),P.default(P.default(t).filter((function(t){return!e.has(t)}))))}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}var ee=function(e){_.default(r,e);var t,n=Q(r);function r(e){var t;return w.default(this,r),t=n.call(this),C.default(I.default(t),"desiredState",new X),C.default(I.default(t),"currentState",new X),C.default(I.default(t),"_hasActiveAttempt",!1),t.channelType=e,t}return x.default(r,[{key:"setNotificationId",value:function(e){this.desiredState.notificationId=e}},{key:"isActive",value:function(){return""!==this.desiredState.notificationId}},{key:"subscribe",value:function(e){this.desiredState.messageTypes.has(e)?Y.debug("message type '".concat(e,"' for channel ").concat(this.channelType," is already registered")):this.desiredState.messageTypes.add(e)}},{key:"unsubscribe",value:function(e){this.desiredState.messageTypes.has(e)&&this.desiredState.messageTypes.delete(e)}},{key:"updateToken",value:function(e){this.desiredState.token=e}},{key:"commitChanges",value:(t=k.default(T.default.mark((function e(){var t,n,r,i,s,a;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._hasActiveAttempt){e.next=3;break}throw Y.error("One registration attempt is already in progress"),new Error("One registration attempt is already in progress");case 3:if(t=Z(this.desiredState,this.currentState),n=O.default(t,2),r=n[0],i=n[1],r){e.next=6;break}return e.abrupt("return");case 6:if(this.currentState.notificationId||i.delete("notificationId"),Y.trace("Persisting ".concat(this.channelType," registration"),i,this.desiredState),e.prev=8,this._hasActiveAttempt=!0,(s=new X).token=this.desiredState.token,s.notificationId=this.desiredState.notificationId,s.messageTypes=new Set(this.desiredState.messageTypes),!(s.messageTypes.size>0)){e.next=24;break}return e.next=17,this.updateRegistration(s,i);case 17:a=e.sent,this.currentState.token=a.token,this.currentState.notificationId=a.notificationId,this.currentState.messageTypes=new Set(a.messageTypes),this.emit("stateChanged",this.channelType,"registered",this.currentState),e.next=30;break;case 24:return e.next=26,this.removeRegistration();case 26:this.currentState.token=s.token,this.currentState.notificationId=s.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged",this.channelType,"unregistered",this.currentState);case 30:e.next=35;break;case 32:throw e.prev=32,e.t0=e.catch(8),e.t0;case 35:return e.prev=35,this._hasActiveAttempt=!1,e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[8,32,35,38]])}))),function(){return t.apply(this,arguments)})}]),r}(U);function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var ne={min:2e3,max:12e4,randomness:.2},re=function(e){_.default(s,e);var t,n,r,i=te(s);function s(e,t,n,r){var a;return w.default(this,s),a=i.call(this,e),C.default(I.default(a),"registrationId",null),a.context=t,a.twilsock=n,a.registrarUrl=r,a}return x.default(s,[{key:"updateRegistration",value:(r=k.default(T.default.mark((function e(t,n){var r,i,s,a,o,u=this;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.has("notificationId")){e.next=3;break}return e.next=3,this.removeRegistration();case 3:if(t.notificationId&&t.notificationId.length){e.next=6;break}throw Y.error("No push notification ID for registration"),new Error("No push notification ID for registration");case 6:return Y.trace("Registering",this.channelType,t),r={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(t.messageTypes),data:{registration_id:t.notificationId}},i=this.context.productId,s="".concat(this.registrarUrl,"?productId=").concat(i),a={"Content-Type":"application/json"},Y.trace("Creating registration for channel ".concat(this.channelType)),e.prev=12,e.next=15,new d.AsyncRetrier(ne).run((function(){return u.twilsock.post(s,a,r,i)}));case 15:o=e.sent,this.registrationId=o.body.id,Y.debug("Registration created: ",o),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(12),Y.error("Registration failed: ",e.t0),e.t0;case 24:return e.abrupt("return",t);case 25:case"end":return e.stop()}}),e,this,[[12,20]])}))),function(e,t){return r.apply(this,arguments)})},{key:"removeRegistration",value:(n=k.default(T.default.mark((function e(){var t,n,r,i=this;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrationId){e.next=2;break}return e.abrupt("return");case 2:return t=this.context.productId,n="".concat(this.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(t),r={"Content-Type":"application/json"},Y.trace("Removing registration for ".concat(this.channelType)),e.prev=6,e.next=9,new d.AsyncRetrier(Object.assign(ne,{maxAttemptsCount:3})).run((function(){return i.twilsock.delete(n,r,{},t)}));case 9:this.registrationId=null,this.currentState.notificationId="",Y.debug("Registration removed for ".concat(this.channelType)),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(6),Y.error("Failed to remove registration ",this.channelType,e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(){return n.apply(this,arguments)})},{key:"sendDeviceRemoveRequest",value:(t=k.default(T.default.mark((function e(t){var n,r,i,s,a=this;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=2;break}throw new Error("Empty registration ID");case 2:return n=this.context.productId,r="".concat(this.registrarUrl,"?productId=").concat(n),i={"Content-Type":"application/json"},s={binding_type:this.channelType,address:t},e.prev=6,Y.trace("Removing old registrations for ".concat(this.channelType)),e.next=10,new d.AsyncRetrier(Object.assign(ne,{maxAttemptsCount:3})).run((function(){return a.twilsock.delete(r,i,s,n)}));case 10:this.registrationId=null,this.currentState.notificationId="",Y.debug("Registration removed for ".concat(this.channelType)),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(6),Y.error("Failed to remove registration ",this.channelType,e.t0),e.t0;case 19:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e){return t.apply(this,arguments)})}]),s}(ee);function ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var se,ae=function(e){_.default(s,e);var t,n,r,i=ie(s);function s(e,t,n){var r;return w.default(this,s),r=i.call(this,"twilsock"),C.default(I.default(r),"contextId",j.v4()),r.productId=e,r.platform=t,r.twilsock=n,r}return x.default(s,[{key:"updateRegistration",value:(r=k.default(T.default.mark((function e(t,n){var r,i;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.has("messageType")){e.next=2;break}return e.abrupt("return",t);case 2:return r=Array.from(t.messageTypes),i={product_id:this.productId,notification_protocol_version:4,endpoint_platform:this.platform,message_types:r},e.prev=4,e.next=7,this.twilsock.setNotificationsContext(this.contextId,i);case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(4),Y.error("Failed to update twilsock notification context: ".concat(e.t0)),e.t0;case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(e,t){return r.apply(this,arguments)})},{key:"removeRegistration",value:(n=k.default(T.default.mark((function e(){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.twilsock.removeNotificationsContext(this.contextId);case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),Y.error("Failed to remove twilsock notification context: ".concat(e.t0)),e.t0;case 9:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return n.apply(this,arguments)})},{key:"sendDeviceRemoveRequest",value:(t=k.default(T.default.mark((function e(t){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),s}(ee);function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var ue=m.literal("apn","fcm","twilsock");e.Notifications=se=function(e){_.default(Client,e);var t,n,r,i=oe(Client);function Client(e){var t,n,r,s,a,o,u,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w.default(this,Client),u=i.call(this),l.logLevel=null!==(t=l.logLevel)&&void 0!==t?t:"error",Y.setLevel(l.logLevel);var f=null!==(n=l.productId)&&void 0!==n?n:"notifications",d=!l.twilsockClient,p=l.twilsockClient=null!==(r=l.twilsockClient)&&void 0!==r?r:new c.TwilsockClient(e,f,l),h=null!==(s=l.notifications)&&void 0!==s?s:{},y=null!==(a=null!==(o=h.region)&&void 0!==o?o:l.region)&&void 0!==a?a:"us1",v="https://ers.".concat(y,".twilio.com/v1/registrations"),m=h.ersUrl||v;u.connectors=new Map;var g=se._detectPlatform();return u.connectors.set("apn",new re("apn",{protocolVersion:4,productId:f,platform:g},p,m)),u.connectors.set("fcm",new re("fcm",{protocolVersion:3,productId:f,platform:g},p,m)),u.connectors.set("twilsock",new ae(f,g,p)),p.on("stateChanged",(function(e){return u.emit("transportState",e)})),u._connector("twilsock").on("stateChanged",(function(e,t,n){return u.emit("stateChanged",e,t,n)})),u._connector("apn").on("stateChanged",(function(e,t,n){return u.emit("stateChanged",e,t,n)})),u._connector("fcm").on("stateChanged",(function(e,t,n){return u.emit("stateChanged",e,t,n)})),p.on("message",(function(e,t){return u._routeMessage(e,t)})),u.updateToken(e),d&&(p.connect(),u.twilsock=p),u}return x.default(Client,[{key:"shutdown",value:(r=k.default(T.default.mark((function e(){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectors.clear(),!this.twilsock){e.next=4;break}return e.next=4,this.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setPushRegistrationId",value:function(e,t){Y.debug("Set ".concat(e," push registration id '").concat(t,"'")),this._connector(e).setNotificationId(t)}},{key:"subscribe",value:function(e,t){Y.debug("Add ".concat(e," subscriptions for message type ").concat(t)),this._connector(e).subscribe(t)}},{key:"unsubscribe",value:function(e,t){Y.debug("Remove ".concat(e," subscriptions for message type ").concat(t)),this._connector(e).unsubscribe(t)}},{key:"updateToken",value:function(e){this.connectors.forEach((function(t){return t.updateToken(e)}))}},{key:"commitChanges",value:(n=k.default(T.default.mark((function e(){var t;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.connectors.forEach((function(e){e.isActive()&&t.push(e.commitChanges())})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"removeRegistrations",value:(t=k.default(T.default.mark((function e(t,n){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._connector(t).sendDeviceRemoveRequest(n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"handlePushNotification",value:function(e){return{messageType:e.twi_message_type,payload:e.payload}}},{key:"_routeMessage",value:function(e,t){Y.debug("Notification message arrived: ",e,t),this.emit("message",e,t)}},{key:"_connector",value:function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: ".concat(e));return t}}],[{key:"_detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),Client}(U),M([m.validateTypes(ue,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",void 0)],e.Notifications.prototype,"setPushRegistrationId",null),M([m.validateTypes(ue,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",void 0)],e.Notifications.prototype,"subscribe",null),M([m.validateTypes(ue,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",void 0)],e.Notifications.prototype,"unsubscribe",null),M([m.validateTypes(m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String]),L("design:returntype",void 0)],e.Notifications.prototype,"updateToken",null),M([m.validateTypesAsync(ue,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",Promise)],e.Notifications.prototype,"removeRegistrations",null),e.Notifications=se=M([m.validateConstructorTypes(m.nonEmptyString,[m.pureObject,"undefined",m.literal(null)]),L("design:paramtypes",[String,Object])],e.Notifications)}(Ug);var RE={};Object.defineProperty(RE,"__esModule",{value:!0});var IE=Dg.exports,CE=Py.exports,OE=Qm.exports,PE=Ly.exports,AE=Ay.exports,jE=My.exports,ME=Ny.exports,LE=Xm.exports,NE=Fg,UE=sy.exports,DE=Ah,FE=Bg,BE=qS.exports,qE=Qd.exports,zE=yy.exports,WE=Ym,GE=xb,$E=qg.exports,JE=$S.exports;function VE(e){return e&&"object"===Os(e)&&"default"in e?e:{default:e}}function KE(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var HE=VE(IE),YE=VE(CE),QE=VE(OE),XE=VE(PE),ZE=VE(AE),eT=VE(jE),tT=VE(ME),nT=VE(LE),rT=VE(NE),iT=VE(UE),sT=VE(BE),aT=KE(qE),oT=VE(zE),uT=KE(GE),cT=VE($E),lT=KE(JE);function fT(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":iT.default(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}function dT(e,t){if("object"===("undefined"==typeof Reflect?"undefined":iT.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function pT(){}function hT(){hT.init.call(this)}function yT(e){return void 0===e._maxListeners?hT.defaultMaxListeners:e._maxListeners}function vT(e,t,n){if(t)e.call(n);else for(var r=e.length,i=ST(e,r),s=0;s<r;++s)i[s].call(n)}function mT(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=ST(e,i),a=0;a<i;++a)s[a].call(n,r)}function gT(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,a=ST(e,s),o=0;o<s;++o)a[o].call(n,r,i)}function bT(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var a=e.length,o=ST(e,a),u=0;u<a;++u)o[u].call(n,r,i,s)}function kT(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=ST(e,i),a=0;a<i;++a)s[a].apply(n,r)}function wT(e,t,n,r){var i,s,a,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=new pT,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=yT(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[t]=n,++e._eventsCount;return e}function xT(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function _T(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function ST(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}pT.prototype=Object.create(null),hT.EventEmitter=hT,hT.usingDomains=!1,hT.prototype.domain=void 0,hT.prototype._events=void 0,hT.prototype._maxListeners=void 0,hT.defaultMaxListeners=10,hT.init=function(){this.domain=null,hT.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new pT,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},hT.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},hT.prototype.getMaxListeners=function(){return yT(this)},hT.prototype.emit=function(e){var t,n,r,i,s,a,o,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(o=this.domain,u){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:vT(n,l,this);break;case 2:mT(n,l,this,arguments[1]);break;case 3:gT(n,l,this,arguments[1],arguments[2]);break;case 4:bT(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];kT(n,l,this,i)}return!0},hT.prototype.addListener=function(e,t){return wT(this,e,t,!1)},hT.prototype.on=hT.prototype.addListener,hT.prototype.prependListener=function(e,t){return wT(this,e,t,!0)},hT.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,xT(this,e,t)),this},hT.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,xT(this,e,t)),this},hT.prototype.removeListener=function(e,t){var n,r,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new pT:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new pT,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},hT.prototype.off=function(e,t){return this.removeListener(e,t)},hT.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new pT,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new pT:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),s=0;s<i.length;++s)"removeListener"!==(r=i[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new pT,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},hT.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},hT.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_T.call(e,t)},hT.prototype.listenerCount=_T,hT.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var ET=function(){function e(t){YE.default(this,e),this.base=t,this.args=new Array,this.paths=new Array}return QE.default(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();function TT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}var RT=function(e){ZE.default(n,e);var t=TT(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return YE.default(this,n),(r=t.call(this)).name=r.constructor.name,r.message="".concat(e," (status: ").concat(i,", code: ").concat(s,")"),r.status=i,r.code=s,r}return n}(sT.default(Error)),IT=function(e){ZE.default(n,e);var t=TT(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;return YE.default(this,n),(r=t.call(this,e,i,s)).body=a,r}return n}(RT);function CT(e){return JSON.parse(JSON.stringify(e))}function OT(e){if(!(void 0===e||PT(e)))throw new RT("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function PT(e){return function(e){return!isNaN(parseInt(e))&&isFinite(e)}(e)&&e>0}var AT=aT.getLogger("twilio-sync");function jT(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}var MT=function(e){AT.setLevel(e)},LT=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];AT.trace.apply(null,jT("T",t))},NT=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];AT.debug.apply(null,jT("D",t))},UT=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];AT.warn.apply(null,jT("W",t))},DT=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];AT.error.apply(null,jT("E",t))},FT="/v4/Subscriptions",BT="/v3/Maps",qT="/v3/Lists",zT="/v3/Documents",WT="/v3/Streams",GT="/v3/Insights";function $T(e,t,n){return e&&void 0!==e[t]?e[t]:n}var JT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};YE.default(this,e);var n=t.region||"us1",r="https://cds.".concat(n,".twilio.com"),i=t.cdsUri||r;this.settings={subscriptionsUri:i+FT,documentsUri:i+zT,listsUri:i+qT,mapsUri:i+BT,streamsUri:i+WT,insightsUri:i+GT,sessionStorageEnabled:$T(t.Sync,"enableSessionStorage",!0),productId:t.productId}}return QE.default(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();function VT(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return KT(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return KT(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function KT(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var HT=function(){function e(t){YE.default(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return QE.default(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new RT("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"setSubscriptionState",value:function(e){this.localObject._setSubscriptionState(e)}}]),e}(),YT=function(){function e(t){var n=this;YE.default(this,e),nT.default(this,"isConnected",!1),nT.default(this,"maxBatchSize",100),nT.default(this,"subscriptionTtlTimer",null),nT.default(this,"pendingPokeReason",null),this.services=t,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=WE.Backoff.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),NT("All subscriptions resolved."))}))}var t;return QE.default(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i,s=[],a=VT(e);try{for(a.s();!(i=a.n()).done;){var o=oT.default(i.value,2),u=o[0],c=o[1];if(!t.get(u)&&n!==c.pendingAction&&!c.rejectedWithError&&(s.push(c),r&&s.length>=r))break}}catch(e){a.e(e)}finally{a.f()}return s}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:(t=HE.default(rT.default.mark((function e(t,n){var r,i,s,a,o,u,c,l,f,d,p,h,y=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return NT("Twilsock connection (required for subscription) not ready; waiting…"),this.backoff.reset(),e.abrupt("return");case 4:n=this.processLocalActions(t,n),r=(new Date).getTime(),i=VT(n);try{for(i.s();!(s=i.n()).done;)a=s.value,this.recordActionAttemptOn(a,t,r)}catch(e){i.e(e)}finally{i.f()}return o=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=10,e.next=13,this.request(t,r,o,n);case 13:u=e.sent,c=u.body.max_batch_size,!isNaN(parseInt(c))&&isFinite(c)&&c>0&&(this.maxBatchSize=c),this.subscriptionTtlTimer||(l=u.body.ttl_in_s,!isNaN(parseFloat(l))&&isFinite(l)&&l>0&&(this.subscriptionTtlTimer=setTimeout((function(){return y.onSubscriptionTtlElapsed()}),1e3*l))),"establish"===t&&(f=u.body.estimated_delivery_in_ms,!isNaN(parseFloat(f))&&isFinite(f)&&f>0?setTimeout((function(){return y.verifyPokeDelivery(r,f,n)}),f):DT("Invalid timeout: ".concat(f)),n.filter((function(e){return e.pendingCorrelationId===r})).forEach((function(e){return e.setSubscriptionState("response_in_flight")}))),this.backoff.reset(),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(10),d=VT(n);try{for(d.s();!(p=d.n()).done;)h=p.value,this.recordActionFailureOn(h,t)}catch(e){d.e(e)}finally{d.f()}e.t0 instanceof FE.TransportUnavailableError?(NT("Twilsock connection (required for subscription) not ready (c:".concat(r,"); waiting…")),this.backoff.reset()):(NT("Failed an attempt to ".concat(t," subscriptions (c:").concat(r,"); retrying"),e.t0),this.persist());case 26:case"end":return e.stop()}}),e,this,[[10,21]])}))),function(e,n){return t.apply(this,arguments)})},{key:"verifyPokeDelivery",value:function(e,t,n){var r=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),s=i?(new Date).getTime()-i:t;s>=t?(n.filter((function(t){return t.pendingCorrelationId===e})).forEach((function(e){e.updatePending(null,null),e.retryCount++,r.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout((function(){return r.verifyPokeDelivery(e,t,n)}),t-s)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter((function(e){return!e.rejectedWithError})):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}},{key:"recordActionFailureOn",value:function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n,r){var i=r.map((function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}})),s=r.filter((function(e){return e.retryCount>0})).length;NT("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var a={event_protocol_version:3,action:e,correlation_id:t,retried_requests:s,ttl_in_s:-1,requests:i};return"ttl"===n&&(a.reason=n),this.services.network.post(this.services.config.subscriptionsUri,a)}},{key:"add",value:function(e,t){NT("Establishing intent to subscribe to ".concat(e));var n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new HT(t)),this.persist())}},{key:"remove",value:function(e){NT("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){var n;switch(LT("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(n=e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:var r;switch(n[0]){case"map_":r=e.event.map_sid;break;case"list_":r=e.event.list_sid;break;case"document_":r=e.event.document_sid;break;case"stream_":r=e.event.stream_sid;break;case"live_query_":r=e.event.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:r=void 0}this.applyEventToSubscribedEntity(r,e,t);break;default:NT("Dropping unknown message type ".concat(e.event_type))}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(NT("Event Replay for subscription to ".concat(n," (c:").concat(t,") interrupted; continuing eagerly.")),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(NT("Event Replay for subscription to ".concat(n," (c:").concat(t,") completed. Subscription is ready.")),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):NT("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):NT("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(DT("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,n){if(e){var r;n=n||(r=this.persisted.get(e))&&r.isEstablished;var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,n)):NT("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){NT("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t,n=[],r=VT(this.persisted.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.reset(),i.rejectedWithError&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}this.persisted.clear();for(var s=0,a=n;s<a.length;s++){var o=a[s];this.persisted.set(o.sid,o)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();function QT(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function XT(e){return e.body?e.body.code:0}function ZT(e){return 409===e.status?new IT(QT(e),e.status,XT(e),e.body):e.status?new RT(QT(e),e.status,XT(e)):e instanceof FE.TransportUnavailableError?e:new RT(e.message,0,0)}var eR=function(){function e(t,n,r){YE.default(this,e),this.clientInfo=t,this.config=n,this.transport=r}return QE.default(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+uT.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){var s=[502,503,504];n&&s.push(429);var a=new WE.Retrier(t.backoffConfig());a.on("attempt",(function(){e().then((function(e){return a.succeeded(e)})).catch((function(e){if(s.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);a.failed(ZT(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?a.failed(ZT(e)):(a.removeAllListeners(),a.cancel(),i(ZT(e)))}))})),a.on("succeeded",(function(e){r(e)})),a.on("cancelled",(function(e){return i(ZT(e))})),a.on("failed",(function(e){return i(ZT(e))})),a.start()}))}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return NT("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.get(e,n,t.config.productId)}),!0)}},{key:"post",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.createHeaders();return null!=n&&(s["If-Match"]=n),NT("POST",e,"ID:",s["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.post(e,s,t,r.config.productId)}),i)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return null!=n&&(i["If-Match"]=n),NT("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.put(e,i,t,r.config.productId)}),!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return NT("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.delete(e,n,t.config.productId)}),!1)}}]),e}(),tR=function(){function e(t,n){YE.default(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(e){}}return QE.default(e,[{key:"storageKey",value:function(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}}]),e}();function nR(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return rR(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rR(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function rR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var iR=function(){function e(t,n){YE.default(this,e),this.services=t,this.removalHandler=n,this.subscriptionState="none",this._attachedListeners=new Map}return QE.default(e,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}},{key:"_subscribe",value:function(){this.services.router._subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router._unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}},{key:"detach",value:function(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(e,t){var n,r=nR(this._attachedListeners.values());try{for(r.s();!(n=r.n()).done;){n.value.emit(e,t)}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),sR=function(){function e(t){YE.default(this,e),nT.default(this,"queuedRequests",[]),nT.default(this,"isRequestInFlight",!1),this.inputMergingFunction=t}return QE.default(e,[{key:"add",value:function(e,t){var n=this,r=new Promise((function(r,i){return n.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:i})}));return this.wakeupQueue(),r}},{key:"squashAndAdd",value:function(e,t){var n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map((function(e){return e.input})).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach((function(e){return i.then(e.resolve,e.reject)})),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then((function(t){e.isRequestInFlight=!1,e.wakeupQueue()}))}}}]),e}(),aR=function(){function e(t){YE.default(this,e),nT.default(this,"queueByNamespaceKey",new Map),this.inputReducer=t}var t,n,r;return QE.default(e,[{key:"add",value:(r=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.add(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"squashAndAdd",value:(n=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.squashAndAdd(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"invokeQueueMethod",value:(t=HE.default(rT.default.mark((function e(t,n){var r,i;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new sR(this.inputReducer)),r=this.queueByNamespaceKey.get(t),i=n(r),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();function oR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}var uR=function(e){ZE.default(n,e);var t=oR(n);function n(){var e;return YE.default(this,n),(e=t.call(this)).closed=!1,e.uuid=GE.v4(),e}return QE.default(n,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),n}(hT);function cR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}var lR=function(e){ZE.default(f,e);var t,n,r,i,s,a,o,u,c,l=cR(f);function f(e,t,n){var r;YE.default(this,f),r=l.call(this,e,n),nT.default(XE.default(r),"isDeleted",!1);return r.updateMergingQueue=new sR((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.descriptor=t,r.descriptor.data=r.descriptor.data||{},r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return QE.default(f,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":if(e.id<=this.lastEventId){LT("Document update skipped, current:",this.lastEventId,", remote:",e.id);break}var t=void 0!==this.descriptor.data?CT(this.descriptor.data):null;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{data:e.document_data,isLocal:!1,previousData:t}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data});break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:(c=HE.default(rT.default.mark((function e(t,n){var r,i=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(r,(function(e){return i._setUnconditionally(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"mutate",value:(u=HE.default(rT.default.mark((function e(t,n){var r,i=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.add(r,(function(e){return i._setWithIfMatch(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"update",value:(o=HE.default(rT.default.mark((function e(t,n){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate((function(e){return Object.assign(e,t)}),n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"setTtl",value:(a=HE.default(rT.default.mark((function e(t){var n;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({ttl:t});case 2:n=e.sent,this.descriptor.date_expires=n.date_expires;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_setUnconditionally",value:(s=HE.default(rT.default.mark((function e(t,n){var r;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:n});case 2:return r=e.sent,this._handleSuccessfulUpdateResult(r),e.abrupt("return",this.descriptor.data);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"_setWithIfMatch",value:(i=HE.default(rT.default.mark((function e(t,n){var r,i,s;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t(CT(this.descriptor.data)))){e.next=22;break}return i=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:r,revision:i,ttl:n});case 6:return s=e.sent,this._handleSuccessfulUpdateResult(s),e.abrupt("return",this.descriptor.data);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.descriptor.data);case 23:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_handleSuccessfulUpdateResult",value:function(e){if(!(e.last_event_id<=this.descriptor.last_event_id)){var t=void 0!==this.descriptor.data?CT(this.descriptor.data):null;this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:t})}}},{key:"_postUpdateToServer",value:(r=HE.default(rT.default.mark((function e(t){var n,r,i;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return n={data:t.data},void 0!==t.ttl&&(n.ttl=t.ttl),r=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,n,r);case 7:return i=e.sent,e.abrupt("return",{revision:i.body.revision,data:t.data,last_event_id:i.body.last_event_id,date_updated:i.body.date_updated,date_expires:i.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.reject(new RT("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return r.apply(this,arguments)})},{key:"_softSync",value:(n=HE.default(rT.default.mark((function e(){var t=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then((function(e){var n={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(n),t})).catch((function(e){404===e.status?t.onRemoved(!1):DT("Can't get updates for ".concat(t.sid,":"),e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onRemoved",value:function(e){if(!this.isDeleted){var t=void 0!==this.descriptor.data?CT(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e,previousData:t})}}},{key:"removeDocument",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",Promise.reject(new RT("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"document"}}]),f}(iR),fR=function(e){ZE.default(o,e);var t,n,r,i,s,a=cR(o);function o(e){var t;return YE.default(this,o),(t=a.call(this)).syncDocumentImpl=e,t.syncDocumentImpl.attach(XE.default(t)),t}return QE.default(o,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return lR.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:(s=HE.default(rT.default.mark((function e(t,n){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.set(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"mutate",value:(i=HE.default(rT.default.mark((function e(t,n){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.mutate(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"update",value:(r=HE.default(rT.default.mark((function e(t,n){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.update(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setTtl",value:(n=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeDocument",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){cT.default(tT.default(o.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return lR.type}}]),o}(uR);nT.default(fR,"removed","removed"),nT.default(fR,"updated","updated"),fT([DE.validateTypesAsync(DE.pureObject,["undefined",DE.objectSchema("document metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Object,Object]),dT("design:returntype",Promise)],fR.prototype,"set",null),fT([DE.validateTypesAsync("function",["undefined",DE.objectSchema("document metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Function,Object]),dT("design:returntype",Promise)],fR.prototype,"mutate",null),fT([DE.validateTypesAsync(DE.pureObject,["undefined",DE.objectSchema("document metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Object,Object]),dT("design:returntype",Promise)],fR.prototype,"update",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number]),dT("design:returntype",Promise)],fR.prototype,"setTtl",null);var dR=function(){function e(t){YE.default(this,e),this.descriptor=t}return QE.default(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(e,t,n,r){return this.descriptor.lastEventId=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.dateUpdated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.dateExpires=e}}]),e}(),Paginator=function(){function Paginator(e,t,n,r){YE.default(this,Paginator),this.prevToken=n,this.nextToken=r,this.items=e,this.source=t}var e,t;return QE.default(Paginator,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"prevPage",value:(e=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]),Paginator}();function pR(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return hR(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hR(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function hR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yR=function(){function e(t,n){YE.default(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return QE.default(e,[{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}]),e}(),vR=function(){function e(t,n){YE.default(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return QE.default(e,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new yR(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,s=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(s))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var s=r||i;n||s?n&&!s?this.root=s:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var a=t.left;a.right;)a=a.right;if(t.left===a)t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!0};else{var o=a.parent,u=a.left;o.right=u,u&&(u.parent=o),t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.left=t.left,a.left.parent=a,a.balanceFactor=t.balanceFactor,t={parent:o,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:Symbol.iterator,value:rT.default.mark((function e(){var t,n,r;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=pR(this.getIterator()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"getIterator",value:rT.default.mark((function e(){var t,n,r,i=arguments;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.left)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)||null===t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.right){e.next=21;break}for(n=n.right;n.left;)n=n.left;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.left===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.left===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))},{key:"getReverseIterator",value:rT.default.mark((function e(){var t,n,r,i=arguments;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.right)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)&&null!==t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.left){e.next=21;break}for(n=n.left;n.right;)n=n.right;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.right===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.right===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))}]),e}();function mR(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return gR(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gR(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function gR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bR=function(){function e(t,n){YE.default(this,e),this.value=t,this.revision=n||0}return QE.default(e,[{key:"isValid",get:function(){return!0}}]),e}(),kR=function(){function e(t){YE.default(this,e),this.revision=t}return QE.default(e,[{key:"isValid",get:function(){return!1}}]),e}(),wR=function(){function e(){YE.default(this,e),this.items=new vR}return QE.default(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new bR(t,n)),t)}},{key:"delete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.items.get(e);(!r||r.revision<t||r&&!0===n)&&this.items.set(e,new kR(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}},{key:"forEach",value:function(e){if(this.items){var t,n=mR(this.items);try{for(n.s();!(t=n.n()).done;){var r=oT.default(t.value,2),i=r[0],s=r[1];s.isValid&&e(i,s.value)}}catch(e){n.e(e)}finally{n.f()}}}}]),e}();function xR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}var _R=function(e){ZE.default(v,e);var t,n,r,i,s,a,o,u,c,l,f,d,p,h,y=xR(v);function v(e,t,n){var r;YE.default(this,v);return(r=y.call(this,e,n)).updateMergingQueue=new aR((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new wR,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return QE.default(v,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:(h=HE.default(rT.default.mark((function e(t,n,r,i){var s,a;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={data:n},void 0!==i&&(s.ttl=i),e.next=4,this.services.network.post(t,s,r);case 4:return(a=e.sent).body.data=n,a.body.date_updated=new Date(a.body.date_updated),e.abrupt("return",a.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"push",value:(p=HE.default(rT.default.mark((function e(t,n){var r,i,s;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).ttl,e.next=3,this._addOrUpdateItemOnServer(this.links.items,t,void 0,r);case 3:return i=e.sent,s=Number(i.index),this._handleItemMutated(s,i.url,i.last_event_id,i.revision,t,i.date_updated,i.date_expires,!0,!1),e.abrupt("return",this.cache.get(s));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"set",value:(d=HE.default(rT.default.mark((function e(t,n,r){var i,s=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return s._updateItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"_updateItemUnconditionally",value:(f=HE.default(rT.default.mark((function e(t,n,r){var i,s;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return i=e.sent,e.next=5,this._addOrUpdateItemOnServer(i.uri,n,void 0,r);case 5:return s=e.sent,this._handleItemMutated(t,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"_updateItemWithIfMatch",value:(l=HE.default(rT.default.mark((function e(t,n,r){var i,s,a,o;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(i=e.sent,!(s=n(CT(i.data)))){e.next=25;break}return a=i.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(i.uri,s,a,r);case 9:return o=e.sent,this._handleItemMutated(t,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,n,r));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=HE.default(rT.default.mark((function e(t,n,r){var i,s=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return s._updateItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(o=HE.default(rT.default.mark((function e(t){var n,r,i;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=CT(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"get",value:function(){var e=HE.default(rT.default.mark((function e(t){var n;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(a=HE.default(rT.default.mark((function e(t){var n;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new RT("No item with index ".concat(t," found"),404,54151);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"queryItems",value:function(){var e=HE.default(rT.default.mark((function e(t){var n,r,i,s,a=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new ET(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.index)?a._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(Number(e.index),new dR({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,data:e.data}),e.last_event_id),a.cache.get(e.index)})),s=r.body.meta,e.abrupt("return",new Paginator(i,(function(e){return a.queryItems({pageToken:e})}),s.previous_token,s.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(s=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return OT((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getContext",value:(i=HE.default(rT.default.mark((function e(){var t;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setTtl",value:(r=HE.default(rT.default.mark((function e(t){var n,r;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=HE.default(rT.default.mark((function e(t,n){var r,i,s;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:s=e.sent,r.updateDateExpires(s.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,s,a,o,u){if(this.shouldIgnoreEvent(e,n))LT("Item ".concat(e," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(n));else{this._updateRootDateUpdated(s);var c=this.cache.get(e);if(!c){var l=new dR({index:e,uri:t,lastEventId:n,revision:r,data:i,dateUpdated:s,dateExpires:a});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,o)}var f=CT(c.data);c.update(n,r,i,s),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",s={item:e,isLocal:!t};n||(s.previousItemData=r),this.broadcastEventToListeners(i,s)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,previousItemData:n})}},{key:"_handleContextUpdate",value:function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(LT("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}],[{key:"type",get:function(){return"list"}}]),v}(iR),SR=function(e){ZE.default(p,e);var t,n,r,i,s,a,o,u,c,l,f,d=xR(p);function p(e){var t;return YE.default(this,p),(t=d.call(this)).syncListImpl=e,t.syncListImpl.attach(XE.default(t)),t}return QE.default(p,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return _R.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:(f=HE.default(rT.default.mark((function e(t,n){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.push(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"set",value:(l=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(o=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"get",value:(a=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getContext",value:(s=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getItems",value:(i=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=HE.default(rT.default.mark((function e(t,n){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){cT.default(tT.default(p.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return _R.type}}]),p}(uR);nT.default(SR,"itemAdded","itemAdded"),nT.default(SR,"itemUpdated","itemUpdated"),nT.default(SR,"itemRemoved","itemRemoved"),nT.default(SR,"removed","removed"),fT([DE.validateTypesAsync(DE.pureObject,["undefined",DE.objectSchema("item metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Object,Object]),dT("design:returntype",Promise)],SR.prototype,"push",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger,DE.pureObject,["undefined",DE.objectSchema("item metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Number,Object,Object]),dT("design:returntype",Promise)],SR.prototype,"set",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger,"function",["undefined",DE.objectSchema("item metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Number,Function,Object]),dT("design:returntype",Promise)],SR.prototype,"mutate",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger,DE.pureObject,["undefined",DE.objectSchema("item metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Number,Object,Object]),dT("design:returntype",Promise)],SR.prototype,"update",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number]),dT("design:returntype",Promise)],SR.prototype,"remove",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number]),dT("design:returntype",Promise)],SR.prototype,"get",null),fT([DE.validateTypesAsync(["undefined",DE.objectSchema("query options",{from:[DE.nonNegativeInteger,"undefined"],pageSize:[DE.custom((function(e){return[PT(e),"a positive integer"]})),"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],SR.prototype,"getItems",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number]),dT("design:returntype",Promise)],SR.prototype,"setTtl",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger,DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number,Number]),dT("design:returntype",Promise)],SR.prototype,"setItemTtl",null);var ER=function(){function e(t){YE.default(this,e),this.descriptor=t}return QE.default(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}}]),e}();function TR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}var RR=function(e){ZE.default(h,e);var t,n,r,i,s,a,o,u,c,l,f,d,p=TR(h);function h(e,t,n){var r;YE.default(this,h);return(r=p.call(this,e,n)).updateMergingQueue=new aR((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new wR,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),t.items&&t.items.forEach((function(e){e.date_updated=new Date(e.date_updated),r.cache.store(e.key,new ER(e),e.last_event_id)})),r}return QE.default(h,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:(d=HE.default(rT.default.mark((function e(t,n,r){var i,s=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return s._putItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"get",value:function(){var e=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new RT("SyncMapItem key may not be empty",400,54209);case 2:if(!this.cache.has(t)){e.next=6;break}return e.abrupt("return",this.cache.get(t));case 6:return e.abrupt("return",this._getItemFromServer(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(f=HE.default(rT.default.mark((function e(t){var n;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new RT("The specified Map Item does not exist",404,54201);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"mutate",value:(l=HE.default(rT.default.mark((function e(t,n,r){var i,s=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return s._putItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"update",value:(c=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"_putItemUnconditionally",value:(u=HE.default(rT.default.mark((function e(t,n,r){var i,s;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,n,void 0,r);case 2:return i=e.sent,s=i.item,this._handleItemMutated(s.key,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,i.added,!1),e.abrupt("return",this.cache.get(s.key));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"_putItemWithIfMatch",value:(o=HE.default(rT.default.mark((function e(t,n,r){var i,s,a,o,u;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch((function(e){if(404===e.status)return new ER({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e}));case 2:if(i=e.sent,!(s=n(CT(i.data)))){e.next=26;break}return a=i.revision,e.prev=6,e.next=9,this._putItemToServer(t,s,a,r);case 9:return o=e.sent,u=o.item,this._handleItemMutated(u.key,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,o.added,!1),e.abrupt("return",this.cache.get(u.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,n,r));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e,t,n){return o.apply(this,arguments)})},{key:"_putItemToServer",value:(a=HE.default(rT.default.mark((function e(t,n,r,i){var s,a,o,u,c;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new ET(this.links.items).pathSegment(t).build(),a={data:n},void 0!==i&&(a.ttl=i),e.prev=3,e.next=6,this.services.network.put(s,a,r);case 6:return o=e.sent,(u=o.body).data=n,u.date_updated=new Date(u.date_updated),c=201===o.status.code,e.abrupt("return",{added:c,item:u});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"remove",value:(s=HE.default(rT.default.mark((function e(t){var n,r,i;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=CT(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"queryItems",value:function(){var e=HE.default(rT.default.mark((function e(t){var n,r,i,s,a=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new ET(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.key)?a._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(e.key,new ER(e),e.last_event_id),a.cache.get(e.key)})),s=r.body.meta,e.abrupt("return",new Paginator(i,(function(e){return a.queryItems({pageToken:e})}),s.previous_token,s.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(i=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return OT((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,s,a,o,u){if(this.shouldIgnoreEvent(e,n))LT("SyncMapItem ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(s);var c=this.cache.get(e);if(!c){var l=new ER({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:s,date_expires:a});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,o)}var f=CT(c.data);c.update(n,r,i,s),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",s={item:e,isLocal:!t};n||(s.previousItemData=r),this.broadcastEventToListeners(i,s)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,previousItemData:n})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"setTtl",value:(r=HE.default(rT.default.mark((function e(t){var n,r;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=HE.default(rT.default.mark((function e(t,n){var r,i,s;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:s=e.sent,r.updateDateExpires(s.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"map"}}]),h}(iR),IR=function(e){ZE.default(f,e);var t,n,r,i,s,a,o,u,c,l=TR(f);function f(e){var t;return YE.default(this,f),(t=l.call(this)).syncMapImpl=e,t.syncMapImpl.attach(XE.default(t)),t}return QE.default(f,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return RR.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:(c=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"get",value:(u=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"mutate",value:(o=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"update",value:(a=HE.default(rT.default.mark((function e(t,n,r){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"remove",value:(s=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getItems",value:(i=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=HE.default(rT.default.mark((function e(t,n){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.next=3,this.syncMapImpl.removeMap();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){cT.default(tT.default(f.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return RR.type}}]),f}(uR);function CR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}nT.default(IR,"itemAdded","itemAdded"),nT.default(IR,"itemUpdated","itemUpdated"),nT.default(IR,"itemRemoved","itemRemoved"),nT.default(IR,"removed","removed"),fT([DE.validateTypesAsync("string",DE.pureObject,["undefined",DE.objectSchema("item metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[String,Object,Object]),dT("design:returntype",Promise)],IR.prototype,"set",null),fT([DE.validateTypesAsync("string"),dT("design:type",Function),dT("design:paramtypes",[String]),dT("design:returntype",Promise)],IR.prototype,"get",null),fT([DE.validateTypesAsync("string","function",["undefined",DE.objectSchema("item metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[String,Function,Object]),dT("design:returntype",Promise)],IR.prototype,"mutate",null),fT([DE.validateTypesAsync("string",DE.pureObject,["undefined",DE.objectSchema("item metadata",{ttl:[DE.nonNegativeInteger,"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[String,Object,Object]),dT("design:returntype",Promise)],IR.prototype,"update",null),fT([DE.validateTypesAsync("string"),dT("design:type",Function),dT("design:paramtypes",[String]),dT("design:returntype",Promise)],IR.prototype,"remove",null),fT([DE.validateTypesAsync(["undefined",DE.objectSchema("query options",{from:["string","undefined"],pageSize:[DE.custom((function(e){return[PT(e),"a positive integer"]})),"undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],IR.prototype,"getItems",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number]),dT("design:returntype",Promise)],IR.prototype,"setTtl",null),fT([DE.validateTypesAsync("string",DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[String,Number]),dT("design:returntype",Promise)],IR.prototype,"setItemTtl",null);var OR=function(e){ZE.default(s,e);var t,n,r,i=CR(s);function s(e,t,n){var r;return YE.default(this,s),(r=i.call(this,e,n)).descriptor=t,r}return QE.default(s,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:(r=HE.default(rT.default.mark((function e(t){var n,r,i,s;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.next=3,this.services.network.post(this.links.messages,n);case 3:return r=e.sent,i=r.body,s=this._handleMessagePublished(i.sid,t,!1),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=HE.default(rT.default.mark((function e(t){var n,r;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,n){var r={sid:e,data:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}],[{key:"type",get:function(){return"stream"}}]),s}(iR);fT([DE.validateTypesAsync(DE.pureObject),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],OR.prototype,"publishMessage",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number]),dT("design:returntype",Promise)],OR.prototype,"setTtl",null);var PR=function(e){ZE.default(s,e);var t,n,r,i=CR(s);function s(e){var t;return YE.default(this,s),(t=i.call(this)).syncStreamImpl=e,t.syncStreamImpl.attach(XE.default(t)),t}return QE.default(s,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return OR.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:(r=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.publishMessage(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){cT.default(tT.default(s.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return OR.type}}]),s}(uR);nT.default(PR,"messagePublished","messagePublished"),nT.default(PR,"removed","removed"),fT([DE.validateTypesAsync(DE.pureObject),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],PR.prototype,"publishMessage",null),fT([DE.validateTypesAsync(DE.nonNegativeInteger),dT("design:type",Function),dT("design:paramtypes",[Number]),dT("design:returntype",Promise)],PR.prototype,"setTtl",null);var AR=function e(t){YE.default(this,e),this.sdk="js",this.sdkVer=t,this.os=lT.os.family,this.osVer=lT.os.version,this.pl=lT.name,this.plVer=lT.version},jR=function(){function e(){YE.default(this,e),this.names=new Map,this.entities=new Map}return QE.default(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();function MR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}var LR=function(e){ZE.default(n,e);var t=MR(n);function n(e,r,i,s){var a;return YE.default(this,n),(a=t.call(this,r,i)).descriptor=e,a.cache=new wR,s&&s.forEach((function(e){a.cache.store(e.key,{key:e.key,value:e.data},e.revision)})),a}return QE.default(n,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return n.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var e={};return this.cache.forEach((function(t,n){e[t]=n.value})),e}},{key:"_update",value:function(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}},{key:"handleItemMutated",value:function(e,t,n){if(this.shouldIgnoreEvent(e,n))LT("Item ".concat(e," update skipped, revision: ").concat(n));else{var r={key:e,value:t};this.cache.store(e,r,n),this.broadcastEventToListeners("itemUpdated",r)}}},{key:"handleItemRemoved",value:function(e,t){var n=null===t;this.shouldIgnoreEvent(e,t)?LT("Item ".concat(e," delete skipped, revision: ").concat(t)):(this.cache.delete(e,t,n),this.broadcastEventToListeners("itemRemoved",{key:e}))}},{key:"handleBatchUpdate",value:function(e){var t=this,n={};for(var r in null!=e&&e.forEach((function(e){n[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach((function(e,r){var i=n[e];null!=i?t.handleItemMutated(e,i.data,i.revision):t.handleItemRemoved(e,null),delete n[e]})),n)this.handleItemMutated(r,n[r].data,n[r].revision)}},{key:"shouldIgnoreEvent",value:function(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}}],[{key:"type",get:function(){return"live_query"}}]),n}(iR);function NR(e){return UR.apply(this,arguments)}function UR(){return(UR=HE.default(rT.default.mark((function e(t){var n,r,i,s,a,o;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.network,r=t.queryString,i=t.uri,s=t.type,null!=r){e.next=3;break}throw new RT("Invalid query",400,54507);case 3:return a={query_string:r},s===DR.type&&(a.type=s),e.next=7,n.post(i,a,void 0,!0);case 7:return o=e.sent,e.abrupt("return",o.body);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var DR=function(e){ZE.default(n,e);var t=MR(n);function n(e){var r;return YE.default(this,n),(r=t.call(this)).liveQueryImpl=e,r.liveQueryImpl.attach(XE.default(r)),r}return QE.default(n,[{key:"type",get:function(){return LR.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){cT.default(tT.default(n.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return LR.type}}]),n}(uR);nT.default(DR,"itemUpdated","itemUpdated"),nT.default(DR,"itemRemoved","itemRemoved");var FR=function(e){ZE.default(i,e);var t,n,r=MR(i);function i(e){var t;return YE.default(this,i),t=r.call(this),nT.default(XE.default(t),"queryExpression",null),nT.default(XE.default(t),"items",{}),Object.assign(XE.default(t),e),t.updateIndexName(e.indexName),t}return QE.default(i,[{key:"type",get:function(){return i.type}},{key:"search",value:(n=HE.default(rT.default.mark((function e(t){var n=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.items={},e.abrupt("return",NR({network:this.network,uri:this.queryUri,queryString:t}).then((function(e){n.queryExpression=t,e.items&&e.items.forEach((function(e){n.items[e.key]=e.data})),n.emit("searchResult",n.getItems())})).catch((function(e){throw DT("Error '".concat(e.message,"' while executing query '").concat(t,"'")),n.queryExpression=null,e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"subscribe",value:(t=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.queryExpression){e.next=2;break}return e.abrupt("return",Promise.reject(new RT("Invalid query",400,54507)));case 2:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(e){this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(e){return new ET(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),i}(hT);nT.default(FR,"searchResult","searchResult"),fT([DE.validateTypesAsync("string"),dT("design:type",Function),dT("design:paramtypes",[String]),dT("design:returntype",Promise)],FR.prototype,"search",null),fT([DE.validateTypes(DE.nonEmptyString),dT("design:type",Function),dT("design:paramtypes",[String]),dT("design:returntype",void 0)],FR.prototype,"updateIndexName",null);function BR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tT.default(e);if(t){var i=tT.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eT.default(this,n)}}function qR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qR(Object(n),!0).forEach((function(t){nT.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var WR="data_sync",GR="3.0.6";function $R(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};var t=e.mode||(e.id?"open_or_create":"create_new");return zR(zR({},e),{},{mode:t})}return{mode:"create_new"}}var JR="com.twilio.rtd.cds.document",VR="com.twilio.rtd.cds.list",KR="com.twilio.rtd.cds.map",HR="twilio.sync.event",Client=function(e){ZE.default(Client,e);var t,n,r,i,s,a,o,u,c,l,f,d,p,h,y,v=BR(Client);function Client(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(YE.default(this,Client),t=v.call(this),!e)throw new Error("Sync library needs a valid Twilio token to be passed");n.hasOwnProperty("logLevel")?MT(n.logLevel):MT("silent");var r=n.productId=n.productId||WR;n.clientMetadata=n.clientMetadata||{},n.clientMetadata.hasOwnProperty("type")||(n.clientMetadata.type="sync"),n.clientMetadata.hasOwnProperty("sdk")||(n.clientMetadata.sdk="JS",n.clientMetadata.sdkv=GR);var i=!n.twilsockClient;if(!n.initRegistrations){var s=new FE.InitRegistration(r);Client.populateInitRegistrations(s),n.initRegistrations=[s]}var a=n.twilsockClient=n.twilsockClient||new FE.Twilsock(e,r,n);a.on("tokenAboutToExpire",(function(e){return t.emit("tokenAboutToExpire",e)})),a.on("tokenExpired",(function(){return t.emit("tokenExpired")})),a.on("connectionError",(function(e){return t.emit("connectionError",e)})),a.on("stateChanged",(function(e){t.emit("connectionStateChanged",e),t.services.subscriptions.onConnectionStateChanged("connected"===e)})),a.on("message",(function(e,n){return t._routeMessage(e,n)}));var o=new JT(n),u=new eR(new AR(GR),o,a),c=new tR(o);return t.services={config:o,twilsock:a,network:u,storage:c,router:XE.default(t),subscriptions:null},t.services.subscriptions=new YT(t.services),t.entities=new jR,i&&a.connect(),t}return QE.default(Client,[{key:"_routeMessage",value:function(e,t){switch(LT("Notification type:",e,"content:",t),e){case JR:case VR:case KR:this.services.subscriptions.acceptMessage(t,!1);break;case HR:this.services.subscriptions.acceptMessage(t,!0)}}},{key:"_subscribe",value:function(e,t){this.services.subscriptions.add(e,t)}},{key:"_unsubscribe",value:function(e){this.services.subscriptions.remove(e)}},{key:"connectionState",get:function(){return this.services.twilsock.state}},{key:"ensureReady",value:(y=HE.default(rT.default.mark((function e(){var t;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),UT("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(){return y.apply(this,arguments)})},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=CT(n);e!==SR.type&&e!==IR.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:(h=HE.default(rT.default.mark((function e(t,n){var r,i,s,a=arguments;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]&&a[2],n){e.next=3;break}throw new RT("Cannot get entity without id",404);case 3:return i=new ET(t).pathSegment(n).queryParam("Include",r?"items":void 0).build(),e.next=6,this.services.network.get(i);case 6:return s=e.sent,e.abrupt("return",s.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"_createDocument",value:function(e,t,n){var r={unique_name:e,data:t||{}};return void 0!==n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then((function(e){return e.body.data=r.data,e.body}))}},{key:"_getDocument",value:(p=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(fR.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_createList",value:function(e,t,n,r){var i={unique_name:e,purpose:t,context:n};return void 0!==r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then((function(e){return e.body}))}},{key:"_getList",value:(d=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(SR.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_createMap",value:function(e,t){var n={unique_name:e};return void 0!==t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then((function(e){return e.body}))}},{key:"_getMap",value:(f=HE.default(rT.default.mark((function e(t){var n,r=arguments;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",this.readRootFromSessionCache(IR.type,t)||this._get(this.services.config.mapsUri,t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_getStream",value:(l=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(PR.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_createStream",value:(c=HE.default(rT.default.mark((function e(t,n){var r,i;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={unique_name:t},void 0!==n&&(r.ttl=n),e.next=4,this.services.network.post(this.services.config.streamsUri,r);case 4:return i=e.sent,e.abrupt("return",i.body);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"_getLiveQuery",value:function(e){return this.readRootFromSessionCache(DR.type,e)}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:(u=HE.default(rT.default.mark((function e(t){var n,r,i,s,a=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=$R(t)).mode){e.next=9;break}return e.next=6,this._createDocument(n.id,n.data,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,fR.type))){e.next=14;break}return e.abrupt("return",new fR(i));case 14:return e.prev=14,e.next=17,this._getDocument(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createDocument(n.id,n.data,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.document(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(fR.type,n.id,r),s=new lR(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),s=this.entities.store(s),e.abrupt("return",new fR(s));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return u.apply(this,arguments)})},{key:"map",value:(o=HE.default(rT.default.mark((function e(t){var n,r,i,s,a=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=$R(t)).mode){e.next=9;break}return e.next=6,this._createMap(n.id,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,IR.type))){e.next=14;break}return e.abrupt("return",new IR(i));case 14:return e.prev=14,e.next=17,this._getMap(n.id,n.includeItems);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createMap(n.id,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.map(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(IR.type,n.id,r),s=new RR(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),s=this.entities.store(s),e.abrupt("return",new IR(s));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return o.apply(this,arguments)})},{key:"list",value:(a=HE.default(rT.default.mark((function e(t){var n,r,i,s,a=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=$R(t)).mode){e.next=9;break}return e.next=6,this._createList(n.id,n.purpose,n.context,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,SR.type))){e.next=14;break}return e.abrupt("return",new SR(i));case 14:return e.prev=14,e.next=17,this._getList(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createList(n.id,n.purpose,n.context,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.list(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(SR.type,n.id,r),s=new _R(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),s=this.entities.store(s),e.abrupt("return",new SR(s));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return a.apply(this,arguments)})},{key:"stream",value:(s=HE.default(rT.default.mark((function e(t){var n,r,i,s,a,o=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=$R(t)).mode){e.next=9;break}return e.next=6,this._createStream(n.id,n.ttl);case 6:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,PR.type))){e.next=14;break}return e.abrupt("return",new PR(i));case 14:return e.prev=14,e.next=17,this._getStream(n.id);case 17:r=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createStream(n.id,n.ttl);case 29:r=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.stream(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(PR.type,n.id,r),s=function(e,t,n){return o.removeFromCacheAndSession(e,t,n)},a=new OR(this.services,r,s),a=this.entities.store(a),e.abrupt("return",new PR(a));case 44:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return s.apply(this,arguments)})},{key:"shutdown",value:(i=HE.default(rT.default.mark((function e(){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateToken",value:(r=HE.default(rT.default.mark((function e(t){return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.twilsock.updateToken(t).catch((function(e){var t,n=null==e||null===(t=e.reply)||void 0===t?void 0:t.status;if(401===(null==n?void 0:n.code)&&"UNAUTHORIZED"===(null==n?void 0:n.status))throw new RT("Updated token was rejected by server",400,51130);throw e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"liveQuery",value:(n=HE.default(rT.default.mark((function e(t,n){var r,i,s,a,o,u=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return r=new ET(this.services.config.insightsUri).pathSegment(t).pathSegment("Items").build(),e.next=5,NR({network:this.services.network,uri:r,queryString:n,type:DR.type});case 5:return i=e.sent,(s=this.getCached(i.query_id,DR.type))||((a=this._getLiveQuery(i.query_id))||(a={indexName:t,queryExpression:n,sid:i.query_id,queryUri:r,last_event_id:i.last_event_id}),o=function(e,t,n){return u.removeFromCacheAndSession(e,t,n)},s=new LR(a,this.services,o,i.items)),this.storeRootInSessionCache(DR.type,i.query_id,s.liveQueryDescriptor),s=this.entities.store(s),e.abrupt("return",new DR(s));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"instantQuery",value:(t=HE.default(rT.default.mark((function e(t){var n,r=this;return rT.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return n=function(e,t){return r.liveQuery(e,t)},e.abrupt("return",new FR({indexName:t,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:n}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"populateInitRegistrations",value:function(e){e.populateInitRegistrations([HR,JR,VR,KR])}},{key:"version",get:function(){return GR}}]),Client}(hT);nT.default(Client,"connectionStateChanged","connectionStateChanged"),nT.default(Client,"connectionError","connectionError"),nT.default(Client,"tokenAboutToExpire","tokenAboutToExpire"),nT.default(Client,"tokenExpired","tokenExpired"),fT([DE.validateTypesAsync(["undefined","string",DE.objectSchema("open document options",{id:["string","undefined"],mode:[DE.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[DE.nonNegativeInteger,"undefined"],data:[DE.pureObject,"undefined",DE.literal(null)]})]),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],Client.prototype,"document",null),fT([DE.validateTypesAsync(["undefined","string",DE.objectSchema("open map options",{id:["string","undefined"],mode:[DE.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[DE.nonNegativeInteger,"undefined"],data:[DE.pureObject,"undefined",DE.literal(null)],includeItems:["boolean","undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],Client.prototype,"map",null),fT([DE.validateTypesAsync(["undefined","string",DE.objectSchema("open list options",{id:["string","undefined"],mode:[DE.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[DE.nonNegativeInteger,"undefined"],data:[DE.pureObject,"undefined",DE.literal(null)],purpose:["string","undefined"],context:[DE.pureObject,"undefined"],includeItems:["boolean","undefined"]})]),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],Client.prototype,"list",null),fT([DE.validateTypesAsync(["undefined","string",DE.objectSchema("open stream options",{id:["string","undefined"],mode:[DE.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[DE.nonNegativeInteger,"undefined"],data:[DE.pureObject,"undefined",DE.literal(null)]})]),dT("design:type",Function),dT("design:paramtypes",[Object]),dT("design:returntype",Promise)],Client.prototype,"stream",null),fT([DE.validateTypesAsync(DE.nonEmptyString),dT("design:type",Function),dT("design:paramtypes",[String]),dT("design:returntype",Promise)],Client.prototype,"updateToken",null),fT([DE.validateTypesAsync(DE.nonEmptyString,"string"),dT("design:type",Function),dT("design:paramtypes",[String,String]),dT("design:returntype",Promise)],Client.prototype,"liveQuery",null),fT([DE.validateTypesAsync(DE.nonEmptyString),dT("design:type",Function),dT("design:paramtypes",[String]),dT("design:returntype",Promise)],Client.prototype,"instantQuery",null),RE.Client=Client,RE.InsightsItem=function e(){YE.default(this,e)},RE.InstantQuery=FR,RE.LiveQuery=DR,RE.Paginator=Paginator;var YR=RE.SyncClient=Client;function QR(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function XR(e,t,n){return(XR=QR()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Is(i,n.prototype),i}).apply(null,arguments)}function ZR(e){var t="function"==typeof Map?new Map:void 0;return(ZR=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return XR(e,arguments,As(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Is(r,e)})(e)}RE.SyncDocument=fR,RE.SyncList=SR,RE.SyncListItem=dR,RE.SyncMap=IR,RE.SyncMapItem=ER,RE.SyncStream=PR;var eI,tI={},nI=ES,rI=pe("match"),iI=In,sI=s.f,aI=Ut,oI=gr,uI=function(e){if(nI(e))throw TypeError("The method doesn't accept regular expressions");return e},cI=k,lI=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[rI]=!1,"/./"[e](t)}catch(e){}}return!1},fI="".startsWith,dI=Math.min,pI=lI("startsWith");iI({target:"String",proto:!0,forced:!!(pI||(eI=sI(String.prototype,"startsWith"),!eI||eI.writable))&&!pI},{startsWith:function(e){var t=oI(cI(this));uI(e);var n=aI(dI(arguments.length>1?arguments[1]:void 0,t.length)),r=oI(e);return fI?fI.call(t,r,n):t.slice(n,n+r.length)===r}});var hI=T_.left,yI=L,vI=Wa;In({target:"Array",proto:!0,forced:!ec("reduce")||!vI&&yI>79&&yI<83},{reduce:function(e){return hI(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var mI=a,gI=pe("iterator"),bI=!mI((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[gI]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),kI=2147483647,wI=/[^\0-\u007E]/,xI=/[.\u3002\uFF0E\uFF61]/g,_I="Overflow: input needs wider integers to process",SI=Math.floor,EI=String.fromCharCode,TI=function(e){return e+22+75*(e<26)},RI=function(e,t,n){var r=0;for(e=n?SI(e/700):e>>1,e+=SI(e/t);e>455;r+=36)e=SI(e/35);return SI(r+36*e/(e+38))},II=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var s=e.charCodeAt(n++);56320==(64512&s)?t.push(((1023&i)<<10)+(1023&s)+65536):(t.push(i),n--)}else t.push(i)}return t}(e)).length,s=128,a=0,o=72;for(t=0;t<e.length;t++)(n=e[t])<128&&r.push(EI(n));var u=r.length,c=u;for(u&&r.push("-");c<i;){var l=kI;for(t=0;t<e.length;t++)(n=e[t])>=s&&n<l&&(l=n);var f=c+1;if(l-s>SI((kI-a)/f))throw RangeError(_I);for(a+=(l-s)*f,s=l,t=0;t<e.length;t++){if((n=e[t])<s&&++a>kI)throw RangeError(_I);if(n==s){for(var d=a,p=36;;p+=36){var h=p<=o?1:p>=o+26?26:p-o;if(d<h)break;var y=d-h,v=36-h;r.push(EI(TI(h+y%v))),d=SI(y/v)}r.push(EI(TI(d))),o=RI(a,f,c==u),a=0,++c}}++a,++s}return r.join("")},CI=In,OI=R,PI=bI,AI=Ve.exports,jI=Hs,MI=Mr,LI=Kc,NI=xt,UI=sa,DI=ee,FI=Nr,BI=qs,qI=De,zI=S,WI=gr,GI=Hn,$I=h,JI=ma,VI=ha,KI=pe,HI=OI("fetch"),YI=OI("Request"),QI=YI&&YI.prototype,XI=OI("Headers"),ZI=KI("iterator"),eC="URLSearchParams",tC="URLSearchParamsIterator",nC=NI.set,rC=NI.getterFor(eC),iC=NI.getterFor(tC),sC=/\+/g,aC=Array(4),oC=function(e){return aC[e-1]||(aC[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},uC=function(e){try{return decodeURIComponent(e)}catch(t){return e}},cC=function(e){var t=e.replace(sC," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(oC(n--),uC);return t}},lC=/[!'()~]|%20/g,fC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},dC=function(e){return fC[e]},pC=function(e){return encodeURIComponent(e).replace(lC,dC)},hC=function(e,t){if(t)for(var n,r,i=t.split("&"),s=0;s<i.length;)(n=i[s++]).length&&(r=n.split("="),e.push({key:cC(r.shift()),value:cC(r.join("="))}))},yC=function(e){this.entries.length=0,hC(this.entries,e)},vC=function(e,t){if(e<t)throw TypeError("Not enough arguments")},mC=LI((function(e,t){nC(this,{type:tC,iterator:JI(rC(e).entries),kind:t})}),"Iterator",(function(){var e=iC(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n})),gC=function(){UI(this,gC,eC);var e,t,n,r,i,s,a,o,u,c=arguments.length>0?arguments[0]:void 0,l=this,f=[];if(nC(l,{type:eC,entries:f,updateURL:function(){},updateSearchParams:yC}),void 0!==c)if(zI(c))if("function"==typeof(e=VI(c)))for(n=(t=JI(c,e)).next;!(r=n.call(t)).done;){if((a=(s=(i=JI(qI(r.value))).next).call(i)).done||(o=s.call(i)).done||!s.call(i).done)throw TypeError("Expected sequence with length 2");f.push({key:WI(a.value),value:WI(o.value)})}else for(u in c)DI(c,u)&&f.push({key:u,value:WI(c[u])});else hC(f,"string"==typeof c?"?"===c.charAt(0)?c.slice(1):c:WI(c))},bC=gC.prototype;if(jI(bC,{append:function(e,t){vC(arguments.length,2);var n=rC(this);n.entries.push({key:WI(e),value:WI(t)}),n.updateURL()},delete:function(e){vC(arguments.length,1);for(var t=rC(this),n=t.entries,r=WI(e),i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){vC(arguments.length,1);for(var t=rC(this).entries,n=WI(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){vC(arguments.length,1);for(var t=rC(this).entries,n=WI(e),r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){vC(arguments.length,1);for(var t=rC(this).entries,n=WI(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){vC(arguments.length,1);for(var n,r=rC(this),i=r.entries,s=!1,a=WI(e),o=WI(t),u=0;u<i.length;u++)(n=i[u]).key===a&&(s?i.splice(u--,1):(s=!0,n.value=o));s||i.push({key:a,value:o}),r.updateURL()},sort:function(){var e,t,n,r=rC(this),i=r.entries,s=i.slice();for(i.length=0,n=0;n<s.length;n++){for(e=s[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e){for(var t,n=rC(this).entries,r=FI(e,arguments.length>1?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new mC(this,"keys")},values:function(){return new mC(this,"values")},entries:function(){return new mC(this,"entries")}},{enumerable:!0}),AI(bC,ZI,bC.entries),AI(bC,"toString",(function(){for(var e,t=rC(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(pC(e.key)+"="+pC(e.value));return n.join("&")}),{enumerable:!0}),MI(gC,eC),CI({global:!0,forced:!PI},{URLSearchParams:gC}),!PI&&"function"==typeof XI){var kC=function(e){if(zI(e)){var t,n=e.body;if(BI(n)===eC)return(t=e.headers?new XI(e.headers):new XI).has("content-type")||t.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),GI(e,{body:$I(0,String(n)),headers:$I(0,t)})}return e};if("function"==typeof HI&&CI({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return HI(e,arguments.length>1?kC(arguments[1]):{})}}),"function"==typeof YI){var wC=function(e){return UI(this,wC,"Request"),new YI(e,arguments.length>1?kC(arguments[1]):{})};QI.constructor=wC,wC.prototype=QI,CI({global:!0,forced:!0},{Request:wC})}}var xC,_C={URLSearchParams:gC,getState:rC},SC=In,EC=o,TC=bI,RC=i,IC=Nn,CC=Ve.exports,OC=sa,PC=ee,AC=EE,jC=bc,MC=Ic.codeAt,LC=function(e){var t,n,r=[],i=e.toLowerCase().replace(xI,".").split(".");for(t=0;t<i.length;t++)n=i[t],r.push(wI.test(n)?"xn--"+II(n):n);return r.join(".")},NC=gr,UC=Mr,DC=_C,FC=xt,BC=RC.URL,qC=DC.URLSearchParams,zC=DC.getState,WC=FC.set,GC=FC.getterFor("URL"),$C=Math.floor,JC=Math.pow,VC="Invalid scheme",KC="Invalid host",HC="Invalid port",YC=/[A-Za-z]/,QC=/[\d+-.A-Za-z]/,XC=/\d/,ZC=/^0x/i,eO=/^[0-7]+$/,tO=/^\d+$/,nO=/^[\dA-Fa-f]+$/,rO=/[\0\t\n\r #%/:<>?@[\\\]^|]/,iO=/[\0\t\n\r #/:<>?@[\\\]^|]/,sO=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,aO=/[\t\n\r]/g,oO=function(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return KC;if(!(n=cO(t.slice(1,-1))))return KC;e.host=n}else if(mO(e)){if(t=LC(t),rO.test(t))return KC;if(null===(n=uO(t)))return KC;e.host=n}else{if(iO.test(t))return KC;for(n="",r=jC(t),i=0;i<r.length;i++)n+=yO(r[i],fO);e.host=n}},uO=function(e){var t,n,r,i,s,a,o,u=e.split(".");if(u.length&&""==u[u.length-1]&&u.pop(),(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(s=10,i.length>1&&"0"==i.charAt(0)&&(s=ZC.test(i)?16:8,i=i.slice(8==s?1:2)),""===i)a=0;else{if(!(10==s?tO:8==s?eO:nO).test(i))return e;a=parseInt(i,s)}n.push(a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=JC(256,5-t))return null}else if(a>255)return null;for(o=n.pop(),r=0;r<n.length;r++)o+=n[r]*JC(256,3-r);return o},cO=function(e){var t,n,r,i,s,a,o,u=[0,0,0,0,0,0,0,0],c=0,l=null,f=0,d=function(){return e.charAt(f)};if(":"==d()){if(":"!=e.charAt(1))return;f+=2,l=++c}for(;d();){if(8==c)return;if(":"!=d()){for(t=n=0;n<4&&nO.test(d());)t=16*t+parseInt(d(),16),f++,n++;if("."==d()){if(0==n)return;if(f-=n,c>6)return;for(r=0;d();){if(i=null,r>0){if(!("."==d()&&r<4))return;f++}if(!XC.test(d()))return;for(;XC.test(d());){if(s=parseInt(d(),10),null===i)i=s;else{if(0==i)return;i=10*i+s}if(i>255)return;f++}u[c]=256*u[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==d()){if(f++,!d())return}else if(d())return;u[c++]=t}else{if(null!==l)return;f++,l=++c}}if(null!==l)for(a=c-l,c=7;0!=c&&a>0;)o=u[c],u[c--]=u[l+a-1],u[l+--a]=o;else if(8!=c)return;return u},lO=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=$C(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,s=0;s<8;s++)0!==e[s]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=s),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},fO={},dO=AC({},fO,{" ":1,'"':1,"<":1,">":1,"`":1}),pO=AC({},dO,{"#":1,"?":1,"{":1,"}":1}),hO=AC({},pO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),yO=function(e,t){var n=MC(e,0);return n>32&&n<127&&!PC(t,e)?e:encodeURIComponent(e)},vO={ftp:21,file:null,http:80,https:443,ws:80,wss:443},mO=function(e){return PC(vO,e.scheme)},gO=function(e){return""!=e.username||""!=e.password},bO=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},kO=function(e,t){var n;return 2==e.length&&YC.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},wO=function(e){var t;return e.length>1&&kO(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},xO=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&kO(t[0],!0)||t.pop()},_O=function(e){return"."===e||"%2e"===e.toLowerCase()},SO={},EO={},TO={},RO={},IO={},CO={},OO={},PO={},AO={},jO={},MO={},LO={},NO={},UO={},DO={},FO={},BO={},qO={},zO={},WO={},GO={},$O=function(e,t,n,r){var i,s,a,o,u,c=n||SO,l=0,f="",d=!1,p=!1,h=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(sO,"")),t=t.replace(aO,""),i=jC(t);l<=i.length;){switch(s=i[l],c){case SO:if(!s||!YC.test(s)){if(n)return VC;c=TO;continue}f+=s.toLowerCase(),c=EO;break;case EO:if(s&&(QC.test(s)||"+"==s||"-"==s||"."==s))f+=s.toLowerCase();else{if(":"!=s){if(n)return VC;f="",c=TO,l=0;continue}if(n&&(mO(e)!=PC(vO,f)||"file"==f&&(gO(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=f,n)return void(mO(e)&&vO[e.scheme]==e.port&&(e.port=null));f="","file"==e.scheme?c=UO:mO(e)&&r&&r.scheme==e.scheme?c=RO:mO(e)?c=PO:"/"==i[l+1]?(c=IO,l++):(e.cannotBeABaseURL=!0,e.path.push(""),c=zO)}break;case TO:if(!r||r.cannotBeABaseURL&&"#"!=s)return VC;if(r.cannotBeABaseURL&&"#"==s){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,c=GO;break}c="file"==r.scheme?UO:CO;continue;case RO:if("/"!=s||"/"!=i[l+1]){c=CO;continue}c=AO,l++;break;case IO:if("/"==s){c=jO;break}c=qO;continue;case CO:if(e.scheme=r.scheme,s==xC)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==s||"\\"==s&&mO(e))c=OO;else if("?"==s)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",c=WO;else{if("#"!=s){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),c=qO;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",c=GO}break;case OO:if(!mO(e)||"/"!=s&&"\\"!=s){if("/"!=s){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,c=qO;continue}c=jO}else c=AO;break;case PO:if(c=AO,"/"!=s||"/"!=f.charAt(l+1))continue;l++;break;case AO:if("/"!=s&&"\\"!=s){c=jO;continue}break;case jO:if("@"==s){d&&(f="%40"+f),d=!0,a=jC(f);for(var y=0;y<a.length;y++){var v=a[y];if(":"!=v||h){var m=yO(v,hO);h?e.password+=m:e.username+=m}else h=!0}f=""}else if(s==xC||"/"==s||"?"==s||"#"==s||"\\"==s&&mO(e)){if(d&&""==f)return"Invalid authority";l-=jC(f).length+1,f="",c=MO}else f+=s;break;case MO:case LO:if(n&&"file"==e.scheme){c=FO;continue}if(":"!=s||p){if(s==xC||"/"==s||"?"==s||"#"==s||"\\"==s&&mO(e)){if(mO(e)&&""==f)return KC;if(n&&""==f&&(gO(e)||null!==e.port))return;if(o=oO(e,f))return o;if(f="",c=BO,n)return;continue}"["==s?p=!0:"]"==s&&(p=!1),f+=s}else{if(""==f)return KC;if(o=oO(e,f))return o;if(f="",c=NO,n==LO)return}break;case NO:if(!XC.test(s)){if(s==xC||"/"==s||"?"==s||"#"==s||"\\"==s&&mO(e)||n){if(""!=f){var g=parseInt(f,10);if(g>65535)return HC;e.port=mO(e)&&g===vO[e.scheme]?null:g,f=""}if(n)return;c=BO;continue}return HC}f+=s;break;case UO:if(e.scheme="file","/"==s||"\\"==s)c=DO;else{if(!r||"file"!=r.scheme){c=qO;continue}if(s==xC)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==s)e.host=r.host,e.path=r.path.slice(),e.query="",c=WO;else{if("#"!=s){wO(i.slice(l).join(""))||(e.host=r.host,e.path=r.path.slice(),xO(e)),c=qO;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",c=GO}}break;case DO:if("/"==s||"\\"==s){c=FO;break}r&&"file"==r.scheme&&!wO(i.slice(l).join(""))&&(kO(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),c=qO;continue;case FO:if(s==xC||"/"==s||"\\"==s||"?"==s||"#"==s){if(!n&&kO(f))c=qO;else if(""==f){if(e.host="",n)return;c=BO}else{if(o=oO(e,f))return o;if("localhost"==e.host&&(e.host=""),n)return;f="",c=BO}continue}f+=s;break;case BO:if(mO(e)){if(c=qO,"/"!=s&&"\\"!=s)continue}else if(n||"?"!=s)if(n||"#"!=s){if(s!=xC&&(c=qO,"/"!=s))continue}else e.fragment="",c=GO;else e.query="",c=WO;break;case qO:if(s==xC||"/"==s||"\\"==s&&mO(e)||!n&&("?"==s||"#"==s)){if(".."===(u=(u=f).toLowerCase())||"%2e."===u||".%2e"===u||"%2e%2e"===u?(xO(e),"/"==s||"\\"==s&&mO(e)||e.path.push("")):_O(f)?"/"==s||"\\"==s&&mO(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&kO(f)&&(e.host&&(e.host=""),f=f.charAt(0)+":"),e.path.push(f)),f="","file"==e.scheme&&(s==xC||"?"==s||"#"==s))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==s?(e.query="",c=WO):"#"==s&&(e.fragment="",c=GO)}else f+=yO(s,pO);break;case zO:"?"==s?(e.query="",c=WO):"#"==s?(e.fragment="",c=GO):s!=xC&&(e.path[0]+=yO(s,fO));break;case WO:n||"#"!=s?s!=xC&&("'"==s&&mO(e)?e.query+="%27":e.query+="#"==s?"%23":yO(s,fO)):(e.fragment="",c=GO);break;case GO:s!=xC&&(e.fragment+=yO(s,dO))}l++}},JO=function(e){var t,n,r=OC(this,JO,"URL"),i=arguments.length>1?arguments[1]:void 0,s=NC(e),a=WC(r,{type:"URL"});if(void 0!==i)if(i instanceof JO)t=GC(i);else if(n=$O(t={},NC(i)))throw TypeError(n);if(n=$O(a,s,null,t))throw TypeError(n);var o=a.searchParams=new qC,u=zC(o);u.updateSearchParams(a.query),u.updateURL=function(){a.query=String(o)||null},EC||(r.href=KO.call(r),r.origin=HO.call(r),r.protocol=YO.call(r),r.username=QO.call(r),r.password=XO.call(r),r.host=ZO.call(r),r.hostname=eP.call(r),r.port=tP.call(r),r.pathname=nP.call(r),r.search=rP.call(r),r.searchParams=iP.call(r),r.hash=sP.call(r))},VO=JO.prototype,KO=function(){var e=GC(this),t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,a=e.path,o=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",gO(e)&&(c+=n+(r?":"+r:"")+"@"),c+=lO(i),null!==s&&(c+=":"+s)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==o&&(c+="?"+o),null!==u&&(c+="#"+u),c},HO=function(){var e=GC(this),t=e.scheme,n=e.port;if("blob"==t)try{return new JO(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&mO(e)?t+"://"+lO(e.host)+(null!==n?":"+n:""):"null"},YO=function(){return GC(this).scheme+":"},QO=function(){return GC(this).username},XO=function(){return GC(this).password},ZO=function(){var e=GC(this),t=e.host,n=e.port;return null===t?"":null===n?lO(t):lO(t)+":"+n},eP=function(){var e=GC(this).host;return null===e?"":lO(e)},tP=function(){var e=GC(this).port;return null===e?"":String(e)},nP=function(){var e=GC(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},rP=function(){var e=GC(this).query;return e?"?"+e:""},iP=function(){return GC(this).searchParams},sP=function(){var e=GC(this).fragment;return e?"#"+e:""},aP=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(EC&&IC(VO,{href:aP(KO,(function(e){var t=GC(this),n=NC(e),r=$O(t,n);if(r)throw TypeError(r);zC(t.searchParams).updateSearchParams(t.query)})),origin:aP(HO),protocol:aP(YO,(function(e){var t=GC(this);$O(t,NC(e)+":",SO)})),username:aP(QO,(function(e){var t=GC(this),n=jC(NC(e));if(!bO(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=yO(n[r],hO)}})),password:aP(XO,(function(e){var t=GC(this),n=jC(NC(e));if(!bO(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=yO(n[r],hO)}})),host:aP(ZO,(function(e){var t=GC(this);t.cannotBeABaseURL||$O(t,NC(e),MO)})),hostname:aP(eP,(function(e){var t=GC(this);t.cannotBeABaseURL||$O(t,NC(e),LO)})),port:aP(tP,(function(e){var t=GC(this);bO(t)||(""==(e=NC(e))?t.port=null:$O(t,e,NO))})),pathname:aP(nP,(function(e){var t=GC(this);t.cannotBeABaseURL||(t.path=[],$O(t,NC(e),BO))})),search:aP(rP,(function(e){var t=GC(this);""==(e=NC(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",$O(t,e,WO)),zC(t.searchParams).updateSearchParams(t.query)})),searchParams:aP(iP),hash:aP(sP,(function(e){var t=GC(this);""!=(e=NC(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",$O(t,e,GO)):t.fragment=null}))}),CC(VO,"toJSON",(function(){return KO.call(this)}),{enumerable:!0}),CC(VO,"toString",(function(){return KO.call(this)}),{enumerable:!0}),BC){var oP=BC.createObjectURL,uP=BC.revokeObjectURL;oP&&CC(JO,"createObjectURL",(function(e){return oP.apply(BC,arguments)})),uP&&CC(JO,"revokeObjectURL",(function(e){return uP.apply(BC,arguments)}))}function cP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}function lP(e){return function(e){if(Array.isArray(e))return sm(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||am(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}UC(JO,"URL"),SC({global:!0,forced:!TC,sham:!EC},{URL:JO}),function(e){var t=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Object.defineProperty(e,"__esModule",{value:!0});var n=Dg.exports,r=Xm.exports,i=Fg,s=Qd.exports,a=Ym,o=Ah;function u(e){return e&&"object"===Os(e)&&"default"in e?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var l=u(n),f=u(r),d=u(i),p=c(s);
/*! *****************************************************************************
	  Copyright (c) Microsoft Corporation.
	  
	  Permission to use, copy, modify, and/or distribute this software for any
	  purpose with or without fee is hereby granted.
	  
	  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	  PERFORMANCE OF THIS SOFTWARE.
	  ***************************************************************************** */
function h(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":Os(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}function y(e,t){if("object"===("undefined"==typeof Reflect?"undefined":Os(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function v(e,t){return["".concat((new Date).toISOString()," MCS Client ").concat(e,":")].concat(Array.from(t))}var m=function(){function e(t){Ms(this,e),f.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?t+" ":""}return Ts(e,[{key:"setLevel",value:function(e){p.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.trace.apply(null,v(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.debug.apply(null,v(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.info.apply(null,v(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.warn.apply(null,v(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.error.apply(null,v(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){p.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.trace.apply(null,v("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.debug.apply(null,v("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.info.apply(null,v("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.warn.apply(null,v("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];p.error.apply(null,v("E",t))}}]),e}(),g=function(e,t){return"".concat((n=e,n.startsWith("http")?"":function(e){return"https://mcs.".concat(null!=e?e:"us1",".twilio.com")}(t))).concat(e);var n},b=function(){function e(t,n,r,i){var s,a,o,u,c,l;Ms(this,e);var f=null!==(s=null!==(a=i.MCS)&&void 0!==a?a:i)&&void 0!==s?s:{};this.region=null!==(o=null!==(u=f.region)&&void 0!==u?u:i.region)&&void 0!==o?o:"us1",this.mediaUrl=g(n,this.region),this.mediaSetUrl=r?g(r):"".concat(this.mediaUrl,"Set"),this.token=t,this.retryWhenThrottledOverride=null===(c=f.retryWhenThrottledOverride)||void 0===c||c,this.backoffConfigOverride=null!==(l=f.backoffConfigOverride)&&void 0!==l?l:e.backoffConfigDefault}return Ts(e,[{key:"updateToken",value:function(e){this.token=e}}],[{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}},{key:"retryWhenThrottledDefault",get:function(){return true}}]),e}(),Media=function(){function Media(e,t,n){Ms(this,Media),this.config=e,this.network=t,this._update(n)}return Ts(Media,[{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}},{key:"filename",get:function(){return this.state.filename}},{key:"category",get:function(){return this.state.category}},{key:"getContentUrl",value:function(){var e=this;return l.default(d.default.mark((function t(){var n;return d.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.network.get("".concat(e.config.mediaUrl,"/").concat(e.sid));case 2:return n=t.sent,e._update(n.body),t.abrupt("return",Promise.resolve(e.state.contentDirectUrl));case 5:case"end":return t.stop()}}),t)})))()}},{key:"getCachedContentUrl",value:function(){var e=this;return l.default(d.default.mark((function t(){return d.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.state.contentDirectUrl){t.next=2;break}return t.abrupt("return",Promise.resolve(e.state.contentDirectUrl));case 2:return t.next=4,e.getContentUrl();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()}},{key:"_update",value:function(e){var t,n,r,i;this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUploadUpdated:e.date_upload_updated?new Date(e.date_upload_updated):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,author:e.author,url:e.url,contentUrl:e.links.content,contentDirectUrl:null!==(t=e.links.content_direct_temporary)&&void 0!==t?t:null,filename:null!==(n=e.filename)&&void 0!==n?n:null,category:null!==(r=e.category)&&void 0!==r?r:"media",isMultipartUpstream:null!==(i=e.is_multipart_upstream)&&void 0!==i&&i}}}]),Media}(),k=function(e){Cs(n,e);var t=cP(n);function n(e,r,i,s,a){var o;return Ms(this,n),(o=t.call(this,e)).code=r,o.body=i,o.status=s,o.headers=a,o}return n}(ZR(Error)),w=t.XMLHttpRequest||{};function x(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}var _,S,E=function(){function e(){Ms(this,e)}return Ts(e,[{key:"get",value:function(t,n){return l.default(d.default.mark((function r(){return d.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",e.request("GET",t,n));case 1:case"end":return r.stop()}}),r)})))()}},{key:"post",value:function(t,n,r){return l.default(d.default.mark((function i(){return d.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",e.request("POST",t,n,r));case 1:case"end":return i.stop()}}),i)})))()}}],[{key:"request",value:function(e,t,n,r){return l.default(d.default.mark((function i(){return d.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise((function(i,s){var a=new w;for(var o in a.open(e,t,!0),a.onreadystatechange=function(){if(4===a.readyState){var e,t=(e=a.getAllResponseHeaders())?e.split("\r\n").map((function(e){return e.split(": ")})).filter((function(e){return 2===e.length&&e[1].length>0})).reduce((function(e,t){return e[t[0]]=t[1],e}),{}):{},n=x(a);if(200<=a.status&&a.status<300)i({status:a.status,headers:t,body:n});else{var r,o,u=null!==(r=a.statusText)&&void 0!==r?r:"NONE";o="string"==typeof n?n&&1===n.split("\n",2).length?n:"":JSON.stringify(n);var c="".concat(a.status,": [").concat(u,"] ").concat(o);s(new k(c,a.status,n,u,t))}}},n)a.setRequestHeader(o,n[o]),"Content-Type"===o&&"application/json"===n[o]&&(r=JSON.stringify(r));a.send(r)})));case 1:case"end":return i.stop()}}),i)})))()}}]),e}(),T=m.scope("Network"),R=function(){function e(t,n){Ms(this,e),this.config=t,this.transport=n}return Ts(e,[{key:"backoffConfig",value:function(){return Object.assign(b.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){var e,t;return null!==(e=null!==(t=this.config.retryWhenThrottledOverride)&&void 0!==t?t:b.retryWhenThrottledDefault)&&void 0!==e&&e}},{key:"executeWithRetry",value:function(e,t){var n=this;return l.default(d.default.mark((function r(){return d.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,i){var s=[502,503,504];t&&s.push(429);var o=new a.Retrier(n.backoffConfig());o.on("attempt",l.default(d.default.mark((function t(){var n;return d.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:n=t.sent,o.succeeded(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),s.indexOf(t.t0.status)>-1||"Twilsock disconnected"===t.t0.message?o.failed(t.t0):(o.removeAllListeners(),o.cancel(),i(t.t0));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),o.on("succeeded",(function(e){r(e)})),o.on("cancelled",(function(e){return i(e)})),o.on("failed",(function(e){return i(e)})),o.start()})));case 1:case"end":return r.stop()}}),r)})))()}},{key:"get",value:function(e){var t=this;return l.default(d.default.mark((function n(){var r,i;return d.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={"X-Twilio-Token":t.config.token},T.trace("sending GET request to ",e," headers ",r),n.prev=2,n.next=5,t.executeWithRetry((function(){return t.transport.get(e,r)}),t.retryWhenThrottled());case 5:return i=n.sent,T.trace("response",i),n.abrupt("return",i);case 10:throw n.prev=10,n.t0=n.catch(2),T.debug("get() error ".concat(n.t0)),n.t0;case 14:case"end":return n.stop()}}),n,null,[[2,10]])})))()}},{key:"post",value:function(e,n,r,i,s){var a=this;return l.default(d.default.mark((function o(){var u,c,l;return d.default.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return u={"X-Twilio-Token":a.config.token},"undefined"!=typeof FormData&&r instanceof FormData||!i||Object.assign(u,{"Content-Type":i}),c=new URL(e),n&&c.searchParams.append("Category",n),s&&c.searchParams.append("Filename",s),T.trace("sending POST request to ".concat(e," with headers ").concat(u)),o.prev=6,o.next=9,a.transport.post(c.href,u,r);case 9:l=o.sent,o.next=18;break;case 12:if(o.prev=12,o.t0=o.catch(6),!(void 0===t.XMLHttpRequest&&r instanceof FormData)){o.next=16;break}throw new TypeError("Posting FormData supported only with browser engine's FormData");case 16:throw T.debug("post() error ".concat(o.t0)),o.t0;case 18:return T.trace("response",l),o.abrupt("return",l);case 20:case"end":return o.stop()}}),o,null,[[6,12]])})))()}}]),e}(),I=m.scope("");e.default=(S=_=function(){function Client(e,t,n){var r,i;Ms(this,Client);var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.options=s,this.options.logLevel=null!==(r=this.options.logLevel)&&void 0!==r?r:"silent",this.config=new b(e,t,n,this.options),I.setLevel(this.options.logLevel),this.options.transport=null!==(i=this.options.transport)&&void 0!==i?i:new E,this.transport=this.options.transport,this.network=new R(this.config,this.transport)}return Ts(Client,[{key:"updateToken",value:function(e){I.info("updateToken"),this.config.updateToken(e)}},{key:"get",value:function(e){var t=this;return l.default(d.default.mark((function n(){var r;return d.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.network.get("".concat(t.config.mediaUrl,"/").concat(e));case 2:return r=n.sent,n.abrupt("return",new Media(t.config,t.network,r.body));case 4:case"end":return n.stop()}}),n)})))()}},{key:"post",value:function(e,t,n,r){var i=this;return l.default(d.default.mark((function s(){var a;return d.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,i.network.post(i.config.mediaUrl,null!=n?n:"media",t,e,r);case 2:return a=s.sent,s.abrupt("return",new Media(i.config,i.network,a.body));case 4:case"end":return s.stop()}}),s)})))()}},{key:"postFormData",value:function(e,t){var n=this;return l.default(d.default.mark((function r(){var i;return d.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.network.post(n.config.mediaUrl,null!=t?t:"media",e);case 2:return i=r.sent,r.abrupt("return",new Media(n.config,n.network,i.body));case 4:case"end":return r.stop()}}),r)})))()}},{key:"mediaSetGet",value:function(e){var t=this;return l.default(d.default.mark((function n(){var r,i;return d.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={command:"get",list:e.map((function(e){return{media_sid:e}}))},n.next=3,t.network.post("".concat(t.config.mediaSetUrl),null,JSON.stringify(r),"application/json");case 3:return i=n.sent,n.abrupt("return",i.map((function(e){if(200!==e.code)throw new Error("Failed to obtain detailed information about Media items (failed SID ".concat(e.media_record.sid,")"));return new Media(t.config,t.network,e.media_record)})));case 5:case"end":return n.stop()}}),n)})))()}}]),Client}(),f.default(_,"version","0.5.2"),S),h([o.validateTypes(o.nonEmptyString),y("design:type",Function),y("design:paramtypes",[String]),y("design:returntype",void 0)],e.default.prototype,"updateToken",null),h([o.validateTypesAsync(o.nonEmptyString),y("design:type",Function),y("design:paramtypes",[String]),y("design:returntype",Promise)],e.default.prototype,"get",null),e.default=h([o.validateConstructorTypes(o.nonEmptyString,o.nonEmptyString,[o.nonEmptyString,o.literal(null)],[o.pureObject,"undefined"]),y("design:paramtypes",[String,String,Object,Object])],e.default),e.Client=e.default,e.McsClient=e.default,e.McsMedia=Media,e.Media=Media,e.default=e.default}(tI);var fP=ia,dP="ArrayBuffer",pP=fw.ArrayBuffer;function hP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}In({global:!0,forced:i.ArrayBuffer!==pP},{ArrayBuffer:pP}),fP(dP);var yP=np.scope("Member"),Member=function(e){Cs(Member,e);var t,n,r,i,s=hP(Member);function Member(e,t,n,r,i){var a;if(Ms(this,Member),(a=s.call(this)).channel=n,a.links=r,a.services=i,a.state={attributes:Oh(e.attributes,"Retrieved malformed attributes from the server for member: "+t,yP),dateCreated:e.dateCreated?Ch(e.dateCreated):null,dateUpdated:e.dateCreated?Ch(e.dateUpdated):null,sid:t,typingTimeout:null,isTyping:!1,identity:e.identity||null,roleSid:e.roleSid||null,lastConsumedMessageIndex:Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,lastConsumptionTimestamp:e.lastConsumptionTimestamp?Ch(e.lastConsumptionTimestamp):null,type:e.type||"chat",userInfo:e.userInfo},!e.identity&&!e.type)throw new Error("Received invalid Member object from server: Missing identity or type of Member.");return a}return Ts(Member,[{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}},{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout((function(){return t._endTyping()}),e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t,n,r,i=[],s=Oh(e.attributes,"Retrieved malformed attributes from the server for member: "+this.state.sid,yP);e.attributes&&!Iv(this.state.attributes,s)&&(this.state.attributes=s,i.push("attributes"));var a=Ch(e.dateUpdated);e.dateUpdated&&(null==a?void 0:a.getTime())!==(null===(t=this.state.dateUpdated)||void 0===t?void 0:t.getTime())&&(this.state.dateUpdated=a,i.push("dateUpdated"));var o=Ch(e.dateCreated);e.dateCreated&&(null==o?void 0:o.getTime())!==(null===(n=this.state.dateCreated)||void 0===n?void 0:n.getTime())&&(this.state.dateCreated=o,i.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,i.push("roleSid")),(Number.isInteger(e.lastConsumedMessageIndex)||null===e.lastConsumedMessageIndex)&&this.state.lastConsumedMessageIndex!==e.lastConsumedMessageIndex&&(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,i.push("lastConsumedMessageIndex"));var u=Ch(e.lastConsumptionTimestamp);return e.lastConsumptionTimestamp&&(null==u?void 0:u.getTime())!==(null===(r=this.state.lastConsumptionTimestamp)||void 0===r?void 0:r.getTime())&&(this.state.lastConsumptionTimestamp=u,i.push("lastConsumptionTimestamp")),i.length>0&&this.emit("updated",{member:this,updateReasons:i}),this}},{key:"getUserDescriptor",value:(i=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User Descriptor is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getUser",value:(r=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"remove",value:(n=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channel.removeMember(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateAttributes",value:(t=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),Member}(Zv);function vP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}js(Member,"typingStarted","typingStarted"),js(Member,"typingEnded","typingEnded"),js(Member,"updated","updated"),Jd([Tv(["string","number","boolean","object",bv(null)]),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],Member.prototype,"updateAttributes",null);var mP=np.scope("Members"),gP=function(e){Cs(f,e);var t,n,r,i,s,a,o,u,c,l=vP(f);function f(e,t,n,r,i){var s;return Ms(this,f),(s=l.call(this)).channel=e,s.members=t,s.links=n,s.configuration=r,s.services=i,s}return Ts(f,[{key:"unsubscribe",value:(c=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"subscribe",value:(u=Ss(Gd.mark((function e(t){var n=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:t,mode:"open_existing"}).then((function(e){e.on("itemAdded",(function(e){mP.debug(n.channel.sid+" itemAdded: "+e.item.key),n.upsertMember(e.item.key,e.item.data).then((function(e){n.emit("memberJoined",e)}))})),e.on("itemRemoved",(function(e){mP.debug(n.channel.sid+" itemRemoved: "+e.key);var t=e.key;if(n.members.has(t)){var r=n.members.get(t);n.members.delete(t),n.emit("memberLeft",r)}})),e.on("itemUpdated",(function(e){mP.debug(n.channel.sid+" itemUpdated: "+e.item.key),n.upsertMember(e.item.key,e.item.data)}));var t=[],r=n;return e.getItems().then((function e(n){return n.items.forEach((function(e){t.push(r.upsertMember(e.key,e.data))})),n.hasNextPage?n.nextPage().then(e):null})).then((function(){return Promise.all(t)})).then((function(){return e}))})).catch((function(e){throw n.rosterEntityPromise=null,"disconnected"!=n.services.syncClient.connectionState&&mP.error("Failed to get roster object for channel",n.channel.sid,e),mP.debug("ERROR: Failed to get roster object for channel",n.channel.sid,e),e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"upsertMember",value:(o=Ss(Gd.mark((function e(t,n){var r,i,s=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.members.get(t))){e.next=3;break}return e.abrupt("return",r._update(n));case 3:return i={self:"".concat(this.links.participants,"/").concat(t)},r=new Member(n,t,this.channel,i,this.services),this.members.set(t,r),r.on("updated",(function(e){return s.emit("memberUpdated",e)})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getMembers",value:(a=Ss(Gd.mark((function e(){var t=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise.then((function(){var e=[];return t.members.forEach((function(t){return e.push(t)})),e})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getMemberBySid",value:(s=Ss(Gd.mark((function e(t){var n=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise.then((function(){var e=n.members.get(t);if(!e)throw new Error("Member with SID "+t+" was not found");return e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getMemberByIdentity",value:(i=Ss(Gd.mark((function e(t){var n,r=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",this.rosterEntityPromise.then((function(){if(r.members.forEach((function(e){e.identity===t&&(n=e)})),!n)throw new Error("Member with identity "+t+" was not found");return n})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"add",value:(r=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"invite",value:(n=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.channel.links.invites,{identity:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"remove",value:(t=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),f}(Zv),Media=function(){function Media(e,t){Ms(this,Media),js(this,"mcsMedia",null),this.services=t,this.state={sid:e.sid,filename:e.filename,contentType:e.contentType,size:e.size}}var e;return Ts(Media,[{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"getContentTemporaryUrl",value:(e=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]),Media}();function bP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}var kP=np.scope("Message"),Message=function(e){Cs(Message,e);var t,n,r,i,s=bP(Message);function Message(e,t,n,r,i,a){var o;return Ms(this,Message),(o=s.call(this)).channel=n,o.links=r,o.configuration=i,o.services=a,o.state={sid:t.sid,index:e,author:null==t.author?null:t.author,body:t.text,timestamp:t.timestamp?new Date(t.timestamp):null,dateUpdated:t.dateUpdated?new Date(t.dateUpdated):null,lastUpdatedBy:t.lastUpdatedBy?t.lastUpdatedBy:null,attributes:Oh(t.attributes,"Got malformed attributes for the message ".concat(t.sid),kP),type:t.type?t.type:"text",media:t.type&&"media"===t.type&&t.media?new Media(t.media,o.services):null,memberSid:null==t.memberSid?null:t.memberSid},o}return Ts(Message,[{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return"media"===this.type?null:this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"memberSid",get:function(){return this.state.memberSid}},{key:"_update",value:function(e){var t=[];!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("dateCreated"));var n=Oh(e.attributes,"Got malformed attributes for the message ".concat(this.sid),kP);Iv(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes")),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"getMember",value:(i=Ss(Gd.mark((function e(){var t,n,r=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.state.memberSid){e.next=5;break}return e.next=4,this.channel.getMemberBySid(this.memberSid).catch((function(){return kP.debug('Member with sid "'+r.memberSid+'" not found for message '+r.sid),null}));case 4:t=e.sent;case 5:if(t||!this.state.author){e.next=9;break}return e.next=8,this.channel.getMemberByIdentity(this.state.author).catch((function(){return kP.debug('Member with identity "'+r.author+'" not found for message '+r.sid),null}));case 8:t=e.sent;case 9:if(!t){e.next=11;break}return e.abrupt("return",t);case 11:throw n="Member with ",this.state.memberSid&&(n+="SID '"+this.state.memberSid+"' "),this.state.author&&(this.state.memberSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Member with "===n&&(n="Member "),n+="was not found",new Error(n);case 17:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"remove",value:(r=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"updateBody",value:(n=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{body:t});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateAttributes",value:(t=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),Message}(Zv);function wP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}js(Message,"updated","updated"),Jd([Tv("string"),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Message.prototype,"updateBody",null),Jd([Tv(["string","number","boolean","object",bv(null)]),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],Message.prototype,"updateAttributes",null);var xP=np.scope("Messages"),_P=function(e){Cs(c,e);var t,n,r,i,s,a,o,u=wP(c);function c(e,t,n){var r;return Ms(this,c),(r=u.call(this)).channel=e,r.configuration=t,r.services=n,r.messagesByIndex=new Map,r.messagesListPromise=null,r}return Ts(c,[{key:"subscribe",value:(o=Ss(Gd.mark((function e(t){var n=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({id:t,mode:"open_existing"}).then((function(e){return e.on("itemAdded",(function(e){xP.debug(n.channel.sid+" itemAdded: "+e.item.index);var t={self:"".concat(n.channel.links.messages,"/").concat(e.item.data.sid),conversation:n.channel.links.self,messages_receipts:"".concat(n.channel.links.messages,"/").concat(e.item.data.sid,"/Receipts")},r=new Message(e.item.index,e.item.data,n.channel,t,n.configuration,n.services);n.messagesByIndex.has(r.index)?xP.debug("Message arrived, but already known and ignored",n.channel.sid,r.index):(n.messagesByIndex.set(r.index,r),r.on("updated",(function(e){return n.emit("messageUpdated",e)})),n.emit("messageAdded",r))})),e.on("itemRemoved",(function(e){xP.debug(n.channel.sid+" itemRemoved: "+e.index);var t=e.index;if(n.messagesByIndex.has(t)){var r=n.messagesByIndex.get(t);n.messagesByIndex.delete(r.index),r.removeAllListeners("updated"),n.emit("messageRemoved",r)}})),e.on("itemUpdated",(function(e){xP.debug(n.channel.sid+" itemUpdated: "+e.item.index);var t=n.messagesByIndex.get(e.item.index);t&&t._update(e.item.data)})),e})).catch((function(e){throw n.messagesListPromise=null,"disconnected"!=n.services.syncClient.connectionState&&xP.error("Failed to get messages object for channel",n.channel.sid,e),xP.debug("ERROR: Failed to get messages object for channel",n.channel.sid,e),e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"unsubscribe",value:(a=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"send",value:(s=Ss(Gd.mark((function e(t){var n,r=arguments;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},xP.debug("Sending text message",t,n),e.next=4,this.services.commandExecutor.mutateResource("post",this.channel.links.messages,{body:t||"",attributes:void 0!==n?JSON.stringify(n):void 0});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"sendMedia",value:(i=Ss(Gd.mark((function e(t){var n,r,i,s=arguments;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},xP.debug("Sending media message",t,n),!("undefined"!=typeof FormData&&t instanceof FormData)){e.next=9;break}return xP.debug("Sending media message as FormData",t,n),e.next=6,this.services.mcsClient.postFormData(t);case 6:r=e.sent,e.next=16;break;case 9:if(xP.debug("Sending media message as SendMediaOptions",t,n),(i=t).contentType&&i.media){e.next=13;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 13:return e.next=15,this.services.mcsClient.post(i.contentType,i.media,null);case 15:r=e.sent;case 16:return e.next=18,this.services.commandExecutor.mutateResource("post",this.channel.links.messages,{media_sid:r.sid,attributes:void 0!==n?JSON.stringify(n):void 0});case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getMessages",value:(r=Ss(Gd.mark((function e(t,n,r){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0!==n?n:"end",r=r||"backwards",e.abrupt("return",this._getMessages(t,n,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"wrapPaginator",value:(n=Ss(Gd.mark((function e(t,n,r){var i,s,a,o=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="desc"===t,s=function(){return n.nextPage().then((function(e){return o.wrapPaginator(t,e,r)}))},a=function(){return n.prevPage().then((function(e){return o.wrapPaginator(t,e,r)}))},e.abrupt("return",r(n.items).then((function(e){return{items:e.sort((function(e,t){return e.index-t.index})),hasPrevPage:i?n.hasNextPage:n.hasPrevPage,hasNextPage:i?n.hasPrevPage:n.hasNextPage,prevPage:i?s:a,nextPage:i?a:s}})));case 4:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i={self:"".concat(this.channel.links.messages,"/").concat(t.sid),conversation:this.channel.links.self,messages_receipts:"".concat(this.channel.links.messages,"/").concat(t.sid,"/Receipts")},s=new Message(e,t,this.channel,i,this.configuration,this.services);return this.messagesByIndex.set(s.index,s),s.on("updated",(function(e){return n.emit("messageUpdated",e)})),s}},{key:"_getMessages",value:(t=Ss(Gd.mark((function e(t,n,r){var i,s=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0!==n?n:"end",t=t||30,i="backwards"===r?"desc":"asc",e.abrupt("return",this.messagesListPromise.then((function(e){return e.getItems({from:"end"!==n?n:void 0,pageSize:t,order:i,limit:t})})).then((function(e){return s.wrapPaginator(i,e,(function(e){return Promise.all(e.map((function(e){return s._upsertMessage(e.index,e.data)})))}))})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),c}(Zv);function SP(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return EP(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return EP(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function EP(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function TP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}var RP=np.scope("Channel"),IP={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName",state:"state"};function CP(e){try{return new Date(e)}catch(e){return null}}var Channel=function(e){Cs(Channel,e);var t,n,r,i,s,a,o,u,c,l,f,d,p,h,y,v,m,g,b,k,w,x,_,S,E,T,R,I,C,O=TP(Channel);function Channel(e,t,n,r,i){var s;Ms(this,Channel),(s=O.call(this)).sid=t,s.links=n,s.configuration=r,s.services=i;var a=e.attributes||{},o=e.createdBy,u=CP(e.dateCreated),c=CP(e.dateUpdated),l=e.friendlyName||null,f=Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,d=e.uniqueName||null;try{JSON.stringify(a)}catch(e){throw new Error("Attributes must be a valid JSON object.")}s.entityName=e.channel,s.channelState={uniqueName:d,status:"notParticipating",type:e.type,attributes:a,createdBy:o,dateCreated:u,dateUpdated:c,friendlyName:l,lastConsumedMessageIndex:f},e.notificationLevel&&(s.channelState.notificationLevel=e.notificationLevel);var p={participants:s.links.participants};return s.members=new Map,s.membersEntity=new gP(Rs(s),s.members,p,s.configuration,s.services),s.membersEntity.on("memberJoined",s.emit.bind(Rs(s),"memberJoined")),s.membersEntity.on("memberLeft",s.emit.bind(Rs(s),"memberLeft")),s.membersEntity.on("memberUpdated",(function(e){return s.emit("memberUpdated",e)})),s.messagesEntity=new _P(Rs(s),s.configuration,i),s.messagesEntity.on("messageAdded",(function(e){return s._onMessageAdded(e)})),s.messagesEntity.on("messageUpdated",(function(e){return s.emit("messageUpdated",e)})),s.messagesEntity.on("messageRemoved",s.emit.bind(Rs(s),"messageRemoved")),s}return Ts(Channel,[{key:"status",get:function(){return this.channelState.status}},{key:"type",get:function(){return this.channelState.type}},{key:"uniqueName",get:function(){return this.channelState.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.channelState.type}},{key:"friendlyName",get:function(){return this.channelState.friendlyName}},{key:"dateUpdated",get:function(){return this.channelState.dateUpdated}},{key:"dateCreated",get:function(){return this.channelState.dateCreated}},{key:"createdBy",get:function(){return this.channelState.createdBy}},{key:"attributes",get:function(){return this.channelState.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.channelState.lastConsumedMessageIndex}},{key:"lastMessage",get:function(){return this.channelState.lastMessage}},{key:"notificationLevel",get:function(){return this.channelState.notificationLevel}},{key:"state",get:function(){return this.channelState.state}},{key:"_subscribe",value:(C=Ss(Gd.mark((function e(){var t=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.entityPromise){e.next=2;break}return e.abrupt("return",this.entityPromise);case 2:return e.abrupt("return",this.entityPromise=this.entityPromise||this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then((function(e){return t.entity=e,t.entity.on("updated",(function(e){t._update(e.data)})),t.entity.on("removed",(function(){return t.emit("removed",t)})),t._update(t.entity.data),e})).catch((function(e){throw t.entity=null,t.entityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&RP.error("Failed to get channel object",e),RP.debug("ERROR: Failed to get channel object",e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"_subscribeStreams",value:(I=Ss(Gd.mark((function e(){var t,n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return RP.trace("_subscribeStreams, this.entity.data=",this.entity.data),t=this.entity.data.messages,n=this.entity.data.roster,e.next=8,Promise.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(n)]);case 8:e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),"disconnected"!==this.services.syncClient.connectionState&&RP.error("Failed to subscribe on channel objects",this.sid,e.t0),RP.debug("ERROR: Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return I.apply(this,arguments)})},{key:"_unsubscribe",value:(R=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",Promise.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"_setStatus",value:function(e,t){var n=this;this.statusSource=t,this.channelState.status!==e&&(this.channelState.status=e,"joined"===e?this._subscribeStreams().catch((function(t){if(RP.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):"invited"===e?this._subscribe().catch((function(t){if(RP.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):this.entityPromise&&this._unsubscribe().catch((function(t){if(RP.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})))}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(e){var t,n,r,i,s;RP.trace("_update",e),Channel.preprocessUpdate(e,this.sid);for(var a=new Set,o=0,u=Object.keys(e);o<u.length;o++){var c=u[o],l=IP[c];if(l)switch(l){case IP.status:if(!e.status||"unknown"===e.status||this.channelState.status===e.status)break;this.channelState.status=e.status,a.add(l);break;case IP.attributes:if(Iv(this.channelState.attributes,e.attributes))break;this.channelState.attributes=e.attributes,a.add(l);break;case IP.lastConsumedMessageIndex:if(void 0===e.lastConsumedMessageIndex||e.lastConsumedMessageIndex===this.channelState.lastConsumedMessageIndex)break;this.channelState.lastConsumedMessageIndex=e.lastConsumedMessageIndex,a.add(l);break;case IP.lastMessage:if(this.channelState.lastMessage&&!e.lastMessage){delete this.channelState.lastMessage,a.add(l);break}this.channelState.lastMessage=this.channelState.lastMessage||{},void 0!==(null===(t=e.lastMessage)||void 0===t?void 0:t.index)&&e.lastMessage.index!==this.channelState.lastMessage.index&&(this.channelState.lastMessage.index=e.lastMessage.index,a.add(l)),void 0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.timestamp)&&(null===(r=this.channelState.lastMessage)||void 0===r||null===(i=r.dateCreated)||void 0===i?void 0:i.getTime())!==e.lastMessage.timestamp.getTime()&&(this.channelState.lastMessage.dateCreated=e.lastMessage.timestamp,a.add(l)),Iv(this.channelState.lastMessage,{})&&delete this.channelState.lastMessage;break;case IP.state:var f=e.state||void 0;if(void 0!==f&&(f.dateUpdated=new Date(f.dateUpdated)),Iv(this.channelState.state,f))break;this.channelState.state=f,a.add(l);break;default:var d=e[c]instanceof Date,p=d&&(null===(s=this.channelState[l])||void 0===s?void 0:s.getTime())===e[c].getTime(),h=!d&&this[l]===e[c];if(p||h)break;this.channelState[l]=e[c],a.add(l)}}a.size>0&&this.emit("updated",{channel:this,updateReasons:lP(a)})}},{key:"_onMessageAdded",value:function(e){var t,n=SP(this.members.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identity===e.author){r._endTyping();break}}}catch(e){n.e(e)}finally{n.f()}this.emit("messageAdded",e)}},{key:"_setLastConsumedMessageIndex",value:(T=Ss(Gd.mark((function e(t){var n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post","".concat(this.configuration.links.myConversations,"/").concat(this.sid),{last_consumed_message_index:t});case 2:return n=e.sent,e.abrupt("return",n.unread_messages_count);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"add",value:(E=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.add(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"advanceLastConsumedMessageIndex",value:(S=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:if(!(t<this.lastConsumedMessageIndex)){e.next=6;break}return e.next=5,this._setLastConsumedMessageIndex(this.lastConsumedMessageIndex);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this._setLastConsumedMessageIndex(t);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"decline",value:(_=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete","".concat(this.links.invites,"/").concat(this.configuration.userIdentity));case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"delete",value:(x=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"getAttributes",value:(w=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getMessages",value:(k=Ss(Gd.mark((function e(t,n,r){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.messagesEntity.getMessages(t,n,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return k.apply(this,arguments)})},{key:"getMembers",value:(b=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.membersEntity.getMembers();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"getMembersCount",value:(g=Ss(Gd.mark((function e(){var t,n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ph(this.configuration.links.conversations).path(this.sid).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",n.body.participants_count);case 5:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"getMemberBySid",value:(m=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.getMemberBySid(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getMemberByIdentity",value:(v=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.getMemberByIdentity(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getMessagesCount",value:(y=Ss(Gd.mark((function e(){var t,n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ph(this.configuration.links.conversations).path(this.sid).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",n.body.messages_count);case 5:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getUnconsumedMessagesCount",value:(h=Ss(Gd.mark((function e(){var t,n,r;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ph(this.configuration.links.myConversations).path(this.sid).build(),e.next=3,this.services.network.get(t);case 3:if((n=e.sent).body.conversation_sid===this.sid){e.next=6;break}throw new Error("Channel was not found in the user channels list");case 6:if("number"!=typeof(r=n.body.unread_messages_count)){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"invite",value:(p=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.invite(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"join",value:(d=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:this.configuration.userIdentity});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"leave",value:(f=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.channelState.status){e.next=3;break}return e.next=3,this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(this.configuration.userIdentity));case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"removeMember",value:(l=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.remove("string"==typeof t?t:t.sid);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"sendMessage",value:(c=Ss(Gd.mark((function e(t,n){var r,i;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t&&null!==t){e.next=5;break}return e.next=3,this.messagesEntity.send(t,n);case 3:return r=e.sent,e.abrupt("return",Ih(r.index));case 5:return e.next=7,this.messagesEntity.sendMedia(t,n);case 7:return i=e.sent,e.abrupt("return",Ih(i.index));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"setAllMessagesConsumed",value:(u=Ss(Gd.mark((function e(){var t;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastConsumedMessageIndex(t.items[0].index));case 7:return e.abrupt("return",Promise.resolve(0));case 8:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"setNoMessagesConsumed",value:(o=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this._setLastConsumedMessageIndex(null);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"setUserNotificationLevel",value:(a=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post","".concat(this.configuration.links.myConversations,"/").concat(this.sid),{notification_level:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:(s=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"updateFriendlyName",value:(i=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.friendlyName===t){e.next=3;break}return e.next=3,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateLastConsumedMessageIndex",value:(r=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this._setLastConsumedMessageIndex(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateUniqueName",value:(n=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.uniqueName===t){e.next=4;break}return t||(t=""),e.next=4,this.services.commandExecutor.mutateResource("post",this.links.self,{unique_name:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getUserDescriptors",value:(t=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.users.getChannelUserDescriptors(this.sid);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&JSON.stringify(e.attributes)}catch(n){RP.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){RP.warn("Retrieved malformed dateCreated from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){RP.warn("Retrieved malformed dateUpdated from the server for channel: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){RP.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+t),delete e.lastMessage.timestamp}}}]),Channel}(Zv);js(Channel,"memberJoined","memberJoined"),js(Channel,"memberLeft","memberLeft"),js(Channel,"memberUpdated","memberUpdated"),js(Channel,"messageAdded","messageAdded"),js(Channel,"messageRemoved","messageRemoved"),js(Channel,"messageUpdated","messageUpdated"),js(Channel,"typingEnded","typingEnded"),js(Channel,"typingStarted","typingStarted"),js(Channel,"updated","updated"),js(Channel,"removed","removed"),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Channel.prototype,"add",null),Jd([Tv(wv),Vd("design:type",Function),Vd("design:paramtypes",[Number]),Vd("design:returntype",Promise)],Channel.prototype,"advanceLastConsumedMessageIndex",null),Jd([Tv(["undefined",wv],["undefined",wv],["undefined",bv("backwards","forward")]),Vd("design:type",Function),Vd("design:paramtypes",[Number,Number,String]),Vd("design:returntype",Promise)],Channel.prototype,"getMessages",null),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Channel.prototype,"getMemberBySid",null),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Channel.prototype,"getMemberByIdentity",null),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Channel.prototype,"invite",null),Jd([Tv([kv,Member]),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],Channel.prototype,"removeMember",null),Jd([Tv(["string",bv(null),gv((function(e){return[e instanceof FormData,"an instance of FormData"]})),xv("media options",{contentType:[kv,"undefined"],media:gv((function(e){var t="string"==typeof e&&e.length>0||e instanceof Uint8Array||e instanceof ArrayBuffer;return"function"==typeof Blob&&(t=t||e instanceof Blob),[t,"a non-empty string, an instance of Buffer or an instance of Blob"]}))})],["undefined","string","number","boolean","object",bv(null)]),Vd("design:type",Function),Vd("design:paramtypes",[Object,Object]),Vd("design:returntype",Promise)],Channel.prototype,"sendMessage",null),Jd([Tv(bv("default","muted")),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Channel.prototype,"setUserNotificationLevel",null),Jd([Tv(["string","number","boolean","object",bv(null)]),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],Channel.prototype,"updateAttributes",null),Jd([Tv("string"),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Channel.prototype,"updateFriendlyName",null),Jd([Tv([bv(null),wv]),Vd("design:type",Function),Vd("design:paramtypes",[Number]),Vd("design:returntype",Promise)],Channel.prototype,"updateLastConsumedMessageIndex",null),Jd([Tv(["string",bv(null)]),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],Channel.prototype,"updateUniqueName",null);var OP=function(){function e(){var t=this;Ms(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return Ts(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}();function PP(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return AP(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return AP(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function AP(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function MP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jP(Object(n),!0).forEach((function(t){js(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function LP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}var NP=np.scope("Channels"),UP=function(e){Cs(f,e);var t,n,r,i,s,a,o,u,c,l=LP(f);function f(e,t){var n;return Ms(this,f),js(Rs(n=l.call(this)),"channels",new Map),js(Rs(n),"tombstones",new Set),js(Rs(n),"myChannelsFetched",!1),js(Rs(n),"myChannelsRead",new OP),n.configuration=e,n.services=t,n}return Ts(f,[{key:"getMap",value:(c=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.syncClient.map({id:this.configuration.myConversations,mode:"open_existing"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"addChannel",value:(u=Ss(Gd.mark((function e(t){var n,r,i,s,a,o,u;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===t.attributes?{}:t.attributes,e.next=3,this.services.commandExecutor.mutateResource("post",this.configuration.links.conversations,{type:t.isPrivate?"private":"public",unique_name:t.uniqueName,friendly_name:t.friendlyName,attributes:void 0!==n?JSON.stringify(n):void 0});case 3:if(r=e.sent,i=r.sid||null,s=r.sync_objects.conversation||null,a=MP({self:r.url},r.links),!(o=this.channels.get(i))){e.next=12;break}return e.next=11,o._subscribe();case 11:return e.abrupt("return",o);case 12:return u=new Channel({channel:s,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:t.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},i,a,this.configuration,this.services),this.channels.set(u.sid,u),this.registerForEvents(u),e.next=17,u._subscribe();case 17:return this.emit("channelAdded",u),e.abrupt("return",u);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"fetchChannels",value:(o=Ss(Gd.mark((function e(){var t,n,r,i,s,a,o,u=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getMap();case 3:return(t=e.sent).on("itemAdded",(function(e){NP.debug("itemAdded: ".concat(e.item.key)),u.upsertChannel("sync",e.item.key,e.item.data)})),t.on("itemRemoved",(function(e){NP.debug("itemRemoved: ".concat(e.key));var t=e.key;u.myChannelsFetched||u.tombstones.add(t);var n=u.channels.get(t);n&&("joined"!==n.status&&"invited"!==n.status||(n._setStatus("notParticipating","sync"),u.emit("channelLeft",n)),n.isPrivate&&(u.channels.delete(t),u.emit("channelRemoved",n),n.emit("removed",n)))})),t.on("itemUpdated",(function(e){NP.debug("itemUpdated: ".concat(e.item.key)),u.upsertChannel("sync",e.item.key,e.item.data)})),e.next=9,this._fetchMyChannels();case 9:n=e.sent,r=[],i=PP(n);try{for(i.s();!(s=i.n()).done;)a=s.value,r.push(this.upsertChannel("rest",a.channel_sid,a))}catch(e){i.e(e)}finally{i.f()}return this.myChannelsRead.set(!0),e.next=16,Promise.all(r);case 16:return this.myChannelsFetched=!0,this.tombstones.clear(),NP.debug("The channels list has been successfully fetched"),e.abrupt("return",this);case 22:throw e.prev=22,e.t0=e.catch(0),o="Failed to fetch the channels list","disconnected"!==this.services.syncClient.connectionState&&NP.error(o,e.t0),NP.debug("ERROR: ".concat(o),e.t0),e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(){return o.apply(this,arguments)})},{key:"_wrapPaginator",value:(a=Ss(Gd.mark((function e(t,n){var r=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n(t.items).then((function(e){return{items:e,hasNextPage:t.hasNextPage,hasPrevPage:t.hasPrevPage,nextPage:function(){return t.nextPage().then((function(e){return r._wrapPaginator(e,n)}))},prevPage:function(){return t.prevPage().then((function(e){return r._wrapPaginator(e,n)}))}}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"getChannels",value:(s=Ss(Gd.mark((function e(t){var n,r,i=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMap();case 2:return n=e.sent,e.next=5,n.getItems(t);case 5:return r=e.sent,e.abrupt("return",this._wrapPaginator(r,(function(e){return Promise.all(e.map((function(e){return i.upsertChannel("sync",e.key,e.data)})))})));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getChannel",value:(i=Ss(Gd.mark((function e(t){var n,r,i,s=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMap();case 2:return n=e.sent,e.next=5,n.getItems({key:t});case 5:return r=e.sent,i=r.items.map((function(e){return s.upsertChannel("sync",e.key,e.data)})),e.abrupt("return",i.length>0?i[0]:null);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"pushChannel",value:(r=Ss(Gd.mark((function e(t){var n,r;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sid,r={entityName:null,lastConsumedMessageIndex:t.lastConsumedMessageIndex,type:t.type,status:t.status,friendlyName:t.friendlyName,dateUpdated:t.dateUpdated,dateCreated:t.dateCreated,uniqueName:t.uniqueName,createdBy:t.createdBy,attributes:t.attributes,channel:t instanceof ChannelDescriptor?t.channel:null,notificationLevel:t.notificationLevel,sid:n},e.next=4,this.upsertChannel("chat",n,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_updateChannel",value:function(e,t,n){var r=this,i=void 0!==t._statusSource()&&e!==t._statusSource(),s="rest"!==e||"sync"===t._statusSource();if(i&&s&&"sync"!==e)NP.trace("upsertChannel: the channel is known from sync and it came from chat, ignoring",{sid:t.sid,data:n.status,channel:t.status});else{if(["joined","invited"].includes(n.status)&&t.status!==n.status){t._setStatus(n.status,e);var a={};return void 0!==n.notificationLevel&&(a.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(a.lastConsumedMessageIndex=n.lastConsumedMessageIndex),Iv(a,{})||t._update(a),void t._subscribe().then((function(){r.emit("joined"===n.status?"channelJoined":"channelInvited",t)}))}if(["joined","invited"].includes(t.status)&&"notParticipating"===n.status)return t._setStatus("notParticipating",e),t._update(n),void t._subscribe().then((function(){r.emit("channelLeft",t)}));"private"!==n.type||"notParticipating"!==n.status?t._update(n):t._subscribe()}}},{key:"upsertChannel",value:(n=Ss(Gd.mark((function e(t,n,r){var i,s,a,o;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(NP.trace("upsertChannel called for ".concat(n),r),!(i=this.channels.get(n))){e.next=8;break}return NP.trace("upsertChannel: the channel ".concat(i.sid," is known;")+"its status is known from source ".concat(i._statusSource()," ")+"and the update came from source ".concat(t),i),this._updateChannel(t,i,r),e.next=7,i._subscribe();case 7:return e.abrupt("return",i);case 8:if(!["chat","rest"].includes(t)||!this.tombstones.has(n)){e.next=11;break}return NP.trace("upsertChannel: the channel is deleted but reappeared again from chat, ignoring",n),e.abrupt("return",null);case 11:return NP.trace("upsertChannel: creating a local channel object with sid ".concat(n),r),s="".concat(this.configuration.links.conversations,"/").concat(n),a={self:s,messages:"".concat(s,"/Messages"),participants:"".concat(s,"/Participants"),invites:"".concat(s,"/Invites")},o=new Channel(r,n,a,this.configuration,this.services),this.channels.set(n,o),e.next=18,o._subscribe();case 18:return this.registerForEvents(o),this.emit("channelAdded",o),["joined","invited"].includes(r.status)&&(o._setStatus(r.status,t),this.emit("joined"===r.status?"channelJoined":"channelInvited",o)),e.abrupt("return",o);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",(function(){return t.onChannelRemoved(e.sid)})),e.on("updated",(function(e){return t.emit("channelUpdated",e)})),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",(function(e){return t.emit("memberUpdated",e)})),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",(function(e){return t.emit("messageUpdated",e)})),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}},{key:"_fetchMyChannels",value:(t=Ss(Gd.mark((function e(){var t,n,r,i,s;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=null;case 2:return r=new Ph(this.configuration.links.myConversations),n&&r.arg("PageToken",n),e.next=6,this.services.network.get(r.build());case 6:i=e.sent,s=i.body.conversations.map((function(e){return{descriptor:e,channel_sid:e.conversation_sid,status:e.status,channel:e.sync_objects.conversation,messages:e.sync_objects.messages,roster:"".concat(e.conversation_sid,".roster"),lastConsumedMessageIndex:e.last_consumed_message_index,notificationLevel:e.notification_level}})),n=i.body.meta.next_token,t=[].concat(lP(t),lP(s));case 10:if(n){e.next=2;break}case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),f}(Zv),DP=In,FP=Hr.find,BP=xl,qP="find",zP=!0;qP in[]&&Array(1).find((function(){zP=!1})),DP({target:"Array",proto:!0,forced:zP},{find:function(e){return FP(this,e,arguments.length>1?arguments[1]:void 0)}}),BP(qP);var WP=np.scope("UserDescriptor"),UserDescriptor=function(){function UserDescriptor(e,t){Ms(this,UserDescriptor),this.services=e,this.descriptor=t,this.identity=t.identity,this.friendlyName=t.friendly_name,this.attributes=Oh(t.attributes,"Failed to parse user attributes",WP),this.online=t.is_online,this.notifiable=t.is_notifiable}return Ts(UserDescriptor,[{key:"subscribe",value:function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{key:"_getDescriptor",value:function(){return this.descriptor}}]),UserDescriptor}(),GP=function(){function e(t,n){Ms(this,e),this.configuration=t,this.services=n}var t,n;return Ts(e,[{key:"getUserDescriptor",value:(n=Ss(Gd.mark((function e(t){var n,r;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ph(this.configuration.links.users).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,e.abrupt("return",new UserDescriptor(this.services,r.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(t=Ss(Gd.mark((function e(t){var n,r,i,s=this,a=arguments;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},r=new Ph(this.configuration.links.users).arg("ConversationSid",t).arg("PageToken",n.pageToken).build(),e.next=4,this.services.network.get(r);case 4:return i=e.sent,e.abrupt("return",new nm(i.body.users.map((function(e){return new UserDescriptor(s.services,e)})),(function(e){return s.getChannelUserDescriptors(t,{pageToken:e})}),i.body.meta.prev_token,i.body.meta.next_token));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function $P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$P(Object(n),!0).forEach((function(t){js(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function VP(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}var KP=function(e){Cs(a,e);var t,n,r,i,s=VP(a);function a(e,t,n){var r;return Ms(this,a),(r=s.call(this)).configuration=t,r.services=n,r.fifoStack=[],r.myself=e,r.myself.on("updated",(function(e){return r.emit("userUpdated",e)})),r.myself.on("userSubscribed",(function(){return r.emit("userSubscribed",r.myself)})),r.myself.on("userUnsubscribed",(function(){r.emit("userUnsubscribed",r.myself),r.myself._ensureFetched()})),r.subscribedUsers=new Map,r.userDescriptors=new GP(r.configuration,JP(JP({},r.services),{},{users:Rs(r)})),r}return Ts(a,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=-1;this.fifoStack.find((function(n,r){return n==e.identity&&(t=r,!0)}))&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.configuration.userInfosToSubscribe&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{key:"getUser",value:(i=Ss(Gd.mark((function e(t){var n,r,i,s=this,a=arguments;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,e.next=3,this.myself._ensureFetched();case 3:if(t!=this.myself.identity){e.next=5;break}return e.abrupt("return",this.myself);case 5:if(r=this.subscribedUsers.get(t)){e.next=18;break}if(n){e.next=12;break}return e.next=10,this.getUserDescriptor(t);case 10:i=e.sent,n=i._getDescriptor().sync_objects.user_info_map;case 12:return(r=new User(t,n,this.configuration,this.services)).on("updated",(function(e){return s.emit("userUpdated",e)})),r.on("userSubscribed",(function(){return s.handleSubscribeUser(r)})),r.on("userUnsubscribed",(function(){return s.handleUnsubscribeUser(r)})),e.next=18,r._ensureFetched();case 18:return e.abrupt("return",r);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getUserDescriptor",value:(r=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.userDescriptors.getUserDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(n=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.userDescriptors.getChannelUserDescriptors(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getSubscribedUsers",value:(t=Ss(Gd.mark((function e(){var t;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.myself._ensureFetched();case 2:return t=[this.myself],this.subscribedUsers.forEach((function(e){return t.push(e)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(Zv),HP=np.scope("TypingIndicator"),YP=function(){function e(t,n,r){Ms(this,e),this.getChannel=t,this.configuration=n,this.services=r,this.serviceTypingTimeout=null,this.sentUpdates=new Map}var t,n,r;return Ts(e,[{key:"typingTimeout",get:function(){return this.configuration.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.configuration.typingIndicatorTimeoutDefault}},{key:"initialize",value:function(){var e=this;this.services.notificationClient.on("message",(function(t,n){t===Ng.TYPING_INDICATOR&&e._handleRemoteTyping(n)}))}},{key:"_handleRemoteTyping",value:(r=Ss(Gd.mark((function e(t){var n=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:HP.trace("Got new typing indicator ",t),this.getChannel(t.channel_sid).then((function(e){e&&e.members.forEach((function(e){if(e.identity===t.identity){var r=n.configuration.typingIndicatorTimeoutOverride+1e3||1e3*t.typing_timeout;e._startTyping(r)}}))})).catch((function(e){throw HP.error(e),e}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"send",value:(n=Ss(Gd.mark((function e(t){var n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this.sentUpdates.get(t))&&n>Date.now()-this.typingTimeout)){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return this.sentUpdates.set(t,Date.now()),e.abrupt("return",this._send(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_send",value:(t=Ss(Gd.mark((function e(t){var n,r,i,s=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return HP.trace("Sending typing indicator"),n=this.configuration.links.typing,r={"Content-Type":"application/x-www-form-urlencoded"},i="ChannelSid="+t,e.abrupt("return",this.services.transport.post(n,r,i,this.configuration.productId).then((function(e){e.body.hasOwnProperty("typing_timeout")&&(s.serviceTypingTimeout=1e3*e.body.typing_timeout)})).catch((function(e){throw HP.error("Failed to send typing indicator:",e),e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),QP=function(){function e(t,n,r){Ms(this,e),this.client=t,this.services=n,this.url=r}var t;return Ts(e,[{key:"getChannels",value:(t=Ss(Gd.mark((function e(){var t,n,r,i=this,s=arguments;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=new Ph(this.url).arg("PageToken",t.pageToken).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,e.abrupt("return",new nm(r.body.conversations.map((function(e){return new ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),r.body.meta.previous_token,r.body.meta.next_token));case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),PushNotification=function PushNotification(e){Ms(this,PushNotification),this.title=e.title||null,this.body=e.body||null,this.sound=e.sound||null,this.badge=e.badge||null,this.action=e.action||null,this.type=e.type||null,this.data=e.data||{}};function XP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ZP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?XP(Object(n),!0).forEach((function(t){js(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var eA,tA,nA,rA=function(e){return e.replace(/(^\/+|\/+$)/g,"")},iA=function(){function e(t,n,r){Ms(this,e),this._serviceUrl=t,this._services=n,this._productId=r}var t,n,r;return Ts(e,[{key:"_preProcessUrl",value:function(e){var t=rA(e);return/^https?:\/\//.test(e)?t:"".concat(rA(this._serviceUrl),"/").concat(t)}},{key:"_makeRequest",value:(r=Ss(Gd.mark((function e(t,n,r,i){var s,a,o,u;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=this._preProcessUrl(n),a=ZP({"Content-Type":"application/json; charset=utf-8"},i||{}),e.t0=t,e.next="get"===e.t0?5:"post"===e.t0?11:"delete"===e.t0?15:19;break;case 5:return u=s,r&&(u+="?"+Object.entries(r).map((function(e){return e.map(encodeURIComponent).join("=")})).join("&")),e.next=9,this._services.transport.get(u,a,this._productId);case 9:return o=e.sent,e.abrupt("break",19);case 11:return e.next=13,this._services.transport.post(s,a,JSON.stringify(r),this._productId);case 13:return o=e.sent,e.abrupt("break",19);case 15:return e.next=17,this._services.transport.delete(s,a,null,this._productId);case 17:return o=e.sent,e.abrupt("break",19);case 19:if(!(o.status.code<200||o.status.code>=300)){e.next=21;break}throw new Error("Request responded with a non-success code ".concat(o.status.code));case 21:return e.abrupt("return",o);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"fetchResource",value:(n=Ss(Gd.mark((function e(t,n){var r,i=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,new Pg({min:50,max:1600,maxAttemptsCount:6}).run((function(){return i._makeRequest("get",t,n)}));case 4:r=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),new Error('Fetch resource from "'.concat(t,'" failed.'));case 10:return e.abrupt("return",r.body);case 11:case"end":return e.stop()}}),e,null,[[1,7]])}))),function(e,t){return n.apply(this,arguments)})},{key:"mutateResource",value:(t=Ss(Gd.mark((function e(t,n,r){var i;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._makeRequest(t,n,r,{"X-Twilio-Mutation-Id":xb.v4()});case 2:if(202!==(i=e.sent).status.code){e.next=7;break}return e.next=6,this.fetchResource(i.body.resource_url);case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",i.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();function sA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sA(Object(n),!0).forEach((function(t){js(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oA(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ps(this,n)}}var uA=np.scope("Client"),cA="6.0.0",lA=function e(){Ms(this,e)};return e.Client=(tA=eA=function(e){Cs(Client,e);var t,n,r,i,s,a,o,u,c,l,f,d,p,h,y,v,m,g=oA(Client);function Client(e){var t,n,r,i,s,a,o,u,c,l,f,d,p,h,y,v,m,b,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ms(this,Client),js(Rs(b=g.call(this)),"connectionState","unknown"),js(Rs(b),"_ensureReady",null),js(Rs(b),"_resolveEnsureReady",null),js(Rs(b),"_rejectEnsureReady",null),js(Rs(b),"channelsPromise",null),js(Rs(b),"configurationPromise",null),js(Rs(b),"version",cA),js(Rs(b),"parsePushNotification",nA.parsePushNotification),b.fpaToken=e,b.options=k,b.options=null!==(t=b.options)&&void 0!==t?t:{},!b.options.disableDeepClone){var w=aA(aA({},b.options),{},{transport:void 0,twilsockClient:void 0});(w=Rh(w)).transport=b.options.transport,w.twilsockClient=b.options.twilsockClient,b.options=w}b.options.logLevel=null!==(n=b.options.logLevel)&&void 0!==n?n:"silent",uA.setLevel(b.options.logLevel);var x=b.options.productId="ip_messaging";b.options.clientMetadata=null!==(r=b.options.clientMetadata)&&void 0!==r?r:{},b.options.clientMetadata.hasOwnProperty("type")||(b.options.clientMetadata.type="chat"),b.options.clientMetadata.hasOwnProperty("sdk")||(b.options.clientMetadata.sdk="JS",b.options.clientMetadata.sdkv=cA),b.options.Sync=null!==(i=b.options.Sync)&&void 0!==i?i:{},null!==(s=b.options.Sync)&&void 0!==s&&s.enableSessionStorage||(b.options.Sync.enableSessionStorage=!0),b.options.region&&(b.options.Sync.region=b.options.region),b.services=new lA;var _=!b.options.twilsockClient;if(!b.options.initRegistrations){var S=new Bg.InitRegistration(x);nA.populateInitRegistrations(S),YR.populateInitRegistrations(S),b.options.initRegistrations=[S]}b.services.twilsockClient=b.options.twilsockClient=null!==(a=b.options.twilsockClient)&&void 0!==a?a:new Bg.TwilsockClient(e,x,b.options),b.services.twilsockClient.on("tokenAboutToExpire",(function(e){return b.emit("tokenAboutToExpire",e)})),b.services.twilsockClient.on("tokenExpired",(function(){return b.emit("tokenExpired")})),b.services.twilsockClient.on("connectionError",(function(e){return b.emit("connectionError",e)})),b.services.twilsockClient.on("stateChanged",(function(e){uA.debug("Handling stateChanged for ChatClient: new state ".concat(e)),e!==b.connectionState&&(b.connectionState=e,b.emit("connectionStateChanged",b.connectionState))})),b.services.transport=b.options.transport=null!==(o=b.options.transport)&&void 0!==o?o:b.options.twilsockClient,b.services.notificationClient=b.options.notificationsClient=null!==(u=b.options.notificationsClient)&&void 0!==u?u:new Ug.Notifications(e,b.options),b.services.syncClient=b.options.syncClient=null!==(c=b.options.syncClient)&&void 0!==c?c:new YR(e,b.options);var E=null!==(l=null!==(f=null!==(d=null===(p=b.options)||void 0===p?void 0:p.Chat)&&void 0!==d?d:null===(h=b.options)||void 0===h?void 0:h.IPMessaging)&&void 0!==f?f:b.options)&&void 0!==l?l:{},T=null!==(y=E.region)&&void 0!==y?y:b.options.region,R=null!==(v=null!==(m=E.apiUri)&&void 0!==m?m:E.typingUri)&&void 0!==v?v:"https://aim.".concat(T||"us1",".twilio.com");b.services.commandExecutor=new iA(R,{transport:b.options.transport},x);var I=function(e){b._rejectEnsureReady(e),b.emit("stateChanged","failed")};return b.services.twilsockClient.once("connectionError",I),b.services.twilsockClient.once("disconnected",I),b.services.twilsockClient.once("connected",Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uA.debug("ChatClient started INITIALIZING"),b.services.twilsockClient.off("connectionError",I),b.services.twilsockClient.off("disconnected",I),e.prev=3,e.next=6,b._initialize();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),b._rejectEnsureReady(e.t0),b.emit("stateChanged","failed");case 12:case"end":return e.stop()}}),e,null,[[3,8]])})))),b._ensureReady=new Promise((function(e,t){b._resolveEnsureReady=e,b._rejectEnsureReady=t})).catch((function(e){})),b._myself=new User("","",null,b.services),_&&b.services.twilsockClient.connect(),b}return Ts(Client,[{key:"user",get:function(){return this._myself}},{key:"reachabilityEnabled",get:function(){if(!this.configuration)throw new Error("Reachability information could not yet be accessed as the client has not yet been initialized. Subscribe to the 'stateChanged' event to properly react to the client initialization.");return this.configuration.reachabilityEnabled}},{key:"token",get:function(){return this.fpaToken}},{key:"_subscribeToPushNotifications",value:function(e){var t=this;[Ng.NEW_MESSAGE,Ng.ADDED_TO_CHANNEL,Ng.INVITED_TO_CHANNEL,Ng.REMOVED_FROM_CHANNEL,Ng.CONSUMPTION_UPDATE].forEach((function(n){t.services.notificationClient.subscribe(e,n)}))}},{key:"_unsubscribeFromPushNotifications",value:function(e){var t=this;[Ng.NEW_MESSAGE,Ng.ADDED_TO_CHANNEL,Ng.INVITED_TO_CHANNEL,Ng.REMOVED_FROM_CHANNEL,Ng.CONSUMPTION_UPDATE].forEach((function(n){t.services.notificationClient.unsubscribe(e,n)}))}},{key:"_initialize",value:(m=Ss(Gd.mark((function e(){var t,n=this;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.fetchResource("Client/v1/Configuration");case 2:return t=e.sent,this.configuration=new pp(this.options,t,uA),this._myself._resolveInitialization(this.configuration,this.configuration.userIdentity,this.configuration.userInfo,!0),this.services.typingIndicator=new YP(this.getChannelBySid.bind(this),this.configuration,this.services),this.services.network=new Lg(this.configuration,this.services),this.services.users=new KP(this._myself,this.configuration,this.services),this.services.users.on("userSubscribed",this.emit.bind(this,"userSubscribed")),this.services.users.on("userUpdated",(function(e){return n.emit("userUpdated",e)})),this.services.users.on("userUnsubscribed",this.emit.bind(this,"userUnsubscribed")),this.channels=new UP(this.configuration,this.services),this.channels.on("channelAdded",this.emit.bind(this,"channelAdded")),this.channels.on("channelInvited",this.emit.bind(this,"channelInvited")),this.channels.on("channelRemoved",this.emit.bind(this,"channelRemoved")),this.channels.on("channelJoined",this.emit.bind(this,"channelJoined")),this.channels.on("channelLeft",this.emit.bind(this,"channelLeft")),this.channels.on("channelUpdated",(function(e){return n.emit("channelUpdated",e)})),this.channels.on("memberJoined",this.emit.bind(this,"memberJoined")),this.channels.on("memberLeft",this.emit.bind(this,"memberLeft")),this.channels.on("memberUpdated",(function(e){return n.emit("memberUpdated",e)})),this.channels.on("messageAdded",this.emit.bind(this,"messageAdded")),this.channels.on("messageUpdated",(function(e){return n.emit("messageUpdated",e)})),this.channels.on("messageRemoved",this.emit.bind(this,"messageRemoved")),this.channels.on("typingStarted",this.emit.bind(this,"typingStarted")),this.channels.on("typingEnded",this.emit.bind(this,"typingEnded")),this.channelsPromise=this.channels.fetchChannels().then((function(){return n.channels})).catch((function(e){throw e})),e.next=29,this.services.users.myself._ensureFetched();case 29:nA.supportedPushChannels.forEach((function(e){return n._subscribeToPushNotifications(e)})),this.services.typingIndicator.initialize(),this.services.publicChannels=new im(this,this.services,this.configuration.links.conversations),this.services.userChannels=new QP(this,this.services,this.configuration.links.myConversations),this.services.mcsClient=new tI.McsClient(this.fpaToken,this.configuration.links.mediaService,null,aA(aA({},this.options),{},{transport:null})),this._resolveEnsureReady(),this.emit("stateChanged","initialized");case 36:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"shutdown",value:(v=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.services.syncClient.shutdown();case 4:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"updateToken",value:(y=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:if(uA.info("updateToken"),this.fpaToken!==t){e.next=5;break}return e.abrupt("return",this);case 5:return e.next=7,this.services.twilsockClient.updateToken(t);case 7:return this.fpaToken=t,this.services.mcsClient.updateToken(t),e.next=11,this.configurationPromise;case 11:return e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getChannelBySid",value:(h=Ss(Gd.mark((function e(t){var n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.channels.myChannelsRead.promise;case 4:return e.next=6,this.channels.getChannel(t);case 6:if(n=e.sent){e.next=11;break}return e.next=10,this.services.publicChannels.getChannelBySid(t);case 10:n=e.sent;case 11:return e.next=13,this.channels.pushChannel(n);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(p=Ss(Gd.mark((function e(t){var n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.channels.myChannelsRead.promise;case 4:return e.next=6,this.services.publicChannels.getChannelByUniqueName(t);case 6:return n=e.sent,e.next=9,this.channels.pushChannel(n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getSubscribedChannels",value:(d=Ss(Gd.mark((function e(t){var n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.channelsPromise;case 4:return n=e.sent,e.next=7,n.getChannels(t);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getLocalChannels",value:(f=Ss(Gd.mark((function e(t){var n,r,i;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.channelsPromise;case 4:return n=e.sent,r=Array.from(n.channels.values()),i=(null==t?void 0:t.order)||"ascending",null!=t&&t.criteria&&("lastMessage"===t.criteria?r.sort((function(e,t){return nA.compareChannelsByLastMessage(e,t,i)})):"uniqueName"===t.criteria?r.sort((function(e,t){return nA.compareChannelsByStringProperty(e.uniqueName,t.uniqueName,i)})):"friendlyName"===t.criteria&&r.sort((function(e,t){return nA.compareChannelsByStringProperty(e.friendlyName,t.friendlyName,i)}))),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getPublicChannelDescriptors",value:(l=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.services.publicChannels.getChannels();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"getUserChannelDescriptors",value:(c=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.services.userChannels.getChannels();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"createChannel",value:(u=Ss(Gd.mark((function e(t){var n;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return t=t||{},e.next=5,this.channelsPromise;case 5:return n=e.sent,e.next=8,n.addChannel(t);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setPushRegistrationId",value:(o=Ss(Gd.mark((function e(t,n){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return this.services.notificationClient.setPushRegistrationId(t,n),e.next=5,this.services.notificationClient.commitChanges();case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"unsetPushRegistrationId",value:(a=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return this._unsubscribeFromPushNotifications(t),e.next=5,this.services.notificationClient.commitChanges();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"handlePushNotification",value:(s=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:uA.debug("handlePushNotification, notificationPayload=",t),this.emit("pushNotification",nA.parsePushNotification(t));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getUser",value:(i=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.services.users.getUser(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getUserDescriptor",value:(r=Ss(Gd.mark((function e(t){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.services.users.getUserDescriptor(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getSubscribedUsers",value:(n=Ss(Gd.mark((function e(){return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this.services.users.getSubscribedUsers();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}],[{key:"create",value:(t=Ss(Gd.mark((function e(t,n){var r;return Gd.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n||!n.twilsockClient){e.next=2;break}throw new Error("Obsolete usage of ChatClient.create() factory method: if you pass twilsock from the outside then you must use ChatClient constructor and be prepared to work with uninitialized client.");case 2:return r=new nA(t,n),e.next=5,r._ensureReady;case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"populateInitRegistrations",value:function(e){e.populateInitRegistrations([Ng.TYPING_INDICATOR])}},{key:"compareChannelsByLastMessage",value:function(e,t,n){var r=function(e,t){var n,r,i,s,a,o,u,c,l,f;return(null===(n=e.lastMessage)||void 0===n||null===(r=n.dateCreated)||void 0===r?void 0:r.getTime())>(null===(i=t.lastMessage)||void 0===i||null===(s=i.dateCreated)||void 0===s?void 0:s.getTime())?1:(null===(a=e.lastMessage)||void 0===a||null===(o=a.dateCreated)||void 0===o?void 0:o.getTime())<(null===(u=t.lastMessage)||void 0===u||null===(c=u.dateCreated)||void 0===c?void 0:c.getTime())?-1:null!==(l=t.lastMessage)&&void 0!==l&&l.dateCreated?1:null!==(f=e.lastMessage)&&void 0!==f&&f.dateCreated?-1:t.lastMessage?1:e.lastMessage?-1:0}(e,t);return console.log("Sorted ".concat(e.sid," and ").concat(t.sid,": return ").concat(r)),"ascending"===n?r:-r}},{key:"compareChannelsByStringProperty",value:function(e,t,n){var r,i,s=(i=t,(r=e)&&i?e.localeCompare(t):i?1:r?-1:0);return"ascending"===n?s:-s}},{key:"parsePushNotificationChatData",value:function(e){var t={};for(var n in nA.supportedPushDataFields)void 0!==e[n]&&null!==e[n]&&("message_index"===n?null!==Ih(e[n])&&(t[nA.supportedPushDataFields[n]]=Number(e[n])):t[nA.supportedPushDataFields[n]]=e[n]);return t}},{key:"parsePushNotification",value:function(e){if(uA.debug("parsePushNotification, notificationPayload=",e),void 0!==e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var t=nA.parsePushNotificationChatData(e),n=e.aps,r=null,i=null;return"string"==typeof n.alert?r=n.alert||null:(r=n.alert.body||null,i=n.alert.title||null),new PushNotification({title:i,body:r,sound:n.sound||null,badge:n.badge||null,action:n.category||null,type:e.twi_message_type,data:t})}if(void 0!==e.data){var s=e.data;if(!s.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var a=nA.parsePushNotificationChatData(e.data);return new PushNotification({title:s.twi_title||null,body:s.twi_body||null,sound:s.twi_sound||null,badge:null,action:s.twi_action||null,type:s.twi_message_type,data:a})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),Client}(Zv),js(eA,"version",cA),js(eA,"supportedPushChannels",["fcm","apn"]),js(eA,"supportedPushDataFields",{channel_sid:"channelSid",message_sid:"messageSid",message_index:"messageIndex"}),js(eA,"channelAdded","channelAdded"),js(eA,"channelInvited","channelInvited"),js(eA,"channelJoined","channelJoined"),js(eA,"channelLeft","channelLeft"),js(eA,"channelRemoved","channelRemoved"),js(eA,"channelUpdated","channelUpdated"),js(eA,"memberJoined","memberJoined"),js(eA,"memberLeft","memberLeft"),js(eA,"memberUpdated","memberUpdated"),js(eA,"messageAdded","messageAdded"),js(eA,"messageRemoved","messageRemoved"),js(eA,"messageUpdated","messageUpdated"),js(eA,"tokenAboutToExpire","tokenAboutToExpire"),js(eA,"tokenExpired","tokenExpired"),js(eA,"typingEnded","typingEnded"),js(eA,"typingStarted","typingStarted"),js(eA,"pushNotification","pushNotification"),js(eA,"userSubscribed","userSubscribed"),js(eA,"userUnsubscribed","userUnsubscribed"),js(eA,"userUpdated","userUpdated"),js(eA,"connectionError","connectionError"),js(eA,"stateChanged","stateChanged"),js(eA,"connectionStateChanged","connectionStateChanged"),nA=tA),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],e.Client.prototype,"updateToken",null),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],e.Client.prototype,"getChannelBySid",null),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],e.Client.prototype,"getChannelByUniqueName",null),Jd([Tv(["undefined",xv("sorting options",{criteria:[bv("lastMessage","friendlyName","uniqueName"),"undefined"],order:[bv("ascending","descending"),"undefined"]})]),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],e.Client.prototype,"getLocalChannels",null),Jd([Tv(["undefined",xv("channel options",{friendlyName:["string","undefined"],isPrivate:["boolean","undefined"],uniqueName:["string","undefined"]})]),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],e.Client.prototype,"createChannel",null),Jd([Tv(bv("fcm","apn"),"string"),Vd("design:type",Function),Vd("design:paramtypes",[String,String]),Vd("design:returntype",Promise)],e.Client.prototype,"setPushRegistrationId",null),Jd([Tv(bv("fcm","apn")),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],e.Client.prototype,"unsetPushRegistrationId",null),Jd([Tv(_v),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",Promise)],e.Client.prototype,"handlePushNotification",null),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],e.Client.prototype,"getUser",null),Jd([Tv(kv),Vd("design:type",Function),Vd("design:paramtypes",[String]),Vd("design:returntype",Promise)],e.Client.prototype,"getUserDescriptor",null),Jd([Ev(_v),Vd("design:type",Function),Vd("design:paramtypes",[Object]),Vd("design:returntype",PushNotification)],e.Client,"parsePushNotification",null),e.Client=nA=Jd([Sv(kv,[_v,"undefined",bv(null)]),Vd("design:paramtypes",[String,Object])],e.Client),e.Channel=Channel,e.ChannelDescriptor=ChannelDescriptor,e.Media=Media,e.Member=Member,e.Message=Message,e.PushNotification=PushNotification,e.RestPaginator=nm,e.User=User,e.UserDescriptor=UserDescriptor,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
