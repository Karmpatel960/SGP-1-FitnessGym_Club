/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.

*/
this.Twilio=this.Twilio||{},this.Twilio.Sync=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")(),o={},a=function(e){try{return!!e()}catch(e){return!0}},s=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u={},c={}.propertyIsEnumerable,l=Object.getOwnPropertyDescriptor,f=l&&!c.call({1:2},1);u.f=f?function(e){var t=l(this,e);return!!t&&t.enumerable}:c;var d,p,h=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},v={}.toString,y=function(e){return v.call(e).slice(8,-1)},m=y,g="".split,b=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==m(e)?g.call(e,""):Object(e)}:Object,k=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},w=b,x=k,_=function(e){return w(x(e))},S=function(e){return"object"==typeof e?null!==e:"function"==typeof e},E=i,T=function(e){return"function"==typeof e?e:void 0},I=function(e,t){return arguments.length<2?T(E[e]):E[e]&&E[e][t]},R=I("navigator","userAgent")||"",O=i,A=R,C=O.process,P=O.Deno,M=C&&C.versions||P&&P.version,j=M&&M.v8;j?p=(d=j.split("."))[0]<4?1:d[0]+d[1]:A&&(!(d=A.match(/Edge\/(\d+)/))||d[1]>=74)&&(d=A.match(/Chrome\/(\d+)/))&&(p=d[1]);var L=p&&+p,N=L,F=a,D=!!Object.getOwnPropertySymbols&&!F((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&N&&N<41})),U=D&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,B=I,q=U?function(e){return"symbol"==typeof e}:function(e){var t=B("Symbol");return"function"==typeof t&&Object(e)instanceof t},W=S,z={exports:{}},$=i,G=function(e,t){try{Object.defineProperty($,e,{value:t,configurable:!0,writable:!0})}catch(n){$[e]=t}return t},K=G,V="__core-js_shared__",Q=i[V]||K(V,{}),H=Q;(z.exports=function(e,t){return H[e]||(H[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.17.3",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var Y=k,J=function(e){return Object(Y(e))},X=J,Z={}.hasOwnProperty,ee=Object.hasOwn||function(e,t){return Z.call(X(e),t)},te=0,ne=Math.random(),re=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++te+ne).toString(36)},ie=i,oe=z.exports,ae=ee,se=re,ue=D,ce=U,le=oe("wks"),fe=ie.Symbol,de=ce?fe:fe&&fe.withoutSetter||se,pe=function(e){return ae(le,e)&&(ue||"string"==typeof le[e])||(ue&&ae(fe,e)?le[e]=fe[e]:le[e]=de("Symbol."+e)),le[e]},he=S,ve=q,ye=function(e,t){var n,r;if("string"===t&&"function"==typeof(n=e.toString)&&!W(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!W(r=n.call(e)))return r;if("string"!==t&&"function"==typeof(n=e.toString)&&!W(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},me=pe("toPrimitive"),ge=function(e,t){if(!he(e)||ve(e))return e;var n,r=e[me];if(void 0!==r){if(void 0===t&&(t="default"),n=r.call(e,t),!he(n)||ve(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),ye(e,t)},be=ge,ke=q,we=function(e){var t=be(e,"string");return ke(t)?t:String(t)},xe=S,_e=i.document,Se=xe(_e)&&xe(_e.createElement),Ee=function(e){return Se?_e.createElement(e):{}},Te=Ee,Ie=!s&&!a((function(){return 7!=Object.defineProperty(Te("div"),"a",{get:function(){return 7}}).a})),Re=s,Oe=u,Ae=h,Ce=_,Pe=we,Me=ee,je=Ie,Le=Object.getOwnPropertyDescriptor;o.f=Re?Le:function(e,t){if(e=Ce(e),t=Pe(t),je)try{return Le(e,t)}catch(e){}if(Me(e,t))return Ae(!Oe.f.call(e,t),e[t])};var Ne={},Fe=S,De=function(e){if(!Fe(e))throw TypeError(String(e)+" is not an object");return e},Ue=s,Be=Ie,qe=De,We=we,ze=Object.defineProperty;Ne.f=Ue?ze:function(e,t,n){if(qe(e),t=We(t),qe(n),Be)try{return ze(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var $e=Ne,Ge=h,Ke=s?function(e,t,n){return $e.f(e,t,Ge(1,n))}:function(e,t,n){return e[t]=n,e},Ve={exports:{}},Qe=Q,He=Function.toString;"function"!=typeof Qe.inspectSource&&(Qe.inspectSource=function(e){return He.call(e)});var Ye,Je,Xe,Ze=Qe.inspectSource,et=Ze,tt=i.WeakMap,nt="function"==typeof tt&&/native code/.test(et(tt)),rt=z.exports,it=re,ot=rt("keys"),at=function(e){return ot[e]||(ot[e]=it(e))},st={},ut=nt,ct=S,lt=Ke,ft=ee,dt=Q,pt=at,ht=st,vt="Object already initialized",yt=i.WeakMap;if(ut||dt.state){var mt=dt.state||(dt.state=new yt),gt=mt.get,bt=mt.has,kt=mt.set;Ye=function(e,t){if(bt.call(mt,e))throw new TypeError(vt);return t.facade=e,kt.call(mt,e,t),t},Je=function(e){return gt.call(mt,e)||{}},Xe=function(e){return bt.call(mt,e)}}else{var wt=pt("state");ht[wt]=!0,Ye=function(e,t){if(ft(e,wt))throw new TypeError(vt);return t.facade=e,lt(e,wt,t),t},Je=function(e){return ft(e,wt)?e[wt]:{}},Xe=function(e){return ft(e,wt)}}var xt={set:Ye,get:Je,has:Xe,enforce:function(e){return Xe(e)?Je(e):Ye(e,{})},getterFor:function(e){return function(t){var n;if(!ct(t)||(n=Je(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},_t=i,St=Ke,Et=ee,Tt=G,It=Ze,Rt=xt.get,Ot=xt.enforce,At=String(String).split("String");(Ve.exports=function(e,t,n,r){var i,o=!!r&&!!r.unsafe,a=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||Et(n,"name")||St(n,"name",t),(i=Ot(n)).source||(i.source=At.join("string"==typeof t?t:""))),e!==_t?(o?!s&&e[t]&&(a=!0):delete e[t],a?e[t]=n:St(e,t,n)):a?e[t]=n:Tt(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Rt(this).source||It(this)}));var Ct={},Pt=Math.ceil,Mt=Math.floor,jt=function(e){return isNaN(e=+e)?0:(e>0?Mt:Pt)(e)},Lt=jt,Nt=Math.min,Ft=function(e){return e>0?Nt(Lt(e),9007199254740991):0},Dt=jt,Ut=Math.max,Bt=Math.min,qt=function(e,t){var n=Dt(e);return n<0?Ut(n+t,0):Bt(n,t)},Wt=_,zt=Ft,$t=qt,Gt=function(e){return function(t,n,r){var i,o=Wt(t),a=zt(o.length),s=$t(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},Kt={includes:Gt(!0),indexOf:Gt(!1)},Vt=ee,Qt=_,Ht=Kt.indexOf,Yt=st,Jt=function(e,t){var n,r=Qt(e),i=0,o=[];for(n in r)!Vt(Yt,n)&&Vt(r,n)&&o.push(n);for(;t.length>i;)Vt(r,n=t[i++])&&(~Ht(o,n)||o.push(n));return o},Xt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zt=Jt,en=Xt.concat("length","prototype");Ct.f=Object.getOwnPropertyNames||function(e){return Zt(e,en)};var tn={};tn.f=Object.getOwnPropertySymbols;var nn=Ct,rn=tn,on=De,an=I("Reflect","ownKeys")||function(e){var t=nn.f(on(e)),n=rn.f;return n?t.concat(n(e)):t},sn=ee,un=an,cn=o,ln=Ne,fn=function(e,t){for(var n=un(t),r=ln.f,i=cn.f,o=0;o<n.length;o++){var a=n[o];sn(e,a)||r(e,a,i(t,a))}},dn=a,pn=/#|\.prototype\./,hn=function(e,t){var n=yn[vn(e)];return n==gn||n!=mn&&("function"==typeof t?dn(t):!!t)},vn=hn.normalize=function(e){return String(e).replace(pn,".").toLowerCase()},yn=hn.data={},mn=hn.NATIVE="N",gn=hn.POLYFILL="P",bn=hn,kn=i,wn=o.f,xn=Ke,_n=Ve.exports,Sn=G,En=fn,Tn=bn,In=function(e,t){var n,r,i,o,a,s=e.target,u=e.global,c=e.stat;if(n=u?kn:c?kn[s]||Sn(s,{}):(kn[s]||{}).prototype)for(r in t){if(o=t[r],i=e.noTargetGet?(a=wn(n,r))&&a.value:n[r],!Tn(u?r:s+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;En(o,i)}(e.sham||i&&i.sham)&&xn(o,"sham",!0),_n(n,r,o,e)}},Rn=Jt,On=Xt,An=Object.keys||function(e){return Rn(e,On)},Cn=J,Pn=An;In({target:"Object",stat:!0,forced:a((function(){Pn(1)}))},{keys:function(e){return Pn(Cn(e))}});var Mn,jn=y,Ln=Array.isArray||function(e){return"Array"==jn(e)},Nn=q,Fn=function(e){if(Nn(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},Dn=Ne,Un=De,Bn=An,qn=s?Object.defineProperties:function(e,t){Un(e);for(var n,r=Bn(t),i=r.length,o=0;i>o;)Dn.f(e,n=r[o++],t[n]);return e},Wn=I("document","documentElement"),zn=De,$n=qn,Gn=Xt,Kn=st,Vn=Wn,Qn=Ee,Hn=at("IE_PROTO"),Yn=function(){},Jn=function(e){return"<script>"+e+"</"+"script>"},Xn=function(e){e.write(Jn("")),e.close();var t=e.parentWindow.Object;return e=null,t},Zn=function(){try{Mn=new ActiveXObject("htmlfile")}catch(e){}var e,t;Zn="undefined"!=typeof document?document.domain&&Mn?Xn(Mn):((t=Qn("iframe")).style.display="none",Vn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Jn("document.F=Object")),e.close(),e.F):Xn(Mn);for(var n=Gn.length;n--;)delete Zn.prototype[Gn[n]];return Zn()};Kn[Hn]=!0;var er=Object.create||function(e,t){var n;return null!==e?(Yn.prototype=zn(e),n=new Yn,Yn.prototype=null,n[Hn]=e):n=Zn(),void 0===t?n:$n(n,t)},tr={},nr=_,rr=Ct.f,ir={}.toString,or="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];tr.f=function(e){return or&&"[object Window]"==ir.call(e)?function(e){try{return rr(e)}catch(e){return or.slice()}}(e):rr(nr(e))};var ar={},sr=pe;ar.f=sr;var ur=i,cr=ee,lr=ar,fr=Ne.f,dr=function(e){var t=ur.Symbol||(ur.Symbol={});cr(t,e)||fr(t,e,{value:lr.f(e)})},pr=Ne.f,hr=ee,vr=pe("toStringTag"),yr=function(e,t,n){e&&!hr(e=n?e:e.prototype,vr)&&pr(e,vr,{configurable:!0,value:t})},mr=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},gr=mr,br=function(e,t,n){if(gr(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},kr=S,wr=Ln,xr=pe("species"),_r=function(e){var t;return wr(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!wr(t.prototype)?kr(t)&&null===(t=t[xr])&&(t=void 0):t=void 0),void 0===t?Array:t},Sr=function(e,t){return new(_r(e))(0===t?0:t)},Er=br,Tr=b,Ir=J,Rr=Ft,Or=Sr,Ar=[].push,Cr=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(u,c,l,f){for(var d,p,h=Ir(u),v=Tr(h),y=Er(c,l,3),m=Rr(v.length),g=0,b=f||Or,k=t?b(u,m):n||a?b(u,0):void 0;m>g;g++)if((s||g in v)&&(p=y(d=v[g],g,h),e))if(t)k[g]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return g;case 2:Ar.call(k,d)}else switch(e){case 4:return!1;case 7:Ar.call(k,d)}return o?-1:r||i?i:k}},Pr={forEach:Cr(0),map:Cr(1),filter:Cr(2),some:Cr(3),every:Cr(4),find:Cr(5),findIndex:Cr(6),filterReject:Cr(7)},Mr=In,jr=i,Lr=I,Nr=s,Fr=D,Dr=a,Ur=ee,Br=Ln,qr=S,Wr=q,zr=De,$r=J,Gr=_,Kr=we,Vr=Fn,Qr=h,Hr=er,Yr=An,Jr=Ct,Xr=tr,Zr=tn,ei=o,ti=Ne,ni=u,ri=Ke,ii=Ve.exports,oi=z.exports,ai=st,si=re,ui=pe,ci=ar,li=dr,fi=yr,di=xt,pi=Pr.forEach,hi=at("hidden"),vi="Symbol",yi=ui("toPrimitive"),mi=di.set,gi=di.getterFor(vi),bi=Object.prototype,ki=jr.Symbol,wi=Lr("JSON","stringify"),xi=ei.f,_i=ti.f,Si=Xr.f,Ei=ni.f,Ti=oi("symbols"),Ii=oi("op-symbols"),Ri=oi("string-to-symbol-registry"),Oi=oi("symbol-to-string-registry"),Ai=oi("wks"),Ci=jr.QObject,Pi=!Ci||!Ci.prototype||!Ci.prototype.findChild,Mi=Nr&&Dr((function(){return 7!=Hr(_i({},"a",{get:function(){return _i(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=xi(bi,t);r&&delete bi[t],_i(e,t,n),r&&e!==bi&&_i(bi,t,r)}:_i,ji=function(e,t){var n=Ti[e]=Hr(ki.prototype);return mi(n,{type:vi,tag:e,description:t}),Nr||(n.description=t),n},Li=function(e,t,n){e===bi&&Li(Ii,t,n),zr(e);var r=Kr(t);return zr(n),Ur(Ti,r)?(n.enumerable?(Ur(e,hi)&&e[hi][r]&&(e[hi][r]=!1),n=Hr(n,{enumerable:Qr(0,!1)})):(Ur(e,hi)||_i(e,hi,Qr(1,{})),e[hi][r]=!0),Mi(e,r,n)):_i(e,r,n)},Ni=function(e,t){zr(e);var n=Gr(t),r=Yr(n).concat(Bi(n));return pi(r,(function(t){Nr&&!Fi.call(n,t)||Li(e,t,n[t])})),e},Fi=function(e){var t=Kr(e),n=Ei.call(this,t);return!(this===bi&&Ur(Ti,t)&&!Ur(Ii,t))&&(!(n||!Ur(this,t)||!Ur(Ti,t)||Ur(this,hi)&&this[hi][t])||n)},Di=function(e,t){var n=Gr(e),r=Kr(t);if(n!==bi||!Ur(Ti,r)||Ur(Ii,r)){var i=xi(n,r);return!i||!Ur(Ti,r)||Ur(n,hi)&&n[hi][r]||(i.enumerable=!0),i}},Ui=function(e){var t=Si(Gr(e)),n=[];return pi(t,(function(e){Ur(Ti,e)||Ur(ai,e)||n.push(e)})),n},Bi=function(e){var t=e===bi,n=Si(t?Ii:Gr(e)),r=[];return pi(n,(function(e){!Ur(Ti,e)||t&&!Ur(bi,e)||r.push(Ti[e])})),r};(Fr||(ki=function(){if(this instanceof ki)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Vr(arguments[0]):void 0,t=si(e),n=function(e){this===bi&&n.call(Ii,e),Ur(this,hi)&&Ur(this[hi],t)&&(this[hi][t]=!1),Mi(this,t,Qr(1,e))};return Nr&&Pi&&Mi(bi,t,{configurable:!0,set:n}),ji(t,e)},ii(ki.prototype,"toString",(function(){return gi(this).tag})),ii(ki,"withoutSetter",(function(e){return ji(si(e),e)})),ni.f=Fi,ti.f=Li,ei.f=Di,Jr.f=Xr.f=Ui,Zr.f=Bi,ci.f=function(e){return ji(ui(e),e)},Nr&&(_i(ki.prototype,"description",{configurable:!0,get:function(){return gi(this).description}}),ii(bi,"propertyIsEnumerable",Fi,{unsafe:!0}))),Mr({global:!0,wrap:!0,forced:!Fr,sham:!Fr},{Symbol:ki}),pi(Yr(Ai),(function(e){li(e)})),Mr({target:vi,stat:!0,forced:!Fr},{for:function(e){var t=Vr(e);if(Ur(Ri,t))return Ri[t];var n=ki(t);return Ri[t]=n,Oi[n]=t,n},keyFor:function(e){if(!Wr(e))throw TypeError(e+" is not a symbol");if(Ur(Oi,e))return Oi[e]},useSetter:function(){Pi=!0},useSimple:function(){Pi=!1}}),Mr({target:"Object",stat:!0,forced:!Fr,sham:!Nr},{create:function(e,t){return void 0===t?Hr(e):Ni(Hr(e),t)},defineProperty:Li,defineProperties:Ni,getOwnPropertyDescriptor:Di}),Mr({target:"Object",stat:!0,forced:!Fr},{getOwnPropertyNames:Ui,getOwnPropertySymbols:Bi}),Mr({target:"Object",stat:!0,forced:Dr((function(){Zr.f(1)}))},{getOwnPropertySymbols:function(e){return Zr.f($r(e))}}),wi)&&Mr({target:"JSON",stat:!0,forced:!Fr||Dr((function(){var e=ki();return"[null]"!=wi([e])||"{}"!=wi({a:e})||"{}"!=wi(Object(e))}))},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(qr(t)||void 0!==e)&&!Wr(e))return Br(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Wr(t))return t}),i[1]=t,wi.apply(null,i)}});ki.prototype[yi]||ri(ki.prototype,yi,ki.prototype.valueOf),fi(ki,vi),ai[hi]=!0;var qi=a,Wi=L,zi=pe("species"),$i=function(e){return Wi>=51||!qi((function(){var t=[];return(t.constructor={})[zi]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Gi=Pr.filter;In({target:"Array",proto:!0,forced:!$i("filter")},{filter:function(e){return Gi(this,e,arguments.length>1?arguments[1]:void 0)}});var Ki=In,Vi=a,Qi=_,Hi=o.f,Yi=s,Ji=Vi((function(){Hi(1)}));Ki({target:"Object",stat:!0,forced:!Yi||Ji,sham:!Yi},{getOwnPropertyDescriptor:function(e,t){return Hi(Qi(e),t)}});var Xi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Zi=Ee("span").classList,eo=Zi&&Zi.constructor&&Zi.constructor.prototype,to=eo===Object.prototype?void 0:eo,no=a,ro=function(e,t){var n=[][e];return!!n&&no((function(){n.call(null,t||function(){throw 1},1)}))},io=Pr.forEach,oo=ro("forEach")?[].forEach:function(e){return io(this,e,arguments.length>1?arguments[1]:void 0)},ao=i,so=Xi,uo=to,co=oo,lo=Ke,fo=function(e){if(e&&e.forEach!==co)try{lo(e,"forEach",co)}catch(t){e.forEach=co}};for(var po in so)fo(ao[po]&&ao[po].prototype);fo(uo);var ho=we,vo=Ne,yo=h,mo=function(e,t,n){var r=ho(t);r in e?vo.f(e,r,yo(0,n)):e[r]=n},go=an,bo=_,ko=o,wo=mo;In({target:"Object",stat:!0,sham:!s},{getOwnPropertyDescriptors:function(e){for(var t,n,r=bo(e),i=ko.f,o=go(r),a={},s=0;o.length>s;)void 0!==(n=i(r,t=o[s++]))&&wo(a,t,n);return a}});var xo=i,_o=yr;In({global:!0},{Reflect:{}}),_o(xo.Reflect,"Reflect",!0);var So=mr,Eo=S,To=[].slice,Io={},Ro=function(e,t,n){if(!(t in Io)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";Io[t]=Function("C,a","return new C("+r.join(",")+")")}return Io[t](e,n)},Oo=Function.bind||function(e){var t=So(this),n=To.call(arguments,1),r=function(){var i=n.concat(To.call(arguments));return this instanceof r?Ro(t,i.length,i):t.apply(e,i)};return Eo(t.prototype)&&(r.prototype=t.prototype),r},Ao=In,Co=mr,Po=De,Mo=S,jo=er,Lo=Oo,No=a,Fo=I("Reflect","construct"),Do=No((function(){function e(){}return!(Fo((function(){}),[],e)instanceof e)})),Uo=!No((function(){Fo((function(){}))})),Bo=Do||Uo;function qo(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Wo(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){qo(o,r,i,a,s,"next",e)}function s(e){qo(o,r,i,a,s,"throw",e)}a(void 0)}))}}function zo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Go(e,t,n){return t&&$o(e.prototype,t),n&&$o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ko(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vo(e,t){return Vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Vo(e,t)}function Qo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vo(e,t)}function Ho(e){return Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ho(e)}function Yo(e,t){if(t&&("object"===Ho(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ko(e)}function Jo(e){return Jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Jo(e)}function Xo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ao({target:"Reflect",stat:!0,forced:Bo,sham:Bo},{construct:function(e,t){Co(e),Po(t);var n=arguments.length<3?e:Co(arguments[2]);if(Uo&&!Do)return Fo(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(Lo.apply(e,r))}var i=n.prototype,o=jo(Mo(i)?i:Object.prototype),a=Function.apply.call(e,o,t);return Mo(a)?a:o}});var Zo=Pr.map;In({target:"Array",proto:!0,forced:!$i("map")},{map:function(e){return Zo(this,e,arguments.length>1?arguments[1]:void 0)}});var ea={};ea[pe("toStringTag")]="z";var ta="[object z]"===String(ea),na=ta,ra=y,ia=pe("toStringTag"),oa="Arguments"==ra(function(){return arguments}()),aa=na?ra:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),ia))?n:oa?ra(t):"Object"==(r=ra(t))&&"function"==typeof t.callee?"Arguments":r},sa=aa,ua=ta?{}.toString:function(){return"[object "+sa(this)+"]"},ca=ta,la=Ve.exports,fa=ua;ca||la(Object.prototype,"toString",fa,{unsafe:!0});var da=i.Promise,pa=Ve.exports,ha=function(e,t,n){for(var r in t)pa(e,r,t[r],n);return e},va=S,ya=De,ma=function(e){if(!va(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},ga=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return ya(n),ma(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),ba=I,ka=Ne,wa=s,xa=pe("species"),_a=function(e){var t=ba(e),n=ka.f;wa&&t&&!t[xa]&&n(t,xa,{configurable:!0,get:function(){return this}})},Sa=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Ea={},Ta=Ea,Ia=pe("iterator"),Ra=Array.prototype,Oa=function(e){return void 0!==e&&(Ta.Array===e||Ra[Ia]===e)},Aa=aa,Ca=Ea,Pa=pe("iterator"),Ma=function(e){if(null!=e)return e[Pa]||e["@@iterator"]||Ca[Aa(e)]},ja=De,La=Ma,Na=function(e,t){var n=arguments.length<2?La(e):t;if("function"!=typeof n)throw TypeError(String(e)+" is not iterable");return ja(n.call(e))},Fa=De,Da=function(e,t,n){var r,i;Fa(e);try{if(void 0===(r=e.return)){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return Fa(r),n},Ua=De,Ba=Oa,qa=Ft,Wa=br,za=Na,$a=Ma,Ga=Da,Ka=function(e,t){this.stopped=e,this.result=t},Va=function(e,t,n){var r,i,o,a,s,u,c,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),h=Wa(t,l,1+f+p),v=function(e){return r&&Ga(r,"normal",e),new Ka(!0,e)},y=function(e){return f?(Ua(e),p?h(e[0],e[1],v):h(e[0],e[1])):p?h(e,v):h(e)};if(d)r=e;else{if("function"!=typeof(i=$a(e)))throw TypeError("Target is not iterable");if(Ba(i)){for(o=0,a=qa(e.length);a>o;o++)if((s=y(e[o]))&&s instanceof Ka)return s;return new Ka(!1)}r=za(e,i)}for(u=r.next;!(c=u.call(r)).done;){try{s=y(c.value)}catch(e){Ga(r,"throw",e)}if("object"==typeof s&&s&&s instanceof Ka)return s}return new Ka(!1)},Qa=pe("iterator"),Ha=!1;try{var Ya=0,Ja={next:function(){return{done:!!Ya++}},return:function(){Ha=!0}};Ja[Qa]=function(){return this},Array.from(Ja,(function(){throw 2}))}catch(e){}var Xa,Za,es,ts,ns=function(e,t){if(!t&&!Ha)return!1;var n=!1;try{var r={};r[Qa]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},rs=De,is=mr,os=pe("species"),as=function(e,t){var n,r=rs(e).constructor;return void 0===r||null==(n=rs(r)[os])?t:is(n)},ss=/(?:ipad|iphone|ipod).*applewebkit/i.test(R),us="process"==y(i.process),cs=i,ls=a,fs=br,ds=Wn,ps=Ee,hs=ss,vs=us,ys=cs.setImmediate,ms=cs.clearImmediate,gs=cs.process,bs=cs.MessageChannel,ks=cs.Dispatch,ws=0,xs={},_s="onreadystatechange";try{Xa=cs.location}catch(e){}var Ss=function(e){if(xs.hasOwnProperty(e)){var t=xs[e];delete xs[e],t()}},Es=function(e){return function(){Ss(e)}},Ts=function(e){Ss(e.data)},Is=function(e){cs.postMessage(String(e),Xa.protocol+"//"+Xa.host)};ys&&ms||(ys=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return xs[++ws]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Za(ws),ws},ms=function(e){delete xs[e]},vs?Za=function(e){gs.nextTick(Es(e))}:ks&&ks.now?Za=function(e){ks.now(Es(e))}:bs&&!hs?(ts=(es=new bs).port2,es.port1.onmessage=Ts,Za=fs(ts.postMessage,ts,1)):cs.addEventListener&&"function"==typeof postMessage&&!cs.importScripts&&Xa&&"file:"!==Xa.protocol&&!ls(Is)?(Za=Is,cs.addEventListener("message",Ts,!1)):Za=_s in ps("script")?function(e){ds.appendChild(ps("script")).onreadystatechange=function(){ds.removeChild(this),Ss(e)}}:function(e){setTimeout(Es(e),0)});var Rs,Os,As,Cs,Ps,Ms,js,Ls,Ns={set:ys,clear:ms},Fs=i,Ds=/ipad|iphone|ipod/i.test(R)&&void 0!==Fs.Pebble,Us=/web0s(?!.*chrome)/i.test(R),Bs=i,qs=o.f,Ws=Ns.set,zs=ss,$s=Ds,Gs=Us,Ks=us,Vs=Bs.MutationObserver||Bs.WebKitMutationObserver,Qs=Bs.document,Hs=Bs.process,Ys=Bs.Promise,Js=qs(Bs,"queueMicrotask"),Xs=Js&&Js.value;Xs||(Rs=function(){var e,t;for(Ks&&(e=Hs.domain)&&e.exit();Os;){t=Os.fn,Os=Os.next;try{t()}catch(e){throw Os?Cs():As=void 0,e}}As=void 0,e&&e.enter()},zs||Ks||Gs||!Vs||!Qs?!$s&&Ys&&Ys.resolve?((js=Ys.resolve(void 0)).constructor=Ys,Ls=js.then,Cs=function(){Ls.call(js,Rs)}):Cs=Ks?function(){Hs.nextTick(Rs)}:function(){Ws.call(Bs,Rs)}:(Ps=!0,Ms=Qs.createTextNode(""),new Vs(Rs).observe(Ms,{characterData:!0}),Cs=function(){Ms.data=Ps=!Ps}));var Zs=Xs||function(e){var t={fn:e,next:void 0};As&&(As.next=t),Os||(Os=t,Cs()),As=t},eu={},tu=mr,nu=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=tu(t),this.reject=tu(n)};eu.f=function(e){return new nu(e)};var ru,iu,ou,au,su=De,uu=S,cu=eu,lu=i,fu="object"==typeof window,du=In,pu=i,hu=I,vu=da,yu=Ve.exports,mu=ha,gu=ga,bu=yr,ku=_a,wu=S,xu=mr,_u=Sa,Su=Ze,Eu=Va,Tu=ns,Iu=as,Ru=Ns.set,Ou=Zs,Au=function(e,t){if(su(e),uu(t)&&t.constructor===e)return t;var n=cu.f(e);return(0,n.resolve)(t),n.promise},Cu=function(e,t){var n=lu.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},Pu=eu,Mu=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},ju=xt,Lu=bn,Nu=fu,Fu=us,Du=L,Uu=pe("species"),Bu="Promise",qu=ju.get,Wu=ju.set,zu=ju.getterFor(Bu),$u=vu&&vu.prototype,Gu=vu,Ku=$u,Vu=pu.TypeError,Qu=pu.document,Hu=pu.process,Yu=Pu.f,Ju=Yu,Xu=!!(Qu&&Qu.createEvent&&pu.dispatchEvent),Zu="function"==typeof PromiseRejectionEvent,ec="unhandledrejection",tc=!1,nc=Lu(Bu,(function(){var e=Su(Gu),t=e!==String(Gu);if(!t&&66===Du)return!0;if(Du>=51&&/native code/.test(e))return!1;var n=new Gu((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[Uu]=r,!(tc=n.then((function(){}))instanceof r)||!t&&Nu&&!Zu})),rc=nc||!Tu((function(e){Gu.all(e).catch((function(){}))})),ic=function(e){var t;return!(!wu(e)||"function"!=typeof(t=e.then))&&t},oc=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;Ou((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var a,s,u,c=n[o++],l=i?c.ok:c.fail,f=c.resolve,d=c.reject,p=c.domain;try{l?(i||(2===e.rejection&&cc(e),e.rejection=1),!0===l?a=r:(p&&p.enter(),a=l(r),p&&(p.exit(),u=!0)),a===c.promise?d(Vu("Promise-chain cycle")):(s=ic(a))?s.call(a,f,d):f(a)):d(r)}catch(e){p&&!u&&p.exit(),d(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&sc(e)}))}},ac=function(e,t,n){var r,i;Xu?((r=Qu.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),pu.dispatchEvent(r)):r={promise:t,reason:n},!Zu&&(i=pu["on"+e])?i(r):e===ec&&Cu("Unhandled promise rejection",n)},sc=function(e){Ru.call(pu,(function(){var t,n=e.facade,r=e.value;if(uc(e)&&(t=Mu((function(){Fu?Hu.emit("unhandledRejection",r,n):ac(ec,n,r)})),e.rejection=Fu||uc(e)?2:1,t.error))throw t.value}))},uc=function(e){return 1!==e.rejection&&!e.parent},cc=function(e){Ru.call(pu,(function(){var t=e.facade;Fu?Hu.emit("rejectionHandled",t):ac("rejectionhandled",t,e.value)}))},lc=function(e,t,n){return function(r){e(t,r,n)}},fc=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,oc(e,!0))},dc=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Vu("Promise can't be resolved itself");var r=ic(t);r?Ou((function(){var n={done:!1};try{r.call(t,lc(dc,n,e),lc(fc,n,e))}catch(t){fc(n,t,e)}})):(e.value=t,e.state=1,oc(e,!1))}catch(t){fc({done:!1},t,e)}}};if(nc&&(Ku=(Gu=function(e){_u(this,Gu,Bu),xu(e),ru.call(this);var t=qu(this);try{e(lc(dc,t),lc(fc,t))}catch(e){fc(t,e)}}).prototype,(ru=function(e){Wu(this,{type:Bu,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=mu(Ku,{then:function(e,t){var n=zu(this),r=Yu(Iu(this,Gu));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Fu?Hu.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&oc(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),iu=function(){var e=new ru,t=qu(e);this.promise=e,this.resolve=lc(dc,t),this.reject=lc(fc,t)},Pu.f=Yu=function(e){return e===Gu||e===ou?new iu(e):Ju(e)},"function"==typeof vu&&$u!==Object.prototype)){au=$u.then,tc||(yu($u,"then",(function(e,t){var n=this;return new Gu((function(e,t){au.call(n,e,t)})).then(e,t)}),{unsafe:!0}),yu($u,"catch",Ku.catch,{unsafe:!0}));try{delete $u.constructor}catch(e){}gu&&gu($u,Ku)}du({global:!0,wrap:!0,forced:nc},{Promise:Gu}),bu(Gu,Bu,!1),ku(Bu),ou=hu(Bu),du({target:Bu,stat:!0,forced:nc},{reject:function(e){var t=Yu(this);return t.reject.call(void 0,e),t.promise}}),du({target:Bu,stat:!0,forced:nc},{resolve:function(e){return Au(this,e)}}),du({target:Bu,stat:!0,forced:rc},{all:function(e){var t=this,n=Yu(t),r=n.resolve,i=n.reject,o=Mu((function(){var n=xu(t.resolve),o=[],a=0,s=1;Eu(e,(function(e){var u=a++,c=!1;o.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,o[u]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Yu(t),r=n.reject,i=Mu((function(){var i=xu(t.resolve);Eu(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var pc,hc=Object.prototype,vc=hc.hasOwnProperty,yc="function"==typeof Symbol?Symbol:{},mc=yc.iterator||"@@iterator",gc=yc.asyncIterator||"@@asyncIterator",bc=yc.toStringTag||"@@toStringTag";function kc(e,t,n,r){var i=t&&t.prototype instanceof Ic?t:Ic,o=Object.create(i.prototype),a=new Bc(r||[]);return o._invoke=function(e,t,n){var r=xc;return function(i,o){if(r===Sc)throw new Error("Generator is already running");if(r===Ec){if("throw"===i)throw o;return Wc()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=Fc(a,n);if(s){if(s===Tc)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===xc)throw r=Ec,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=Sc;var u=wc(e,t,n);if("normal"===u.type){if(r=n.done?Ec:_c,u.arg===Tc)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=Ec,n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function wc(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}var xc="suspendedStart",_c="suspendedYield",Sc="executing",Ec="completed",Tc={};function Ic(){}function Rc(){}function Oc(){}var Ac={};Ac[mc]=function(){return this};var Cc=Object.getPrototypeOf,Pc=Cc&&Cc(Cc(qc([])));Pc&&Pc!==hc&&vc.call(Pc,mc)&&(Ac=Pc);var Mc=Oc.prototype=Ic.prototype=Object.create(Ac);function jc(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function Lc(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===Rc||"GeneratorFunction"===(t.displayName||t.name))}function Nc(e,t){function n(r,i,o,a){var s=wc(e[r],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"===Ho(c)&&vc.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(s.arg)}var r;this._invoke=function(e,i){function o(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(o,o):o()}}function Fc(e,t){var n=e.iterator[t.method];if(n===pc){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=pc,Fc(e,t),"throw"===t.method))return Tc;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return Tc}var r=wc(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,Tc;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=pc),t.delegate=null,Tc):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,Tc)}function Dc(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Uc(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Bc(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(Dc,this),this.reset(!0)}function qc(e){if(e){var t=e[mc];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(vc.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=pc,t.done=!0,t};return r.next=r}}return{next:Wc}}function Wc(){return{value:pc,done:!0}}Rc.prototype=Mc.constructor=Oc,Oc.constructor=Rc,Oc[bc]=Rc.displayName="GeneratorFunction",jc(Nc.prototype),Nc.prototype[gc]=function(){return this},jc(Mc),Mc[bc]="Generator",Mc[mc]=function(){return this},Mc.toString=function(){return"[object Generator]"},Bc.prototype={constructor:Bc,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=pc,this.done=!1,this.delegate=null,this.method="next",this.arg=pc,this.tryEntries.forEach(Uc),!e)for(var t in this)"t"===t.charAt(0)&&vc.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=pc)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=pc),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=vc.call(i,"catchLoc"),s=vc.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&vc.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,Tc):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),Tc},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),Uc(n),Tc}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;Uc(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:qc(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=pc),Tc}};var zc={wrap:kc,isGeneratorFunction:Lc,AsyncIterator:Nc,mark:function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Oc):(e.__proto__=Oc,bc in e||(e[bc]="GeneratorFunction")),e.prototype=Object.create(Mc),e},awrap:function(e){return{__await:e}},async:function(e,t,n,r,i){void 0===i&&(i=Promise);var o=new Nc(kc(e,t,n,r),i);return Lc(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},keys:function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},values:qc},$c=Object.freeze({__proto__:null,default:zc});function Gc(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":Ho(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function Kc(e,t){if("object"===("undefined"==typeof Reflect?"undefined":Ho(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var Vc={},Qc=In,Hc=S,Yc=Ln,Jc=qt,Xc=Ft,Zc=_,el=mo,tl=pe,nl=$i("slice"),rl=tl("species"),il=[].slice,ol=Math.max;Qc({target:"Array",proto:!0,forced:!nl},{slice:function(e,t){var n,r,i,o=Zc(this),a=Xc(o.length),s=Jc(e,a),u=Jc(void 0===t?a:t,a);if(Yc(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!Yc(n.prototype)?Hc(n)&&null===(n=n[rl])&&(n=void 0):n=void 0,n===Array||void 0===n))return il.call(o,s,u);for(r=new(void 0===n?Array:n)(ol(u-s,0)),i=0;s<u;s++,i++)s in o&&el(r,i,o[s]);return r.length=i,r}});var al=De,sl=Da,ul=br,cl=J,ll=function(e,t,n,r){try{return r?t(al(n)[0],n[1]):t(n)}catch(t){sl(e,"throw",t)}},fl=Oa,dl=Ft,pl=mo,hl=Na,vl=Ma,yl=function(e){var t,n,r,i,o,a,s=cl(e),u="function"==typeof this?this:Array,c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,d=vl(s),p=0;if(f&&(l=ul(l,c>2?arguments[2]:void 0,2)),null==d||u==Array&&fl(d))for(n=new u(t=dl(s.length));t>p;p++)a=f?l(s[p],p):s[p],pl(n,p,a);else for(o=(i=hl(s,d)).next,n=new u;!(r=o.call(i)).done;p++)a=f?ll(i,l,[r.value,p],!0):r.value,pl(n,p,a);return n.length=p,n};In({target:"Array",stat:!0,forced:!ns((function(e){Array.from(e)}))},{from:yl});var ml,gl,bl,kl=jt,wl=Fn,xl=k,_l=function(e){return function(t,n){var r,i,o=wl(xl(t)),a=kl(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):r:e?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}},Sl={codeAt:_l(!1),charAt:_l(!0)},El=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Tl=ee,Il=J,Rl=El,Ol=at("IE_PROTO"),Al=Object.prototype,Cl=Rl?Object.getPrototypeOf:function(e){return e=Il(e),Tl(e,Ol)?e[Ol]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Al:null},Pl=a,Ml=Cl,jl=Ke,Ll=pe("iterator"),Nl=!1;[].keys&&("next"in(bl=[].keys())?(gl=Ml(Ml(bl)))!==Object.prototype&&(ml=gl):Nl=!0);var Fl=null==ml||Pl((function(){var e={};return ml[Ll].call(e)!==e}));Fl&&(ml={}),"function"!=typeof ml[Ll]&&jl(ml,Ll,(function(){return this}));var Dl={IteratorPrototype:ml,BUGGY_SAFARI_ITERATORS:Nl},Ul=Dl.IteratorPrototype,Bl=er,ql=h,Wl=yr,zl=Ea,$l=function(){return this},Gl=In,Kl=function(e,t,n){var r=t+" Iterator";return e.prototype=Bl(Ul,{next:ql(1,n)}),Wl(e,r,!1),zl[r]=$l,e},Vl=Cl,Ql=ga,Hl=yr,Yl=Ke,Jl=Ve.exports,Xl=Ea,Zl=Dl.IteratorPrototype,ef=Dl.BUGGY_SAFARI_ITERATORS,tf=pe("iterator"),nf="keys",rf="values",of="entries",af=function(){return this},sf=function(e,t,n,r,i,o,a){Kl(n,t,r);var s,u,c,l=function(e){if(e===i&&v)return v;if(!ef&&e in p)return p[e];switch(e){case nf:case rf:case of:return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",d=!1,p=e.prototype,h=p[tf]||p["@@iterator"]||i&&p[i],v=!ef&&h||l(i),y="Array"==t&&p.entries||h;if(y&&(s=Vl(y.call(new e)))!==Object.prototype&&s.next&&(Vl(s)!==Zl&&(Ql?Ql(s,Zl):"function"!=typeof s[tf]&&Yl(s,tf,af)),Hl(s,f,!0)),i==rf&&h&&h.name!==rf&&(d=!0,v=function(){return h.call(this)}),p[tf]!==v&&Yl(p,tf,v),Xl[t]=v,i)if(u={values:l(rf),keys:o?v:l(nf),entries:l(of)},a)for(c in u)(ef||d||!(c in p))&&Jl(p,c,u[c]);else Gl({target:t,proto:!0,forced:ef||d},u);return u},uf=Sl.charAt,cf=Fn,lf=xt,ff=sf,df="String Iterator",pf=lf.set,hf=lf.getterFor(df);ff(String,"String",(function(e){pf(this,{type:df,string:cf(e),index:0})}),(function(){var e,t=hf(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=uf(n,r),t.index+=e.length,{value:e,done:!1})}));var vf=De,yf=function(){var e=vf(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},mf={},gf=a,bf=i.RegExp;mf.UNSUPPORTED_Y=gf((function(){var e=bf("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),mf.BROKEN_CARET=gf((function(){var e=bf("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var kf,wf,xf=a,_f=i.RegExp,Sf=xf((function(){var e=_f(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Ef=a,Tf=i.RegExp,If=Ef((function(){var e=Tf("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Rf=Fn,Of=yf,Af=mf,Cf=z.exports,Pf=er,Mf=xt.get,jf=Sf,Lf=If,Nf=RegExp.prototype.exec,Ff=Cf("native-string-replace",String.prototype.replace),Df=Nf,Uf=(kf=/a/,wf=/b*/g,Nf.call(kf,"a"),Nf.call(wf,"a"),0!==kf.lastIndex||0!==wf.lastIndex),Bf=Af.UNSUPPORTED_Y||Af.BROKEN_CARET,qf=void 0!==/()??/.exec("")[1];(Uf||qf||Bf||jf||Lf)&&(Df=function(e){var t,n,r,i,o,a,s,u=this,c=Mf(u),l=Rf(e),f=c.raw;if(f)return f.lastIndex=u.lastIndex,t=Df.call(f,l),u.lastIndex=f.lastIndex,t;var d=c.groups,p=Bf&&u.sticky,h=Of.call(u),v=u.source,y=0,m=l;if(p&&(-1===(h=h.replace("y","")).indexOf("g")&&(h+="g"),m=l.slice(u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==l.charAt(u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,y++),n=new RegExp("^(?:"+v+")",h)),qf&&(n=new RegExp("^"+v+"$(?!\\s)",h)),Uf&&(r=u.lastIndex),i=Nf.call(p?n:u,m),p?i?(i.input=i.input.slice(y),i[0]=i[0].slice(y),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:Uf&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),qf&&i&&i.length>1&&Ff.call(i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&d)for(i.groups=a=Pf(null),o=0;o<d.length;o++)a[(s=d[o])[0]]=i[s[1]];return i});var Wf=Df;In({target:"RegExp",proto:!0,forced:/./.exec!==Wf},{exec:Wf});var zf=In,$f=S,Gf=function(){var e=!1,t=/[ac]/;return t.exec=function(){return e=!0,/./.exec.apply(this,arguments)},!0===t.test("abc")&&e}(),Kf=/./.test;zf({target:"RegExp",proto:!0,forced:!Gf},{test:function(e){if("function"!=typeof this.exec)return Kf.call(this,e);var t=this.exec(e);if(null!==t&&!$f(t))throw new Error("RegExp exec method returned something other than an Object or null");return!!t}});var Vf=In,Qf=s,Hf=i,Yf=ee,Jf=S,Xf=Ne.f,Zf=fn,ed=Hf.Symbol;if(Qf&&"function"==typeof ed&&(!("description"in ed.prototype)||void 0!==ed().description)){var td={},nd=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof nd?new ed(e):void 0===e?ed():ed(e);return""===e&&(td[t]=!0),t};Zf(nd,ed);var rd=nd.prototype=ed.prototype;rd.constructor=nd;var id=rd.toString,od="Symbol(test)"==String(ed("test")),ad=/^Symbol\((.*)\)[^)]+$/;Xf(rd,"description",{configurable:!0,get:function(){var e=Jf(this)?this.valueOf():this,t=id.call(e);if(Yf(td,e))return"";var n=od?t.slice(7,-1):t.replace(ad,"$1");return""===n?void 0:n}}),Vf({global:!0,forced:!0},{Symbol:nd})}dr("iterator");var sd=er,ud=Ne,cd=pe("unscopables"),ld=Array.prototype;null==ld[cd]&&ud.f(ld,cd,{configurable:!0,value:sd(null)});var fd=function(e){ld[cd][e]=!0},dd=_,pd=fd,hd=Ea,vd=xt,yd=sf,md="Array Iterator",gd=vd.set,bd=vd.getterFor(md),kd=yd(Array,"Array",(function(e,t){gd(this,{type:md,target:dd(e),index:0,kind:t})}),(function(){var e=bd(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");hd.Arguments=hd.Array,pd("keys"),pd("values"),pd("entries");var wd=i,xd=Xi,_d=to,Sd=kd,Ed=Ke,Td=pe,Id=Td("iterator"),Rd=Td("toStringTag"),Od=Sd.values,Ad=function(e,t){if(e){if(e[Id]!==Od)try{Ed(e,Id,Od)}catch(t){e[Id]=Od}if(e[Rd]||Ed(e,Rd,t),xd[t])for(var n in Sd)if(e[n]!==Sd[n])try{Ed(e,n,Sd[n])}catch(t){e[n]=Sd[n]}}};for(var Cd in xd)Ad(wd[Cd]&&wd[Cd].prototype,Cd);Ad(_d,"DOMTokenList");var Pd={exports:{}};!function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(Pd);var Md=s,jd=Ne.f,Ld=Function.prototype,Nd=Ld.toString,Fd=/^\s*function ([^ (]*)/,Dd="name";Md&&!(Dd in Ld)&&jd(Ld,Dd,{configurable:!0,get:function(){try{return Nd.call(this).match(Fd)[1]}catch(e){return""}}});var Ud,Bd={exports:{}},qd={exports:{}};(Ud=qd).exports=function(e){if(Array.isArray(e))return e},Ud.exports.__esModule=!0,Ud.exports.default=Ud.exports;var Wd={exports:{}};!function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports}(Wd);var zd={exports:{}},$d={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports}($d),function(e){var t=$d.exports;e.exports=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}(zd);var Gd={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(Gd),function(e){var t=qd.exports,n=Wd.exports,r=zd.exports,i=Gd.exports;e.exports=function(e,o){return t(e)||n(e,o)||r(e,o)||i()},e.exports.__esModule=!0,e.exports.default=e.exports}(Bd);var Kd=In,Vd=a,Qd=Ln,Hd=S,Yd=J,Jd=Ft,Xd=mo,Zd=Sr,ep=$i,tp=L,np=pe("isConcatSpreadable"),rp=9007199254740991,ip="Maximum allowed index exceeded",op=tp>=51||!Vd((function(){var e=[];return e[np]=!1,e.concat()[0]!==e})),ap=ep("concat"),sp=function(e){if(!Hd(e))return!1;var t=e[np];return void 0!==t?!!t:Qd(e)};Kd({target:"Array",proto:!0,forced:!op||!ap},{concat:function(e){var t,n,r,i,o,a=Yd(this),s=Zd(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(sp(o=-1===t?a:arguments[t])){if(u+(i=Jd(o.length))>rp)throw TypeError(ip);for(n=0;n<i;n++,u++)n in o&&Xd(s,u,o[n])}else{if(u>=rp)throw TypeError(ip);Xd(s,u++,o)}return s.length=u,s}});var up={exports:{}},cp={exports:{}};!function(e){var t=$d.exports;e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(cp);var lp={exports:{}};!function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(lp);var fp={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(fp),function(e){var t=cp.exports,n=lp.exports,r=zd.exports,i=fp.exports;e.exports=function(e){return t(e)||n(e)||r(e)||i()},e.exports.__esModule=!0,e.exports.default=e.exports}(up);var dp={exports:{}};!function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}(dp);var pp={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports}(pp);var hp={exports:{}},vp={exports:{}};!function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(vp),function(e){var t=vp.exports;e.exports=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&t(e,n)},e.exports.__esModule=!0,e.exports.default=e.exports}(hp);var yp={exports:{}},mp={exports:{}};!function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports}(mp),function(e){var t=Pd.exports.default,n=mp.exports;e.exports=function(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(yp);var gp={exports:{}};!function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(gp);var bp=Kt.includes,kp=fd;In({target:"Array",proto:!0},{includes:function(e){return bp(this,e,arguments.length>1?arguments[1]:void 0)}}),kp("includes");var wp=In,xp=_,_p=[].join,Sp=b!=Object,Ep=ro("join",",");wp({target:"Array",proto:!0,forced:Sp||!Ep},{join:function(e){return _p.call(xp(this),void 0===e?",":e)}});var Tp=S,Ip=Math.floor,Rp=function(e){return!Tp(e)&&isFinite(e)&&Ip(e)===e};In({target:"Number",stat:!0},{isInteger:Rp});var Op=S,Ap=ga,Cp=function(e,t,n){var r,i;return Ap&&"function"==typeof(r=t.constructor)&&r!==n&&Op(i=r.prototype)&&i!==n.prototype&&Ap(e,i),e},Pp=k,Mp=Fn,jp="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",Lp=RegExp("^"+jp+jp+"*"),Np=RegExp(jp+jp+"*$"),Fp=function(e){return function(t){var n=Mp(Pp(t));return 1&e&&(n=n.replace(Lp,"")),2&e&&(n=n.replace(Np,"")),n}},Dp={start:Fp(1),end:Fp(2),trim:Fp(3)},Up=s,Bp=i,qp=bn,Wp=Ve.exports,zp=ee,$p=y,Gp=Cp,Kp=q,Vp=ge,Qp=a,Hp=er,Yp=Ct.f,Jp=o.f,Xp=Ne.f,Zp=Dp.trim,eh="Number",th=Bp.Number,nh=th.prototype,rh=$p(Hp(nh))==eh,ih=function(e){if(Kp(e))throw TypeError("Cannot convert a Symbol value to a number");var t,n,r,i,o,a,s,u,c=Vp(e,"number");if("string"==typeof c&&c.length>2)if(43===(t=(c=Zp(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(o=c.slice(2)).length,s=0;s<a;s++)if((u=o.charCodeAt(s))<48||u>i)return NaN;return parseInt(o,r)}return+c};if(qp(eh,!th(" 0o1")||!th("0b1")||th("+0x1"))){for(var oh,ah=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof ah&&(rh?Qp((function(){nh.valueOf.call(n)})):$p(n)!=eh)?Gp(new th(ih(t)),n,ah):ih(t)},sh=Up?Yp(th):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),uh=0;sh.length>uh;uh++)zp(th,oh=sh[uh])&&!zp(ah,oh)&&Xp(ah,oh,Jp(th,oh));ah.prototype=nh,nh.constructor=ah,Wp(Bp,eh,ah)}var ch=s,lh=An,fh=_,dh=u.f,ph=function(e){return function(t){for(var n,r=fh(t),i=lh(r),o=i.length,a=0,s=[];o>a;)n=i[a++],ch&&!dh.call(r,n)||s.push(e?[n,r[n]]:r[n]);return s}},hh={entries:ph(!0),values:ph(!1)}.entries;In({target:"Object",stat:!0},{entries:function(e){return hh(e)}}),Object.defineProperty(Vc,"__esModule",{value:!0});var vh=Bd.exports,yh=up.exports,mh=dp.exports,gh=pp.exports,bh=hp.exports,kh=yp.exports,wh=gp.exports;function xh(e){return e&&"object"===Ho(e)&&"default"in e?e:{default:e}}var _h=xh(Pd.exports),Sh=xh(vh),Eh=xh(yh),Th=xh(mh),Ih=xh(gh),Rh=xh(bh),Oh=xh(kh),Ah=xh(wh),Ch=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{checks:t}};function Ph(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Mh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Mh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var jh=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ch((function(e){var n,r=!1,i=[],o=Ph(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;"string"!=typeof a?(r=r||e instanceof a,i.push("an instance of ".concat(a.name))):(r=r||_h.default(e)===a,i.push("of type ".concat(a)))}}catch(e){o.e(e)}finally{o.f()}return[r,i]}))};function Lh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Nh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Nh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ah.default(e);if(t){var i=Ah.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Oh.default(this,n)}}function Dh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Uh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Uh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Bh=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var n,r=Dh(t.entries());try{for(r.s();!(n=r.n()).done;){var i=Sh.default(n.value,2),o=i[0],a=i[1],s=$h(e[o],a),u=Sh.default(s,4),c=u[0],l=u[1],f=u[2],d=u[3];if(!c)throw new Error("Argument ".concat(o+1," is expected to be ").concat(f).concat(d," but got ").concat(l))}}catch(e){r.e(e)}finally{r.f()}},qh=function(e){var t,n,r;(["undefined","boolean","number","bigint","string"].includes(_h.default(e))&&(n="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===_h.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(n=null===e?"null":"instance of ".concat(null==e||null===(r=e.constructor)||void 0===r?void 0:r.name));return n||(n=_h.default(e)),n},Wh=function(e){var t,n=[],r=Dh(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(zh(i))}}catch(e){r.e(e)}finally{r.f()}return n},zh=function(e){var t,n=[],r=Dh(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?n.push(i):n.push(jh(i))}}catch(e){r.e(e)}finally{r.f()}return n},$h=function(e,t){var n,r,i=[],o=!1,a=Dh(e);try{for(a.s();!(r=a.n()).done;){var s,u=Dh(r.value.checks);try{for(u.s();!(s=u.n()).done;){var c=(0,s.value)(t),l=Sh.default(c,3),f=l[0],d=l[1],p=l[2];o=o||f,!n&&p&&(n=p),d&&(i=[].concat(Eh.default(i),"string"==typeof d?[d]:Eh.default(d)))}}catch(e){u.e(e)}finally{u.f()}}}catch(e){a.e(e)}finally{a.f()}if(o)return[!0];var h=n||qh(t),v=i.length-1;return[!1,h,v>0?"".concat(i.slice(0,v).join(", ")," or ").concat(i[v]):i.join(", "),v>1?";":","]};function Gh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Kh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Kh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Kh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vh=Ch((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),Qh=Ch((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),Hh=Ch((function(e){return["object"===_h.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function Yh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Jh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Vc.array=function(e,t){return Ch((function(n){if(!Array.isArray(n))return[!1,"an array of ".concat(e)];var r,i=Yh(n.entries());try{for(i.s();!(r=i.n()).done;){var o=Sh.default(r.value,2),a=o[0],s=o[1],u=$h(zh(t),s),c=Sh.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(a," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(a," is ").concat(f,")")]}}catch(e){i.e(e)}finally{i.f()}return[!0]}))};var Xh=Vc.custom=Ch,Zh=Vc.literal=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ch((function(e){var n,r=!1,i=[],o=Lh(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;r=r||e===a,i.push("string"==typeof a?'"'.concat(a,'"'):"".concat(a))}}catch(e){o.e(e)}finally{o.f()}return[r,i]}))};Vc.nonEmptyArray=function(e,t){return Ch((function(n){if(!Array.isArray(n)||n.length<1)return[!1,"a non-empty array of ".concat(e)];var r,i=Gh(n.entries());try{for(i.s();!(r=i.n()).done;){var o=Sh.default(r.value,2),a=o[0],s=o[1],u=$h(zh(t),s),c=Sh.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid non-empty array of ".concat(e," (index ").concat(a," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(a," is ").concat(f,")")]}}catch(e){i.e(e)}finally{i.f()}return[!0]}))};var ev=Vc.nonEmptyString=Vh,tv=Vc.nonNegativeInteger=Qh,nv=Vc.objectSchema=function(e,t){return Ch((function(n){if("object"!==_h.default(n)||null===n||Array.isArray(n))return[!1,"valid ".concat(e," (should be a pure object)")];for(var r=0,i=Object.entries(t);r<i.length;r++){var o=Sh.default(i[r],2),a=o[0],s=o[1],u=$h(zh(s),n[a]),c=Sh.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(a,'" should be ').concat(d,")"),"malformed ".concat(e,' (key "').concat(a,'" is ').concat(f,")")]}return[!0]}))},rv=Vc.pureObject=Hh;Vc.runtimeTypeValidation=Bh,Vc.stringifyReceivedType=qh,Vc.type=jh,Vc.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Wh(t);return function(e){return function(e){Rh.default(n,e);var t=Fh(n);function n(){Ih.default(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return Bh(r,i),t.call.apply(t,[this].concat(i))}return Th.default(n)}(e)}};var iv=Vc.validateTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Wh(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Bh(r,t),i.apply(this,t)}}},ov=Vc.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Wh(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{Bh(r,t)}catch(e){return Promise.reject(e)}return i.apply(this,t)}}},av={},sv={exports:{}};!function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports}(sv);var uv={exports:{}},cv={exports:{}};!function(e){var t=gp.exports;e.exports=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=t(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports}(cv),function(e){var t=cv.exports;function n(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=n=Reflect.get,e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=n=function(e,n,r){var i=t(e,n);if(i){var o=Object.getOwnPropertyDescriptor(i,n);return o.get?o.get.call(arguments.length<3?e:r):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports),n.apply(this,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}(uv);var lv={exports:{}};!function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports}(lv);var fv=n($c),dv=Ve.exports,pv=De,hv=Fn,vv=a,yv=yf,mv="toString",gv=RegExp.prototype,bv=gv.toString,kv=vv((function(){return"/a/b"!=bv.call({source:"a",flags:"b"})})),wv=bv.name!=mv;(kv||wv)&&dv(RegExp.prototype,mv,(function(){var e=pv(this),t=hv(e.source),n=e.flags;return"/"+t+"/"+hv(void 0===n&&e instanceof RegExp&&!("flags"in gv)?yv.call(e):n)}),{unsafe:!0});var xv={exports:{}};!function(e){var n,r;n=t,r=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":Ho(window))!==t&&Ho(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":Ho(console))!==t&&("trace"===r&&n?o:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function s(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function u(e,n,r){return function(){("undefined"==typeof console?"undefined":Ho(console))!==t&&(s.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return a(e)||u.apply(this,arguments)}function l(e,n,i){var o,a=this;n=null==n?"WARN":n;var u="loglevel";function l(){var e;if(("undefined"==typeof window?"undefined":Ho(window))!==t&&u){try{e=window.localStorage[u]}catch(e){}if(Ho(e)===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"===Ho(e)&&(u=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=i||c,a.getLevel=function(){return o},a.setLevel=function(n,i){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":Ho(window))!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),s.call(a,n,e),("undefined"==typeof console?"undefined":Ho(console))===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){n=e,l()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(n,!1),function(){if(("undefined"==typeof window?"undefined":Ho(window))!==t&&u){try{return void window.localStorage.removeItem(u)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=l();null==f&&(f=n),a.setLevel(f,!1)}var f=new l,d={};f.getLogger=function(e){if("symbol"!==Ho(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,f.getLevel(),f.methodFactory)),t};var p=("undefined"==typeof window?"undefined":Ho(window))!==t?window.log:void 0;return f.noConflict=function(){return("undefined"==typeof window?"undefined":Ho(window))!==t&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return d},f.default=f,f},e.exports?e.exports=r():n.log=r()}(xv);var _v={exports:{}},Sv=!a((function(){return Object.isExtensible(Object.preventExtensions({}))})),Ev=In,Tv=st,Iv=S,Rv=ee,Ov=Ne.f,Av=Ct,Cv=tr,Pv=Sv,Mv=!1,jv=re("meta"),Lv=0,Nv=Object.isExtensible||function(){return!0},Fv=function(e){Ov(e,jv,{value:{objectID:"O"+Lv++,weakData:{}}})},Dv=_v.exports={enable:function(){Dv.enable=function(){},Mv=!0;var e=Av.f,t=[].splice,n={};n[jv]=1,e(n).length&&(Av.f=function(n){for(var r=e(n),i=0,o=r.length;i<o;i++)if(r[i]===jv){t.call(r,i,1);break}return r},Ev({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Cv.f}))},fastKey:function(e,t){if(!Iv(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Rv(e,jv)){if(!Nv(e))return"F";if(!t)return"E";Fv(e)}return e[jv].objectID},getWeakData:function(e,t){if(!Rv(e,jv)){if(!Nv(e))return!0;if(!t)return!1;Fv(e)}return e[jv].weakData},onFreeze:function(e){return Pv&&Mv&&Nv(e)&&!Rv(e,jv)&&Fv(e),e}};Tv[jv]=!0;var Uv=In,Bv=i,qv=bn,Wv=Ve.exports,zv=_v.exports,$v=Va,Gv=Sa,Kv=S,Vv=a,Qv=ns,Hv=yr,Yv=Cp,Jv=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=Bv[e],s=a&&a.prototype,u=a,c={},l=function(e){var t=s[e];Wv(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!Kv(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!Kv(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!Kv(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(qv(e,"function"!=typeof a||!(i||s.forEach&&!Vv((function(){(new a).entries().next()})))))u=n.getConstructor(t,e,r,o),zv.enable();else if(qv(e,!0)){var f=new u,d=f[o](i?{}:-0,1)!=f,p=Vv((function(){f.has(1)})),h=Qv((function(e){new a(e)})),v=!i&&Vv((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));h||((u=t((function(t,n){Gv(t,u,e);var i=Yv(new a,t,u);return null!=n&&$v(n,i[o],{that:i,AS_ENTRIES:r}),i}))).prototype=s,s.constructor=u),(p||v)&&(l("delete"),l("has"),r&&l("get")),(v||d)&&l(o),i&&s.clear&&delete s.clear}return c[e]=u,Uv({global:!0,forced:u!=a},c),Hv(u,e),i||n.setStrong(u,e,r),u},Xv=Ne.f,Zv=er,ey=ha,ty=br,ny=Sa,ry=Va,iy=sf,oy=_a,ay=s,sy=_v.exports.fastKey,uy=xt.set,cy=xt.getterFor,ly={getConstructor:function(e,t,n,r){var i=e((function(e,o){ny(e,i,t),uy(e,{type:t,index:Zv(null),first:void 0,last:void 0,size:0}),ay||(e.size=0),null!=o&&ry(o,e[r],{that:e,AS_ENTRIES:n})})),o=cy(t),a=function(e,t,n){var r,i,a=o(e),u=s(e,t);return u?u.value=n:(a.last=u={index:i=sy(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=u),r&&(r.next=u),ay?a.size++:e.size++,"F"!==i&&(a.index[i]=u)),e},s=function(e,t){var n,r=o(e),i=sy(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return ey(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ay?e.size=0:this.size=0},delete:function(e){var t=this,n=o(t),r=s(t,e);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first==r&&(n.first=i),n.last==r&&(n.last=a),ay?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=o(this),r=ty(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),ey(i.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),ay&&Xv(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=cy(t),o=cy(r);iy(e,t,(function(e,t){uy(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),oy(t)}};Jv("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ly);var fy={exports:{}};!function(e,t){var n;n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){var r=n(0);e.exports={build:function(e,t){var n,i,o,a=t.plugins;for(n=0,i=a.length;n<i;n++)(o=a[n]).methods&&r(e,o.methods),o.properties&&Object.defineProperties(e,o.properties)},hook:function(e,t,n){var r,i,o,a,s=e.config.plugins,u=[e.context];for(n&&(u=u.concat(n)),r=0,i=s.length;r<i;r++)a=s[r],(o=s[r][t])&&o.apply(a,u)}}},function(e,t,n){function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){var r=n(0),i=n(2);function o(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(o.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"===Ho(e)?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"===Ho(e)?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,o,a=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||a],o=r.to||a,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:o})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=o},function(e,t,n){var r=n(0),i=n(6),o=n(1),a=[null,[]];function s(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(s.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),o.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,o=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),o?this.observersForEvent(i.onLeave.state):a,o?this.observersForEvent(i.onLeave[t]):a,this.observersForEvent(i.on.transition),o?["doTransit",[this]]:a,o?this.observersForEvent(i.onEnter.state):a,o?this.observersForEvent(i.onEnter[n]):a,o?this.observersForEvent(i.on[n]):a,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],a=e[0][1],s=e[0][2];if(t[0].event=i,i&&s&&i!==n&&o.hook(this,"lifecycle",t),0===a.length)return e.shift(),this.observeEvents(e,t,i,r);var u=a.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=s},function(e,t,n){var r=n(0),i=n(2),o=n(1),a=n(3),s=n(4),u={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return f(this||{},e)}function f(e,t){return d(e,new a(t,l)),e._fsm(),e}function d(e,t){if("object"!==Ho(e)||Array.isArray(e))throw Error("StateMachine can only be applied to objects");o.build(e,t),Object.defineProperties(e,c),r(e,u),r(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new s(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new a(t,l);return d(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=f,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=n()}(fy);var dy={exports:{}},py="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(py){var hy=new Uint8Array(16);dy.exports=function(){return py(hy),hy}}else{var vy=new Array(16);dy.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),vy[t]=e>>>((3&t)<<3)&255;return vy}}for(var yy=[],my=0;my<256;++my)yy[my]=(my+256).toString(16).substr(1);var gy,by,ky=function(e,t){var n=t||0,r=yy;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")},wy=dy.exports,xy=ky,_y=0,Sy=0;var Ey=function(e,t,n){var r=t&&n||0,i=t||[],o=(e=e||{}).node||gy,a=void 0!==e.clockseq?e.clockseq:by;if(null==o||null==a){var s=wy();null==o&&(o=gy=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==a&&(a=by=16383&(s[6]<<8|s[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:Sy+1,l=u-_y+(c-Sy)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||u>_y)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_y=u,Sy=c,by=a;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=255&f;var d=u/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=255&d,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=a>>>8|128,i[r++]=255&a;for(var p=0;p<6;++p)i[r+p]=o[p];return t||xy(i)},Ty=dy.exports,Iy=ky;var Ry=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||Ty)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[r+o]=i[o];return t||Iy(i)},Oy=Ey,Ay=Ry,Cy=Ay;Cy.v1=Oy,Cy.v4=Ay;var Py=Cy,My=Ve.exports,jy=Wf,Ly=a,Ny=pe,Fy=Ke,Dy=Ny("species"),Uy=RegExp.prototype,By=function(e,t,n,r){var i=Ny(e),o=!Ly((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!Ly((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Dy]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||n){var s=/./[i],u=t(i,""[e],(function(e,t,n,r,i){var a=t.exec;return a===jy||a===Uy.exec?o&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));My(String.prototype,e,u[0]),My(Uy,i,u[1])}r&&Fy(Uy[i],"sham",!0)},qy=Sl.charAt,Wy=function(e,t,n){return t+(n?qy(e,t).length:1)},zy=J,$y=Math.floor,Gy="".replace,Ky=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Vy=/\$([$&'`]|\d{1,2})/g,Qy=y,Hy=Wf,Yy=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==Qy(e))throw TypeError("RegExp#exec called on incompatible receiver");return Hy.call(e,t)},Jy=By,Xy=a,Zy=De,em=jt,tm=Ft,nm=Fn,rm=k,im=Wy,om=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,u=Vy;return void 0!==i&&(i=zy(i),u=Ky),Gy.call(o,u,(function(o,u){var c;switch(u.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":c=i[u.slice(1,-1)];break;default:var l=+u;if(0===l)return o;if(l>s){var f=$y(l/10);return 0===f?o:f<=s?void 0===r[f-1]?u.charAt(1):r[f-1]+u.charAt(1):o}c=r[l-1]}return void 0===c?"":c}))},am=Yy,sm=pe("replace"),um=Math.max,cm=Math.min,lm="$0"==="a".replace(/./,"$0"),fm=!!/./[sm]&&""===/./[sm]("a","$0"),dm=!Xy((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));Jy("replace",(function(e,t,n){var r=fm?"$":"$0";return[function(e,n){var r=rm(this),i=null==e?void 0:e[sm];return void 0!==i?i.call(e,r,n):t.call(nm(r),e,n)},function(e,i){var o=Zy(this),a=nm(e);if("string"==typeof i&&-1===i.indexOf(r)&&-1===i.indexOf("$<")){var s=n(t,o,a,i);if(s.done)return s.value}var u="function"==typeof i;u||(i=nm(i));var c=o.global;if(c){var l=o.unicode;o.lastIndex=0}for(var f=[];;){var d=am(o,a);if(null===d)break;if(f.push(d),!c)break;""===nm(d[0])&&(o.lastIndex=im(a,tm(o.lastIndex),l))}for(var p,h="",v=0,y=0;y<f.length;y++){d=f[y];for(var m=nm(d[0]),g=um(cm(em(d.index),a.length),0),b=[],k=1;k<d.length;k++)b.push(void 0===(p=d[k])?p:String(p));var w=d.groups;if(u){var x=[m].concat(b,g,a);void 0!==w&&x.push(w);var _=nm(i.apply(void 0,x))}else _=om(m,a,g,b,w,i);g>=v&&(h+=a.slice(v,g)+_,v=g+m.length)}return h+a.slice(v)}]}),!dm||!lm||fm);var pm,hm,vm,ym={exports:{}},mm="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,gm=mm,bm=s,km=i,wm=S,xm=ee,_m=aa,Sm=Ke,Em=Ve.exports,Tm=Ne.f,Im=Cl,Rm=ga,Om=pe,Am=re,Cm=km.Int8Array,Pm=Cm&&Cm.prototype,Mm=km.Uint8ClampedArray,jm=Mm&&Mm.prototype,Lm=Cm&&Im(Cm),Nm=Pm&&Im(Pm),Fm=Object.prototype,Dm=Fm.isPrototypeOf,Um=Om("toStringTag"),Bm=Am("TYPED_ARRAY_TAG"),qm=Am("TYPED_ARRAY_CONSTRUCTOR"),Wm=gm&&!!Rm&&"Opera"!==_m(km.opera),zm=!1,$m={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Gm={BigInt64Array:8,BigUint64Array:8},Km=function(e){if(!wm(e))return!1;var t=_m(e);return xm($m,t)||xm(Gm,t)};for(pm in $m)(vm=(hm=km[pm])&&hm.prototype)?Sm(vm,qm,hm):Wm=!1;for(pm in Gm)(vm=(hm=km[pm])&&hm.prototype)&&Sm(vm,qm,hm);if((!Wm||"function"!=typeof Lm||Lm===Function.prototype)&&(Lm=function(){throw TypeError("Incorrect invocation")},Wm))for(pm in $m)km[pm]&&Rm(km[pm],Lm);if((!Wm||!Nm||Nm===Fm)&&(Nm=Lm.prototype,Wm))for(pm in $m)km[pm]&&Rm(km[pm].prototype,Nm);if(Wm&&Im(jm)!==Nm&&Rm(jm,Nm),bm&&!xm(Nm,Um))for(pm in zm=!0,Tm(Nm,Um,{get:function(){return wm(this)?this[Bm]:void 0}}),$m)km[pm]&&Sm(km[pm],Bm,pm);var Vm={NATIVE_ARRAY_BUFFER_VIEWS:Wm,TYPED_ARRAY_CONSTRUCTOR:qm,TYPED_ARRAY_TAG:zm&&Bm,aTypedArray:function(e){if(Km(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Rm&&!Dm.call(Lm,e))throw TypeError("Target is not a typed array constructor");return e},exportTypedArrayMethod:function(e,t,n){if(bm){if(n)for(var r in $m){var i=km[r];if(i&&xm(i.prototype,e))try{delete i.prototype[e]}catch(e){}}Nm[e]&&!n||Em(Nm,e,n?t:Wm&&Pm[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(bm){if(Rm){if(n)for(r in $m)if((i=km[r])&&xm(i,e))try{delete i[e]}catch(e){}if(Lm[e]&&!n)return;try{return Em(Lm,e,n?t:Wm&&Lm[e]||t)}catch(e){}}for(r in $m)!(i=km[r])||i[e]&&!n||Em(i,e,t)}},isView:function(e){if(!wm(e))return!1;var t=_m(e);return"DataView"===t||xm($m,t)||xm(Gm,t)},isTypedArray:Km,TypedArray:Lm,TypedArrayPrototype:Nm},Qm=i,Hm=a,Ym=ns,Jm=Vm.NATIVE_ARRAY_BUFFER_VIEWS,Xm=Qm.ArrayBuffer,Zm=Qm.Int8Array,eg=!Jm||!Hm((function(){Zm(1)}))||!Hm((function(){new Zm(-1)}))||!Ym((function(e){new Zm,new Zm(null),new Zm(1.5),new Zm(e)}),!0)||Hm((function(){return 1!==new Zm(new Xm(2),1,void 0).length})),tg=jt,ng=Ft,rg=function(e){if(void 0===e)return 0;var t=tg(e),n=ng(t);if(t!==n)throw RangeError("Wrong length or index");return n},ig=Math.abs,og=Math.pow,ag=Math.floor,sg=Math.log,ug=Math.LN2,cg=J,lg=qt,fg=Ft,dg=function(e){for(var t=cg(this),n=fg(t.length),r=arguments.length,i=lg(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,a=void 0===o?n:lg(o,n);a>i;)t[i++]=e;return t},pg=i,hg=s,vg=mm,yg=Ke,mg=ha,gg=a,bg=Sa,kg=jt,wg=Ft,xg=rg,_g={pack:function(e,t,n){var r,i,o,a=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?og(2,-24)-og(2,-77):0,f=e<0||0===e&&1/e<0?1:0,d=0;for((e=ig(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=ag(sg(e)/ug),e*(o=og(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*og(2,1-c))*o>=2&&(r++,o/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*o-1)*og(2,t),r+=c):(i=e*og(2,c-1)*og(2,t),r=0));t>=8;a[d++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;a[d++]=255&r,r/=256,s-=8);return a[--d]|=128*f,a},unpack:function(e,t){var n,r=e.length,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;n=256*n+e[u],u--,s-=8);if(0===l)l=1-a;else{if(l===o)return n?NaN:c?-1/0:1/0;n+=og(2,t),l-=a}return(c?-1:1)*n*og(2,l-t)}},Sg=Cl,Eg=ga,Tg=Ct.f,Ig=Ne.f,Rg=dg,Og=yr,Ag=xt.get,Cg=xt.set,Pg="ArrayBuffer",Mg="DataView",jg="Wrong index",Lg=pg.ArrayBuffer,Ng=Lg,Fg=pg.DataView,Dg=Fg&&Fg.prototype,Ug=Object.prototype,Bg=pg.RangeError,qg=_g.pack,Wg=_g.unpack,zg=function(e){return[255&e]},$g=function(e){return[255&e,e>>8&255]},Gg=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Kg=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Vg=function(e){return qg(e,23,4)},Qg=function(e){return qg(e,52,8)},Hg=function(e,t){Ig(e.prototype,t,{get:function(){return Ag(this)[t]}})},Yg=function(e,t,n,r){var i=xg(n),o=Ag(e);if(i+t>o.byteLength)throw Bg(jg);var a=Ag(o.buffer).bytes,s=i+o.byteOffset,u=a.slice(s,s+t);return r?u:u.reverse()},Jg=function(e,t,n,r,i,o){var a=xg(n),s=Ag(e);if(a+t>s.byteLength)throw Bg(jg);for(var u=Ag(s.buffer).bytes,c=a+s.byteOffset,l=r(+i),f=0;f<t;f++)u[c+f]=l[o?f:t-f-1]};if(vg){if(!gg((function(){Lg(1)}))||!gg((function(){new Lg(-1)}))||gg((function(){return new Lg,new Lg(1.5),new Lg(NaN),Lg.name!=Pg}))){for(var Xg,Zg=(Ng=function(e){return bg(this,Ng),new Lg(xg(e))}).prototype=Lg.prototype,eb=Tg(Lg),tb=0;eb.length>tb;)(Xg=eb[tb++])in Ng||yg(Ng,Xg,Lg[Xg]);Zg.constructor=Ng}Eg&&Sg(Dg)!==Ug&&Eg(Dg,Ug);var nb=new Fg(new Ng(2)),rb=Dg.setInt8;nb.setInt8(0,2147483648),nb.setInt8(1,2147483649),!nb.getInt8(0)&&nb.getInt8(1)||mg(Dg,{setInt8:function(e,t){rb.call(this,e,t<<24>>24)},setUint8:function(e,t){rb.call(this,e,t<<24>>24)}},{unsafe:!0})}else Ng=function(e){bg(this,Ng,Pg);var t=xg(e);Cg(this,{bytes:Rg.call(new Array(t),0),byteLength:t}),hg||(this.byteLength=t)},Fg=function(e,t,n){bg(this,Fg,Mg),bg(e,Ng,Mg);var r=Ag(e).byteLength,i=kg(t);if(i<0||i>r)throw Bg("Wrong offset");if(i+(n=void 0===n?r-i:wg(n))>r)throw Bg("Wrong length");Cg(this,{buffer:e,byteLength:n,byteOffset:i}),hg||(this.buffer=e,this.byteLength=n,this.byteOffset=i)},hg&&(Hg(Ng,"byteLength"),Hg(Fg,"buffer"),Hg(Fg,"byteLength"),Hg(Fg,"byteOffset")),mg(Fg.prototype,{getInt8:function(e){return Yg(this,1,e)[0]<<24>>24},getUint8:function(e){return Yg(this,1,e)[0]},getInt16:function(e){var t=Yg(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Yg(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Kg(Yg(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Kg(Yg(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Wg(Yg(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Wg(Yg(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Jg(this,1,e,zg,t)},setUint8:function(e,t){Jg(this,1,e,zg,t)},setInt16:function(e,t){Jg(this,2,e,$g,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Jg(this,2,e,$g,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Jg(this,4,e,Gg,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Jg(this,4,e,Gg,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Jg(this,4,e,Vg,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Jg(this,8,e,Qg,t,arguments.length>2?arguments[2]:void 0)}});Og(Ng,Pg),Og(Fg,Mg);var ib=jt,ob=function(e){var t=ib(e);if(t<0)throw RangeError("The argument can't be less than 0");return t},ab=function(e,t){var n=ob(e);if(n%t)throw RangeError("Wrong offset");return n},sb=J,ub=Ft,cb=Na,lb=Ma,fb=Oa,db=br,pb=Vm.aTypedArrayConstructor,hb=In,vb=i,yb=s,mb=eg,gb=Vm,bb={ArrayBuffer:Ng,DataView:Fg},kb=Sa,wb=h,xb=Ke,_b=Rp,Sb=Ft,Eb=rg,Tb=ab,Ib=we,Rb=ee,Ob=aa,Ab=S,Cb=q,Pb=er,Mb=ga,jb=Ct.f,Lb=function(e){var t,n,r,i,o,a,s=sb(e),u=arguments.length,c=u>1?arguments[1]:void 0,l=void 0!==c,f=lb(s);if(null!=f&&!fb(f))for(a=(o=cb(s,f)).next,s=[];!(i=a.call(o)).done;)s.push(i.value);for(l&&u>2&&(c=db(c,arguments[2],2)),n=ub(s.length),r=new(pb(this))(n),t=0;n>t;t++)r[t]=l?c(s[t],t):s[t];return r},Nb=Pr.forEach,Fb=_a,Db=Ne,Ub=o,Bb=Cp,qb=xt.get,Wb=xt.set,zb=Db.f,$b=Ub.f,Gb=Math.round,Kb=vb.RangeError,Vb=bb.ArrayBuffer,Qb=bb.DataView,Hb=gb.NATIVE_ARRAY_BUFFER_VIEWS,Yb=gb.TYPED_ARRAY_CONSTRUCTOR,Jb=gb.TYPED_ARRAY_TAG,Xb=gb.TypedArray,Zb=gb.TypedArrayPrototype,ek=gb.aTypedArrayConstructor,tk=gb.isTypedArray,nk="BYTES_PER_ELEMENT",rk="Wrong length",ik=function(e,t){for(var n=0,r=t.length,i=new(ek(e))(r);r>n;)i[n]=t[n++];return i},ok=function(e,t){zb(e,t,{get:function(){return qb(this)[t]}})},ak=function(e){var t;return e instanceof Vb||"ArrayBuffer"==(t=Ob(e))||"SharedArrayBuffer"==t},sk=function(e,t){return tk(e)&&!Cb(t)&&t in e&&_b(+t)&&t>=0},uk=function(e,t){return t=Ib(t),sk(e,t)?wb(2,e[t]):$b(e,t)},ck=function(e,t,n){return t=Ib(t),!(sk(e,t)&&Ab(n)&&Rb(n,"value"))||Rb(n,"get")||Rb(n,"set")||n.configurable||Rb(n,"writable")&&!n.writable||Rb(n,"enumerable")&&!n.enumerable?zb(e,t,n):(e[t]=n.value,e)};yb?(Hb||(Ub.f=uk,Db.f=ck,ok(Zb,"buffer"),ok(Zb,"byteOffset"),ok(Zb,"byteLength"),ok(Zb,"length")),hb({target:"Object",stat:!0,forced:!Hb},{getOwnPropertyDescriptor:uk,defineProperty:ck}),ym.exports=function(e,t,n){var r=e.match(/\d+$/)[0]/8,i=e+(n?"Clamped":"")+"Array",o="get"+e,a="set"+e,s=vb[i],u=s,c=u&&u.prototype,l={},f=function(e,t){zb(e,t,{get:function(){return function(e,t){var n=qb(e);return n.view[o](t*r+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var o=qb(e);n&&(i=(i=Gb(i))<0?0:i>255?255:255&i),o.view[a](t*r+o.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};Hb?mb&&(u=t((function(e,t,n,o){return kb(e,u,i),Bb(Ab(t)?ak(t)?void 0!==o?new s(t,Tb(n,r),o):void 0!==n?new s(t,Tb(n,r)):new s(t):tk(t)?ik(u,t):Lb.call(u,t):new s(Eb(t)),e,u)})),Mb&&Mb(u,Xb),Nb(jb(s),(function(e){e in u||xb(u,e,s[e])})),u.prototype=c):(u=t((function(e,t,n,o){kb(e,u,i);var a,s,c,l=0,d=0;if(Ab(t)){if(!ak(t))return tk(t)?ik(u,t):Lb.call(u,t);a=t,d=Tb(n,r);var p=t.byteLength;if(void 0===o){if(p%r)throw Kb(rk);if((s=p-d)<0)throw Kb(rk)}else if((s=Sb(o)*r)+d>p)throw Kb(rk);c=s/r}else c=Eb(t),a=new Vb(s=c*r);for(Wb(e,{buffer:a,byteOffset:d,byteLength:s,length:c,view:new Qb(a)});l<c;)f(e,l++)})),Mb&&Mb(u,Xb),c=u.prototype=Pb(Zb)),c.constructor!==u&&xb(c,"constructor",u),xb(c,Yb,u),Jb&&xb(c,Jb,i),l[i]=u,hb({global:!0,forced:u!=s,sham:!Hb},l),nk in u||xb(u,nk,r),nk in c||xb(c,nk,r),Fb(i)}):ym.exports=function(){},(0,ym.exports)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var lk=J,fk=qt,dk=Ft,pk=Math.min,hk=[].copyWithin||function(e,t){var n=lk(this),r=dk(n.length),i=fk(e,r),o=fk(t,r),a=arguments.length>2?arguments[2]:void 0,s=pk((void 0===a?r:fk(a,r))-o,r-i),u=1;for(o<i&&i<o+s&&(u=-1,o+=s-1,i+=s-1);s-- >0;)o in n?n[i]=n[o]:delete n[i],i+=u,o+=u;return n},vk=hk,yk=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("copyWithin",(function(e,t){return vk.call(yk(this),e,t,arguments.length>2?arguments[2]:void 0)}));var mk=Pr.every,gk=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("every",(function(e){return mk(gk(this),e,arguments.length>1?arguments[1]:void 0)}));var bk=dg,kk=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("fill",(function(e){return bk.apply(kk(this),arguments)}));var wk=as,xk=Vm.TYPED_ARRAY_CONSTRUCTOR,_k=Vm.aTypedArrayConstructor,Sk=function(e){return _k(wk(e,e[xk]))},Ek=function(e,t){for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},Tk=Sk,Ik=Pr.filter,Rk=function(e,t){return Ek(Tk(e),t)},Ok=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("filter",(function(e){var t=Ik(Ok(this),e,arguments.length>1?arguments[1]:void 0);return Rk(this,t)}));var Ak=Pr.find,Ck=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("find",(function(e){return Ak(Ck(this),e,arguments.length>1?arguments[1]:void 0)}));var Pk=Pr.findIndex,Mk=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("findIndex",(function(e){return Pk(Mk(this),e,arguments.length>1?arguments[1]:void 0)}));var jk=Pr.forEach,Lk=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("forEach",(function(e){jk(Lk(this),e,arguments.length>1?arguments[1]:void 0)}));var Nk=Kt.includes,Fk=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("includes",(function(e){return Nk(Fk(this),e,arguments.length>1?arguments[1]:void 0)}));var Dk=Kt.indexOf,Uk=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("indexOf",(function(e){return Dk(Uk(this),e,arguments.length>1?arguments[1]:void 0)}));var Bk=i,qk=Vm,Wk=kd,zk=pe("iterator"),$k=Bk.Uint8Array,Gk=Wk.values,Kk=Wk.keys,Vk=Wk.entries,Qk=qk.aTypedArray,Hk=qk.exportTypedArrayMethod,Yk=$k&&$k.prototype[zk],Jk=!!Yk&&("values"==Yk.name||null==Yk.name),Xk=function(){return Gk.call(Qk(this))};Hk("entries",(function(){return Vk.call(Qk(this))})),Hk("keys",(function(){return Kk.call(Qk(this))})),Hk("values",Xk,!Jk),Hk(zk,Xk,!Jk);var Zk=Vm.aTypedArray,ew=[].join;(0,Vm.exportTypedArrayMethod)("join",(function(e){return ew.apply(Zk(this),arguments)}));var tw=_,nw=jt,rw=Ft,iw=ro,ow=Math.min,aw=[].lastIndexOf,sw=!!aw&&1/[1].lastIndexOf(1,-0)<0,uw=iw("lastIndexOf"),cw=sw||!uw?function(e){if(sw)return aw.apply(this,arguments)||0;var t=tw(this),n=rw(t.length),r=n-1;for(arguments.length>1&&(r=ow(r,nw(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:aw,lw=cw,fw=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("lastIndexOf",(function(e){return lw.apply(fw(this),arguments)}));var dw=Pr.map,pw=Sk,hw=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("map",(function(e){return dw(hw(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(pw(e))(t)}))}));var vw=mr,yw=J,mw=b,gw=Ft,bw=function(e){return function(t,n,r,i){vw(n);var o=yw(t),a=mw(o),s=gw(o.length),u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in a){i=a[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in a&&(i=n(i,a[u],u,o));return i}},kw={left:bw(!1),right:bw(!0)},ww=kw.left,xw=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("reduce",(function(e){return ww(xw(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var _w=kw.right,Sw=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("reduceRight",(function(e){return _w(Sw(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Ew=Vm.aTypedArray,Tw=Vm.exportTypedArrayMethod,Iw=Math.floor;Tw("reverse",(function(){for(var e,t=this,n=Ew(t).length,r=Iw(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t}));var Rw=Ft,Ow=ab,Aw=J,Cw=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("set",(function(e){Cw(this);var t=Ow(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=Aw(e),i=Rw(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),a((function(){new Int8Array(1).set({})})));var Pw=Sk,Mw=Vm.aTypedArray,jw=[].slice;(0,Vm.exportTypedArrayMethod)("slice",(function(e,t){for(var n=jw.call(Mw(this),e,t),r=Pw(this),i=0,o=n.length,a=new r(o);o>i;)a[i]=n[i++];return a}),a((function(){new Int8Array(1).slice()})));var Lw=Pr.some,Nw=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("some",(function(e){return Lw(Nw(this),e,arguments.length>1?arguments[1]:void 0)}));var Fw=Math.floor,Dw=function(e,t){var n=e.length,r=Fw(n/2);return n<8?Uw(e,t):Bw(Dw(e.slice(0,r),t),Dw(e.slice(r),t),t)},Uw=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},Bw=function(e,t,n){for(var r=e.length,i=t.length,o=0,a=0,s=[];o<r||a<i;)o<r&&a<i?s.push(n(e[o],t[a])<=0?e[o++]:t[a++]):s.push(o<r?e[o++]:t[a++]);return s},qw=Dw,Ww=R.match(/firefox\/(\d+)/i),zw=!!Ww&&+Ww[1],$w=/MSIE|Trident/.test(R),Gw=R.match(/AppleWebKit\/(\d+)\./),Kw=!!Gw&&+Gw[1],Vw=a,Qw=mr,Hw=Ft,Yw=qw,Jw=zw,Xw=$w,Zw=L,ex=Kw,tx=Vm.aTypedArray,nx=Vm.exportTypedArrayMethod,rx=i.Uint16Array,ix=rx&&rx.prototype.sort,ox=!!ix&&!Vw((function(){var e=new rx(2);e.sort(null),e.sort({})})),ax=!!ix&&!Vw((function(){if(Zw)return Zw<74;if(Jw)return Jw<67;if(Xw)return!0;if(ex)return ex<602;var e,t,n=new rx(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(n.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));nx("sort",(function(e){var t=this;if(void 0!==e&&Qw(e),ax)return ix.call(t,e);tx(t);var n,r=Hw(t.length),i=Array(r);for(n=0;n<r;n++)i[n]=t[n];for(i=Yw(t,function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e)),n=0;n<r;n++)t[n]=i[n];return t}),!ax||ox);var sx=Ft,ux=qt,cx=Sk,lx=Vm.aTypedArray;(0,Vm.exportTypedArrayMethod)("subarray",(function(e,t){var n=lx(this),r=n.length,i=ux(e,r);return new(cx(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,sx((void 0===t?r:ux(t,r))-i))}));var fx=Vm,dx=a,px=i.Int8Array,hx=fx.aTypedArray,vx=fx.exportTypedArrayMethod,yx=[].toLocaleString,mx=[].slice,gx=!!px&&dx((function(){yx.call(new px(1))}));vx("toLocaleString",(function(){return yx.apply(gx?mx.call(hx(this)):hx(this),arguments)}),dx((function(){return[1,2].toLocaleString()!=new px([1,2]).toLocaleString()}))||!dx((function(){px.prototype.toLocaleString.call([1,2])})));var bx=Vm.exportTypedArrayMethod,kx=a,wx=i.Uint8Array,xx=wx&&wx.prototype||{},_x=[].toString,Sx=[].join;kx((function(){_x.call({})}))&&(_x=function(){return Sx.call(this)});var Ex=xx.toString!=_x;bx("toString",_x,Ex);var Tx=S,Ix=y,Rx=pe("match"),Ox=By,Ax=function(e){var t;return Tx(e)&&(void 0!==(t=e[Rx])?!!t:"RegExp"==Ix(e))},Cx=De,Px=k,Mx=as,jx=Wy,Lx=Ft,Nx=Fn,Fx=Yy,Dx=Wf,Ux=a,Bx=mf.UNSUPPORTED_Y,qx=[].push,Wx=Math.min,zx=4294967295,$x=!Ux((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));Ox("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=Nx(Px(this)),i=void 0===n?zx:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!Ax(e))return t.call(r,e,i);for(var o,a,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,f=new RegExp(e.source,c+"g");(o=Dx.call(f,r))&&!((a=f.lastIndex)>l&&(u.push(r.slice(l,o.index)),o.length>1&&o.index<r.length&&qx.apply(u,o.slice(1)),s=o[0].length,l=a,u.length>=i));)f.lastIndex===o.index&&f.lastIndex++;return l===r.length?!s&&f.test("")||u.push(""):u.push(r.slice(l)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=Px(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(Nx(i),t,n)},function(e,i){var o=Cx(this),a=Nx(e),s=n(r,o,a,i,r!==t);if(s.done)return s.value;var u=Mx(o,RegExp),c=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(Bx?"g":"y"),f=new u(Bx?"^(?:"+o.source+")":o,l),d=void 0===i?zx:i>>>0;if(0===d)return[];if(0===a.length)return null===Fx(f,a)?[a]:[];for(var p=0,h=0,v=[];h<a.length;){f.lastIndex=Bx?0:h;var y,m=Fx(f,Bx?a.slice(h):a);if(null===m||(y=Wx(Lx(f.lastIndex+(Bx?h:0)),a.length))===p)h=jx(a,h,c);else{if(v.push(a.slice(p,h)),v.length===d)return v;for(var g=1;g<=m.length-1;g++)if(v.push(m[g]),v.length===d)return v;h=p=y}}return v.push(a.slice(p)),v}]}),!$x,Bx);var Gx={exports:{}},Kx={exports:{}};!function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports}(Kx);var Vx={exports:{}},Qx={exports:{}};!function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports}(Qx),function(e){var t=vp.exports,n=Qx.exports;function r(i,o,a){return n()?(e.exports=r=Reflect.construct,e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=r=function(e,n,r){var i=[null];i.push.apply(i,n);var o=new(Function.bind.apply(e,i));return r&&t(o,r.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports),r.apply(null,arguments)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(Vx),function(e){var t=gp.exports,n=vp.exports,r=Kx.exports,i=Vx.exports;function o(a){var s="function"==typeof Map?new Map:void 0;return e.exports=o=function(e){if(null===e||!r(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==s){if(s.has(e))return s.get(e);s.set(e,o)}function o(){return i(e,arguments,t(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),n(o,e)},e.exports.__esModule=!0,e.exports.default=e.exports,o(a)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}(Gx);var Hx={};Object.defineProperty(Hx,"__esModule",{value:!0});var Yx=dp.exports,Jx=mp.exports,Xx=hp.exports,Zx=yp.exports,e_=gp.exports,t_=lv.exports;function n_(e){return e&&"object"===Ho(e)&&"default"in e?e:{default:e}}var r_=n_(pp.exports),i_=n_(Yx),o_=n_(Jx),a_=n_(Xx),s_=n_(Zx),u_=n_(e_),c_=n_(t_);function l_(){}function f_(){f_.init.call(this)}function d_(e){return void 0===e._maxListeners?f_.defaultMaxListeners:e._maxListeners}function p_(e,t,n){if(t)e.call(n);else for(var r=e.length,i=w_(e,r),o=0;o<r;++o)i[o].call(n)}function h_(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=w_(e,i),a=0;a<i;++a)o[a].call(n,r)}function v_(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=w_(e,o),s=0;s<o;++s)a[s].call(n,r,i)}function y_(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=w_(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function m_(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=w_(e,i),a=0;a<i;++a)o[a].apply(n,r)}function g_(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new l_,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=d_(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function b_(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function k_(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function w_(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function x_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u_.default(e);if(t){var i=u_.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s_.default(this,n)}}l_.prototype=Object.create(null),f_.EventEmitter=f_,f_.usingDomains=!1,f_.prototype.domain=void 0,f_.prototype._events=void 0,f_.prototype._maxListeners=void 0,f_.defaultMaxListeners=10,f_.init=function(){this.domain=null,f_.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new l_,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f_.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},f_.prototype.getMaxListeners=function(){return d_(this)},f_.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:p_(n,l,this);break;case 2:h_(n,l,this,arguments[1]);break;case 3:v_(n,l,this,arguments[1],arguments[2]);break;case 4:y_(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];m_(n,l,this,i)}return!0},f_.prototype.addListener=function(e,t){return g_(this,e,t,!1)},f_.prototype.on=f_.prototype.addListener,f_.prototype.prependListener=function(e,t){return g_(this,e,t,!0)},f_.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,b_(this,e,t)),this},f_.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,b_(this,e,t)),this},f_.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new l_:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new l_,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},f_.prototype.off=function(e,t){return this.removeListener(e,t)},f_.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new l_,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new l_:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new l_,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},f_.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},f_.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):k_.call(e,t)},f_.prototype.listenerCount=k_,f_.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var __=function(e){a_.default(n,e);var t=x_(n);function n(e){var r;return r_.default(this,n),r=t.call(this),c_.default(o_.default(r),"timeout",null),c_.default(o_.default(r),"startTimestamp",-1),r.minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return i_.default(n,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt count limit reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(e){this.emit("succeeded",e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}}]),n}(f_),S_=function(e){a_.default(n,e);var t=x_(n);function n(e){var r;return r_.default(this,n),r=t.call(this),c_.default(o_.default(r),"resolve",(function(){})),c_.default(o_.default(r),"reject",(function(){})),r.retrier=new __(e),r}return i_.default(n,[{key:"run",value:function(e){var t=this;return this.retrier.on("attempt",(function(){e().then((function(e){return t.retrier.succeeded(e)})).catch((function(e){return t.retrier.failed(e)}))})),this.retrier.on("succeeded",(function(e){return t.resolve(e)})),this.retrier.on("cancelled",(function(){return t.reject(new Error("Cancelled"))})),this.retrier.on("failed",(function(e){return t.reject(e)})),new Promise((function(e,n){t.resolve=e,t.reject=n,t.retrier.start()}))}},{key:"cancel",value:function(){this.retrier.cancel()}}]),n}(f_);function E_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u_.default(e);if(t){var i=u_.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s_.default(this,n)}}function T_(e){return null!=e}var I_=function(e){a_.default(n,e);var t=E_(n);function n(e){var r;r_.default(this,n),r=t.call(this),c_.default(o_.default(r),"backoffDelay",0),c_.default(o_.default(r),"nextBackoffDelay",0),c_.default(o_.default(r),"backoffNumber",0),c_.default(o_.default(r),"timeoutID",null),c_.default(o_.default(r),"maxNumberOfRetry",-1);var i=e=e||{},o=i.initialDelay,a=i.maxDelay,s=i.randomisationFactor,u=i.factor;if(T_(o)&&o<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(T_(a)&&a<=1)throw new Error("The maximal timeout must be greater than 1.");if(T_(s)&&(s<0||s>1))throw new Error("The randomisation factor must be between 0 and 1.");if(T_(u)&&u<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=o||100,r.maxDelay=a||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=s||0,r.factor=u||2,r.reset(),r}return i_.default(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(f_);Hx.AsyncRetrier=S_;var R_=Hx.Backoff=I_,O_=Hx.Retrier=__;Jv("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ly);var A_={exports:{}};!function(e,n){(function(){var r={function:!0,object:!0}["undefined"==typeof window?"undefined":Ho(window)]&&window||this,i=n,o=e&&!e.nodeType&&e,a=i&&o&&"object"==Ho(t)&&t;!a||a.global!==a&&a.window!==a&&a.self!==a||(r=a);var s=Math.pow(2,53)-1,u=/\bOpera/,c=Object.prototype,l=c.hasOwnProperty,f=c.toString;function d(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function p(e){return e=g(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:d(e)}function h(e,t){for(var n in e)l.call(e,n)&&t(e[n],n,e)}function v(e){return null==e?d(e):f.call(e).slice(8,-1)}function y(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function m(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=s)for(;++n<r;)t(e[n],n,e);else h(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function g(e){return String(e).replace(/^ +| +$/g,"")}var b=function e(t){var n=r,i=t&&"object"==Ho(t)&&"String"!=v(t);i&&(n=t,t=null);var o=n.navigator||{},a=o.userAgent||"";t||(t=a);var s,c,l=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(f.toString()),d="Object",b=i?d:"ScriptBridgingProxyObject",k=i?d:"Environment",w=i&&n.java?"JavaPackage":v(n.java),x=i?d:"RuntimeObject",_=/\bJava/.test(w)&&n.java,S=_&&v(n.environment)==k,E=_?"a":"Î±",T=_?"b":"Î²",I=n.document||{},R=n.operamini||n.opera,O=u.test(O=i&&R?R["[[Class]]"]:v(R))?O:R=null,A=t,C=[],P=null,M=t==a,j=M&&R&&"function"==typeof R.version&&R.version(),L=m([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||y(n))+"\\b","i").exec(t)&&(n.label||n)})),N=function(e){return m(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||y(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),F=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return m(e,(function(e,n,r){return e||(n[F]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(F)]||RegExp("\\b"+y(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=function(e){return m(e,(function(e,n){var r=n.pattern||y(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),p(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function B(e){return m(e,(function(e,n){var r=n.pattern||y(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=p(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function q(e){return m(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(U)&&!F&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(F=g(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!F?F=B([D]):D&&F&&(F=F.replace(RegExp("^("+y(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+y(D)+")[-_.]?(\\w)","i"),D+" $2")),(s=/\bGoogle TV\b/.exec(F))&&(F=s[0]),/\bSimulator\b/i.test(t)&&(F=(F?F+" ":"")+"Simulator"),"Opera Mini"==N&&/\bOPiOS\b/.test(t)&&C.push("running in Turbo/Uncompressed mode"),"IE"==N&&/\blike iPhone OS\b/.test(t)?(D=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,F=s.product):/^iP/.test(F)?(N||(N="Safari"),U="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==N&&/^Linux\b/i.test(U)?U="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(F))||/\bAndroid\b/.test(U)&&/^Chrome/.test(N)&&/\bVersion\//i.test(t)?(N="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==N?(/\bMobi/i.test(t)||(U="Android",C.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&C.unshift("accelerated")):"UC Browser"==N&&/\bUCWEB\b/.test(t)?C.push("speed mode"):"PaleMoon"==N&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?C.push("identifying as Firefox "+s[1]):"Firefox"==N&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(U||(U="Firefox OS"),F||(F=s[1])):!N||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!F&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(N=null),(s=F||D||U)&&(F||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:s)+" Browser")):"Electron"==N&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&C.push("Chromium "+s),j||(j=q(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",y(N),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==L&&parseFloat(j)>3?"WebKit":/\bOpera\b/.test(N)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(L=[s]),"IE"==N&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(N+=" Mobile",U="Windows Phone "+(/\+$/.test(s)?s:s+".x"),C.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(N="IE Mobile",U="Windows Phone 8.x",C.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=N&&"Trident"==L&&(s=/\brv:([\d.]+)/.exec(t))&&(N&&C.push("identifying as "+N+(j?" "+j:"")),N="IE",j=s[1]),M){if(function(e,t){var n=null!=e?Ho(e[t]):"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(n,"global"))if(_&&(A=(s=_.lang.System).getProperty("os.arch"),U=U||s.getProperty("os.name")+" "+s.getProperty("os.version")),S){try{j=n.require("ringo/engine").version.join("."),N="RingoJS"}catch(e){(s=n.system)&&s.global.system==n.system&&(N="Narwhal",U||(U=s[0].os||null))}N||(N="Rhino")}else"object"==Ho(n.process)&&!n.process.browser&&(s=n.process)&&("object"==Ho(s.versions)&&("string"==typeof s.versions.electron?(C.push("Node "+s.versions.node),N="Electron",j=s.versions.electron):"string"==typeof s.versions.nw&&(C.push("Chromium "+j,"Node "+s.versions.node),N="NW.js",j=s.versions.nw)),N||(N="Node.js",A=s.arch,U=s.platform,j=(j=/[\d.]+/.exec(s.version))?j[0]:null));else v(s=n.runtime)==b?(N="Adobe AIR",U=s.flash.system.Capabilities.os):v(s=n.phantom)==x?(N="PhantomJS",j=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof I.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(j=[j,I.documentMode],(s=+s[1]+4)!=j[1]&&(C.push("IE "+j[1]+" mode"),L&&(L[1]=""),j[1]=s),j="IE"==N?String(j[1].toFixed(1)):j[0]):"number"==typeof I.documentMode&&/^(?:Chrome|Firefox)\b/.test(N)&&(C.push("masking as "+N+" "+j),N="IE",j="11.0",L=["Trident"],U="Windows");U=U&&p(U)}if(j&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(M&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(P=/b/i.test(s)?"beta":"alpha",j=j.replace(RegExp(s+"\\+?$"),"")+("beta"==P?T:E)+(/\d+\+?/.exec(s)||"")),"Fennec"==N||"Firefox"==N&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))N="Firefox Mobile";else if("Maxthon"==N&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(F))"Xbox 360"==F&&(U=null),"Xbox 360"==F&&/\bIEMobile\b/.test(t)&&C.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(N)&&(!N||F||/Browser|Mobi/.test(N))||"Windows CE"!=U&&!/Mobi/i.test(t))if("IE"==N&&M)try{null===n.external&&C.unshift("platform preview")}catch(e){C.unshift("embedded")}else(/\bBlackBerry\b/.test(F)||/\bBB10\b/.test(t))&&(s=(RegExp(F.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||j)?(U=((s=[s,/BB10/.test(t)])[1]?(F=null,D="BlackBerry"):"Device Software")+" "+s[0],j=null):this!=h&&"Wii"!=F&&(M&&R||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==N&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==N&&(U&&!/^Win/.test(U)&&j>5.5||/\bWindows XP\b/.test(U)&&j>8||8==j&&!/\bTrident\b/.test(t)))&&!u.test(s=e.call(h,t.replace(u,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),u.test(N)?(/\bIE\b/.test(s)&&"Mac OS"==U&&(U=null),s="identify"+s):(s="mask"+s,N=O?p(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(U=null),M||(j=null)),L=["Presto"],C.push(s));else N+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==N&&"+"==s[1].slice(-1)?(N="WebKit Nightly",P="alpha",j=s[1].slice(0,-1)):j!=s[1]&&j!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(j=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==L&&(L=["Blink"]),M&&(l||s[1])?(L&&(L[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),L&&(L[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==N&&(!j||parseInt(j)>45)?j=s:"Chrome"==N&&/\bHeadlessChrome/i.test(t)&&C.unshift("headless")),"Opera"==N&&(s=/\bzbov|zvav$/.exec(U))?(N+=" ",C.unshift("desktop mode"),"zvav"==s?(N+="Mini",j=null):N+="Mobile",U=U.replace(RegExp(" *"+s+"$"),"")):"Safari"==N&&/\bChrome\b/.exec(L&&L[1])?(C.unshift("desktop mode"),N="Chrome Mobile",j=null,/\bOS X\b/.test(U)?(D="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(N)&&!j&&(j=q("Chrome")),j&&0==j.indexOf(s=/[\d.]+$/.exec(U))&&t.indexOf("/"+s+"-")>-1&&(U=g(U.replace(s,""))),U&&-1!=U.indexOf(N)&&!RegExp(N+" OS").test(U)&&(U=U.replace(RegExp(" *"+y(N)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||"Safari"!=N&&/^iOS/.test(U)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(N)&&L[1])&&(s=L[L.length-1])&&C.push(s),C.length&&(C=["("+C.join("; ")+")"]),D&&F&&F.indexOf(D)<0&&C.push("on "+D),F&&C.push((/^on /.test(C[C.length-1])?"":"on ")+F),U&&(s=/ ([\d.+]+)$/.exec(U),c=s&&"/"==U.charAt(U.length-s[0].length-1),U={architecture:32,family:s&&!c?U.replace(s[0],""):U,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+s),"")),N&&(/\bWOW64\b/i.test(t)||M&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&C.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==N&&parseFloat(j)>=39&&(U.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=L&&L[0],W.manufacturer=D,W.name=N,W.prerelease=P,W.product=F,W.ua=t,W.version=N&&j,W.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=e,W.toString=function(){return this.description||""},W.version&&C.unshift(j),W.name&&C.unshift(N),U&&N&&(U!=String(U).split(" ")[0]||U!=N.split(" ")[0]&&!F)&&C.push(F?"("+U+")":"on "+U),C.length&&(W.description=C.join(" ")),W}();i&&o?h(b,(function(e,t){i[t]=e})):r.platform=b}).call(t)}(A_,A_.exports);var C_=De,P_=Ft,M_=Fn,j_=k,L_=Wy,N_=Yy;By("match",(function(e,t,n){return[function(t){var n=j_(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](M_(n))},function(e){var r=C_(this),i=M_(e),o=n(t,r,i);if(o.done)return o.value;if(!r.global)return N_(r,i);var a=r.unicode;r.lastIndex=0;for(var s,u=[],c=0;null!==(s=N_(r,i));){var l=M_(s[0]);u[c]=l,""===l&&(r.lastIndex=L_(i,P_(r.lastIndex),a)),c++}return 0===c?null:u}]}));var F_=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},D_=De,U_=k,B_=F_,q_=Fn,W_=Yy;By("search",(function(e,t,n){return[function(t){var n=U_(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](q_(n))},function(e){var r=D_(this),i=q_(e),o=n(t,r,i);if(o.done)return o.value;var a=r.lastIndex;B_(a,0)||(r.lastIndex=0);var s=W_(r,i);return B_(r.lastIndex,a)||(r.lastIndex=a),null===s?-1:s.index}]}));var z_=In,$_=qt,G_=jt,K_=Ft,V_=J,Q_=Sr,H_=mo,Y_=$i("splice"),J_=Math.max,X_=Math.min,Z_=9007199254740991,eS="Maximum allowed length exceeded";z_({target:"Array",proto:!0,forced:!Y_},{splice:function(e,t){var n,r,i,o,a,s,u=V_(this),c=K_(u.length),l=$_(e,c),f=arguments.length;if(0===f?n=r=0:1===f?(n=0,r=c-l):(n=f-2,r=X_(J_(G_(t),0),c-l)),c+n-r>Z_)throw TypeError(eS);for(i=Q_(u,r),o=0;o<r;o++)(a=l+o)in u&&H_(i,o,u[a]);if(i.length=r,n<r){for(o=l;o<c-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:delete u[s];for(o=c;o>c-r+n;o--)delete u[o-1]}else if(n>r)for(o=c-r;o>l;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:delete u[s];for(o=0;o<n;o++)u[o+l]=arguments[o+2];return u.length=c-r+n,i}}),function(e){var t=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Object.defineProperty(e,"__esModule",{value:!0});var n=sv.exports,r=dp.exports,i=mp.exports,o=uv.exports,a=hp.exports,s=yp.exports,u=gp.exports,c=pp.exports,l=lv.exports,f=fv,d=Pd.exports,p=Vc,h=xv.exports,v=fy.exports,y=Py,m=Gx.exports,g=Hx,b=A_.exports;function k(e){return e&&"object"===Ho(e)&&"default"in e?e:{default:e}}function w(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var x=k(n),_=k(r),S=k(i),E=k(o),T=k(a),I=k(s),R=k(u),O=k(c),A=k(l),C=k(f),P=k(d),M=w(h),j=w(v),L=k(m),N=w(b);function F(){}function D(){D.init.call(this)}function U(e){return void 0===e._maxListeners?D.defaultMaxListeners:e._maxListeners}function B(e,t,n){if(t)e.call(n);else for(var r=e.length,i=Q(e,r),o=0;o<r;++o)i[o].call(n)}function q(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=Q(e,i),a=0;a<i;++a)o[a].call(n,r)}function W(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=Q(e,o),s=0;s<o;++s)a[s].call(n,r,i)}function z(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=Q(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function $(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=Q(e,i),a=0;a<i;++a)o[a].apply(n,r)}function G(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new F,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=U(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function K(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function V(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Q(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}F.prototype=Object.create(null),D.EventEmitter=D,D.usingDomains=!1,D.prototype.domain=void 0,D.prototype._events=void 0,D.prototype._maxListeners=void 0,D.defaultMaxListeners=10,D.init=function(){this.domain=null,D.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new F,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},D.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},D.prototype.getMaxListeners=function(){return U(this)},D.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:B(n,l,this);break;case 2:q(n,l,this,arguments[1]);break;case 3:W(n,l,this,arguments[1],arguments[2]);break;case 4:z(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];$(n,l,this,i)}return!0},D.prototype.addListener=function(e,t){return G(this,e,t,!1)},D.prototype.on=D.prototype.addListener,D.prototype.prependListener=function(e,t){return G(this,e,t,!0)},D.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,K(this,e,t)),this},D.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,K(this,e,t)),this},D.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new F:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new F,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},D.prototype.off=function(e,t){return this.removeListener(e,t)},D.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new F,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new F:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new F,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},D.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},D.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):V.call(e,t)},D.prototype.listenerCount=V,D.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var H=M.getLogger("twilsock");function Y(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var J=function(){function e(t){O.default(this,e),A.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?" "+t+":":""}return _.default(e,[{key:"setLevel",value:function(e){H.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.trace.apply(null,Y("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.debug.apply(null,Y("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.info.apply(null,Y("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.warn.apply(null,Y("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.error.apply(null,Y("E",t))}}],[{key:"setLevel",value:function(e){H.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.trace.apply(null,Y("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.debug.apply(null,Y("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.info.apply(null,Y("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.warn.apply(null,Y("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];H.error.apply(null,Y("E",t))}}]),e}(),X=new J(""),Z="0.12.2",ee=function(){function e(t,n,r){O.default(this,e),A.default(this,"confirmedCapabilities",new Set),this.activeGrant=n,this._token=t;var i=r.region||"us1",o="wss://tsock.".concat(i,".twilio.com/v3/wsconnect"),a=r.twilsock||r.Twilsock||{};this.url=a.uri||o,this._continuationToken=r.continuationToken?r.continuationToken:null,this.logLevel=r.logLevel?r.logLevel:"error",this.retryPolicy=r.retryPolicy?r.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=r.clientMetadata?r.clientMetadata:{},this.clientMetadata.ver=Z,this.initRegistrations=r.initRegistrations?r.initRegistrations:null,this.tweaks=r.tweaks?r.tweaks:null}return _.default(e,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}}]),e}(),te=function e(t){O.default(this,e),this.id=t||"TM".concat(y.v4())};function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var re=function(e){T.default(n,e);var t=ne(n);function n(e,r,i,o,a){var s;return O.default(this,n),s=t.call(this),A.default(S.default(s),"method","init"),s.token=e,s.continuation_token=r,s.metadata=i,s.registrations=o,s.tweaks=a,s.capabilities=["client_update","offline_storage","telemetry.v1"],s}return n}(te);function ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var oe=function(e){T.default(n,e);var t=ie(n);function n(e,r,i,o,a,s,u){var c;return O.default(this,n),(c=t.call(this,e)).continuationToken=r,c.continuationTokenStatus=o,c.offlineStorage=a,c.initRegistrations=s,c.debugInfo=u,c.confirmedCapabilities=i,c}return n}(te);function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var se=function(e){T.default(n,e);var t=ae(n);function n(e){var r;return O.default(this,n),r=t.call(this),A.default(S.default(r),"method","update"),r.token=e,r}return n}(te);function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var ce=function(e){T.default(n,e);var t=ue(n);function n(e,r,i){var o;return O.default(this,n),o=t.call(this),A.default(S.default(o),"method","message"),o.active_grant=e,o.payload_type=r,o.http_request=i,o}return n}(te);function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var fe=function(e){T.default(n,e);var t=le(n);function n(e){var r;return O.default(this,n),r=t.call(this,e),A.default(S.default(r),"method","reply"),A.default(S.default(r),"payload_type","application/json"),A.default(S.default(r),"status",{code:200,status:"OK"}),r}return n}(te);function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var pe=function(e){T.default(n,e);var t=de(n);function n(){var e;return O.default(this,n),e=t.call(this),A.default(S.default(e),"method","close"),e}return n}(te);function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var ve=function e(t,n,r,i,o,a){O.default(this,e),this.start=t,this.end=n,this.title=r,this.details=i,this.id=o,this.type=a},ye=function(e){T.default(n,e);var t=he(n);function n(e){var r;return O.default(this,n),r=t.call(this),A.default(S.default(r),"method","telemetry.v1"),r.events=e,r}return n}(te);function me(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})).length}function ge(e){var t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,(function(e,t){n[t]=e.charCodeAt(0)})),n}function be(e){var t=Array.prototype.map.call(e,(function(e){return String.fromCharCode(e)})).join("").replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function ke(e){return JSON.parse(be(e))}var we=function(){function e(){O.default(this,e)}return _.default(e,null,[{key:"parse",value:function(e){var t,n,r=new Uint8Array(e),i=function(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(r);if("TWILSOCK"!==i.protocol||"V3.0"!==i.version)return X.error("unsupported protocol: ".concat(i.protocol," ver ").concat(i.version)),null;try{t=ke(r.subarray(i.size,i.size+i.headerSize))}catch(t){return X.error("failed to parse message header",t,e),null}if(X.debug("message received: ",t.method),X.trace("message received: ",t),t.payload_size>0){var o=2+i.size+i.headerSize,a=t.payload_size;if(t.hasOwnProperty("payload_type")&&0!==t.payload_type.indexOf("application/json"))0===t.payload_type.indexOf("text/plain")&&(n=be(r.subarray(o,o+a)));else try{n=ke(r.subarray(o,o+a))}catch(t){return X.error("failed to parse message body",t,e),null}}return{method:t.method,header:t,payload:n}}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=me(t);var n=JSON.stringify(e),r="TWILSOCK V3.0 "+me(n);X.debug("send request:",r+n+t);var i=ge(r+"\r\n"+n+"\r\n"+t);return i.buffer}}]),e}();function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var _e=function(e){T.default(n,e);var t=xe(n);function n(e){return O.default(this,n),t.call(this,e)}return n}(L.default(Error));function Se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Ee=function(e){T.default(n,e);var t=Se(n);function n(e,r){var i;return O.default(this,n),(i=t.call(this,e)).reply=r,i}return n}(_e);function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){A.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Oe=function(e){T.default(n,e);var t=Re(n);function n(e){var r;return O.default(this,n),r=t.call(this),A.default(S.default(r),"newBackoff",null),A.default(S.default(r),"usedBackoff",null),A.default(S.default(r),"retrier",null),r.options=e?Ie({},e):{},r}return _.default(n,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");var e,t;this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():null===(e=this.retrier)||void 0===e||e.failed(new Error):null===(t=this.retrier)||void 0===t||t.failed(new Error)}},{key:"cancel",value:function(){var e;null===(e=this.retrier)||void 0===e||e.cancel()}},{key:"cleanRetrier",value:function(){var e,t;null===(e=this.retrier)||void 0===e||e.removeAllListeners(),null===(t=this.retrier)||void 0===t||t.cancel(),this.retrier=null}},{key:"getRetryPolicy",value:function(){var e=Ie({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new g.Retrier(t),this.retrier.once("attempt",(function(){var t,n;null===(t=e.retrier)||void 0===t||t.on("attempt",(function(){return e.emit("attempt")})),null===(n=e.retrier)||void 0===n||n.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(function(t){return e.emit("failed",t)})),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}]),n}(D);function Ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Ce=function(e){T.default(i,e);var t,n,r=Ae(i);function i(e,t,n){var o;O.default(this,i),o=r.call(this),A.default(S.default(o),"disconnectingTimer",null),A.default(S.default(o),"disconnectedPromiseResolve",null),A.default(S.default(o),"terminalStates",["disconnected","rejected"]),A.default(S.default(o),"tokenExpiredSasCode",20104),A.default(S.default(o),"terminationReason","Connection is not initialized"),o.websocket=e,o.websocket.on("connected",(function(){return o.fsm.socketConnected()})),o.websocket.on("disconnected",(function(){return o.fsm.socketClosed()})),o.websocket.on("message",(function(e){return o.onIncomingMessage(e)})),o.websocket.on("socketError",(function(e){return o.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(e.message),httpStatusCode:null,errorCode:null})})),o.transport=t,o.config=n,o.retrier=new Oe(n.retryPolicy),o.retrier.on("attempt",(function(){return o.retry()})),o.retrier.on("failed",(function(e){X.warn("Retrying failed: ".concat(e.message)),o.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(function(){X.debug("Browser reported connectivity state: online"),o.resetBackoff(),o.fsm.systemOnline()})),window.addEventListener("offline",(function(){X.debug("Browser reported connectivity state: offline"),o.websocket.close(),o.fsm.socketClosed()})));var a=j.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){o.setupSocket(),o.emit("connecting")},onEnterInitialising:function(){o.sendInit()},onLeaveInitialising:function(){o.cancelInit()},onEnterUpdating:function(){o.sendUpdate()},onLeaveUpdating:function(){o.cancelUpdate()},onEnterRetrying:function(){o.initRetry(),o.emit("connecting")},onEnterConnected:function(){o.resetBackoff(),o.onConnected()},onUserUpdateToken:function(){o.resetBackoff()},onTokenRejected:function(){o.resetBackoff(),o.closeSocket(!0),o.finalizeSocket()},onUserDisconnect:function(){o.closeSocket(!0)},onEnterDisconnecting:function(){o.startDisconnectTimer()},onLeaveDisconnecting:function(){o.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){o.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){o.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){o.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){o.cancelDisconnectTimer()},onDisconnected:function(){o.resetBackoff(),o.finalizeSocket()},onReceiveClose:function(){o.onCloseReceived()},onReceiveOffload:function(e,t){X.debug("onreceiveoffload: ",t),o.modifyBackoff(t.body),o.onCloseReceived()},onUnsupported:function(){o.closeSocket(!0),o.finalizeSocket()},onError:function(e,t){o.closeSocket(t),o.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&o.changeState(e)},onInvalidTransition:function(e,t,n){X.warn("FSM: unexpected transition",t,n)}}});return o.fsm=new a,o}return _.default(i,[{key:"changeState",value:function(e){X.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){X.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){X.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var e=this;X.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((function(){X.debug("disconnecting is timed out"),e.closeSocket(!0)}),3e3)}},{key:"cancelDisconnectTimer",value:function(){X.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";default:return"disconnected"}}},{key:"initRetry",value:function(){X.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(X.trace("retry"),this.websocket.close(),this.fsm.userRetry()):X.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){X.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){X.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=we.parse(e);if(t){var n=t.method,r=t.header,i=t.payload;if("reply"!==n&&this.confirmReceiving(r),"notification"===n)this.emit("message",r.message_type,i);else if("reply"===r.method)this.transport.processReply({id:r.id,status:r.status,header:r,body:i});else if("client_update"===r.method)"token_about_to_expire"===r.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===r.method)if(308===r.status.code)X.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:r.status.status,body:i});else if(406===r.status.code){var o="Server closed connection because can't parse protocol: ".concat(JSON.stringify(r.status));this.emitReplyConnectionError(o,r,!0),X.error(o),this.fsm.receiveFatalClose()}else 417===r.status.code?(X.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose(r.status.status)):410===r.status.code?(X.warn("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status),this.emit("tokenExpired")):401===r.status.code?(X.error("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status)):(X.warn("unexpected message: ",r.status),this.fsm.receiveOffload({status:r.status.status,body:null}))}}},{key:"sendInit",value:(n=x.default(C.default.mark((function e(){var t,n;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.trace("sendInit"),e.prev=1,this.emit("beforeSendInit"),e.next=5,this.transport.sendInit();case 5:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.config.confirmedCapabilities=t.confirmedCapabilities,this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0 instanceof Ee?(n=!1,X.warn("Init rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),this.emit("sendInitFailed"),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.t0.message,e.t0.reply,n)):(this.terminationReason=e.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(e.t0.message,"\n").concat(JSON.stringify(e.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(){return n.apply(this,arguments)})},{key:"sendUpdate",value:(t=x.default(C.default.mark((function e(){var t,n,r;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.trace("sendUpdate"),t=new se(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:n=e.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof Ee?(r=!1,X.warn("Token update rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(r=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status),this.emitReplyConnectionError(e.t0.message,e.t0.reply,r)):(this.emit("error",!1,e.t0.message,null,null),this.fsm.updateError(e.t0)),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(){return t.apply(this,arguments)})},{key:"emitReplyConnectionError",value:function(e,t,n){var r=t.status&&t.status.description?t.status.description:e,i=t.status.code,o=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:"Connection error: ".concat(r),httpStatusCode:i,errorCode:o})}},{key:"cancelInit",value:function(){X.trace("cancelInit")}},{key:"cancelUpdate",value:function(){X.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){X.trace("confirmReceiving");try{this.transport.send(new fe(e.id))}catch(e){X.debug("failed to confirm packet receiving",e)}}},{key:"closeSocket",value:function(e){var t=this;X.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((function(){return t.fsm.socketClosed()}),0)}},{key:"connect",value:function(){X.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return X.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()}))}},{key:"updateToken",value:function(e){var t=this;return X.trace("updateToken:",e),new Promise((function(e,n){t.once("tokenUpdated",(function(t){t?n(t):e()})),t.fsm.userUpdateToken()}))}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(){this.websocket.close()}}]),i}(D),Pe=function(){function e(){O.default(this,e)}return _.default(e,null,[{key:"getMetadata",value:function(e){var t,n,r,i,o,a,s,u,c=e&&e.clientMetadata?e.clientMetadata:{},l={env:null!==(t=N.name)&&void 0!==t?t:"unknown",envv:null!==(n=N.version)&&void 0!==n?n:"unknown",os:null!==(r=null===(i=N.os)||void 0===i?void 0:i.family)&&void 0!==r?r:"unknown",osv:null!==(o=null===(a=N.os)||void 0===a?void 0:a.version)&&void 0!==o?o:"unknown",osa:null!==(s=null===(u=N.os)||void 0===u?void 0:u.architecture)&&void 0!==s?s:"unknown",sdk:"js-default"},f={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((function(e){return e in c||e in l})).forEach((function(e){return f[e]=e in c?c[e]:l[e]})),f}}]),e}();var Me=function(){function e(t,n){var r=this;O.default(this,e),this.config=n,this.activeRequests=new Map,this.channel=t,this.channel.on("reply",(function(e){return r.processReply(e)})),this.channel.on("disconnected",(function(){r.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new _e("disconnected"))})),r.activeRequests.clear()}))}var t;return _.default(e,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new Ee("Transport failure: "+e.status.status,e)),X.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout((function(){X.trace("request",e,"is timed out"),n(new _e("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,r)}},{key:"shutdown",value:function(){this.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new _e("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}},{key:"sendInit",value:(t=x.default(C.default.mark((function e(){var t,n,r;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.trace("sendInit"),t=Pe.getMetadata(this.config),n=new re(this.config.token,this.config.continuationToken,t,this.config.initRegistrations,this.config.tweaks),e.next=5,this.sendWithReply(n);case 5:return r=e.sent,e.abrupt("return",new oe(r.id,r.header.continuation_token,new Set(r.header.capabilities),r.header.continuation_token_status,r.header.offline_storage,r.header.init_registrations,r.header.debug_info));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sendClose",value:function(){var e=new pe;this.send(e)}},{key:"sendWithReply",value:function(e,t){var n=this;return new Promise((function(r,i){var o=n.send(e,t);n.storeRequest(o,r,i)}))}},{key:"send",value:function(e,t){e.id=e.id||"TM".concat(y.v4());var n=we.createPacket(e,function(e){switch(P.default(e)){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw X.debug("failed to send ",e,t),X.trace(t.stack),t}}}]),e}();function je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Le=function(e){T.default(r,e);var n=je(r);function r(e){var i;return O.default(this,r),i=n.call(this),A.default(S.default(i),"socket",null),i.url=e,i.url=e,i.WebSocket=t.WebSocket||t.MozWebSocket||{},i}return _.default(r,[{key:"isConnected",get:function(){return!!this.socket&&1===this.socket.readyState}},{key:"connect",value:function(){var e,t=this;X.trace("connecting to socket");try{e=new this.WebSocket(this.url)}catch(e){return X.debug("Socket error: ".concat(this.url)),void this.emit("socketError",e)}e.binaryType="arraybuffer",e.onopen=function(){X.debug("socket opened ".concat(t.url)),t.emit("connected")},e.onclose=function(e){X.debug("socket closed",e),t.emit("disconnected",e)},e.onerror=function(e){X.debug("Socket error:",e),t.emit("socketError",e)},e.onmessage=function(e){t.emit("message",e.data)},this.socket=e}},{key:"send",value:function(e){return this.socket&&this.socket.send(e)}},{key:"close",value:function(){if(X.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),r}(D);function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Fe=function(e){T.default(u,e);var t,n,r,i,o,a,s=Ne(u);function u(e){var t;return O.default(this,u),(t=s.call(this)).transport=e,t.registrations=new Map,t.registrationsInProgress=new Map,t}return _.default(u,[{key:"putNotificationContext",value:(a=x.default(C.default.mark((function e(t,n){var r;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(r,n);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"deleteNotificationContext",value:(o=x.default(C.default.mark((function e(t){var n;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"updateRegistration",value:(i=x.default(C.default.mark((function e(t,n){var r,i;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.debug("update registration for context",t),(r=this.registrationsInProgress.get(t))||(r=new Set,this.registrationsInProgress.set(t,r)),i=y.v4(),r.add(i),e.prev=5,e.next=8,this.putNotificationContext(t,n);case 8:X.debug("registration attempt succeeded for context",n),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),X.warn("registration attempt failed for context",n),X.debug(e.t0),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e,t){return i.apply(this,arguments)})},{key:"updateRegistrations",value:(r=x.default(C.default.mark((function e(){var t,n=this;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.trace("refreshing ".concat(this.registrations.size," registrations")),t=[],this.registrations.forEach((function(e,r){t.push(n.updateRegistration(r,e))})),e.next=5,Promise.all(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setNotificationsContext",value:(n=x.default(C.default.mark((function e(t,n){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}throw new _e("Invalid arguments provided");case 2:return this.registrations.set(t,n),e.next=5,this.updateRegistration(t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeNotificationsContext",value:(t=x.default(C.default.mark((function e(t){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(D);function De(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var Ue=function(e){T.default(n,e);var t=De(n);function n(e,r,i){var o;return O.default(this,n),(o=t.call(this,r)).status=e,o.description=r,o.body=i,o}return n}(_e);function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var qe=function(e){T.default(n,e);var t=Be(n);function n(e){return O.default(this,n),t.call(this,e)}return n}(_e);function We(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:{}};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map((function(e){return e.split("=")})).reduce((function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e}),{})}return n}throw new _e("Incorrect URI: "+e)}(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}function ze(e,t,n,r,i){return{to:We(e,t),headers:n,body:r,grant:i}}var $e=function(){function e(t,n,r){O.default(this,e),this.config=r,this.transport=t,this.pendingMessages=[],this.twilsock=n}var t;return _.default(e,[{key:"saveMessage",value:function(e){var t=this;return new Promise((function(n,r){var i={message:e,resolve:n,reject:r,alreadyRejected:!1,timeout:setTimeout((function(){X.debug("request is timed out"),r(new _e("request '".concat(e.to.method,"' to '").concat(e.to.host,"' timed out"))),i.alreadyRejected=!0}),2e4)};t.pendingMessages.push(i)}))}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var n=t.message;e.actualSend(n).then((function(e){return t.resolve(e)})).catch((function(e){return t.reject(e)})),clearTimeout(t.timeout)}catch(e){return X.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){var e=this;this.pendingMessages.forEach((function(t){t.reject(new qe("Unable to connect: "+e.twilsock.getTerminationReason)),t.alreadyRejected=!0,clearTimeout(t.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:(t=x.default(C.default.mark((function e(t){var n,r,i,o,a,s,u,c;return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.to,i=t.headers,o=t.body,a=null!==(n=t.grant)&&void 0!==n?n:this.config.activeGrant,s={host:r.host,path:r.path,method:r.method,params:r.params,headers:i},u=new ce(a,i["Content-Type"]||"application/json",s),X.trace("Sending upstream message",u),e.next=9,this.transport.sendWithReply(u,o);case 9:if(c=e.sent,X.trace("Received upstream message response",c),!((f=c)&&f.header&&f.header.http_status)||(l=c.header.http_status.code)>=200&&l<300){e.next=13;break}throw new Ue(c.header.http_status.code,c.header.http_status.status,c.body);case 13:return e.abrupt("return",{status:c.header.http_status,headers:c.header.http_headers,body:c.body});case 14:case"end":return e.stop()}var l,f}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new qe("Unable to connect: "+this.twilsock.getTerminationReason));var o=ze(e,t,n,r,i);return this.twilsock.isConnected?this.actualSend(o):this.saveMessage(o)}}]),e}(),Ge=function(){function e(){var t=this;O.default(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return _.default(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}(),Ke=function(){function e(t){O.default(this,e),this.id=t}return _.default(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new _e('Field "storage_id" is missing')}}]),e}(),Ve=function(){function e(){return O.default(this,e),A.default(this,"initializedFlag","twilio_twilsock_token_storage"),A.default(this,"tokenStoragePrefix","twilio_continuation_token_"),e._instance||(this.initialize(),e._instance=this),e._instance}return _.default(e,[{key:"sessionStorage",value:function(){try{return t.sessionStorage}catch(e){return null}}},{key:"window",value:function(){try{return t.window}catch(e){return null}}},{key:"storeToken",value:function(e,t){this.canStore()&&this.sessionStorage.setItem(this.getKeyName(t),e)}},{key:"getStoredToken",value:function(e){return this.canStore()?this.sessionStorage.getItem(this.getKeyName(e)):null}},{key:"initialize",value:function(){var e=this;if(this.canStore()){this.sessionStorage.getItem(this.initializedFlag)&&this.clear(),this.sessionStorage.setItem(this.initializedFlag,"true");var t=this.sessionStorage.removeItem;this.window.addEventListener("unload",(function(){t(e.initializedFlag)}))}}},{key:"clear",value:function(){if(this.canStore()){for(var e=[],t=0;t<this.sessionStorage.length;t++){var n=this.sessionStorage.key(t);n&&0===n.indexOf(this.tokenStoragePrefix)&&e.push(n)}var r=this.sessionStorage.removeItem;e.forEach((function(e){return r(e)})),r(this.initializedFlag)}}},{key:"getKeyName",value:function(e){return"".concat(this.tokenStoragePrefix).concat(e)}},{key:"canStore",value:function(){return!!(this.sessionStorage&&this.sessionStorage.length&&this.window)}}]),e}();A.default(Ve,"_instance",null);var Qe,He,Ye=new Ve,Je=function(){function e(t,n,r,i,o,a){O.default(this,e),this.title=t,this.details=n,this.start=r,this.type=o,this.id=a,this.end=i}return _.default(e,[{key:"toTelemetryEvent",value:function(){var e=new Date,t=this.start,n=this.end?this.end:e;if(n<t){var r=n;n=t,t=r}var i=t.getTime()-e.getTime(),o=n.getTime()-e.getTime();return new ve(i,o,this.title,this.details,this.id,this.type)}}]),e}();e.TelemetryPoint=void 0,(Qe=e.TelemetryPoint||(e.TelemetryPoint={}))[Qe.Start=0]="Start",Qe[Qe.End=1]="End",e.EventSendingLimitation=void 0,(He=e.EventSendingLimitation||(e.EventSendingLimitation={}))[He.MinEventsPortion=0]="MinEventsPortion",He[He.AnyEvents=1]="AnyEvents",He[He.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished";var Xe=function(){function t(e,n){O.default(this,t),A.default(this,"minEventsPortionToSend",50),A.default(this,"maxEventsPortionToSend",100),A.default(this,"pendingEvents",new Map),A.default(this,"readyEvents",[]),A.default(this,"hasInitializationFinished",!1),A.default(this,"_canSendTelemetry",!1),this.config=e,this.packetInterface=n}return _.default(t,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(t){X.debug("TelemetryTracker.canSendTelemetry: ".concat(t," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!t&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=t,t&&this.sendTelemetry(e.EventSendingLimitation.AnyEvents),t&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}},{key:"addPartialEvent",value:function(t,n,r){X.debug("Adding ".concat(r===e.TelemetryPoint.Start?"starting":"ending"," timepoint for '").concat(n,"' event"));var i=this.pendingEvents.has(n);if(r===e.TelemetryPoint.Start)i&&X.debug("Overwriting starting point for '".concat(n,"' event")),this.pendingEvents.set(n,t);else{if(!i)return void X.info("Could not find started event for '".concat(n,"' event"));this.addTelemetryEvent(this.merge(this.pendingEvents.get(n),t)),this.pendingEvents.delete(n)}}},{key:"getTelemetryToSend",value:function(t){return this.canSendTelemetry&&0!=this.readyEvents.length?t==e.EventSendingLimitation.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(t==e.EventSendingLimitation.AnyEventsIncludingUnfinished):[]}},{key:"getTelemetryPortion",value:function(e){var t=this,n=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),r=this.readyEvents.splice(0,n);return e&&r.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach((function(e,n){if(!(r.length>=t.maxEventsPortionToSend)){var i=t.pendingEvents.get(n);t.pendingEvents.delete(n),r.push(new Je("[UNFINISHED] ".concat(i.title),i.details,i.start,null,i.type,i.id))}})),r}},{key:"merge",value:function(e,t){return new Je(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(e.EventSendingLimitation.MinEventsPortion)}},{key:"sendTelemetry",value:function(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new ye(t.map((function(e){return e.toTelemetryEvent()}))))}catch(e){X.debug("Error while sending ".concat(t.length," telemetry events due to ").concat(e,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(t)}}}]),t}();function Ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R.default(e);if(t){var i=R.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I.default(this,n)}}var et=function e(){O.default(this,e)};A.default(et,"TWILSOCK_CONNECT","twilsock.sdk.connect"),A.default(et,"TWILSOCK_INIT","twilsock.sdk.init"),e.TwilsockClient=function(t){T.default(f,t);var n,r,i,o,a,s,u,c,l=Ze(f);function f(t,n,r){var i;O.default(this,f),i=l.call(this),A.default(S.default(i),"version",Z),A.default(S.default(i),"offlineStorageDeferred",new Ge),r.continuationToken=r.continuationToken?r.continuationToken:Ye.getStoredToken(n);var o=i.config=new ee(t,n,r);X.setLevel(o.logLevel);var a=new Le(o.url),s=new Me(a,o);return i.channel=new Ce(a,s,o),i.registrations=new Fe(s),i.upstream=new $e(s,i.channel,o),i.telemetryTracker=new Xe(o,s),i.channel.on("initialized",(function(){return i.telemetryTracker.canSendTelemetry=!0})),a.on("disconnected",(function(){return i.telemetryTracker.canSendTelemetry=!1})),i.registrations.on("registered",(function(e){return i.emit("registered",e)})),i.channel.on("message",(function(e,t){return setTimeout((function(){return i.emit("message",e,t)}),0)})),i.channel.on("stateChanged",(function(e){return setTimeout((function(){return i.emit("stateChanged",e)}),0)})),i.channel.on("connectionError",(function(e){return setTimeout((function(){return i.emit("connectionError",e)}),0)})),i.channel.on("tokenAboutToExpire",(function(){return setTimeout((function(){return i.emit("tokenAboutToExpire")}),0)})),i.channel.on("tokenExpired",(function(){return setTimeout((function(){return i.emit("tokenExpired")}),0)})),i.channel.on("connected",(function(){return i.registrations.updateRegistrations()})),i.channel.on("connected",(function(){return i.upstream.sendPendingMessages()})),i.channel.on("connected",(function(){return setTimeout((function(){return i.emit("connected")}),0)})),i.channel.on("beforeConnect",(function(){return i.telemetryTracker.addPartialEvent(new Je("Establish WebSocket connection","",new Date),et.TWILSOCK_CONNECT,e.TelemetryPoint.Start)})),i.channel.on("connected",(function(){return i.telemetryTracker.addPartialEvent(new Je("Establish WebSocket connection","",new Date,new Date),et.TWILSOCK_CONNECT,e.TelemetryPoint.End)})),i.channel.on("beforeSendInit",(function(){return i.telemetryTracker.addPartialEvent(new Je("Send Twilsock init","",new Date),et.TWILSOCK_INIT,e.TelemetryPoint.Start)})),i.channel.on("initialized",(function(){return i.telemetryTracker.addPartialEvent(new Je("Send Twilsock init","Succeeded",new Date,new Date),et.TWILSOCK_INIT,e.TelemetryPoint.End)})),i.channel.on("sendInitFailed",(function(){return i.telemetryTracker.addPartialEvent(new Je("Send Twilsock init","Failed",new Date,new Date),et.TWILSOCK_INIT,e.TelemetryPoint.End)})),i.channel.on("initialized",(function(e){i.handleStorageId(n,e),Ye.storeToken(e.continuationToken,n),setTimeout((function(){return i.emit("initialized",e)}),0)})),i.channel.on("disconnected",(function(){return setTimeout((function(){return i.emit("disconnected")}),0)})),i.channel.on("disconnected",(function(){return i.upstream.rejectPendingMessages()})),i.channel.on("disconnected",(function(){return i.offlineStorageDeferred.fail(new _e("Client disconnected"))})),i.offlineStorageDeferred.promise.catch((function(){})),i}return _.default(f,[{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return X.debug("Emitting ".concat(e.toString(),"(").concat(r.map((function(e){return JSON.stringify(e)})).join(", "),")")),(t=E.default(R.default(f.prototype),"emit",this)).call.apply(t,[this,e].concat(r))}},{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(Ke.create(t.offlineStorage[e])),X.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(n){this.offlineStorageDeferred.fail(new _e("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(n,".")))}else this.offlineStorageDeferred.fail(new _e("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new _e("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:(c=x.default(C.default.mark((function e(t){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(X.trace("updating token '".concat(t,"'")),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.next=6,this.channel.updateToken(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"setNotificationsContext",value:(u=x.default(C.default.mark((function e(t,n){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.setNotificationsContext(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"removeNotificationsContext",value:(s=x.default(C.default.mark((function e(t){return C.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.removeNotificationsContext(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:(a=x.default(C.default.mark((function t(){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEventsIncludingUnfinished),t.next=3,this.channel.disconnect();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"get",value:(o=x.default(C.default.mark((function t(n,r,i){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("GET",n,r,void 0,i);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"post",value:(i=x.default(C.default.mark((function t(n,r,i,o){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("POST",n,r,i,o);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"put",value:(r=x.default(C.default.mark((function t(n,r,i,o){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("PUT",n,r,i,o);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"delete",value:(n=x.default(C.default.mark((function t(n,r,i,o){return C.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),t.next=3,this.upstream.send("DELETE",n,r,i,o);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"addTelemetryEvent",value:function(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(t,n,r){this.telemetryTracker.addPartialEvent(t,n,r),r===e.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),f}(D),e.TwilsockClient=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":P.default(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([p.validateConstructorTypes(p.nonEmptyString,p.nonEmptyString,[p.pureObject,"undefined",p.literal(null)]),function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":P.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[String,String,Object])],e.TwilsockClient);var tt=function(){function e(t){O.default(this,e),this.product=t,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}return _.default(e,[{key:"populateInitRegistrations",value:function(e){var t=new Set(this.message_types);for(var n in e)t.add(e[n]);this.message_types=Array.from(t)}}]),e}();e.InitRegistration=tt,e.TelemetryEventDescription=Je,e.TelemetryTracker=Xe,e.TransportUnavailableError=qe,e.Twilsock=e.TwilsockClient,e.TwilsockError=_e}(av);var tS=function(){function e(t){zo(this,e),this.base=t,this.args=new Array,this.paths=new Array}return Go(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();function nS(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function rS(e,t,n){return rS=nS()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Vo(i,n.prototype),i},rS.apply(null,arguments)}function iS(e){var t="function"==typeof Map?new Map:void 0;return iS=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return rS(e,arguments,Jo(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Vo(r,e)},iS(e)}function oS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}var aS=function(e){Qo(n,e);var t=oS(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return zo(this,n),(r=t.call(this)).name=r.constructor.name,r.message="".concat(e," (status: ").concat(i,", code: ").concat(o,")"),r.status=i,r.code=o,r}return Go(n)}(iS(Error)),sS=function(e){Qo(n,e);var t=oS(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;return zo(this,n),(r=t.call(this,e,i,o)).body=a,r}return Go(n)}(aS),uS=In,cS=a,lS=I("JSON","stringify"),fS=/[\uD800-\uDFFF]/g,dS=/^[\uD800-\uDBFF]$/,pS=/^[\uDC00-\uDFFF]$/,hS=function(e,t,n){var r=n.charAt(t-1),i=n.charAt(t+1);return dS.test(e)&&!pS.test(i)||pS.test(e)&&!dS.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},vS=cS((function(){return'"\\udf06\\ud834"'!==lS("\udf06\ud834")||'"\\udead"'!==lS("\udead")}));function yS(e){return JSON.parse(JSON.stringify(e))}function mS(e){if(!(void 0===e||gS(e)))throw new aS("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function gS(e){return function(e){return!isNaN(parseInt(e))&&isFinite(e)}(e)&&e>0}lS&&uS({target:"JSON",stat:!0,forced:vS},{stringify:function(e,t,n){var r=lS.apply(null,arguments);return"string"==typeof r?r.replace(fS,hS):r}});var bS=xv.exports.getLogger("twilio-sync");function kS(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}var wS=function(e){bS.setLevel(e)},xS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];bS.trace.apply(null,kS("T",t))},_S=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];bS.debug.apply(null,kS("D",t))},SS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];bS.warn.apply(null,kS("W",t))},ES=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];bS.error.apply(null,kS("E",t))},TS="/v4/Subscriptions",IS="/v3/Maps",RS="/v3/Lists",OS="/v3/Documents",AS="/v3/Streams",CS="/v3/Insights";function PS(e,t,n){return e&&void 0!==e[t]?e[t]:n}var MS=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};zo(this,e);var n=t.region||"us1",r="https://cds.".concat(n,".twilio.com"),i=t.cdsUri||r;this.settings={subscriptionsUri:i+TS,documentsUri:i+OS,listsUri:i+RS,mapsUri:i+IS,streamsUri:i+AS,insightsUri:i+CS,sessionStorageEnabled:PS(t.Sync,"enableSessionStorage",!0),productId:t.productId}}return Go(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();function jS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function LS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return jS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jS(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var NS=s,FS=a,DS=An,US=tn,BS=u,qS=J,WS=b,zS=Object.assign,$S=Object.defineProperty,GS=!zS||FS((function(){if(NS&&1!==zS({b:1},zS($S({},"a",{enumerable:!0,get:function(){$S(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=zS({},e)[n]||DS(zS({},t)).join("")!=r}))?function(e,t){for(var n=qS(e),r=arguments.length,i=1,o=US.f,a=BS.f;r>i;)for(var s,u=WS(arguments[i++]),c=o?DS(u).concat(o(u)):DS(u),l=c.length,f=0;l>f;)s=c[f++],NS&&!a.call(u,s)||(n[s]=u[s]);return n}:zS,KS=GS;function VS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return QS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return QS(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function QS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}In({target:"Object",stat:!0,forced:Object.assign!==KS},{assign:KS});var HS=function(){function e(t){zo(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return Go(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new aS("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"setSubscriptionState",value:function(e){this.localObject._setSubscriptionState(e)}}]),e}(),YS=function(){function e(t){var n=this;zo(this,e),Xo(this,"isConnected",!1),Xo(this,"maxBatchSize",100),Xo(this,"subscriptionTtlTimer",null),Xo(this,"pendingPokeReason",null),this.services=t,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=R_.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),_S("All subscriptions resolved."))}))}var t;return Go(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i,o=[],a=VS(e);try{for(a.s();!(i=a.n()).done;){var s=LS(i.value,2),u=s[0],c=s[1];if(!t.get(u)&&n!==c.pendingAction&&!c.rejectedWithError&&(o.push(c),r&&o.length>=r))break}}catch(e){a.e(e)}finally{a.f()}return o}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:(t=Wo(zc.mark((function e(t,n){var r,i,o,a,s,u,c,l,f,d,p,h,v=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return _S("Twilsock connection (required for subscription) not ready; waitingâ¦"),this.backoff.reset(),e.abrupt("return");case 4:n=this.processLocalActions(t,n),r=(new Date).getTime(),i=VS(n);try{for(i.s();!(o=i.n()).done;)a=o.value,this.recordActionAttemptOn(a,t,r)}catch(e){i.e(e)}finally{i.f()}return s=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=10,e.next=13,this.request(t,r,s,n);case 13:u=e.sent,c=u.body.max_batch_size,!isNaN(parseInt(c))&&isFinite(c)&&c>0&&(this.maxBatchSize=c),this.subscriptionTtlTimer||(l=u.body.ttl_in_s,!isNaN(parseFloat(l))&&isFinite(l)&&l>0&&(this.subscriptionTtlTimer=setTimeout((function(){return v.onSubscriptionTtlElapsed()}),1e3*l))),"establish"===t&&(f=u.body.estimated_delivery_in_ms,!isNaN(parseFloat(f))&&isFinite(f)&&f>0?setTimeout((function(){return v.verifyPokeDelivery(r,f,n)}),f):ES("Invalid timeout: ".concat(f)),n.filter((function(e){return e.pendingCorrelationId===r})).forEach((function(e){return e.setSubscriptionState("response_in_flight")}))),this.backoff.reset(),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(10),d=VS(n);try{for(d.s();!(p=d.n()).done;)h=p.value,this.recordActionFailureOn(h,t)}catch(e){d.e(e)}finally{d.f()}e.t0 instanceof av.TransportUnavailableError?(_S("Twilsock connection (required for subscription) not ready (c:".concat(r,"); waitingâ¦")),this.backoff.reset()):(_S("Failed an attempt to ".concat(t," subscriptions (c:").concat(r,"); retrying"),e.t0),this.persist());case 26:case"end":return e.stop()}}),e,this,[[10,21]])}))),function(e,n){return t.apply(this,arguments)})},{key:"verifyPokeDelivery",value:function(e,t,n){var r=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),o=i?(new Date).getTime()-i:t;o>=t?(n.filter((function(t){return t.pendingCorrelationId===e})).forEach((function(e){e.updatePending(null,null),e.retryCount++,r.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout((function(){return r.verifyPokeDelivery(e,t,n)}),t-o)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter((function(e){return!e.rejectedWithError})):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}},{key:"recordActionFailureOn",value:function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n,r){var i=r.map((function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}})),o=r.filter((function(e){return e.retryCount>0})).length;_S("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var a={event_protocol_version:4,action:e,correlation_id:t,retried_requests:o,ttl_in_s:-1,requests:i};return"ttl"===n&&(a.reason=n),this.services.network.post(this.services.config.subscriptionsUri,a)}},{key:"add",value:function(e,t){_S("Establishing intent to subscribe to ".concat(e));var n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new HS(t)),this.persist())}},{key:"remove",value:function(e){_S("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){xS("Subscriptions received",e);var n=e.event_type,r=void 0!==e.events?e.events:[e.event],i=e.correlation_id;i&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(i,(new Date).getTime());var o,a=VS(r);try{for(a.s();!(o=a.n()).done;){var s=o.value,u=void 0;switch(e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(s,i);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(s,i);break;case"subscription_failed":this.applySubscriptionFailedMessage(s,i);break;case(u=n.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:var c=void 0;switch(u[0]){case"map_":c=s.map_sid;break;case"list_":c=s.list_sid;break;case"document_":c=s.document_sid;break;case"stream_":c=s.stream_sid;break;case"live_query_":c=s.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:c=void 0}this.applyEventToSubscribedEntity(c,s,n,t);break;default:_S("Dropping unknown message type ".concat(n))}}}catch(e){a.e(e)}finally{a.f()}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(_S("Event Replay for subscription to ".concat(n," (c:").concat(t,") interrupted; continuing eagerly.")),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(_S("Event Replay for subscription to ".concat(n," (c:").concat(t,") completed. Subscription is ready.")),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):_S("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):_S("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(ES("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,n,r){if(e){var i;r=r||(i=this.persisted.get(e))&&i.isEstablished;var o=this.subscriptions.get(e);o?(t.type=n,o.update(t,r)):_S("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){_S("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t,n=[],r=VS(this.persisted.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.reset(),i.rejectedWithError&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}this.persisted.clear();for(var o=0,a=n;o<a.length;o++){var s=a[o];this.persisted.set(s.sid,s)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();function JS(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function XS(e){return e.body?e.body.code:0}function ZS(e){return 409===e.status?new sS(JS(e),e.status,XS(e),e.body):e.status?new aS(JS(e),e.status,XS(e)):e instanceof av.TransportUnavailableError?e:new aS(e.message,0,0)}var eE=function(){function e(t,n,r){zo(this,e),this.clientInfo=t,this.config=n,this.transport=r}return Go(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+Py.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){var o=[502,503,504];n&&o.push(429);var a=new O_(t.backoffConfig());a.on("attempt",(function(){e().then((function(e){return a.succeeded(e)})).catch((function(e){if(o.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);a.failed(ZS(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?a.failed(ZS(e)):(a.removeAllListeners(),a.cancel(),i(ZS(e)))}))})),a.on("succeeded",(function(e){r(e)})),a.on("cancelled",(function(e){return i(ZS(e))})),a.on("failed",(function(e){return i(ZS(e))})),a.start()}))}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return _S("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.get(e,n,t.config.productId)}),!0)}},{key:"post",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.createHeaders();return null!=n&&(o["If-Match"]=n),_S("POST",e,"ID:",o["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.post(e,o,t,r.config.productId)}),i)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return null!=n&&(i["If-Match"]=n),_S("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.put(e,i,t,r.config.productId)}),!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return _S("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.delete(e,n,t.config.productId)}),!1)}}]),e}(),tE=function(){function e(t,n){zo(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(e){}}return Go(e,[{key:"storageKey",value:function(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}}]),e}();function nE(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Jo(e)););return e}function rE(){return rE="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=nE(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},rE.apply(this,arguments)}function iE(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return oE(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oE(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function oE(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var aE=function(){function e(t,n){zo(this,e),this.services=t,this.removalHandler=n,this.subscriptionState="none",this._attachedListeners=new Map}return Go(e,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}},{key:"_subscribe",value:function(){this.services.router._subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router._unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}},{key:"detach",value:function(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,o=iE(this._attachedListeners.values());try{for(o.s();!(i=o.n()).done;){var a=i.value;a.emit.apply(a,[e].concat(n))}}catch(e){o.e(e)}finally{o.f()}}}]),e}(),sE=function(){function e(t){zo(this,e),Xo(this,"queuedRequests",[]),Xo(this,"isRequestInFlight",!1),this.inputMergingFunction=t}return Go(e,[{key:"add",value:function(e,t){var n=this,r=new Promise((function(r,i){return n.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:i})}));return this.wakeupQueue(),r}},{key:"squashAndAdd",value:function(e,t){var n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map((function(e){return e.input})).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach((function(e){return i.then(e.resolve,e.reject)})),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then((function(t){e.isRequestInFlight=!1,e.wakeupQueue()}))}}}]),e}(),uE=function(){function e(t){zo(this,e),Xo(this,"queueByNamespaceKey",new Map),this.inputReducer=t}var t,n,r;return Go(e,[{key:"add",value:(r=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.add(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"squashAndAdd",value:(n=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.squashAndAdd(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"invokeQueueMethod",value:(t=Wo(zc.mark((function e(t,n){var r,i;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new sE(this.inputReducer)),r=this.queueByNamespaceKey.get(t),i=n(r),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),cE={};Object.defineProperty(cE,"__esModule",{value:!0});var lE=pp.exports,fE=dp.exports,dE=mp.exports,pE=uv.exports,hE=hp.exports,vE=yp.exports,yE=gp.exports,mE=lv.exports;function gE(e){return e&&"object"===Ho(e)&&"default"in e?e:{default:e}}var bE=gE(up.exports),kE=gE(lE),wE=gE(fE),xE=gE(dE),_E=gE(pE),SE=gE(hE),EE=gE(vE),TE=gE(yE),IE=gE(mE);function RE(){}function OE(){OE.init.call(this)}function AE(e){return void 0===e._maxListeners?OE.defaultMaxListeners:e._maxListeners}function CE(e,t,n){if(t)e.call(n);else for(var r=e.length,i=UE(e,r),o=0;o<r;++o)i[o].call(n)}function PE(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=UE(e,i),a=0;a<i;++a)o[a].call(n,r)}function ME(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=UE(e,o),s=0;s<o;++s)a[s].call(n,r,i)}function jE(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=UE(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}function LE(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=UE(e,i),a=0;a<i;++a)o[a].apply(n,r)}function NE(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new RE,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=AE(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function FE(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function DE(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function UE(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function BE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=TE.default(e);if(t){var i=TE.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return EE.default(this,n)}}RE.prototype=Object.create(null),OE.EventEmitter=OE,OE.usingDomains=!1,OE.prototype.domain=void 0,OE.prototype._events=void 0,OE.prototype._maxListeners=void 0,OE.defaultMaxListeners=10,OE.init=function(){this.domain=null,OE.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new RE,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},OE.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},OE.prototype.getMaxListeners=function(){return AE(this)},OE.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:CE(n,l,this);break;case 2:PE(n,l,this,arguments[1]);break;case 3:ME(n,l,this,arguments[1],arguments[2]);break;case 4:jE(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];LE(n,l,this,i)}return!0},OE.prototype.addListener=function(e,t){return NE(this,e,t,!1)},OE.prototype.on=OE.prototype.addListener,OE.prototype.prependListener=function(e,t){return NE(this,e,t,!0)},OE.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,FE(this,e,t)),this},OE.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,FE(this,e,t)),this},OE.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new RE:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new RE,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},OE.prototype.off=function(e,t){return this.removeListener(e,t)},OE.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new RE,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new RE:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new RE,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},OE.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},OE.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):DE.call(e,t)},OE.prototype.listenerCount=DE,OE.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var qE=function(e){SE.default(n,e);var t=BE(n);function n(){var e;return kE.default(this,n),e=t.call(this),IE.default(xE.default(e),"eventHistory",new Map),e}return wE.default(n,[{key:"on",value:function(e,t){return _E.default(TE.default(n.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return _E.default(TE.default(n.prototype),"once",this).call(this,e,t)}},{key:"off",value:function(e,t){return _E.default(TE.default(n.prototype),"off",this).call(this,e,t)}},{key:"emit",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return this.eventHistory.set(e,i),(t=_E.default(TE.default(n.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}},{key:"addListener",value:function(e,t){return _E.default(TE.default(n.prototype),"addListener",this).call(this,e,t)}},{key:"removeListener",value:function(e,t){return _E.default(TE.default(n.prototype),"removeListener",this).call(this,e,t)}},{key:"addListenerWithReplay",value:function(e,t){var n=this.eventHistory.get(e);return void 0!==n&&t.apply(void 0,bE.default(n)),this.addListener(e,t)}},{key:"onWithReplay",value:function(e,t){return this.addListenerWithReplay(e,t)}},{key:"onceWithReplay",value:function(e,t){var r=this.eventHistory.get(e);return void 0!==r?(t.apply(void 0,bE.default(r)),this):_E.default(TE.default(n.prototype),"once",this).call(this,e,t)}}]),n}(OE),WE=cE.ReplayEventEmitter=qE;function zE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}var $E=function(e){Qo(n,e);var t=zE(n);function n(){var e;return zo(this,n),(e=t.call(this)).closed=!1,e.uuid=Py.v4(),e}return Go(n,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),n}(WE);function GE(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}var KE=function(e){Qo(f,e);var t,n,r,i,o,a,s,u,c,l=GE(f);function f(e,t,n){var r;zo(this,f),Xo(Ko(r=l.call(this,e,n)),"isDeleted",!1);return r.updateMergingQueue=new sE((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.descriptor=t,r.descriptor.data=r.descriptor.data||{},r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return Go(f,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":if(e.id<=this.lastEventId){xS("Document update skipped, current:",this.lastEventId,", remote:",e.id);break}var t=void 0!==this.descriptor.data?yS(this.descriptor.data):null;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{data:e.document_data,isLocal:!1,previousData:t}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data});break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:(c=Wo(zc.mark((function e(t,n){var r,i=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(r,(function(e){return i._setUnconditionally(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"mutate",value:(u=Wo(zc.mark((function e(t,n){var r,i=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.add(r,(function(e){return i._setWithIfMatch(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"update",value:(s=Wo(zc.mark((function e(t,n){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate((function(e){return Object.assign(e,t)}),n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"setTtl",value:(a=Wo(zc.mark((function e(t){var n;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({ttl:t});case 2:n=e.sent,this.descriptor.date_expires=n.date_expires;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_setUnconditionally",value:(o=Wo(zc.mark((function e(t,n){var r;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:n});case 2:return r=e.sent,this._handleSuccessfulUpdateResult(r),e.abrupt("return",this.descriptor.data);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"_setWithIfMatch",value:(i=Wo(zc.mark((function e(t,n){var r,i,o;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t(yS(this.descriptor.data)))){e.next=22;break}return i=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:r,revision:i,ttl:n});case 6:return o=e.sent,this._handleSuccessfulUpdateResult(o),e.abrupt("return",this.descriptor.data);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.descriptor.data);case 23:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_handleSuccessfulUpdateResult",value:function(e){if(!(e.last_event_id<=this.descriptor.last_event_id)){var t=void 0!==this.descriptor.data?yS(this.descriptor.data):null;this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:t})}}},{key:"_postUpdateToServer",value:(r=Wo(zc.mark((function e(t){var n,r,i;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return n={data:t.data},void 0!==t.ttl&&(n.ttl=t.ttl),r=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,n,r);case 7:return i=e.sent,e.abrupt("return",{revision:i.body.revision,data:t.data,last_event_id:i.body.last_event_id,date_updated:i.body.date_updated,date_expires:i.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.reject(new aS("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return r.apply(this,arguments)})},{key:"_softSync",value:(n=Wo(zc.mark((function e(){var t=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then((function(e){var n={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(n),t})).catch((function(e){404===e.status?t.onRemoved(!1):ES("Can't get updates for ".concat(t.sid,":"),e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onRemoved",value:function(e){if(!this.isDeleted){var t=void 0!==this.descriptor.data?yS(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e,previousData:t})}}},{key:"removeDocument",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",Promise.reject(new aS("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"document"}}]),f}(aE),VE=function(e){Qo(s,e);var t,n,r,i,o,a=GE(s);function s(e){var t;return zo(this,s),(t=a.call(this)).syncDocumentImpl=e,t.syncDocumentImpl.attach(Ko(t)),t}return Go(s,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return KE.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:(o=Wo(zc.mark((function e(t,n){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.set(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"mutate",value:(i=Wo(zc.mark((function e(t,n){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.mutate(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"update",value:(r=Wo(zc.mark((function e(t,n){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.update(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setTtl",value:(n=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeDocument",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){rE(Jo(s.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return KE.type}}]),s}($E);Xo(VE,"removed","removed"),Xo(VE,"updated","updated"),Gc([ov(rv,["undefined",nv("document metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object,Object]),Kc("design:returntype",Promise)],VE.prototype,"set",null),Gc([ov("function",["undefined",nv("document metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Function,Object]),Kc("design:returntype",Promise)],VE.prototype,"mutate",null),Gc([ov(rv,["undefined",nv("document metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object,Object]),Kc("design:returntype",Promise)],VE.prototype,"update",null),Gc([ov(tv),Kc("design:type",Function),Kc("design:paramtypes",[Number]),Kc("design:returntype",Promise)],VE.prototype,"setTtl",null);var QE=function(){function e(t){zo(this,e),this.descriptor=t}return Go(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(e,t,n,r){return this.descriptor.lastEventId=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.dateUpdated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.dateExpires=e}}]),e}(),HE=function(){function e(t,n,r,i){zo(this,e),this.prevToken=r,this.nextToken=i,this.items=t,this.source=n}var t,n;return Go(e,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:(n=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"prevPage",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function YE(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return JE(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return JE(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function JE(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var XE=function(){function e(t,n){zo(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return Go(e,[{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}]),e}(),ZE=function(e){function t(e,n){zo(this,t),this.isLessThan=e||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return Go(t,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new XE(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,o=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(o))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var o=r||i;n||o?n&&!o?this.root=o:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var a=t.left;a.right;)a=a.right;if(t.left===a)t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!0};else{var s=a.parent,u=a.left;s.right=u,u&&(u.parent=s),t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.left=t.left,a.left.parent=a,a.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:Symbol.iterator,value:zc.mark((function e(){var t,n,r;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=YE(this.getIterator()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"getIterator",value:zc.mark((function e(){var t,n,r,i=arguments;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.left)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)||null===t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.right){e.next=21;break}for(n=n.right;n.left;)n=n.left;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.left===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.left===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))},{key:"getReverseIterator",value:zc.mark((function e(){var t,n,r,i=arguments;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.right)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)&&null!==t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.left){e.next=21;break}for(n=n.left;n.right;)n=n.right;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.right===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.right===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))}]),t}();function eT(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return tT(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tT(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function tT(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var nT=function(){function e(t,n){zo(this,e),this.value=t,this.revision=n||0}return Go(e,[{key:"isValid",get:function(){return!0}}]),e}(),rT=function(){function e(t){zo(this,e),this.revision=t}return Go(e,[{key:"isValid",get:function(){return!1}}]),e}(),iT=function(){function e(){zo(this,e),this.items=new ZE}return Go(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new nT(t,n)),t)}},{key:"delete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.items.get(e);(!r||r.revision<t||r&&!0===n)&&this.items.set(e,new rT(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}},{key:"forEach",value:function(e){if(this.items){var t,n=eT(this.items);try{for(n.s();!(t=n.n()).done;){var r=LS(t.value,2),i=r[0],o=r[1];o.isValid&&e(i,o.value)}}catch(e){n.e(e)}finally{n.f()}}}}]),e}();function oT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}var aT=function(e){Qo(y,e);var t,n,r,i,o,a,s,u,c,l,f,d,p,h,v=oT(y);function y(e,t,n){var r;zo(this,y);return(r=v.call(this,e,n)).updateMergingQueue=new uE((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new iT,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return Go(y,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:(h=Wo(zc.mark((function e(t,n,r,i){var o,a;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={data:n},void 0!==i&&(o.ttl=i),e.next=4,this.services.network.post(t,o,r);case 4:return(a=e.sent).body.data=n,a.body.date_updated=new Date(a.body.date_updated),e.abrupt("return",a.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"push",value:(p=Wo(zc.mark((function e(t,n){var r,i,o;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).ttl,e.next=3,this._addOrUpdateItemOnServer(this.links.items,t,void 0,r);case 3:return i=e.sent,o=Number(i.index),this._handleItemMutated(o,i.url,i.last_event_id,i.revision,t,i.date_updated,i.date_expires,!0,!1),e.abrupt("return",this.cache.get(o));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"set",value:(d=Wo(zc.mark((function e(t,n,r){var i,o=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return o._updateItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"_updateItemUnconditionally",value:(f=Wo(zc.mark((function e(t,n,r){var i,o;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return i=e.sent,e.next=5,this._addOrUpdateItemOnServer(i.uri,n,void 0,r);case 5:return o=e.sent,this._handleItemMutated(t,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"_updateItemWithIfMatch",value:(l=Wo(zc.mark((function e(t,n,r){var i,o,a,s;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(i=e.sent,!(o=n(yS(i.data)))){e.next=25;break}return a=i.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(i.uri,o,a,r);case 9:return s=e.sent,this._handleItemMutated(t,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,n,r));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=Wo(zc.mark((function e(t,n,r){var i,o=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return o._updateItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(s=Wo(zc.mark((function e(t){var n,r,i;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=yS(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:function(){var e=Wo(zc.mark((function e(t){var n;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(a=Wo(zc.mark((function e(t){var n;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new aS("No item with index ".concat(t," found"),404,54151);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"queryItems",value:function(){var e=Wo(zc.mark((function e(t){var n,r,i,o,a=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new tS(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.index)?a._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(Number(e.index),new QE({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,data:e.data}),e.last_event_id),a.cache.get(e.index)})),o=r.body.meta,e.abrupt("return",new HE(i,(function(e){return a.queryItems({pageToken:e})}),o.previous_token,o.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(o=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return mS((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getContext",value:(i=Wo(zc.mark((function e(){var t;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setTtl",value:(r=Wo(zc.mark((function e(t){var n,r;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Wo(zc.mark((function e(t,n){var r,i,o;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:o=e.sent,r.updateDateExpires(o.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,o,a,s,u){if(this.shouldIgnoreEvent(e,n))xS("Item ".concat(e," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(n));else{this._updateRootDateUpdated(o);var c=this.cache.get(e);if(!c){var l=new QE({index:e,uri:t,lastEventId:n,revision:r,data:i,dateUpdated:o,dateExpires:a});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=yS(c.data);c.update(n,r,i,o),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",o={item:e,isLocal:!t};n||(o.previousItemData=r),this.broadcastEventToListeners(i,o)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,previousItemData:n})}},{key:"_handleContextUpdate",value:function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(xS("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}],[{key:"type",get:function(){return"list"}}]),y}(aE),sT=function(e){Qo(p,e);var t,n,r,i,o,a,s,u,c,l,f,d=oT(p);function p(e){var t;return zo(this,p),(t=d.call(this)).syncListImpl=e,t.syncListImpl.attach(Ko(t)),t}return Go(p,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return aT.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:(f=Wo(zc.mark((function e(t,n){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.push(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"set",value:(l=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(s=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:(a=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getContext",value:(o=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getItems",value:(i=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Wo(zc.mark((function e(t,n){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){rE(Jo(p.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return aT.type}}]),p}($E);Xo(sT,"itemAdded","itemAdded"),Xo(sT,"itemUpdated","itemUpdated"),Xo(sT,"itemRemoved","itemRemoved"),Xo(sT,"removed","removed"),Gc([ov(rv,["undefined",nv("item metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object,Object]),Kc("design:returntype",Promise)],sT.prototype,"push",null),Gc([ov(tv,rv,["undefined",nv("item metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Number,Object,Object]),Kc("design:returntype",Promise)],sT.prototype,"set",null),Gc([ov(tv,"function",["undefined",nv("item metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Number,Function,Object]),Kc("design:returntype",Promise)],sT.prototype,"mutate",null),Gc([ov(tv,rv,["undefined",nv("item metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Number,Object,Object]),Kc("design:returntype",Promise)],sT.prototype,"update",null),Gc([ov(tv),Kc("design:type",Function),Kc("design:paramtypes",[Number]),Kc("design:returntype",Promise)],sT.prototype,"remove",null),Gc([ov(tv),Kc("design:type",Function),Kc("design:paramtypes",[Number]),Kc("design:returntype",Promise)],sT.prototype,"get",null),Gc([ov(["undefined",nv("query options",{from:[tv,"undefined"],pageSize:[Xh((function(e){return[gS(e),"a positive integer"]})),"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],sT.prototype,"getItems",null),Gc([ov(tv),Kc("design:type",Function),Kc("design:paramtypes",[Number]),Kc("design:returntype",Promise)],sT.prototype,"setTtl",null),Gc([ov(tv,tv),Kc("design:type",Function),Kc("design:paramtypes",[Number,Number]),Kc("design:returntype",Promise)],sT.prototype,"setItemTtl",null);var uT=function(){function e(t){zo(this,e),this.descriptor=t}return Go(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}}]),e}();function cT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}var lT=function(e){Qo(h,e);var t,n,r,i,o,a,s,u,c,l,f,d,p=cT(h);function h(e,t,n){var r;zo(this,h);return(r=p.call(this,e,n)).updateMergingQueue=new uE((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new iT,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),t.items&&t.items.forEach((function(e){e.date_updated=new Date(e.date_updated),r.cache.store(e.key,new uT(e),e.last_event_id)})),r}return Go(h,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:(d=Wo(zc.mark((function e(t,n,r){var i,o=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return o._putItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"get",value:function(){var e=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new aS("SyncMapItem key may not be empty",400,54209);case 2:if(!this.cache.has(t)){e.next=6;break}return e.abrupt("return",this.cache.get(t));case 6:return e.abrupt("return",this._getItemFromServer(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(f=Wo(zc.mark((function e(t){var n;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new aS("The specified Map Item does not exist",404,54201);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"mutate",value:(l=Wo(zc.mark((function e(t,n,r){var i,o=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return o._putItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"update",value:(c=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"_putItemUnconditionally",value:(u=Wo(zc.mark((function e(t,n,r){var i,o;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,n,void 0,r);case 2:return i=e.sent,o=i.item,this._handleItemMutated(o.key,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,i.added,!1),e.abrupt("return",this.cache.get(o.key));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"_putItemWithIfMatch",value:(s=Wo(zc.mark((function e(t,n,r){var i,o,a,s,u;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch((function(e){if(404===e.status)return new uT({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e}));case 2:if(i=e.sent,!(o=n(yS(i.data)))){e.next=26;break}return a=i.revision,e.prev=6,e.next=9,this._putItemToServer(t,o,a,r);case 9:return s=e.sent,u=s.item,this._handleItemMutated(u.key,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,s.added,!1),e.abrupt("return",this.cache.get(u.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,n,r));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e,t,n){return s.apply(this,arguments)})},{key:"_putItemToServer",value:(a=Wo(zc.mark((function e(t,n,r,i){var o,a,s,u,c;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new tS(this.links.items).pathSegment(t).build(),a={data:n},void 0!==i&&(a.ttl=i),e.prev=3,e.next=6,this.services.network.put(o,a,r);case 6:return s=e.sent,(u=s.body).data=n,u.date_updated=new Date(u.date_updated),c=201===s.status.code,e.abrupt("return",{added:c,item:u});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"remove",value:(o=Wo(zc.mark((function e(t){var n,r,i;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=yS(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"queryItems",value:function(){var e=Wo(zc.mark((function e(t){var n,r,i,o,a=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new tS(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.key)?a._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(e.key,new uT(e),e.last_event_id),a.cache.get(e.key)})),o=r.body.meta,e.abrupt("return",new HE(i,(function(e){return a.queryItems({pageToken:e})}),o.previous_token,o.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(i=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return mS((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,o,a,s,u){if(this.shouldIgnoreEvent(e,n))xS("SyncMapItem ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(o);var c=this.cache.get(e);if(!c){var l=new uT({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:o,date_expires:a});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=yS(c.data);c.update(n,r,i,o),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",o={item:e,isLocal:!t};n||(o.previousItemData=r),this.broadcastEventToListeners(i,o)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,previousItemData:n})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"setTtl",value:(r=Wo(zc.mark((function e(t){var n,r;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Wo(zc.mark((function e(t,n){var r,i,o;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:o=e.sent,r.updateDateExpires(o.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"map"}}]),h}(aE),fT=function(e){Qo(f,e);var t,n,r,i,o,a,s,u,c,l=cT(f);function f(e){var t;return zo(this,f),(t=l.call(this)).syncMapImpl=e,t.syncMapImpl.attach(Ko(t)),t}return Go(f,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return lT.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:(c=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"get",value:(u=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"mutate",value:(s=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"update",value:(a=Wo(zc.mark((function e(t,n,r){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"remove",value:(o=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getItems",value:(i=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=Wo(zc.mark((function e(t,n){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.next=3,this.syncMapImpl.removeMap();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){rE(Jo(f.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return lT.type}}]),f}($E);function dT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}Xo(fT,"itemAdded","itemAdded"),Xo(fT,"itemUpdated","itemUpdated"),Xo(fT,"itemRemoved","itemRemoved"),Xo(fT,"removed","removed"),Gc([ov("string",rv,["undefined",nv("item metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[String,Object,Object]),Kc("design:returntype",Promise)],fT.prototype,"set",null),Gc([ov("string"),Kc("design:type",Function),Kc("design:paramtypes",[String]),Kc("design:returntype",Promise)],fT.prototype,"get",null),Gc([ov("string","function",["undefined",nv("item metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[String,Function,Object]),Kc("design:returntype",Promise)],fT.prototype,"mutate",null),Gc([ov("string",rv,["undefined",nv("item metadata",{ttl:[tv,"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[String,Object,Object]),Kc("design:returntype",Promise)],fT.prototype,"update",null),Gc([ov("string"),Kc("design:type",Function),Kc("design:paramtypes",[String]),Kc("design:returntype",Promise)],fT.prototype,"remove",null),Gc([ov(["undefined",nv("query options",{from:["string","undefined"],pageSize:[Xh((function(e){return[gS(e),"a positive integer"]})),"undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],fT.prototype,"getItems",null),Gc([ov(tv),Kc("design:type",Function),Kc("design:paramtypes",[Number]),Kc("design:returntype",Promise)],fT.prototype,"setTtl",null),Gc([ov("string",tv),Kc("design:type",Function),Kc("design:paramtypes",[String,Number]),Kc("design:returntype",Promise)],fT.prototype,"setItemTtl",null);var pT=function(e){Qo(o,e);var t,n,r,i=dT(o);function o(e,t,n){var r;return zo(this,o),(r=i.call(this,e,n)).descriptor=t,r}return Go(o,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:(r=Wo(zc.mark((function e(t){var n,r,i,o;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.next=3,this.services.network.post(this.links.messages,n);case 3:return r=e.sent,i=r.body,o=this._handleMessagePublished(i.sid,t,!1),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=Wo(zc.mark((function e(t){var n,r;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,n){var r={sid:e,data:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}],[{key:"type",get:function(){return"stream"}}]),o}(aE);Gc([ov(rv),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],pT.prototype,"publishMessage",null),Gc([ov(tv),Kc("design:type",Function),Kc("design:paramtypes",[Number]),Kc("design:returntype",Promise)],pT.prototype,"setTtl",null);var hT=function(e){Qo(o,e);var t,n,r,i=dT(o);function o(e){var t;return zo(this,o),(t=i.call(this)).syncStreamImpl=e,t.syncStreamImpl.attach(Ko(t)),t}return Go(o,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return pT.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:(r=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.publishMessage(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){rE(Jo(o.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return pT.type}}]),o}($E);Xo(hT,"messagePublished","messagePublished"),Xo(hT,"removed","removed"),Gc([ov(rv),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],hT.prototype,"publishMessage",null),Gc([ov(tv),Kc("design:type",Function),Kc("design:paramtypes",[Number]),Kc("design:returntype",Promise)],hT.prototype,"setTtl",null);var vT=Go((function e(t){zo(this,e),this.sdk="js",this.sdkVer=t,this.os=A_.exports.os.family,this.osVer=A_.exports.os.version,this.pl=A_.exports.name,this.plVer=A_.exports.version})),yT=function(){function e(){zo(this,e),this.names=new Map,this.entities=new Map}return Go(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();function mT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}var gT=Go((function e(){zo(this,e)})),bT=function(e){Qo(n,e);var t=mT(n);function n(e,r,i,o){var a;return zo(this,n),(a=t.call(this,r,i)).descriptor=e,a.cache=new iT,o&&o.forEach((function(e){a.cache.store(e.key,{key:e.key,value:e.data},e.revision)})),a}return Go(n,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return n.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var e={};return this.cache.forEach((function(t,n){e[t]=n.value})),e}},{key:"_update",value:function(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}},{key:"handleItemMutated",value:function(e,t,n){if(this.shouldIgnoreEvent(e,n))xS("Item ".concat(e," update skipped, revision: ").concat(n));else{var r={key:e,value:t};this.cache.store(e,r,n),this.broadcastEventToListeners("itemUpdated",r)}}},{key:"handleItemRemoved",value:function(e,t){var n=null===t;this.shouldIgnoreEvent(e,t)?xS("Item ".concat(e," delete skipped, revision: ").concat(t)):(this.cache.delete(e,t,n),this.broadcastEventToListeners("itemRemoved",{key:e}))}},{key:"handleBatchUpdate",value:function(e){var t=this,n={};for(var r in null!=e&&e.forEach((function(e){n[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach((function(e,r){var i=n[e];null!=i?t.handleItemMutated(e,i.data,i.revision):t.handleItemRemoved(e,null),delete n[e]})),n)this.handleItemMutated(r,n[r].data,n[r].revision)}},{key:"shouldIgnoreEvent",value:function(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}}],[{key:"type",get:function(){return"live_query"}}]),n}(aE);function kT(e){return wT.apply(this,arguments)}function wT(){return wT=Wo(zc.mark((function e(t){var n,r,i,o,a,s;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.network,r=t.queryString,i=t.uri,o=t.type,null!=r){e.next=3;break}throw new aS("Invalid query",400,54507);case 3:return a={query_string:r},o===xT.type&&(a.type=o),e.next=7,n.post(i,a,void 0,!0);case 7:return s=e.sent,e.abrupt("return",s.body);case 9:case"end":return e.stop()}}),e)}))),wT.apply(this,arguments)}var xT=function(e){Qo(n,e);var t=mT(n);function n(e){var r;return zo(this,n),(r=t.call(this)).liveQueryImpl=e,r.liveQueryImpl.attach(Ko(r)),r}return Go(n,[{key:"type",get:function(){return bT.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){rE(Jo(n.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return bT.type}}]),n}($E);Xo(xT,"itemUpdated","itemUpdated"),Xo(xT,"itemRemoved","itemRemoved");var _T=function(e){Qo(i,e);var t,n,r=mT(i);function i(e){var t;return zo(this,i),Xo(Ko(t=r.call(this)),"queryExpression",null),Xo(Ko(t),"items",{}),Object.assign(Ko(t),e),t.updateIndexName(e.indexName),t}return Go(i,[{key:"type",get:function(){return i.type}},{key:"search",value:(n=Wo(zc.mark((function e(t){var n=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.items={},e.abrupt("return",kT({network:this.network,uri:this.queryUri,queryString:t}).then((function(e){n.queryExpression=t,e.items&&e.items.forEach((function(e){n.items[e.key]=e.data})),n.emit("searchResult",n.getItems())})).catch((function(e){throw ES("Error '".concat(e.message,"' while executing query '").concat(t,"'")),n.queryExpression=null,e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"subscribe",value:(t=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.queryExpression){e.next=2;break}return e.abrupt("return",Promise.reject(new aS("Invalid query",400,54507)));case 2:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(e){this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(e){return new tS(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),i}(WE);Xo(_T,"searchResult","searchResult"),Gc([ov("string"),Kc("design:type",Function),Kc("design:paramtypes",[String]),Kc("design:returntype",Promise)],_T.prototype,"search",null),Gc([iv(ev),Kc("design:type",Function),Kc("design:paramtypes",[String]),Kc("design:returntype",void 0)],_T.prototype,"updateIndexName",null);function ST(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jo(e);if(t){var i=Jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yo(this,n)}}function ET(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function TT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ET(Object(n),!0).forEach((function(t){Xo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ET(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var IT="data_sync",RT="3.2.2";function OT(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};var t=e.mode||(e.id?"open_or_create":"create_new");return TT(TT({},e),{},{mode:t})}return{mode:"create_new"}}var AT="com.twilio.rtd.cds.document",CT="com.twilio.rtd.cds.list",PT="com.twilio.rtd.cds.map",MT="twilio.sync.event",Client=function(e){Qo(Client,e);var t,n,r,i,o,a,s,u,c,l,f,d,p,h,v,y=ST(Client);function Client(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(zo(this,Client),n=y.call(this),!e)throw new Error("Sync library needs a valid Twilio token to be passed");r.hasOwnProperty("logLevel")?wS(r.logLevel):wS("silent");var i=r.productId=r.productId||IT;r.clientMetadata=r.clientMetadata||{},r.clientMetadata.hasOwnProperty("type")||(r.clientMetadata.type="sync"),r.clientMetadata.hasOwnProperty("sdk")||(r.clientMetadata.sdk="JS",r.clientMetadata.sdkv=RT);var o=!r.twilsockClient;if(!r.initRegistrations){var a=new av.InitRegistration(i);Client.populateInitRegistrations(a),r.initRegistrations=[a]}var s=r.twilsockClient=null!==(t=r.twilsockClient)&&void 0!==t?t:new av.Twilsock(e,i,r);s.on("tokenAboutToExpire",(function(){return n.emit("tokenAboutToExpire")})),s.on("tokenExpired",(function(){return n.emit("tokenExpired")})),s.on("connectionError",(function(e){return n.emit("connectionError",e)})),s.on("stateChanged",(function(e){n.emit("connectionStateChanged",e),n.services.subscriptions.onConnectionStateChanged("connected"===e)})),s.on("message",(function(e,t){return n._routeMessage(e,t)}));var u=new MS(r),c=new eE(new vT(RT),u,s),l=new tE(u);return n.services={config:u,twilsock:s,network:c,storage:l,router:Ko(n),subscriptions:null},n.services.subscriptions=new YS(n.services),n.entities=new yT,o&&s.connect(),n}return Go(Client,[{key:"_routeMessage",value:function(e,t){switch(xS("Notification type:",e,"content:",t),e){case AT:case CT:case PT:this.services.subscriptions.acceptMessage(t,!1);break;case MT:this.services.subscriptions.acceptMessage(t,!0)}}},{key:"_subscribe",value:function(e,t){this.services.subscriptions.add(e,t)}},{key:"_unsubscribe",value:function(e){this.services.subscriptions.remove(e)}},{key:"connectionState",get:function(){return this.services.twilsock.state}},{key:"ensureReady",value:(v=Wo(zc.mark((function e(){var t;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),SS("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(){return v.apply(this,arguments)})},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=yS(n);e!==sT.type&&e!==fT.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:(h=Wo(zc.mark((function e(t,n){var r,i,o,a=arguments;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]&&a[2],n){e.next=3;break}throw new aS("Cannot get entity without id",404);case 3:return i=new tS(t).pathSegment(n).queryParam("Include",r?"items":void 0).build(),e.next=6,this.services.network.get(i);case 6:return o=e.sent,e.abrupt("return",o.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"_createDocument",value:function(e,t,n){var r={unique_name:e,data:t||{}};return void 0!==n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then((function(e){return e.body.data=r.data,e.body}))}},{key:"_getDocument",value:(p=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(VE.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_createList",value:function(e,t,n,r){var i={unique_name:e,purpose:t,context:n};return void 0!==r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then((function(e){return e.body}))}},{key:"_getList",value:(d=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(sT.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_createMap",value:function(e,t){var n={unique_name:e};return void 0!==t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then((function(e){return e.body}))}},{key:"_getMap",value:(f=Wo(zc.mark((function e(t){var n,r=arguments;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",this.readRootFromSessionCache(fT.type,t)||this._get(this.services.config.mapsUri,t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_getStream",value:(l=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(hT.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_createStream",value:(c=Wo(zc.mark((function e(t,n){var r,i;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={unique_name:t},void 0!==n&&(r.ttl=n),e.next=4,this.services.network.post(this.services.config.streamsUri,r);case 4:return i=e.sent,e.abrupt("return",i.body);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"_getLiveQuery",value:function(e){return this.readRootFromSessionCache(xT.type,e)}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:(u=Wo(zc.mark((function e(t){var n,r,i,o,a=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=OT(t)).mode){e.next=9;break}return e.next=6,this._createDocument(n.id,n.data,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,VE.type))){e.next=14;break}return e.abrupt("return",new VE(i));case 14:return e.prev=14,e.next=17,this._getDocument(n.id);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createDocument(n.id,n.data,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.document(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(VE.type,n.id,r),o=new KE(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),o=this.entities.store(o),e.abrupt("return",new VE(o));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return u.apply(this,arguments)})},{key:"map",value:(s=Wo(zc.mark((function e(t){var n,r,i,o,a=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=OT(t)).mode){e.next=9;break}return e.next=6,this._createMap(n.id,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,fT.type))){e.next=14;break}return e.abrupt("return",new fT(i));case 14:return e.prev=14,e.next=17,this._getMap(n.id,n.includeItems);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createMap(n.id,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.map(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(fT.type,n.id,r),o=new lT(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),o=this.entities.store(o),e.abrupt("return",new fT(o));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return s.apply(this,arguments)})},{key:"list",value:(a=Wo(zc.mark((function e(t){var n,r,i,o,a=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=OT(t)).mode){e.next=9;break}return e.next=6,this._createList(n.id,n.purpose,n.context,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,sT.type))){e.next=14;break}return e.abrupt("return",new sT(i));case 14:return e.prev=14,e.next=17,this._getList(n.id);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createList(n.id,n.purpose,n.context,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.list(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(sT.type,n.id,r),o=new aT(this.services,r,(function(e,t,n){return a.removeFromCacheAndSession(e,t,n)})),o=this.entities.store(o),e.abrupt("return",new sT(o));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return a.apply(this,arguments)})},{key:"stream",value:(o=Wo(zc.mark((function e(t){var n,r,i,o,a,s=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=OT(t)).mode){e.next=9;break}return e.next=6,this._createStream(n.id,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,hT.type))){e.next=14;break}return e.abrupt("return",new hT(i));case 14:return e.prev=14,e.next=17,this._getStream(n.id);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createStream(n.id,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.stream(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(hT.type,n.id,r),o=function(e,t,n){return s.removeFromCacheAndSession(e,t,n)},a=new pT(this.services,r,o),a=this.entities.store(a),e.abrupt("return",new hT(a));case 44:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return o.apply(this,arguments)})},{key:"shutdown",value:(i=Wo(zc.mark((function e(){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateToken",value:(r=Wo(zc.mark((function e(t){return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.twilsock.updateToken(t).catch((function(e){var t,n=null==e||null===(t=e.reply)||void 0===t?void 0:t.status;if(401===(null==n?void 0:n.code)&&"UNAUTHORIZED"===(null==n?void 0:n.status))throw new aS("Updated token was rejected by server",400,51130);throw e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"liveQuery",value:(n=Wo(zc.mark((function e(t,n){var r,i,o,a,s,u=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return r=new tS(this.services.config.insightsUri).pathSegment(t).pathSegment("Items").build(),e.next=5,kT({network:this.services.network,uri:r,queryString:n,type:xT.type});case 5:return i=e.sent,(o=this.getCached(i.query_id,xT.type))||((a=this._getLiveQuery(i.query_id))||(a={indexName:t,queryExpression:n,sid:i.query_id,queryUri:r,last_event_id:i.last_event_id}),s=function(e,t,n){return u.removeFromCacheAndSession(e,t,n)},o=new bT(a,this.services,s,i.items)),this.storeRootInSessionCache(xT.type,i.query_id,o.liveQueryDescriptor),o=this.entities.store(o),e.abrupt("return",new xT(o));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"instantQuery",value:(t=Wo(zc.mark((function e(t){var n,r=this;return zc.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return n=function(e,t){return r.liveQuery(e,t)},e.abrupt("return",new _T({indexName:t,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:n}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"populateInitRegistrations",value:function(e){e.populateInitRegistrations([MT,AT,CT,PT])}},{key:"version",get:function(){return RT}}]),Client}(WE);return Xo(Client,"connectionStateChanged","connectionStateChanged"),Xo(Client,"connectionError","connectionError"),Xo(Client,"tokenAboutToExpire","tokenAboutToExpire"),Xo(Client,"tokenExpired","tokenExpired"),Gc([ov(["undefined","string",nv("open document options",{id:["string","undefined"],mode:[Zh("open_or_create","open_existing","create_new"),"undefined"],ttl:[tv,"undefined"],data:[rv,"undefined",Zh(null)]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],Client.prototype,"document",null),Gc([ov(["undefined","string",nv("open map options",{id:["string","undefined"],mode:[Zh("open_or_create","open_existing","create_new"),"undefined"],ttl:[tv,"undefined"],data:[rv,"undefined",Zh(null)],includeItems:["boolean","undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],Client.prototype,"map",null),Gc([ov(["undefined","string",nv("open list options",{id:["string","undefined"],mode:[Zh("open_or_create","open_existing","create_new"),"undefined"],ttl:[tv,"undefined"],data:[rv,"undefined",Zh(null)],purpose:["string","undefined"],context:[rv,"undefined"],includeItems:["boolean","undefined"]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],Client.prototype,"list",null),Gc([ov(["undefined","string",nv("open stream options",{id:["string","undefined"],mode:[Zh("open_or_create","open_existing","create_new"),"undefined"],ttl:[tv,"undefined"],data:[rv,"undefined",Zh(null)]})]),Kc("design:type",Function),Kc("design:paramtypes",[Object]),Kc("design:returntype",Promise)],Client.prototype,"stream",null),Gc([ov(ev),Kc("design:type",Function),Kc("design:paramtypes",[String]),Kc("design:returntype",Promise)],Client.prototype,"updateToken",null),Gc([ov(ev,"string"),Kc("design:type",Function),Kc("design:paramtypes",[String,String]),Kc("design:returntype",Promise)],Client.prototype,"liveQuery",null),Gc([ov(ev),Kc("design:type",Function),Kc("design:paramtypes",[String]),Kc("design:returntype",Promise)],Client.prototype,"instantQuery",null),e.Client=Client,e.InsightsItem=gT,e.InstantQuery=_T,e.LiveQuery=xT,e.Paginator=HE,e.SyncClient=Client,e.SyncDocument=VE,e.SyncList=sT,e.SyncListItem=QE,e.SyncMap=fT,e.SyncMapItem=uT,e.SyncStream=hT,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
