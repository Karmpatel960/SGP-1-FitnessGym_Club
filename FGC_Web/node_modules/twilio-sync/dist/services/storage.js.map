{"version":3,"file":"storage.js","sources":["../../src/services/storage.ts"],"sourcesContent":["import { Configuration, Storage } from '../interfaces/services';\n\ninterface StorageBackend {\n  setItem(key: string, value: string): void;\n\n  getItem(key: string): string;\n\n  removeItem(key: string): void;\n}\n\nclass SessionStorage implements Storage {\n  private readonly config: Configuration;\n  private readonly storage: StorageBackend;\n  private storageId: string;\n\n  constructor(config: Configuration, storage?: StorageBackend) {\n    this.config = config;\n    this.storageId = null;\n    try {\n      this.storage = storage || sessionStorage;\n    } catch (e) {\n    }\n  }\n\n  private storageKey(type: string, key: string) {\n    return `${this.storageId}::${type}::${key}`;\n  }\n\n  private get isReady(): boolean {\n    return this.config.sessionStorageEnabled && !!this.storageId;\n  }\n\n  updateStorageId(storageId: string) {\n    this.storageId = storageId;\n  }\n\n  store(type: string, id: string, value: Object) {\n    if (!this.isReady) {\n      return null;\n    }\n    return this._store(this.storageKey(type, id), value);\n  }\n\n  read(type: string, id: string): Object {\n    if (!this.isReady) {\n      return null;\n    }\n    return this._read(this.storageKey(type, id));\n  }\n\n  remove(type: string, sid: string, uniqueName: string): void {\n    if (!this.isReady) {\n      return null;\n    }\n    try {\n      this.storage.removeItem(this.storageKey(type, sid));\n      if (uniqueName) {\n        this.storage.removeItem(this.storageKey(type, uniqueName));\n      }\n    } catch (e) {\n    }\n  }\n\n  update(type: string, sid: string, uniqueName: string, patch: Object): void {\n    if (!this.isReady) {\n      return null;\n    }\n    // Currently cache may have root stored twice - by sid and by uniqueName\n    // Maybe need to create some index if needed\n    this._apply(this.storageKey(type, sid), patch);\n    if (uniqueName) {\n      this._apply(this.storageKey(type, uniqueName), patch);\n    }\n  }\n\n  private _store(key: string, value: Object) {\n    try {\n      this.storage.setItem(key, JSON.stringify(value));\n    } catch (e) {\n    }\n  }\n\n  private _read(key: string): Object {\n    try {\n      let storedData = this.storage.getItem(key);\n      if (storedData) {\n        return JSON.parse(storedData);\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  private _apply(key: string, patch: any): boolean {\n    let value = this._read(key);\n    if (!value) {\n      return false;\n    }\n    this._store(key, Object.assign(value, patch));\n  }\n}\n\nexport { StorageBackend, SessionStorage };\n"],"names":[],"mappings":"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"}