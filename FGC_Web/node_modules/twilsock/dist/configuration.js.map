{"version":3,"file":"configuration.js","sources":["../src/configuration.ts"],"sourcesContent":["import { LogLevelDesc } from \"loglevel\";\nimport { version } from \"../package.json\";\nimport type { ClientOptionsType } from \"./client\";\nimport { InitRegistration } from \"./protocol/initregistration\";\n\nexport type RetryPolicyType = {\n  min: number;\n  max: number;\n  initial?: number;\n  maxAttemptsCount?: number;\n  maxAttemptsTime?: number;\n  randomness?: number;\n};\n\n/**\n * Settings container for the Twilsock client library\n */\nclass Configuration {\n  private _token: string;\n  private _continuationToken: string | null;\n  public confirmedCapabilities: Set<string> = new Set<string>();\n\n  public readonly retryPolicy: RetryPolicyType;\n  public readonly url: string;\n  public readonly activeGrant: string;\n  public readonly logLevel: LogLevelDesc;\n  public readonly clientMetadata: Record<string, unknown>;\n  public readonly initRegistrations: InitRegistration[] | null;\n  public readonly tweaks: Record<string, unknown> | null;\n\n  /**\n   * @param {String} token - authentication token\n   * @param {Object} options - options to override defaults\n   */\n  constructor(\n    token: string,\n    activeGrant: string,\n    options: Partial<ClientOptionsType>\n  ) {\n    this.activeGrant = activeGrant;\n    this._token = token;\n\n    const region = options.region || \"us1\";\n    const defaultTwilsockUrl = `wss://tsock.${region}.twilio.com/v3/wsconnect`;\n\n    const twilsockOptions = options.twilsock || options.Twilsock || {};\n    this.url = twilsockOptions.uri || defaultTwilsockUrl;\n\n    this._continuationToken = options.continuationToken\n      ? options.continuationToken\n      : null;\n\n    this.logLevel = options.logLevel ? options.logLevel : \"error\";\n\n    this.retryPolicy = options.retryPolicy\n      ? options.retryPolicy\n      : {\n          min: 1 * 1000,\n          max: 2 * 60 * 1000,\n          randomness: 0.2,\n        };\n\n    this.clientMetadata = options.clientMetadata ? options.clientMetadata : {};\n    this.clientMetadata.ver = version;\n\n    this.initRegistrations = options.initRegistrations\n      ? options.initRegistrations\n      : null;\n\n    this.tweaks = options.tweaks ? options.tweaks : null;\n  }\n\n  public get token(): string {\n    return this._token;\n  }\n\n  public get continuationToken(): string | null {\n    return this._continuationToken;\n  }\n\n  public updateToken(token: string): void {\n    this._token = token;\n  }\n\n  public updateContinuationToken(continuationToken: string): void {\n    this._continuationToken = continuationToken;\n  }\n}\n\nexport { Configuration };\n"],"names":["version"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcA;;;AAGA,MAAM,aAAa;;;;;IAiBjB,YACE,KAAa,EACb,WAAmB,EACnB,OAAmC;QAjB9B,0BAAqB,GAAgB,IAAI,GAAG,EAAU,CAAC;QAmB5D,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QAEpB,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,IAAI,KAAK,CAAC;QACvC,MAAM,kBAAkB,GAAG,eAAe,MAAM,0BAA0B,CAAC;QAE3E,MAAM,eAAe,GAAG,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,IAAI,EAAE,CAAC;QACnE,IAAI,CAAC,GAAG,GAAG,eAAe,CAAC,GAAG,IAAI,kBAAkB,CAAC;QAErD,IAAI,CAAC,kBAAkB,GAAG,OAAO,CAAC,iBAAiB;cAC/C,OAAO,CAAC,iBAAiB;cACzB,IAAI,CAAC;QAET,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,GAAG,OAAO,CAAC;QAE9D,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,WAAW;cAClC,OAAO,CAAC,WAAW;cACnB;gBACE,GAAG,EAAE,CAAC,GAAG,IAAI;gBACb,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,IAAI;gBAClB,UAAU,EAAE,GAAG;aAChB,CAAC;QAEN,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC,cAAc,GAAG,OAAO,CAAC,cAAc,GAAG,EAAE,CAAC;QAC3E,IAAI,CAAC,cAAc,CAAC,GAAG,GAAGA,gBAAO,CAAC;QAElC,IAAI,CAAC,iBAAiB,GAAG,OAAO,CAAC,iBAAiB;cAC9C,OAAO,CAAC,iBAAiB;cACzB,IAAI,CAAC;QAET,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC;KACtD;IAED,IAAW,KAAK;QACd,OAAO,IAAI,CAAC,MAAM,CAAC;KACpB;IAED,IAAW,iBAAiB;QAC1B,OAAO,IAAI,CAAC,kBAAkB,CAAC;KAChC;IAEM,WAAW,CAAC,KAAa;QAC9B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;KACrB;IAEM,uBAAuB,CAAC,iBAAyB;QACtD,IAAI,CAAC,kBAAkB,GAAG,iBAAiB,CAAC;KAC7C;;;;;"}